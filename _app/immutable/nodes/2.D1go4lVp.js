import{f as j,g as A,s as tt,a as y,b as ne,d as ve,e as Qe,r as da}from"../chunks/DscdaUK8.js";import{i as me}from"../chunks/tUnkN8nb.js";import{c as je,a as Be,o as Ae,b as va}from"../chunks/DX2lUfdR.js";import{e as ye,u as k,aN as fa,N as Me,a9 as Te,V as pa,r as ba,aO as ma,v as _e,a as t,a7 as h,ac as U,s as i,C as Tt,ad as xe,z as r,A as o,y as s,w as lt,x as he,aa as te,aP as Pe,aQ as ke,d as Le,ae as _a}from"../chunks/CtXWJ4Rl.js";import{i as gt}from"../chunks/j1nT2hqj.js";import{s as be,b as ie,c as Ue,a as fe,j as ha,k as De,m as oe,n as sa,o as Ze,q as ga,u as ya,w as wa,f as Ne,v as pe,x as xa,y as Ea,z as Sa,g as za,h as ka,i as We}from"../chunks/Cr3u1VxF.js";import ja from"../chunks/DN3J-sCw.js";import qa from"../chunks/BKbm5EfA.js";import $a from"../chunks/BvbcL8L1.js";import Ca from"../chunks/CpqWQj0X.js";import Ma from"../chunks/CMBHzUVU.js";import La from"../chunks/BNFRKsyx.js";import Ta from"../chunks/CvpCKVSJ.js";import Aa from"../chunks/DKqRZLee.js";import Ra from"../chunks/e1t1TJwC.js";import Pa from"../chunks/pOAIlSuq.js";import Da from"../chunks/CDr_-IW6.js";import Ia from"../chunks/DkwgWrlg.js";import Na from"../chunks/BdPnv_Ww.js";import Oa from"../chunks/Wp1az9L3.js";import Ba from"../chunks/BozMgj6L.js";import Ua from"../chunks/ChEK7k_d.js";import Ha from"../chunks/BT5hMKdo.js";import Va from"../chunks/DZg2n5Gj.js";import Fa from"../chunks/B--_m8y4.js";import Ka from"../chunks/BPfJ8Mnp.js";import Ya from"../chunks/BbyHsVxX.js";import Ga from"../chunks/D1dfjzr5.js";import Wa from"../chunks/sTVjfoeb.js";import Xa from"../chunks/BJv4UY2l.js";import Ja from"../chunks/DqmJETbX.js";import Za from"../chunks/Dbr1vHU4.js";import Qa from"../chunks/DIrtYIXF.js";import tn from"../chunks/ZuxV2OeQ.js";import en from"../chunks/BBQehyBW.js";import an from"../chunks/CTUHu1i9.js";import nn from"../chunks/DgcN0BtG.js";import on from"../chunks/D89J0wRi.js";import rn from"../chunks/D3GOXJB7.js";import ln from"../chunks/KMlGcXzU.js";import sn from"../chunks/hyOVM0Ug.js";import cn from"../chunks/D_zlzWZC.js";import un from"../chunks/DBEQdhVc.js";import dn from"../chunks/Kieb5-lA.js";import vn from"../chunks/nEnXKinN.js";import fn from"../chunks/t4Dmsr4x.js";import pn from"../chunks/CXnItg8R.js";import bn from"../chunks/DWD3NyID.js";import mn from"../chunks/BGVZ31-y.js";import _n from"../chunks/DK9tbYvT.js";import hn from"../chunks/9Ve3I6w0.js";import gn from"../chunks/DkuNIGT0.js";import yn from"../chunks/CuS-bfel.js";import wn from"../chunks/D7_Q8Xbe.js";import xn from"../chunks/BVE7Js9b.js";import En from"../chunks/B-q0s-Uw.js";import{b as we}from"../chunks/BkcxXaB0.js";import{p as Gt,l as na}from"../chunks/CvkxTUf8.js";import{b as ia}from"../chunks/DKz3C7iu.js";function Oe(m,L,d){ye(()=>{var F=k(()=>L(m,d?.())||{});if(F?.destroy)return()=>F.destroy()})}function Sn(m,L,d=L){var F=new WeakSet;fa(m,"input",async X=>{var B=X?m.defaultValue:m.value;if(B=Xe(m)?Je(B):B,d(B),Me!==null&&F.add(Me),await Te(),B!==(B=L())){var E=m.selectionStart,u=m.selectionEnd,J=m.value.length;if(m.value=B??"",u!==null){var K=m.value.length;E===u&&u===J&&K>J?(m.selectionStart=K,m.selectionEnd=K):(m.selectionStart=E,m.selectionEnd=Math.min(u,K))}}}),(pa&&m.defaultValue!==m.value||k(L)==null&&m.value)&&(d(Xe(m)?Je(m.value):m.value),Me!==null&&F.add(Me)),ba(()=>{var X=L();if(m===document.activeElement){var B=ma??Me;if(F.has(B))return}Xe(m)&&X===Je(m.value)||m.type==="date"&&!X&&!m.value||X!==m.value&&(m.value=X??"")})}function Xe(m){var L=m.type;return L==="number"||L==="range"}function Je(m){return m===""?null:+m}function oa(m){return typeof m=="string"?m?document.querySelector(m):null:m??null}function ca(m,L="body"){let d=oa(L)??document.body;return d&&d.appendChild(m),{update(F){const X=oa(F)??document.body;X===d||!X||(m.parentNode&&m.parentNode.removeChild(m),X.appendChild(m),d=X)},destroy(){m.parentNode&&m.parentNode.removeChild(m)}}}var zn=j('<button type="button"> </button>'),kn=j('<div class="radial svelte-furii8"><div class="radial-label svelte-furii8"> </div> <!></div>'),jn=j('<div class="picker svelte-furii8"><button type="button" class="value-button svelte-furii8" aria-label="Favorability value"><span class="value-label svelte-furii8"> </span></button> <p class="hint svelte-furii8" aria-live="polite"> </p> <!></div>');function qn(m,L){_e(L,!1);const d=h(),F=h(),X=h(),B=h();let E=Gt(L,"value",8,null),u=Gt(L,"disabled",8,!1);const J=0,K=100,qt=Array.from({length:11},(e,a)=>a*10),$t=176,Mt=62,At=qt.length;function H(e){const a=e/At*Math.PI*2-Math.PI/2,n=Math.cos(a)*Mt,c=Math.sin(a)*Mt;return`translate(calc(-50% + ${n}px), calc(-50% + ${c}px))`}const Y=120,_t=120,zt=250,M=12,V="[data-result-pane]",rt="reunion:radial-channel",yt=je();let v=h(!1),S=h(null),l=h(void 0),x=h(null),et=h(null),ft=h(""),st=!1,ut=0,p=h(null),q=null,N=!1,wt=0,G=null;const xt=e=>typeof e=="number"?e.toString().padStart(2,"0"):"??";function Wt(e){return yt("register",{element:e}),{destroy(){yt("unregister",{element:e})}}}function P(e){yt("commit",{value:e})}function Ct(e){if(u())return;St(!0);const a=typeof t(d)=="number"?t(d):0,n=Math.min(K,Math.max(J,a+e));i(l,n),P(n)}function Nt(e){if(u())return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(v)){if(O(a))return;e.preventDefault();return}if(!N&&a>_t){N=!0,at(!1);return}if(N)return;e.preventDefault();const n=e.ctrlKey?10:e.shiftKey?5:1;for(ut+=e.deltaY;ut<=-Y;)Ct(n),ut+=Y;for(;ut>=Y;)Ct(-n),ut-=Y}function Ot(e){if(u())return;const a=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(p)!==null?pt():t(v)&&at(!1),yt("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(v)&&at(!1),yt("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),at(!0);break;case"Escape":t(v)?(e.preventDefault(),at(!1)):t(p)!==null&&(e.preventDefault(),St(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?-5:-1);break;case"Backspace":(t(p)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),R());break;case"Delete":(t(p)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),nt());break;default:a&&(e.preventDefault(),e.stopPropagation(),z(e.key))}}function Vt(e){if(!t(v))return;const a=e.target;t(x)?.contains(a)||t(et)?.contains(a)||at(!1)}function It(e){t(v)&&e.key==="Escape"&&(e.preventDefault(),at(!1))}function Ft(e){if(!t(v))return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);O(a)}function Xt(){st||(window.addEventListener("pointerdown",Vt,!0),window.addEventListener("keydown",It,!0),window.addEventListener("wheel",Ft,{passive:!0}),window.addEventListener("scroll",Bt,!0),window.addEventListener("resize",Bt,!0),st=!0)}function Ht(){st&&(window.removeEventListener("pointerdown",Vt,!0),window.removeEventListener("keydown",It,!0),window.removeEventListener("wheel",Ft),window.removeEventListener("scroll",Bt,!0),window.removeEventListener("resize",Bt,!0),st=!1)}async function Bt(){await Et()}async function Et(){if(!t(v)||!t(x)||(await Te(),!t(v)||!t(x)))return;const e=t(x).getBoundingClientRect(),a=$t,n=a/2;let c=e.top+e.height/2,_=e.left+e.width/2;const w=M,$=Dt(),I=window.innerHeight-$-M,jt=M,C=window.innerWidth-M,vt=c-n,ot=c+n,g=_-n,T=_+n;let W=0;vt<w?W=vt-w:ot>I&&(W=ot-I);let Z=0;if(g<jt?Z=g-jt:T>C&&(Z=T-C),(Z!==0||W!==0)&&(window.scrollBy({top:W,left:Z,behavior:"auto"}),await Te(),!t(v)||!t(x)))return;const mt=t(x).getBoundingClientRect();c=mt.top+mt.height/2,_=mt.left+mt.width/2;const Lt=M+n,Qt=window.innerHeight-$-M-n,re=M+n,le=window.innerWidth-M-n;c=Math.min(Math.max(c,Lt),Qt),_=Math.min(Math.max(_,re),le);const ee=t(et)?.offsetParent instanceof HTMLElement?t(et).offsetParent.getBoundingClientRect():null,se=ee?.top??0,ce=ee?.left??0,ue=c-se,ae=_-ce;i(ft,`top:${Math.round(ue)}px;left:${Math.round(ae)}px;--overlay-size:${a}px;`)}function Dt(){const e=document.querySelector(V);if(!e)return 0;const a=e.getBoundingClientRect();if(a.top>=window.innerHeight)return 0;const n=Math.min(a.height,Math.max(0,window.innerHeight-Math.max(a.top,0)));return Math.max(0,n)}function at(e){if(u())return;const a=e??!t(v);a!==t(v)&&(i(v,a),t(v)?(Rt(),N=!1,dt(),i(p,null),q=null,i(S,typeof t(d)=="number"?t(d):null),i(l,void 0),ut=0,Xt(),Et()):(i(S,null),i(ft,""),Ht(),dt()))}function Zt(e){u()||(i(p,null),q=null,i(l,e),P(e),i(S,e),at(!1))}Be(()=>{Ht(),dt()}),Ae(()=>{const e=a=>D(a);return window.addEventListener(rt,e),()=>{window.removeEventListener(rt,e)}});function b(){t(p)===null&&(q=typeof t(d)=="number"?t(d):E()??null,typeof t(d)=="number"?i(p,t(d).toString()):typeof q=="number"?i(p,q.toString()):i(p,""))}function f(e){const a=e.replace(/\D/g,"").slice(0,3);if(a.length===0){i(p,""),i(l,null),P(null);return}const n=Number.parseInt(a,10),c=n>K?K:n;if(n>K&&a.length>0){i(p,String(Math.floor(n/10))),i(l,Number.parseInt(t(p),10)),P(t(l));return}i(p,c.toString()),i(l,c),P(c)}function z(e){b();const a=t(p)??"",n=a+e,c=Number.parseInt(n,10);!Number.isNaN(c)&&c>K&&a!==""||f(n)}function R(){b();const e=t(p)??"";if(e.length===0){i(p,""),i(l,null),P(null);return}f(e.slice(0,-1))}function nt(){b(),i(p,""),i(l,null),P(null)}function pt(){t(p)!==null&&(i(p,null),q=null)}function St(e){if(t(p)===null)return;const a=q;i(p,null),q=null,!e&&a!==E()?(i(l,a??null),P(a??null)):e||i(l,void 0)}function dt(){wt=0,G&&(clearTimeout(G),G=null)}function O(e){return t(v)?(wt+=e,G&&clearTimeout(G),G=window.setTimeout(()=>{wt=0,G=null},zt),wt>=_t?(N||(N=!0),at(!1),dt(),!0):!1):!1}function Rt(){if(typeof window>"u")return;const e={source:t(x)};window.dispatchEvent(new CustomEvent(rt,{detail:e}))}function D(e){!t(v)||e.detail?.source===t(x)||at(!1)}U(()=>(t(l),Tt(E())),()=>{t(l)!==void 0&&E()===t(l)&&i(l,void 0)}),U(()=>(t(l),Tt(E())),()=>{i(d,t(l)===void 0?E():t(l))}),U(()=>(Tt(u()),t(d)),()=>{i(F,u()?"disabled":t(d)===null?"empty":t(d)<J||t(d)>K?"invalid":"valid")}),U(()=>t(F),()=>{i(X,t(F)==="invalid"?"Keep between 0 and 100.":"")}),U(()=>(t(p),t(d)),()=>{i(B,t(p)!==null?t(p)===""?"??":t(p):xt(t(d)))}),xe(),me();var it=jn(),ct=r(it),Ut=r(ct),Kt=r(Ut,!0);o(Ut),o(ct),ye(()=>A("click",ct,()=>at())),ye(()=>A("keydown",ct,Ot)),ye(()=>A("auto-open",ct,()=>at(!0))),Oe(ct,e=>Wt?.(e)),we(ct,e=>i(x,e),()=>t(x));var bt=s(ct,2),kt=r(bt,!0);o(bt);var Pt=s(bt,2);{var Jt=e=>{var a=kn(),n=r(a),c=r(n,!0);o(n);var _=s(n,2);ie(_,3,()=>qt,w=>w,(w,$,I,jt)=>{var C=zn();let vt;var ot=r(C);o(C),lt(g=>{vt=Ue(C,1,"radial-option svelte-furii8",null,vt,{selected:t(d)===t($),hovered:t(S)===t($)}),fe(C,g),tt(ot,`${t($)??""}%`)},[()=>(Tt(t(I)),k(()=>`transform: ${H(t(I))}`))]),A("pointerenter",C,()=>i(S,t($))),A("focus",C,()=>i(S,t($))),A("pointerleave",C,()=>i(S,null)),A("blur",C,()=>i(S,null)),A("click",C,()=>Zt(t($))),y(w,C)}),o(a),we(a,w=>i(et,w),()=>t(et)),Oe(a,w=>ca?.(w)),lt(w=>{fe(a,t(ft)),tt(c,w)},[()=>(t(S),t(d),k(()=>xt(t(S)??t(d))))]),y(e,a)};gt(Pt,e=>{t(v)&&e(Jt)})}o(it),lt(()=>{be(it,"data-state",t(F)),be(it,"data-open",t(v)),ct.disabled=u(),tt(Kt,t(B)),tt(kt,t(X))}),A("wheel",it,Nt),y(m,it),he()}var $n=j('<button type="button"> </button>'),Cn=j('<div class="radial svelte-cojlv"><div class="radial-label svelte-cojlv"> </div> <!></div>'),Mn=j('<div class="picker svelte-cojlv"><button type="button" class="value-button svelte-cojlv" aria-label="Attendance probability"><span class="value-label svelte-cojlv"> </span></button> <p class="hint svelte-cojlv" aria-live="polite"> </p> <!></div>');function Ln(m,L){_e(L,!1);const d=h(),F=h(),X=h(),B=h();let E=Gt(L,"value",8,null),u=Gt(L,"disabled",8,!1);const J=0,K=100,qt=Array.from({length:11},(e,a)=>a*10),$t=176,Mt=62,At=qt.length,H=120,Y=120,_t=250,zt=12,M="[data-result-pane]",V="reunion:radial-channel";function rt(e){const a=e/At*Math.PI*2-Math.PI/2,n=Math.cos(a)*Mt,c=Math.sin(a)*Mt;return`translate(calc(-50% + ${n}px), calc(-50% + ${c}px))`}const yt=je();let v=h(!1),S=h(null),l=h(void 0),x=h(null),et=h(null),ft=h(""),st=!1,ut=0,p=h(null),q=null,N=!1,wt=0,G=null;const xt=e=>typeof e=="number"?`${e.toString().padStart(2,"0")}%`:"??%";function Wt(e){return yt("register",{element:e}),{destroy(){yt("unregister",{element:e})}}}function P(e){yt("commit",{value:e})}function Ct(e){if(u())return;St(!0);const a=typeof t(d)=="number"?t(d):0,n=Math.min(K,Math.max(J,a+e));i(l,n),P(n)}function Nt(e){if(u())return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(v)){if(O(a))return;e.preventDefault();return}if(!N&&a>Y){N=!0,at(!1);return}if(N)return;e.preventDefault();const n=e.ctrlKey?10:e.shiftKey?5:1;for(ut+=e.deltaY;ut<=-H;)Ct(n),ut+=H;for(;ut>=H;)Ct(-n),ut-=H}function Ot(e){if(u())return;const a=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(p)!==null?pt():t(v)&&at(!1),yt("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(v)&&at(!1),yt("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),at(!0);break;case"Escape":t(v)?(e.preventDefault(),at(!1)):t(p)!==null&&(e.preventDefault(),St(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?-5:-1);break;case"Backspace":(t(p)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),R());break;case"Delete":(t(p)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),nt());break;default:a&&(e.preventDefault(),e.stopPropagation(),z(e.key))}}function Vt(e){if(!t(v))return;const a=e.target;t(x)?.contains(a)||t(et)?.contains(a)||at(!1)}function It(e){t(v)&&e.key==="Escape"&&(e.preventDefault(),at(!1))}function Ft(e){if(!t(v))return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);O(a)}function Xt(){st||(window.addEventListener("pointerdown",Vt,!0),window.addEventListener("keydown",It,!0),window.addEventListener("wheel",Ft,{passive:!0}),window.addEventListener("scroll",Bt,!0),window.addEventListener("resize",Bt,!0),st=!0)}function Ht(){st&&(window.removeEventListener("pointerdown",Vt,!0),window.removeEventListener("keydown",It,!0),window.removeEventListener("wheel",Ft),window.removeEventListener("scroll",Bt,!0),window.removeEventListener("resize",Bt,!0),st=!1)}async function Bt(){await Et()}async function Et(){if(!t(v)||!t(x)||(await Te(),!t(v)||!t(x)))return;const e=t(x).getBoundingClientRect(),a=$t,n=a/2;let c=e.top+e.height/2,_=e.left+e.width/2;const w=zt,$=Dt(),I=window.innerHeight-$-zt,jt=zt,C=window.innerWidth-zt,vt=c-n,ot=c+n,g=_-n,T=_+n;let W=0;vt<w?W=vt-w:ot>I&&(W=ot-I);let Z=0;if(g<jt?Z=g-jt:T>C&&(Z=T-C),(Z!==0||W!==0)&&(window.scrollBy({top:W,left:Z,behavior:"auto"}),await Te(),!t(v)||!t(x)))return;const mt=t(x).getBoundingClientRect();c=mt.top+mt.height/2,_=mt.left+mt.width/2;const Lt=zt+n,Qt=window.innerHeight-$-zt-n,re=zt+n,le=window.innerWidth-zt-n;c=Math.min(Math.max(c,Lt),Qt),_=Math.min(Math.max(_,re),le);const ee=t(et)?.offsetParent instanceof HTMLElement?t(et).offsetParent.getBoundingClientRect():null,se=ee?.top??0,ce=ee?.left??0,ue=c-se,ae=_-ce;i(ft,`top:${Math.round(ue)}px;left:${Math.round(ae)}px;--overlay-size:${a}px;`)}function Dt(){const e=document.querySelector(M);if(!e)return 0;const a=e.getBoundingClientRect();if(a.top>=window.innerHeight)return 0;const n=Math.min(a.height,Math.max(0,window.innerHeight-Math.max(a.top,0)));return Math.max(0,n)}function at(e){if(u())return;const a=e??!t(v);a!==t(v)&&(i(v,a),t(v)?(Rt(),N=!1,dt(),i(p,null),q=null,i(S,t(d)),i(l,void 0),ut=0,Xt(),Et()):(i(S,null),i(ft,""),Ht(),dt()))}function Zt(e){u()||(i(p,null),q=null,i(l,e),P(e),i(S,e),at(!1))}Be(()=>{Ht(),dt()}),Ae(()=>{const e=a=>D(a);return window.addEventListener(V,e),()=>{window.removeEventListener(V,e)}});function b(){t(p)===null&&(q=typeof t(d)=="number"?t(d):E()??null,typeof t(d)=="number"?i(p,t(d).toString()):typeof q=="number"?i(p,q.toString()):i(p,""))}function f(e){const a=e.replace(/\D/g,"").slice(0,3);if(a.length===0){i(p,""),i(l,null),P(null);return}const n=Number.parseInt(a,10),c=n>K?K:n;if(n>K&&a.length>0){i(p,String(Math.floor(n/10))),i(l,Number.parseInt(t(p),10)),P(t(l));return}i(p,c.toString()),i(l,c),P(c)}function z(e){b();const a=t(p)??"",n=a+e,c=Number.parseInt(n,10);!Number.isNaN(c)&&c>K&&a!==""||f(n)}function R(){b();const e=t(p)??"";if(e.length===0){i(p,""),i(l,null),P(null);return}f(e.slice(0,-1))}function nt(){b(),i(p,""),i(l,null),P(null)}function pt(){t(p)!==null&&(i(p,null),q=null)}function St(e){if(t(p)===null)return;const a=q;i(p,null),q=null,!e&&a!==E()?(i(l,a??null),P(a??null)):e||i(l,void 0)}function dt(){wt=0,G&&(clearTimeout(G),G=null)}function O(e){return t(v)?(wt+=e,G&&clearTimeout(G),G=window.setTimeout(()=>{wt=0,G=null},_t),wt>=Y?(N||(N=!0),at(!1),dt(),!0):!1):!1}function Rt(){if(typeof window>"u")return;const e={source:t(x)};window.dispatchEvent(new CustomEvent(V,{detail:e}))}function D(e){!t(v)||e.detail?.source===t(x)||at(!1)}U(()=>(t(l),Tt(E())),()=>{t(l)!==void 0&&E()===t(l)&&i(l,void 0)}),U(()=>(t(l),Tt(E())),()=>{i(d,t(l)===void 0?E():t(l))}),U(()=>(Tt(u()),t(d)),()=>{i(F,u()?"disabled":t(d)===null?"empty":t(d)<J||t(d)>K?"invalid":"valid")}),U(()=>t(F),()=>{i(X,t(F)==="invalid"?"Keep between 0 and 100%.":"")}),U(()=>(t(p),t(d)),()=>{i(B,t(p)!==null?t(p)===""?"??%":`${t(p)}%`:xt(t(d)))}),xe(),me();var it=Mn(),ct=r(it),Ut=r(ct),Kt=r(Ut,!0);o(Ut),o(ct),ye(()=>A("click",ct,()=>at())),ye(()=>A("keydown",ct,Ot)),ye(()=>A("auto-open",ct,()=>at(!0))),Oe(ct,e=>Wt?.(e)),we(ct,e=>i(x,e),()=>t(x));var bt=s(ct,2),kt=r(bt,!0);o(bt);var Pt=s(bt,2);{var Jt=e=>{var a=Cn(),n=r(a),c=r(n,!0);o(n);var _=s(n,2);ie(_,3,()=>qt,w=>w,(w,$,I,jt)=>{var C=$n();let vt;var ot=r(C);o(C),lt(g=>{vt=Ue(C,1,"radial-option svelte-cojlv",null,vt,{selected:t(d)===t($),hovered:t(S)===t($)}),fe(C,g),tt(ot,`${t($)??""}%`)},[()=>(Tt(t(I)),k(()=>`transform: ${rt(t(I))}`))]),A("pointerenter",C,()=>i(S,t($))),A("focus",C,()=>i(S,t($))),A("pointerleave",C,()=>i(S,null)),A("blur",C,()=>i(S,null)),A("click",C,()=>Zt(t($))),y(w,C)}),o(a),we(a,w=>i(et,w),()=>t(et)),Oe(a,w=>ca?.(w)),lt(w=>{fe(a,t(ft)),tt(c,w)},[()=>(t(S),t(d),k(()=>xt(t(S)??t(d))))]),y(e,a)};gt(Pt,e=>{t(v)&&e(Jt)})}o(it),lt(()=>{be(it,"data-state",t(F)),be(it,"data-open",t(v)),ct.disabled=u(),tt(Kt,t(B)),tt(kt,t(X))}),A("wheel",it,Nt),y(m,it),he()}let Ie=null;const Tn='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function An(){if(typeof document>"u")return;const m=document.activeElement;m&&typeof m.focus=="function"&&(Ie=m)}function Rn(){if(Ie){try{Ie.focus({preventScroll:!0})}catch{}Ie=null}}function ra(m){if(!m)return;const L=m.querySelector(Tn);L&&L.focus({preventScroll:!0})}var Pn=j('<p class="empty svelte-1bwzqxo">No continents detected in this dataset.</p>'),Dn=j("<option> </option>"),In=j('<div class="matrix-row svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo"> </div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>0</option><option>25</option><option>50</option><option>75</option><option>100</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div></div>'),Nn=j('<div class="backdrop svelte-1bwzqxo" role="presentation" tabindex="-1"><div class="dialog svelte-1bwzqxo" role="dialog" aria-modal="true" aria-label="Bulk actions"><header class="svelte-1bwzqxo"><div><h2 class="svelte-1bwzqxo">Bulk Actions</h2> <p class="subtitle svelte-1bwzqxo">Trigger presets or continent tweaks without leaving the grid.</p></div> <button type="button" class="close svelte-1bwzqxo" aria-label="Close dialog">√ó</button></header> <div class="content svelte-1bwzqxo"><section class="global svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Global Overrides</h3> <div class="global-grid svelte-1bwzqxo"><fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Probabilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all to 100%</button> <button type="button" class="svelte-1bwzqxo">Set all to 50%</button> <button type="button" class="svelte-1bwzqxo">Set all to 0%</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div> <div class="normalize svelte-1bwzqxo"><span>Normalize average to</span> <input type="number" min="0" max="100" step="1" aria-label="Target mean probability"/> <span>%</span> <button type="button" class="svelte-1bwzqxo">Normalize</button></div></fieldset> <fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Utilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all utilities to 50</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div></fieldset></div></section> <section class="matrix svelte-1bwzqxo"><header class="matrix-head svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Per-Continent Adjustments</h3> <p class="svelte-1bwzqxo">Set specific baselines or deltas for each region.</p></header> <div class="matrix-table svelte-1bwzqxo"><div class="matrix-row matrix-header svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo">Continent</div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div>Favorability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div>Probability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div></div> <!></div></section></div> <footer class="actions svelte-1bwzqxo"><button type="button" class="secondary svelte-1bwzqxo">Close</button></footer></div></div>');function On(m,L){_e(L,!1);let d=Gt(L,"open",8,!1),F=Gt(L,"continents",24,()=>[]);const X=je();let B=h(null),E=h(!1),u=h([]),J=h(50);const K=["","0","25","50","75","100"];function qt(v){return{continent:v,utilitySet:"",utilityDelta:"",probabilitySet:"",probabilityDelta:""}}function $t(v=!1){const S=new Map(t(u).map(l=>[l.continent,l]));i(u,F().map(l=>!v&&S.has(l)?{...S.get(l)}:qt(l))),F().length===0&&i(u,[])}function Mt(){i(J,50),$t(!0)}function At(){X("cancel")}function H(v,S=0,l=100){return Math.max(S,Math.min(l,Math.round(v)))}function Y(v){if(v.trim()==="")return null;const S=Number(v);return Number.isFinite(S)?S:null}function _t(v){const S=Array.isArray(v)?v:[v];X("apply",{actions:S})}function zt(v){const S=v.currentTarget,l=v.target;l&&S.contains(l)&&l!==S||At()}function M(v){v.key==="Escape"&&(v.preventDefault(),At())}U(()=>Tt(d()),()=>{i(E,d())}),U(()=>(Tt(d()),t(E)),()=>{d()&&!t(E)&&Mt()}),U(()=>(Tt(d()),t(B),ra),()=>{d()&&t(B)&&ra(t(B))}),U(()=>Tt(d()),()=>{d()&&$t(!1)}),xe(),me();var V=ne(),rt=te(V);{var yt=v=>{var S=Nn(),l=r(S),x=r(l),et=s(r(x),2);o(x);var ft=s(x,2),st=r(ft),ut=s(r(st),2),p=r(ut),q=s(r(p),2),N=r(q),wt=s(N,2),G=s(wt,2);o(q);var xt=s(q,2),Wt=r(xt),P=s(Wt,2);o(xt);var Ct=s(xt,2),Nt=s(r(Ct),2);ha(Nt);var Ot=s(Nt,4);o(Ct),o(p);var Vt=s(p,2),It=s(r(Vt),2),Ft=r(It);o(It);var Xt=s(It,2),Ht=r(Xt),Bt=s(Ht,2);o(Xt),o(Vt),o(ut),o(st);var Et=s(st,2),Dt=s(r(Et),2),at=s(r(Dt),2);{var Zt=R=>{var nt=Pn();y(R,nt)},b=R=>{var nt=ne(),pt=te(nt);ie(pt,3,()=>t(u),St=>St.continent,(St,dt,O)=>{var Rt=In(),D=r(Rt),it=r(D,!0);o(D);var ct=s(D,2),Ut=r(ct),Kt=r(Ut),bt=r(Kt),kt=r(bt);o(bt);var Pt=s(bt,2);lt(()=>{t(u),Pe(()=>{t(O)})}),ie(Pt,5,()=>K,ht=>ht,(ht,ze)=>{var Ce=Dn(),ua=r(Ce,!0);o(Ce);var aa={};lt(()=>{tt(ua,t(ze)===""?"‚Äî":t(ze)),aa!==(aa=t(ze))&&(Ce.value=(Ce.__value=t(ze))??"")}),y(ht,Ce)}),o(Pt),o(Kt);var Jt=s(Kt,2);o(Ut);var e=s(Ut,2),a=r(e),n=r(a),c=r(n);o(n);var _=s(n,2);lt(()=>{t(u),Pe(()=>{t(O)})});var w=r(_);w.value=w.__value="";var $=s(w);$.value=$.__value="-50";var I=s($);I.value=I.__value="-25";var jt=s(I);jt.value=jt.__value="-10";var C=s(jt);C.value=C.__value="-5";var vt=s(C);vt.value=vt.__value="+5";var ot=s(vt);ot.value=ot.__value="+10";var g=s(ot);g.value=g.__value="+25";var T=s(g);T.value=T.__value="+50",o(_),o(a);var W=s(a,2);o(e),o(ct);var Z=s(ct,2),mt=r(Z),Lt=r(mt),Qt=r(Lt),re=r(Qt);o(Qt);var le=s(Qt,2);lt(()=>{t(u),Pe(()=>{t(O)})});var ee=r(le);ee.value=ee.__value="";var se=s(ee);se.value=se.__value="0";var ce=s(se);ce.value=ce.__value="25";var ue=s(ce);ue.value=ue.__value="50";var ae=s(ue);ae.value=ae.__value="75";var Re=s(ae);Re.value=Re.__value="100",o(le),o(Lt);var qe=s(Lt,2);o(mt);var $e=s(mt,2),Ee=r($e),Se=r(Ee),He=r(Se);o(Se);var Q=s(Se,2);lt(()=>{t(u),Pe(()=>{t(O)})});var Yt=r(Q);Yt.value=Yt.__value="";var de=s(Yt);de.value=de.__value="-50";var ge=s(de);ge.value=ge.__value="-25";var Ve=s(ge);Ve.value=Ve.__value="-10";var Fe=s(Ve);Fe.value=Fe.__value="-5";var Ke=s(Fe);Ke.value=Ke.__value="+5";var Ye=s(Ke);Ye.value=Ye.__value="+10";var Ge=s(Ye);Ge.value=Ge.__value="+25";var ta=s(Ge);ta.value=ta.__value="+50",o(Q),o(Ee);var ea=s(Ee,2);o($e),o(Z),o(Rt),lt((ht,ze)=>{tt(it,(t(dt),k(()=>t(dt).continent))),tt(kt,`Set favorability for ${t(dt),k(()=>t(dt).continent)??""}`),Jt.disabled=(t(u),Tt(t(O)),k(()=>t(u)[t(O)].utilitySet==="")),tt(c,`Adjust favorability by for ${t(dt),k(()=>t(dt).continent)??""}`),W.disabled=ht,tt(re,`Set probability for ${t(dt),k(()=>t(dt).continent)??""}`),qe.disabled=(t(u),Tt(t(O)),k(()=>t(u)[t(O)].probabilitySet==="")),tt(He,`Adjust probability by for ${t(dt),k(()=>t(dt).continent)??""}`),ea.disabled=ze},[()=>(t(u),Tt(t(O)),k(()=>Y(t(u)[t(O)].utilityDelta)===null)),()=>(t(u),Tt(t(O)),k(()=>Y(t(u)[t(O)].probabilityDelta)===null))]),De(Pt,()=>t(u)[t(O)].utilitySet,ht=>ke(u,t(u)[t(O)].utilitySet=ht)),A("click",Jt,()=>{const ht=Y(t(u)[t(O)].utilitySet);ht!==null&&_t({type:"setContinentUtility",continent:t(dt).continent,value:H(ht)})}),De(_,()=>t(u)[t(O)].utilityDelta,ht=>ke(u,t(u)[t(O)].utilityDelta=ht)),A("click",W,()=>{const ht=Y(t(u)[t(O)].utilityDelta);ht===null||ht===0||(ke(u,t(u)[t(O)].utilityDelta=ht>0?`+${ht}`:`${ht}`),_t({type:"adjustContinentUtility",continent:t(dt).continent,delta:Math.round(ht)}))}),De(le,()=>t(u)[t(O)].probabilitySet,ht=>ke(u,t(u)[t(O)].probabilitySet=ht)),A("click",qe,()=>{const ht=Y(t(u)[t(O)].probabilitySet);ht!==null&&_t({type:"setContinentProbability",continent:t(dt).continent,value:H(ht)})}),De(Q,()=>t(u)[t(O)].probabilityDelta,ht=>ke(u,t(u)[t(O)].probabilityDelta=ht)),A("click",ea,()=>{const ht=Y(t(u)[t(O)].probabilityDelta);ht===null||ht===0||(ke(u,t(u)[t(O)].probabilityDelta=ht>0?`+${ht}`:`${ht}`),_t({type:"adjustContinentProbability",continent:t(dt).continent,delta:Math.round(ht)}))}),y(St,Rt)}),y(R,nt)};gt(at,R=>{t(u),k(()=>t(u).length===0)?R(Zt):R(b,!1)})}o(Dt),o(Et),o(ft);var f=s(ft,2),z=r(f);o(f),o(l),we(l,R=>i(B,R),()=>t(B)),o(S),A("click",et,At),A("click",N,()=>_t({type:"setAllProbabilities",value:100})),A("click",wt,()=>_t({type:"setAllProbabilities",value:50})),A("click",G,()=>_t({type:"setAllProbabilities",value:0})),A("click",Wt,()=>_t({type:"adjustAllProbabilities",delta:10})),A("click",P,()=>_t({type:"adjustAllProbabilities",delta:-10})),Sn(Nt,()=>t(J),R=>i(J,R)),A("click",Ot,()=>{Number.isFinite(t(J))&&_t({type:"normalizeProbabilities",target:H(Number(t(J)))})}),A("click",Ft,()=>_t({type:"setAllUtilities",value:50})),A("click",Ht,()=>_t({type:"adjustAllUtilities",delta:10})),A("click",Bt,()=>_t({type:"adjustAllUtilities",delta:-10})),A("click",z,At),A("click",S,zt),A("keydown",S,M),y(v,S)};gt(rt,v=>{d()&&v(yt)})}y(m,V),he()}var Bn=j('<p class="empty svelte-h2c6bt">No commands yet.</p>'),Un=j('<li class="svelte-h2c6bt"> </li>'),Hn=j('<ul class="diffs svelte-h2c6bt"></ul>'),Vn=j('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Fn=j('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Kn=j('<ul class="svelte-h2c6bt"></ul>'),Yn=j('<p class="empty svelte-h2c6bt">Nothing queued.</p>'),Gn=j('<li class="svelte-h2c6bt"> </li>'),Wn=j('<ul class="diffs svelte-h2c6bt"></ul>'),Xn=j('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Jn=j('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Zn=j('<ul class="svelte-h2c6bt"></ul>'),Qn=j('<div class="history-overlay svelte-h2c6bt" role="dialog" aria-label="Command history"><section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Past</header> <!></section> <section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Future</header> <!></section></div>'),ti=j('<div class="history-wrapper svelte-h2c6bt" role="group"><button type="button" class="history-button svelte-h2c6bt" aria-haspopup="dialog"><span class="btn-icon svelte-h2c6bt" aria-hidden="true">üßæ</span> <span> </span></button> <!></div>');function ei(m,L){_e(L,!1);const d=()=>ve(oe,"$commandHistoryStore",X),F=()=>ve(sa,"$citiesStore",X),[X,B]=Qe();let E=h(!1),u=h(null),J=h({past:[],future:[]}),K=h([]),qt=h([]),$t=h([]),Mt=h({});function At(){i(E,!0)}function H(l){l instanceof FocusEvent&&l.currentTarget instanceof HTMLElement&&l.relatedTarget instanceof HTMLElement&&l.currentTarget.contains(l.relatedTarget)||i(E,!1)}function Y(l,x=!1){return l==null?"??":x?`${l}%`:`${l}`}function _t(l,x){if(!l&&!x)return[];const et=l?.entries??{},ft=x?.entries??{},st=new Set([...Object.keys(et),...Object.keys(ft)]),ut=[];for(const p of st){const q=et[p]??null,N=ft[p]??null,wt=t(Mt)[p]?.name??p;if(!q&&N){N.utility!==null&&ut.push(`${wt} utility ${Y(null)} ‚Üí ${Y(N.utility)}`),N.probability!==null&&ut.push(`${wt} probability ${Y(null,!0)} ‚Üí ${Y(N.probability,!0)}`);continue}q&&N&&(q.utility!==N.utility&&ut.push(`${wt} utility ${Y(q.utility)} ‚Üí ${Y(N.utility)}`),q.probability!==N.probability&&ut.push(`${wt} probability ${Y(q.probability,!0)} ‚Üí ${Y(N.probability,!0)}`)),q&&!N&&(q.utility!==null&&ut.push(`${wt} utility ${Y(q.utility)} ‚Üí ${Y(null)}`),q.probability!==null&&ut.push(`${wt} probability ${Y(q.probability,!0)} ‚Üí ${Y(null,!0)}`))}return ut}function zt(l,x){return _t(l,x)}U(()=>d(),()=>{i(J,d())}),U(()=>t(J),()=>{i(K,[...t(J).past??[]].slice().reverse())}),U(()=>t(J),()=>{i(qt,t(J).future??[])}),U(()=>F(),()=>{i($t,F()??[])}),U(()=>t($t),()=>{i(Mt,Object.fromEntries(t($t).map(l=>[l.id,l])))}),xe(),me();var M=ti(),V=r(M),rt=s(r(V),2),yt=r(rt);o(rt),o(V),we(V,l=>i(u,l),()=>t(u));var v=s(V,2);{var S=l=>{var x=Qn(),et=r(x),ft=s(r(et),2);{var st=G=>{var xt=Bn();y(G,xt)},ut=G=>{var xt=Kn();ie(xt,5,()=>t(K),Ze,(Wt,P)=>{var Ct=Fn(),Nt=r(Ct),Ot=r(Nt),Vt=r(Ot,!0);o(Ot);var It=s(Ot,2),Ft=r(It);o(It),o(Nt);var Xt=s(Nt,2);{var Ht=Et=>{var Dt=Hn();ie(Dt,5,()=>(t(P),k(()=>zt(t(P).before?.vote,t(P).after?.vote))),at=>at,(at,Zt)=>{var b=Un(),f=r(b,!0);o(b),lt(()=>tt(f,t(Zt))),y(at,b)}),o(Dt),y(Et,Dt)},Bt=Et=>{var Dt=Vn();y(Et,Dt)};gt(Xt,Et=>{t(P),k(()=>zt(t(P).before?.vote,t(P).after?.vote).length)?Et(Ht):Et(Bt,!1)})}o(Ct),lt(Et=>{tt(Vt,(t(P),k(()=>t(P).label))),tt(Ft,`[${Et??""}]`)},[()=>(t(P),k(()=>t(P).scope.join(", ")))]),y(Wt,Ct)}),o(xt),y(G,xt)};gt(ft,G=>{t(K),k(()=>t(K).length===0)?G(st):G(ut,!1)})}o(et);var p=s(et,2),q=s(r(p),2);{var N=G=>{var xt=Yn();y(G,xt)},wt=G=>{var xt=Zn();ie(xt,5,()=>t(qt),Ze,(Wt,P)=>{var Ct=Jn(),Nt=r(Ct),Ot=r(Nt),Vt=r(Ot,!0);o(Ot);var It=s(Ot,2),Ft=r(It);o(It),o(Nt);var Xt=s(Nt,2);{var Ht=Et=>{var Dt=Wn();ie(Dt,5,()=>(t(P),k(()=>zt(t(P).before?.vote,t(P).after?.vote))),at=>at,(at,Zt)=>{var b=Gn(),f=r(b,!0);o(b),lt(()=>tt(f,t(Zt))),y(at,b)}),o(Dt),y(Et,Dt)},Bt=Et=>{var Dt=Xn();y(Et,Dt)};gt(Xt,Et=>{t(P),k(()=>zt(t(P).before?.vote,t(P).after?.vote).length)?Et(Ht):Et(Bt,!1)})}o(Ct),lt(Et=>{tt(Vt,(t(P),k(()=>t(P).label))),tt(Ft,`[${Et??""}]`)},[()=>(t(P),k(()=>t(P).scope.join(", ")))]),y(Wt,Ct)}),o(xt),y(G,xt)};gt(q,G=>{t(qt),k(()=>t(qt).length===0)?G(N):G(wt,!1)})}o(p),o(x),y(l,x)};gt(v,l=>{t(E)&&l(S)})}o(M),lt(()=>{be(V,"aria-expanded",t(E)),tt(yt,`Log (${t(J),k(()=>t(J).past.length)??""})`)}),A("mouseenter",M,At),A("mouseleave",M,H),A("focusin",M,At),A("focusout",M,H),y(m,M),he(),B()}var ai=j("<img/>");function la(m,L){const d=na(L,["children","$$slots","$$events","$$legacy"]),F=na(d,["src","alt","loading","decoding"]);let X=Gt(L,"src",8),B=Gt(L,"alt",8),E=Gt(L,"loading",8,"lazy"),u=Gt(L,"decoding",8,"async");var J=ai();ga(J,()=>({...F,src:X(),alt:B(),loading:E(),decoding:u()})),da(J),y(m,J)}var ni=j('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),ii=j('<p class="status error svelte-f9uau2"> </p>'),oi=j('<figure class="inline-frame svelte-f9uau2"><!></figure>'),ri=j('<p class="inline-weather svelte-f9uau2"> </p>'),li=j('<p class="inline-food svelte-f9uau2"> </p>'),si=j('<div class="inline-track svelte-f9uau2"></div> <div class="inline-overlay svelte-f9uau2"><div class="inline-heading svelte-f9uau2"><span class="inline-name svelte-f9uau2"> </span> <span class="inline-country svelte-f9uau2"> </span></div> <p class="inline-summary svelte-f9uau2"> </p> <!> <!></div>',1),ci=j('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),ui=j('<div class="inline-strip svelte-f9uau2" role="group"><!></div>'),di=j('<div class="background-placeholder svelte-f9uau2">Loading imagery‚Ä¶</div>'),vi=j('<div class="background-placeholder svelte-f9uau2"> </div>'),fi=j('<div><div class="sprite-frame svelte-f9uau2"></div> <div class="sprite-frame svelte-f9uau2"></div></div>'),pi=j('<div class="background-placeholder svelte-f9uau2">Preparing imagery‚Ä¶</div>'),bi=j('<div class="background-strip svelte-f9uau2" aria-hidden="true"><!></div>'),mi=j('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),_i=j('<p class="status error svelte-f9uau2"> </p>'),hi=j('<span class="credit svelte-f9uau2"> </span>'),gi=j('<figcaption class="svelte-f9uau2"> <!></figcaption>'),yi=j('<figure class="svelte-f9uau2"><!> <!></figure>'),wi=j('<div class="image-row svelte-f9uau2"></div>'),xi=j('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),Ei=j('<div class="image-strip svelte-f9uau2" role="group"><!></div>');function Si(m,L){_e(L,!1);const d=h(),F=h(),X=h(),B=h();let E=Gt(L,"city",8),u=Gt(L,"variant",8,"details"),J=Gt(L,"direction",8,"normal"),K=Gt(L,"showCaptions",8,!0),qt=Gt(L,"scrollDuration",8,24);const $t=Object.create(null),Mt=Object.create(null),At=Object.create(null),H=480,Y="Details available in the expanded view.",_t=1,zt={};let M=h("idle"),V=h(null),rt=h([]),yt=h([]),v=h(""),S=null,l=0,x=h({}),et=h([]),ft=h(null),st=h(1),ut=h(1),p=0,q="";function N(b){let f=0;for(let z=0;z<b.length;z+=1)f=(f<<5)-f+b.charCodeAt(z),f|=0;return f}function wt(b){const f=qt()*2.5,z=b?.id;if(!z)return f;const pt=.5+Math.abs(N(z))%1e3/1e3*_t;return f*pt}function G(b){const f=b.startsWith("/")?b:`/${b}`;return ia?`${ia}${f}`:f}function xt(b){return G(`${E().images_path}/${b}`)}async function Wt(b){if(!b)return;const f=++l;if($t[b]){i(V,$t[b]),i(rt,t(V)?.images??[]),i(M,"ready"),i(v,""),typeof window<"u"&&Ot(t(rt));return}i(v,""),i(M,"loading");try{const z=await ya(b);if(f!==l)return;$t[b]=z,i(V,z),i(rt,z.images??[]),i(M,"ready"),typeof window<"u"&&Ot(t(rt))}catch(z){if(f!==l)return;i(M,"error"),i(v,z instanceof Error?z.message:"Unable to load images.")}}function P(b){const f=b?.id??null;if(!f){S!==null&&(S=null,i(V,null),i(rt,[]),i(yt,[]),i(M,"idle"),i(v,""));return}if(f===S)return;S=f;const z=$t[f];if(z){i(V,z),i(rt,z.images??[]),i(M,"ready"),i(v,""),Ct(),typeof window<"u"&&Ot(t(rt));return}i(V,null),i(rt,[]),i(yt,[]),i(M,"loading"),i(v,""),Wt(f).then(Ct)}function Ct(){const b=t(rt)??[],f=b.length>1?Xt(S,b):b;(u()==="inline"||u()==="background")&&f.length>0?i(yt,[...f,...f]):i(yt,f)}function Nt(b){if(!b)return 1;const f=t(x)[b]??Mt[b];return f&&Number.isFinite(f)&&f>0?f:1}async function Ot(b){const f=b.filter(z=>z.image&&!Mt[z.image]);f.length!==0&&(await Promise.all(f.map(z=>new Promise(R=>{const nt=new Image;nt.src=xt(z.image),nt.onload=()=>{const pt=nt.naturalHeight?nt.naturalWidth/nt.naturalHeight:1;Mt[z.image]=pt>0?pt:1,R()},nt.onerror=()=>{Mt[z.image]=1,R()}}))),i(x,Object.fromEntries(Object.entries(Mt).map(([z,R])=>[z,R&&Number.isFinite(R)&&R>0?R:1]))))}function Vt(b){const f=At[b];return f&&f.complete&&f.naturalWidth>0?Promise.resolve(f):new Promise((z,R)=>{const nt=new Image;nt.crossOrigin="anonymous",nt.decoding="async",nt.onload=()=>{At[b]=nt,z(nt)},nt.onerror=()=>{R(new Error(`Unable to load image at ${b}`))},nt.src=b})}async function It(b){const f=b.filter(D=>!!D.image);if(f.length===0)throw new Error("No image sources available for sprite generation.");const z=await Promise.all(f.map(D=>Vt(xt(D.image)))),R=H,nt=z.map(D=>D.naturalHeight?D.naturalWidth/D.naturalHeight*R:R),pt=Math.max(1,Math.round(nt.reduce((D,it)=>D+it,0))),St=document.createElement("canvas");St.width=pt,St.height=R;const dt=St.getContext("2d");if(!dt)throw new Error("Unable to obtain canvas rendering context.");let O=0;for(let D=0;D<z.length;D+=1){const it=z[D],ct=nt[D];dt.drawImage(it,O,0,ct,R),O+=ct}let Rt="";try{Rt=St.toDataURL("image/webp",.92)}catch{Rt=""}return(!Rt||Rt==="data:,")&&(Rt=St.toDataURL("image/png")),{url:Rt,ratio:pt/R}}function Ft(b){const f=[...b];for(let z=f.length-1;z>0;z-=1){const R=Math.floor(Math.random()*(z+1));[f[z],f[R]]=[f[R],f[z]]}return f}function Xt(b,f){if(!b)return Ft(f);const z=zt[b];if(z&&z.length===f.length)return z;const R=Ft(f);return zt[b]=R,R}function Ht(){i(ft,null),i(st,1),q=""}async function Bt(b){if(typeof window>"u"||u()!=="background")return;const f=b.length>1?Xt(S,b):b,z=f.map(nt=>nt.image??"").join("|");if(z&&z===q&&t(ft))return;if(!f.length){Ht();return}const R=++p;try{const{url:nt,ratio:pt}=await It(f);if(R!==p)return;i(ft,nt),i(st,Number.isFinite(pt)&&pt>0?pt:1),q=z}catch(nt){if(R!==p)return;Ht(),console.warn("CityImageStrip: failed to build sprite",nt)}}va(()=>P(E())),Ae(()=>{P(E()),typeof window<"u"&&t(rt).length&&Ot(t(rt))}),U(()=>{},()=>{Ct()}),U(()=>t(V),()=>{i(d,t(V)?.summary??"")}),U(()=>t(V),()=>{i(F,t(V)?.seasonal_notes??"")}),U(()=>t(V),()=>{i(X,t(V)?.food_and_drink?.[0]??"")}),U(()=>Tt(E()),()=>{i(B,wt(E()))}),U(()=>(t(yt),t(x)),()=>{i(et,t(yt).map(b=>(t(x),Nt(b.image))))}),U(()=>t(st),()=>{i(ut,Number.isFinite(t(st))&&t(st)>0?t(st):1)}),U(()=>(Tt(u()),t(M),t(rt)),()=>{typeof window<"u"&&u()==="background"&&(t(M)==="ready"?Bt(t(rt)):Ht())}),xe(),me();var Et=ne(),Dt=te(Et);{var at=b=>{var f=ui(),z=r(f);{var R=pt=>{var St=ni();y(pt,St)},nt=pt=>{var St=ne(),dt=te(St);{var O=D=>{var it=ii(),ct=r(it,!0);o(it),lt(()=>tt(ct,t(v))),y(D,it)},Rt=D=>{var it=ne(),ct=te(it);{var Ut=bt=>{var kt=si(),Pt=te(kt);ie(Pt,5,()=>t(yt),Ze,(ot,g,T)=>{var W=oi(),Z=r(W);{let mt=Le(()=>(t(g),k(()=>xt(t(g).image)))),Lt=Le(()=>(t(g),Tt(E()),k(()=>t(g).caption??`${E().name} skyline`)));la(Z,{get src(){return t(mt)},get alt(){return t(Lt)},loading:"lazy",decoding:"async"})}o(W),lt(()=>{be(W,"aria-hidden",(t(rt),k(()=>T>=t(rt).length?"true":void 0))),fe(W,(t(et),k(()=>`aspect-ratio: ${t(et)[T]??1}`)))}),y(ot,W)}),o(Pt);var Jt=s(Pt,2),e=r(Jt),a=r(e),n=r(a,!0);o(a);var c=s(a,2),_=r(c,!0);o(c),o(e);var w=s(e,2),$=r(w,!0);o(w);var I=s(w,2);{var jt=ot=>{var g=ri(),T=r(g,!0);o(g),lt(()=>tt(T,t(F))),y(ot,g)};gt(I,ot=>{t(F)&&ot(jt)})}var C=s(I,2);{var vt=ot=>{var g=li(),T=r(g,!0);o(g),lt(()=>tt(T,t(X))),y(ot,g)};gt(C,ot=>{t(X)&&ot(vt)})}o(Jt),lt(()=>{fe(Pt,`--scroll-duration: ${t(B)}s; --scroll-direction: ${J()}`),tt(n,(Tt(E()),k(()=>E().name))),tt(_,(Tt(E()),k(()=>E().country))),tt($,t(d)||Y)}),y(bt,kt)},Kt=bt=>{var kt=ci();y(bt,kt)};gt(ct,bt=>{t(yt),k(()=>t(yt).length)?bt(Ut):bt(Kt,!1)},!0)}y(D,it)};gt(dt,D=>{t(M)==="error"?D(O):D(Rt,!1)},!0)}y(pt,St)};gt(z,pt=>{t(M)==="loading"?pt(R):pt(nt,!1)})}o(f),lt(()=>be(f,"aria-label",(Tt(E()),k(()=>`Images for ${E().name}`)))),y(b,f)},Zt=b=>{var f=ne(),z=te(f);{var R=pt=>{var St=bi(),dt=r(St);{var O=D=>{var it=di();y(D,it)},Rt=D=>{var it=ne(),ct=te(it);{var Ut=bt=>{var kt=vi(),Pt=r(kt,!0);o(kt),lt(()=>tt(Pt,t(v))),y(bt,kt)},Kt=bt=>{var kt=ne(),Pt=te(kt);{var Jt=a=>{var n=fi();let c;var _=r(n);let w;var $=s(_,2);let I;o(n),lt(()=>{c=Ue(n,1,"sprite-runner svelte-f9uau2",null,c,{paused:!t(ft)}),fe(n,`--scroll-duration: ${t(B)}s; --scroll-direction: ${J()==="reverse"?"reverse":"normal"};`),w=fe(_,`--sprite-ratio: ${t(ut)};`,w,{"background-image":`url("${t(ft)}")`}),I=fe($,`--sprite-ratio: ${t(ut)};`,I,{"background-image":`url("${t(ft)}")`})}),y(a,n)},e=a=>{var n=pi();y(a,n)};gt(Pt,a=>{t(ft)?a(Jt):a(e,!1)},!0)}y(bt,kt)};gt(ct,bt=>{t(M)==="error"?bt(Ut):bt(Kt,!1)},!0)}y(D,it)};gt(dt,D=>{t(M)==="loading"?D(O):D(Rt,!1)})}o(St),y(pt,St)},nt=pt=>{var St=Ei(),dt=r(St);{var O=D=>{var it=mi();y(D,it)},Rt=D=>{var it=ne(),ct=te(it);{var Ut=bt=>{var kt=_i(),Pt=r(kt,!0);o(kt),lt(()=>tt(Pt,t(v))),y(bt,kt)},Kt=bt=>{var kt=ne(),Pt=te(kt);{var Jt=a=>{var n=wi();ie(n,5,()=>t(rt),c=>c.image,(c,_)=>{var w=yi(),$=r(w);{let C=Le(()=>(t(_),k(()=>xt(t(_).image)))),vt=Le(()=>(t(_),Tt(E()),k(()=>t(_).caption??`${E().name} skyline`)));la($,{get src(){return t(C)},get alt(){return t(vt)},loading:"lazy",decoding:"async"})}var I=s($,2);{var jt=C=>{var vt=gi(),ot=r(vt),g=s(ot);{var T=W=>{var Z=hi(),mt=r(Z);o(Z),lt(()=>tt(mt,`¬∑ ${t(_),k(()=>t(_).credit)??""}`)),y(W,Z)};gt(g,W=>{t(_),k(()=>t(_).credit)&&W(T)})}o(vt),lt(()=>tt(ot,`${t(_),k(()=>t(_).caption)??""} `)),y(C,vt)};gt(I,C=>{Tt(K()),t(_),k(()=>K()&&t(_).caption)&&C(jt)})}o(w),y(c,w)}),o(n),y(a,n)},e=a=>{var n=xi();y(a,n)};gt(Pt,a=>{t(rt),k(()=>t(rt).length)?a(Jt):a(e,!1)},!0)}y(bt,kt)};gt(ct,bt=>{t(M)==="error"?bt(Ut):bt(Kt,!1)},!0)}y(D,it)};gt(dt,D=>{t(M)==="loading"?D(O):D(Rt,!1)})}o(St),lt(()=>be(St,"aria-label",(Tt(E()),k(()=>`Images for ${E().name}`)))),y(pt,St)};gt(z,pt=>{u()==="background"?pt(R):pt(nt,!1)},!0)}y(b,f)};gt(Dt,b=>{u()==="inline"?b(at):b(Zt,!1)})}y(m,Et),he()}var zi=j('<span class="chip svelte-jdafhq"><span class="label svelte-jdafhq">Country</span> <strong class="svelte-jdafhq"> </strong></span>'),ki=j('<span class="chip status-chip svelte-jdafhq" role="status"><span class="label svelte-jdafhq">Status</span> <strong class="svelte-jdafhq">Session cleared.</strong></span>'),ji=j('<div class="confirm-backdrop svelte-jdafhq" role="presentation"><div class="confirm-box svelte-jdafhq" role="dialog" aria-modal="true" aria-labelledby="reset-heading"><h3 id="reset-heading" class="svelte-jdafhq">Clear all saved data?</h3> <p class="svelte-jdafhq">This removes your ballot inputs and undo history from this device. You cannot undo this action.</p> <div class="confirm-actions svelte-jdafhq"><button type="button" class="danger svelte-jdafhq">Yes, clear everything</button> <button type="button" class="svelte-jdafhq">Cancel</button></div></div></div>'),qi=j('<div><!> <span class="chip chip-button static svelte-jdafhq"><span class="label svelte-jdafhq">Last saved</span> <span class="chip-content svelte-jdafhq"><span class="chip-icon svelte-jdafhq" aria-hidden="true">üíæ</span> <strong class="svelte-jdafhq"> </strong></span></span> <button type="button" class="chip chip-button svelte-jdafhq"><span class="label svelte-jdafhq"><span class="btn-icon svelte-jdafhq" aria-hidden="true">üóë</span> Reset</span> <strong class="svelte-jdafhq">Clear ballot</strong></button> <!></div> <!>',1);function $i(m,L){_e(L,!1);const d=()=>ve(Ne,"$settingsStore",X),F=()=>ve(pe,"$voteSessionStore",X),[X,B]=Qe(),E=h();let u=Gt(L,"inline",8,!1);const J=je();let K=h(!1),qt=h(!1),$t=null,Mt=h(),At=h();function H(){i(K,!0)}function Y(){i(K,!1)}function _t(){pe.clear(),xa.reset(),oe.clear(),Ne.update(q=>({...q,preferredMode:null})),i(qt,!0),Y(),$t&&clearTimeout($t),$t=setTimeout(()=>{i(qt,!1)},3500),J("cleared")}Be(()=>{$t&&clearTimeout($t)});const zt=u()?"status-inline":"status-ribbon";U(()=>d(),()=>{i(Mt,d())}),U(()=>F(),()=>{i(At,F())}),U(()=>t(At),()=>{i(E,t(At).lastUpdated?new Date(t(At).lastUpdated).toLocaleTimeString():"Not saved yet")}),xe(),me();var M=qi(),V=te(M),rt=r(V);{var yt=q=>{var N=zi(),wt=s(r(N),2),G=r(wt,!0);o(wt),o(N),lt(()=>tt(G,(t(Mt),k(()=>t(Mt).countryKey)))),y(q,N)};gt(rt,q=>{t(Mt),k(()=>t(Mt).countryKey)&&q(yt)})}var v=s(rt,2),S=s(r(v),2),l=s(r(S),2),x=r(l,!0);o(l),o(S),o(v);var et=s(v,2),ft=s(et,2);{var st=q=>{var N=ki();y(q,N)};gt(ft,q=>{t(qt)&&q(st)})}o(V);var ut=s(V,2);{var p=q=>{var N=ji(),wt=r(N),G=s(r(wt),4),xt=r(G),Wt=s(xt,2);o(G),o(wt),o(N),A("click",xt,_t),A("click",Wt,Y),y(q,N)};gt(ut,q=>{t(K)&&q(p)})}lt(()=>{Ue(V,1,wa(zt),"svelte-jdafhq"),tt(x,t(E))}),A("click",et,H),y(m,M),he(),B()}var Ci=j('<div class="info-chip summary-chip svelte-1mrulz2"><span aria-hidden="true">‚ÑπÔ∏è</span> </div>'),Mi=j('<div class="info-chip summary-chip error svelte-1mrulz2"><span aria-hidden="true">‚ö†</span> City insights not available.</div>'),Li=j('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üå§</span> </div>'),Ti=j('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üçΩ</span> </div>'),Ai=j('<tr class="city-row svelte-1mrulz2"><th scope="row" class="city-col svelte-1mrulz2"><div class="city-card svelte-1mrulz2"><div class="row-bg svelte-1mrulz2"><!></div> <div class="row-content svelte-1mrulz2"><div class="city-headline svelte-1mrulz2"><div class="city-title svelte-1mrulz2"><span class="city-country svelte-1mrulz2"><span class="flag svelte-1mrulz2" aria-hidden="true"> </span> </span> <span class="city-name svelte-1mrulz2"> </span></div></div> <div class="meta-stack svelte-1mrulz2"><!> <!> <!></div></div></div></th><td class="utility-col svelte-1mrulz2"><!></td><td class="probability-col svelte-1mrulz2"><div class="probability-cell svelte-1mrulz2"><div class="input-stack svelte-1mrulz2"><!> <button type="button" class="row-reset svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚ü≤</span> Reset</button></div></div></td></tr>'),Ri=j('<section class="grid-shell svelte-1mrulz2"><header class="grid-header svelte-1mrulz2"><!> <div class="toolbar svelte-1mrulz2"><!> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Ü∫</span> Undo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Üª</span> Redo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">üõ†</span> Bulk Actions</button></div></header> <div class="table-scroll svelte-1mrulz2"><table class="svelte-1mrulz2"><colgroup><col class="col-city svelte-1mrulz2"/><col class="col-utility svelte-1mrulz2"/><col class="col-probability svelte-1mrulz2"/></colgroup><thead class="svelte-1mrulz2"><tr><th scope="col" class="city-header svelte-1mrulz2">City</th><th scope="col" class="utility-header svelte-1mrulz2">Favorability</th><th scope="col" class="probability-header svelte-1mrulz2">Probability</th></tr></thead><tbody class="svelte-1mrulz2"></tbody></table></div> <!></section>');function Pi(m,L){_e(L,!1);const d=()=>ve(sa,"$citiesStore",u),F=()=>ve(Sa,"$citiesDocumentStore",u),X=()=>ve(pe,"$voteSessionStore",u),B=()=>ve(oe,"$commandHistoryStore",u),E=()=>ve(Ne,"$settingsStore",u),[u,J]=Qe(),K=Object.assign({"../data/static/meta/athens-greece.json":ja,"../data/static/meta/bangkok-thailand.json":qa,"../data/static/meta/belgrade-serbia.json":$a,"../data/static/meta/bucharest-romania.json":Ca,"../data/static/meta/budapest-hungary.json":Ma,"../data/static/meta/buenos-aires-argentina.json":La,"../data/static/meta/cairo-egypt.json":Ta,"../data/static/meta/cartagena-colombia.json":Aa,"../data/static/meta/casablanca-morocco.json":Ra,"../data/static/meta/chiang-mai-thailand.json":Pa,"../data/static/meta/delhi-india.json":Da,"../data/static/meta/doha-qatar.json":Ia,"../data/static/meta/dubai-uae.json":Na,"../data/static/meta/dublin-ireland.json":Oa,"../data/static/meta/florence-italy.json":Ba,"../data/static/meta/guadalajara-mexico.json":Ua,"../data/static/meta/hanoi-vietnam.json":Ha,"../data/static/meta/helsinki-finland.json":Va,"../data/static/meta/ho-chi-minh-city-vietnam.json":Fa,"../data/static/meta/hong-kong-hong-kong.json":Ka,"../data/static/meta/jakarta-indonesia.json":Ya,"../data/static/meta/krakow-poland.json":Ga,"../data/static/meta/lima-peru.json":Wa,"../data/static/meta/ljubljana-slovenia.json":Xa,"../data/static/meta/lyon-france.json":Ja,"../data/static/meta/madrid-spain.json":Za,"../data/static/meta/manila-philippines.json":Qa,"../data/static/meta/marrakesh-morocco.json":tn,"../data/static/meta/mendoza-argentina.json":en,"../data/static/meta/mumbai-india.json":an,"../data/static/meta/munich-germany.json":nn,"../data/static/meta/nairobi-kenya.json":on,"../data/static/meta/nicosia-cyprus.json":rn,"../data/static/meta/prague-czech-republic.json":ln,"../data/static/meta/quito-ecuador.json":sn,"../data/static/meta/rio-de-janeiro-brazil.json":cn,"../data/static/meta/rotterdam-netherlands.json":un,"../data/static/meta/santiago-chile.json":dn,"../data/static/meta/sao-paulo-brazil.json":vn,"../data/static/meta/seoul-south-korea.json":fn,"../data/static/meta/seville-spain.json":pn,"../data/static/meta/stockholm-sweden.json":bn,"../data/static/meta/taipei-taiwan.json":mn,"../data/static/meta/tashkent-uzbekistan.json":_n,"../data/static/meta/template.json":hn,"../data/static/meta/thessaloniki-greece.json":gn,"../data/static/meta/tunis-tunisia.json":yn,"../data/static/meta/vienna-austria.json":wn,"../data/static/meta/warsaw-poland.json":xn,"../data/static/meta/zagreb-croatia.json":En}),qt=/\/meta\/([^/]+)\.json$/,$t={};for(const[a,n]of Object.entries(K)){const c=qt.exec(a);if(!c)continue;const _=c[1],w=Ea.parse(n);$t[_]=w}const Mt={Greece:"üá¨üá∑",Thailand:"üáπüá≠",Serbia:"üá∑üá∏",Argentina:"üá¶üá∑",Romania:"üá∑üá¥",Hungary:"üá≠üá∫",Egypt:"üá™üá¨",Morocco:"üá≤üá¶",Ireland:"üáÆüá™",UAE:"üá¶üá™",Italy:"üáÆüáπ",Vietnam:"üáªüá≥",Finland:"üá´üáÆ","Hong Kong":"üá≠üá∞",Peru:"üáµüá™",France:"üá´üá∑",Spain:"üá™üá∏",Philippines:"üáµüá≠",Germany:"üá©üá™",Cyprus:"üá®üáæ","Czech Republic":"üá®üáø",Brazil:"üáßüá∑",Netherlands:"üá≥üá±",Chile:"üá®üá±","South Korea":"üá∞üá∑",Sweden:"üá∏üá™",Taiwan:"üáπüáº",Uzbekistan:"üá∫üáø",Tunisia:"üáπüá≥",Croatia:"üá≠üá∑"};function At(a){return Mt[a]??"üåç"}let H=h([]),Y=h({}),_t=h([]),zt=h(null),M=h(pe.getSnapshot()),V=h({past:[],future:[]}),rt=h();const yt=$t;let v=h(!1),S=h(null),l=h(!1),x=h([]),et=h([]);const ft={},st=["utility","probability"],ut=je();let p=h(!1),q=h(!1),N=h([]),wt=h(!1);const G="reunion-phase2:grid-order";function xt(a,n){const c=n.detail.value;Dt(a,"utility",c)}function Wt(a,n){const c=n.detail.value;Dt(a,"probability",c)}function P(){An(),i(v,!0)}function Ct(){i(v,!1),Rn()}function Nt(){if(!t(H).length)return;const a=t(H).map(n=>n.id);for(let n=a.length-1;n>0;n-=1){const c=Math.floor(Math.random()*(n+1));[a[n],a[c]]=[a[c],a[n]]}i(et,a),Vt(a)}function Ot(){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(G);if(!a)return null;const n=JSON.parse(a);return Array.isArray(n)?n:null}catch{return null}}function Vt(a){if(!(typeof localStorage>"u"))try{localStorage.setItem(G,JSON.stringify(a))}catch{}}function It(a){return yt[a]??null}function Ft(a){const n=It(a);return n?.food_and_drink?.length?n.food_and_drink.slice(0,2).join(" ‚Ä¢ "):null}function Xt(a){return It(a)?.seasonal_notes??null}function Ht(){Nt(),ut("reset")}function Bt(a){const{actions:n}=a.detail;if(!n||n.length===0){Ct();return}const c={},_=g=>Math.max(0,Math.min(100,Math.round(g))),w=(g,T)=>{const W=c[g];if(W&&W[T]!==void 0){const Lt=W[T];return typeof Lt=="number"?Lt:0}const mt=t(M).entries[g]?.[T]??null;return typeof mt=="number"?mt:0},$=(g,T,W)=>{let Z=c[g];Z||(Z={},c[g]=Z),Z[T]=_(W)},I=t(H).map(g=>g.id),jt={};for(const g of t(H))(jt[g.continent]??=[]).push(g.id);const C=(g,T,W)=>{for(const Z of g)$(Z,T,W)},vt=(g,T,W)=>{for(const Z of g){const mt=w(Z,T);$(Z,T,mt+W)}};for(const g of n)switch(g.type){case"setAllProbabilities":C(I,"probability",g.value);break;case"setAllUtilities":C(I,"utility",g.value);break;case"adjustAllUtilities":vt(I,"utility",g.delta);break;case"adjustAllProbabilities":vt(I,"probability",g.delta);break;case"normalizeProbabilities":{const T=_(g.target),W=I.map(mt=>w(mt,"probability")),Z=W.reduce((mt,Lt)=>mt+Lt,0)/(W.length||1);if(Z===0)C(I,"probability",T);else{const mt=T/Z;W.forEach((Lt,Qt)=>{const re=_(Lt*mt);$(I[Qt],"probability",re)})}break}case"setContinentUtility":{const T=jt[g.continent]??[];C(T,"utility",g.value);break}case"adjustContinentUtility":{const T=jt[g.continent]??[];vt(T,"utility",g.delta);break}case"setContinentProbability":{const T=jt[g.continent]??[];C(T,"probability",g.value);break}case"adjustContinentProbability":{const T=jt[g.continent]??[];vt(T,"probability",g.delta);break}}const ot=[];for(const[g,T]of Object.entries(c)){const W=t(M).entries[g],Z={};let mt=!1;if(T.utility!==void 0){const Lt=_(T.utility);(W?.utility??null)!==Lt&&(Z.utility=Lt,Z.autoFilled=!1,mt=!0)}if(T.probability!==void 0){const Lt=_(T.probability);(W?.probability??null)!==Lt&&(Z.probability=Lt,mt=!0)}mt&&ot.push({cityId:g,updates:Z})}ot.length!==0&&(oe.execute({label:`Bulk actions (${ot.length} cities)`,scope:["vote"],perform:()=>{for(const{cityId:g,updates:T}of ot)pe.updateEntry(g,T)}}),za(`Applied bulk actions to ${ot.length} ${ot.length===1?"city":"cities"}.`))}function Et(a){return t(M).entries[a]??{cityId:a,utility:null,probability:null,autoFilled:!1}}function Dt(a,n,c){if((t(M).entries[a]?.[n]??null)===c)return;const $=n==="utility"?{utility:c,autoFilled:!1}:{probability:c};oe.execute({label:`${n==="utility"?"Favorability":"Probability"} ‚Üí ${a}`,scope:["vote"],perform:()=>{pe.updateEntry(a,$)}})}function at(a){t(M).entries[a]&&oe.execute({label:`Reset ${a}`,scope:["vote"],perform:()=>pe.resetCity(a)})}function Zt(a,n,c){if(!c)return;c.dataset.cityId=a,c.dataset.column=n;const _=ft[a]??{};_[n]=c,ft[a]=_}function b(a,n,c){const _=ft[a];_&&_[n]===c&&(delete _[n],ft[a]=_)}function f(a,n,c=!1){const w=ft[a]?.[n];return!w||"disabled"in w&&w.disabled?!1:(w.focus(),typeof w.select=="function"&&w.select(),c&&setTimeout(()=>{w.dispatchEvent(new CustomEvent("auto-open",{bubbles:!1}))},0),!0)}function z(a,n,c=!0){if(f(a,n,c)||!t(S))return;const _=t(S).querySelector(`tr[data-row="${a}"]`);_&&(_.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{f(a,n,c)},120))}function R(a,n,c){const _=st.length,w=t(x).findIndex(ot=>ot.city.id===a);if(w===-1)return;const $=st.indexOf(n);if($===-1)return;const I=w*_+$,jt=Math.min(t(x).length*_-1,Math.max(0,I+c)),C=t(x)[Math.floor(jt/_)],vt=st[jt%_];C&&z(C.city.id,vt)}function nt(a){const{key:n}=a;if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"].includes(n))return;const c=a.target;if(!(c instanceof HTMLElement))return;const _=c.dataset.cityId,w=c.dataset.column;if(!_||!w)return;let $=t(H).findIndex(vt=>vt.id===_);if($===-1)return;let I=st.indexOf(w);if(I===-1)return;switch(a.preventDefault(),n){case"ArrowUp":$=Math.max(0,$-1);break;case"ArrowDown":$=Math.min(t(H).length-1,$+1);break;case"ArrowLeft":I>0?I-=1:$>0&&($-=1,I=st.length-1);break;case"ArrowRight":I<st.length-1?I+=1:$<t(H).length-1&&($+=1,I=0);break;case"Home":I=0;break;case"End":I=st.length-1;break}const jt=t(H)[$],C=st[I];z(jt.id,C,!0)}function pt(a){!(a.ctrlKey||a.metaKey)||a.key.toLowerCase()!=="z"||(a.preventDefault(),a.shiftKey?oe.redo():oe.undo())}function St(){oe.undo()}function dt(){oe.redo()}Ae(()=>(window.addEventListener("keydown",pt),Nt(),()=>{window.removeEventListener("keydown",pt)})),U(()=>d(),()=>{i(H,d())}),U(()=>t(H),()=>{i(Y,Object.fromEntries(t(H).map(a=>[a.id,a])))}),U(()=>(t(H),t(et),t(Y)),()=>{if(t(H).length&&t(et).length!==t(H).length){const a=Ot();a?.length===t(H).length?i(et,a.filter(n=>t(Y)[n])):(i(et,t(H).map(n=>n.id)),Vt(t(et)))}}),U(()=>(t(et),t(Y)),()=>{i(_t,t(et).map(a=>t(Y)[a]).filter(a=>!!a))}),U(()=>F(),()=>{i(zt,F())}),U(()=>X(),()=>{i(M,X())}),U(()=>B(),()=>{i(V,B())}),U(()=>E(),()=>{i(rt,E())}),U(()=>(t(M),t(_t),t(H)),()=>{t(M);const a=t(_t).length===t(H).length&&t(_t).length>0?t(_t):t(H);i(x,a.map((n,c)=>{const _=Et(n.id);return{city:n,entry:_,index:c,meta:It(n.id)}}))}),U(()=>t(V),()=>{i(p,(t(V).past??[]).length>0)}),U(()=>t(V),()=>{i(q,(t(V).future??[]).length>0)}),U(()=>(t(rt),t(l)),()=>{i(wt,!!t(rt)?.countryKey&&!t(l))}),U(()=>(t(zt),t(H)),()=>{i(N,t(zt)?.continents?.length?[...t(zt).continents]:Array.from(new Set(t(H).map(a=>a.continent))).sort())}),xe(),me();var O=Ri(),Rt=r(O),D=r(Rt);$i(D,{inline:!0,$$events:{cleared:Ht}});var it=s(D,2),ct=r(it);ei(ct,{});var Ut=s(ct,2),Kt=s(Ut,2),bt=s(Kt,2);o(it),o(Rt);var kt=s(Rt,2),Pt=r(kt),Jt=s(r(Pt),2);ie(Jt,5,()=>t(x),a=>a.city.id,(a,n)=>{var c=Ai(),_=r(c),w=r(_),$=r(w),I=r($);{let Q=Le(()=>(t(n),k(()=>t(n).index%2===0?"normal":"reverse")));Si(I,{get city(){return t(n),k(()=>t(n).city)},variant:"background",get direction(){return t(Q)}})}o($);var jt=s($,2),C=r(jt),vt=r(C),ot=r(vt),g=r(ot),T=r(g,!0);o(g);var W=s(g);o(ot);var Z=s(ot,2),mt=r(Z,!0);o(Z),o(vt),o(C);var Lt=s(C,2),Qt=r(Lt);{var re=Q=>{var Yt=Ci(),de=s(r(Yt));o(Yt),lt(()=>tt(de,` ${t(n),k(()=>t(n).meta.summary)??""}`)),y(Q,Yt)},le=Q=>{var Yt=Mi();y(Q,Yt)};gt(Qt,Q=>{t(n),k(()=>t(n).meta)?Q(re):Q(le,!1)})}var ee=s(Qt,2);{var se=Q=>{var Yt=Li(),de=s(r(Yt));o(Yt),lt(ge=>tt(de,` ${ge??""}`),[()=>(t(n),k(()=>Xt(t(n).city.id)))]),y(Q,Yt)};gt(ee,Q=>{t(n),k(()=>Xt(t(n).city.id))&&Q(se)})}var ce=s(ee,2);{var ue=Q=>{var Yt=Ti(),de=s(r(Yt));o(Yt),lt(ge=>tt(de,` ${ge??""}`),[()=>(t(n),k(()=>Ft(t(n).city.id)))]),y(Q,Yt)};gt(ce,Q=>{t(n),k(()=>Ft(t(n).city.id))&&Q(ue)})}o(Lt),o(jt),o(w),o(_);var ae=s(_),Re=r(ae);qn(Re,{get value(){return t(n),k(()=>t(n).entry.utility)},$$events:{commit:Q=>xt(t(n).city.id,Q),register:Q=>Zt(t(n).city.id,"utility",Q.detail.element),unregister:Q=>b(t(n).city.id,"utility",Q.detail.element),advance:Q=>R(t(n).city.id,"utility",Q.detail?.direction??1,Q.detail?.open??!0)}}),o(ae);var qe=s(ae),$e=r(qe),Ee=r($e),Se=r(Ee);Ln(Se,{get value(){return t(n),k(()=>t(n).entry.probability)},$$events:{commit:Q=>Wt(t(n).city.id,Q),register:Q=>Zt(t(n).city.id,"probability",Q.detail.element),unregister:Q=>b(t(n).city.id,"probability",Q.detail.element),advance:Q=>R(t(n).city.id,"probability",Q.detail?.direction??1,Q.detail?.open??!0)}});var He=s(Se,2);o(Ee),o($e),o(qe),o(c),lt(Q=>{be(c,"data-row",(t(n),k(()=>t(n).city.id))),tt(T,Q),tt(W,` ${t(n),k(()=>t(n).city.country)??""}`),tt(mt,(t(n),k(()=>t(n).city.name)))},[()=>(t(n),k(()=>At(t(n).city.country)))]),A("click",He,()=>at(t(n).city.id)),y(a,c)}),o(Jt),o(Pt),o(kt),we(kt,a=>i(S,a),()=>t(S));var e=s(kt,2);On(e,{get open(){return t(v)},get continents(){return t(N)},$$events:{cancel:Ct,apply:Bt}}),o(O),lt(()=>{Ut.disabled=!t(p),Kt.disabled=!t(q)}),A("click",Ut,St),A("click",Kt,dt),A("click",bt,P),A("keydown",Pt,nt),y(m,O),he(),J()}var Di=j(`<section class="hero svelte-yczqw6"><h1 class="svelte-yczqw6">Phase 2 Ballot Guide</h1> <p class="lede svelte-yczqw6">Record personal utility U(c) on a 0‚Äì100 scale for each finalist city and estimate your attendance probability P(c) as a percentage. Everything stays local until you export the JSON ballot.</p> <section class="phase-cards svelte-yczqw6"><article class="svelte-yczqw6"><h2>Phase 0 ¬∑ Externality</h2> <ul class="svelte-yczqw6"><li>Each voter valued a hypothetical ‚Äú+1 extra attendee.‚Äù</li> <li>Responses combined via 10% trimmed mean (median fallback if &lt;10 voters).</li> <li class="svelte-yczqw6">The shared externality constant is <strong class="svelte-yczqw6">E = 24.4</strong>.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 1 ¬∑ Pruning</h2> <ul class="svelte-yczqw6"><li>A binary vote trimmed 86 nominees down to the top 37 (plus ties).</li> <li>That survivor list became the finalist pool you are filling out now.</li> <li>Round totals (S1) were published for transparency.</li></ul></article> <article class="current svelte-yczqw6"><h2>Phase 2 ¬∑ Your Ballot</h2> <span class="current-tag svelte-yczqw6">Current step</span> <ul class="svelte-yczqw6"><li>Enter personal utility U(c) for every finalist.</li> <li>Estimate attendance probability P(c); values are not auto-normalized.</li> <li>Export JSON mirrors these entries exactly for Phase 3 submission.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 3 ¬∑ Aggregation</h2> <ul class="svelte-yczqw6"><li>Coordinators aggregate attendance (Att) and expected utility (EU) across ballots.</li> <li>TEW(c) = EU(c) + (24.4 √ó N) √ó Att(c); highest TEW wins after tie-breakers.</li> <li>Tie-break order: higher Att, higher median U among P‚â•50%, higher overall median U.</li></ul></article></section> <section class="framework svelte-yczqw6"><h3 class="svelte-yczqw6">Total Expected Welfare snapshot</h3> <pre class="svelte-yczqw6">TEW(c) = EU(c) + (24.4 √ó N) √ó Att(c)</pre> <p>Att(c) is the expected attendee count (Œ£ P_i(c)/100) and EU(c) is the expected personal utility (Œ£ (P_i(c)/100) √ó U_i(c)). During Phase 3 the coordinators compute these values from the exported ballots and publish the full scoring table.</p> <h3 class="svelte-yczqw6">Next-year accountability</h3> <p>If a voter reports a high probability for the winning city but skips the reunion without force-majeure proof, next year's ballot is scaled by 1 ‚àí P<sub>winning</sub>/200. Accurate percentages keep your future weight intact.</p></section> <footer class="modal-footer svelte-yczqw6"><button type="button" class="primary svelte-yczqw6">Start filling the grid</button></footer></section>`);function Ii(m,L){_e(L,!1);let d=Gt(L,"open",8,!1);const F=je();function X(){F("close")}me();var B=ne(),E=te(B);{var u=J=>{var K=Di(),qt=s(r(K),8),$t=r(qt);o(qt),o(K),A("click",$t,X),y(J,K)};gt(E,J=>{d()&&J(u)})}y(m,B),he()}var Ni=j('<div class="page-container svelte-1uha8ag"><div class="countdown-banner svelte-1uha8ag" aria-live="polite"> </div> <!></div>');function Ko(m,L){_e(L,!1);const d="reunion-phase2:phase-explainer-dismissed:v1",F="v1",X=Date.UTC(2025,10,28,21,0,0);let B=h(!1),E=H(X-Date.now()),u=Y(E),J=h(_t(u)),K=h(zt(E)),qt=null;Ae(()=>{Ne.update(x=>x.preferredMode==="grid"?x:{...x,preferredMode:"grid"}),typeof pe.setMode=="function"&&pe.setMode("grid");const l=localStorage.getItem(d);i(B,l!==F),We.set(t(B)),At(),qt=setInterval(At,3e4)}),Be(()=>{qt&&(clearInterval(qt),qt=null)});function $t(){i(B,!1),localStorage.setItem(d,F),requestAnimationFrame(()=>window.scrollTo({top:0,behavior:"smooth"})),We.set(!1)}function Mt(){localStorage.removeItem(d),i(B,!0),We.set(!0)}function At(){const l=X-Date.now();E=H(l),u=Y(E),i(J,_t(u)),i(K,zt(E))}function H(l){if(l<=0)return"Voting closed";const x=Math.max(0,Math.floor(l/6e4)),et=Math.floor(x/1440),ft=Math.floor((x-et*24*60)/60),st=x%60,ut=String(ft).padStart(2,"0"),p=String(st).padStart(2,"0");return`${et}d ${ut}:${p}`}function Y(l){return l==="Voting closed"?l:`Voting ends in ${l} GMT`}function _t(l){const x="Reunion 2026 ‚Äî Lightning Grid";return l?`${x} (${l})`:x}function zt(l){return l==="Voting closed"?"Voting closed on Fri Nov 28, 2025 at 21:00 GMT":`Voting closes in ${l} (Fri Nov 28, 2025 ¬∑ 21:00 GMT)`}me();var M=Ni();ka("1uha8ag",l=>{lt(()=>_a.title=t(J)??"")});var V=r(M),rt=r(V,!0);o(V);var yt=s(V,2);{var v=l=>{Ii(l,{open:!0,$$events:{close:$t}})},S=l=>{Pi(l,{$$events:{reset:Mt}})};gt(yt,l=>{t(B)?l(v):l(S,!1)})}o(M),lt(()=>tt(rt,t(K))),y(m,M),he()}export{Ko as component};
