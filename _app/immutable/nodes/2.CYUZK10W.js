import{f as $,g as D,s as at,a as h,b as ee,d as ce,e as Je,r as ua}from"../chunks/DscdaUK8.js";import{i as fe}from"../chunks/tUnkN8nb.js";import{c as ze,a as Ze,b as da,o as Qe}from"../chunks/DX2lUfdR.js";import{e as he,u as j,aN as va,N as Ce,a9 as Le,V as fa,r as pa,aO as ba,v as pe,ac as B,a as t,a7 as g,s as a,C as Tt,ad as ye,z as r,A as i,y as s,w as dt,x as be,aa as te,aP as Re,aQ as Ee,d as Ae,ae as _a}from"../chunks/CtXWJ4Rl.js";import{i as wt}from"../chunks/j1nT2hqj.js";import{s as ve,b as ae,c as Ue,a as ue,j as ma,k as Pe,m as ie,n as la,o as Xe,q as ha,u as ga,w as ya,f as Ie,v as de,x as wa,y as xa,z as Sa,g as Ea,h as za,i as Ye}from"../chunks/BU4FSgLZ.js";import ka from"../chunks/DN3J-sCw.js";import ja from"../chunks/BKbm5EfA.js";import qa from"../chunks/BvbcL8L1.js";import $a from"../chunks/CpqWQj0X.js";import Ma from"../chunks/CMBHzUVU.js";import Ca from"../chunks/BNFRKsyx.js";import Aa from"../chunks/CvpCKVSJ.js";import La from"../chunks/DKqRZLee.js";import Ta from"../chunks/e1t1TJwC.js";import Ra from"../chunks/pOAIlSuq.js";import Pa from"../chunks/CDr_-IW6.js";import Da from"../chunks/DkwgWrlg.js";import Ia from"../chunks/BdPnv_Ww.js";import Oa from"../chunks/Wp1az9L3.js";import Ua from"../chunks/BozMgj6L.js";import Ba from"../chunks/ChEK7k_d.js";import Na from"../chunks/BT5hMKdo.js";import Ha from"../chunks/DZg2n5Gj.js";import Va from"../chunks/B--_m8y4.js";import Ka from"../chunks/BPfJ8Mnp.js";import Fa from"../chunks/BbyHsVxX.js";import Ya from"../chunks/D1dfjzr5.js";import Wa from"../chunks/sTVjfoeb.js";import Ga from"../chunks/BJv4UY2l.js";import Xa from"../chunks/DqmJETbX.js";import Ja from"../chunks/Dbr1vHU4.js";import Za from"../chunks/DIrtYIXF.js";import Qa from"../chunks/ZuxV2OeQ.js";import tn from"../chunks/BBQehyBW.js";import en from"../chunks/CTUHu1i9.js";import an from"../chunks/DgcN0BtG.js";import nn from"../chunks/D89J0wRi.js";import on from"../chunks/D3GOXJB7.js";import rn from"../chunks/KMlGcXzU.js";import ln from"../chunks/hyOVM0Ug.js";import sn from"../chunks/D_zlzWZC.js";import cn from"../chunks/DBEQdhVc.js";import un from"../chunks/Kieb5-lA.js";import dn from"../chunks/nEnXKinN.js";import vn from"../chunks/t4Dmsr4x.js";import fn from"../chunks/CXnItg8R.js";import pn from"../chunks/DWD3NyID.js";import bn from"../chunks/BGVZ31-y.js";import _n from"../chunks/DK9tbYvT.js";import mn from"../chunks/9Ve3I6w0.js";import hn from"../chunks/DkuNIGT0.js";import gn from"../chunks/CuS-bfel.js";import yn from"../chunks/D7_Q8Xbe.js";import wn from"../chunks/BVE7Js9b.js";import xn from"../chunks/B-q0s-Uw.js";import{b as ge}from"../chunks/BkcxXaB0.js";import{p as Xt,l as na}from"../chunks/CvkxTUf8.js";function Oe(p,R,u){he(()=>{var V=j(()=>R(p,u?.())||{});if(V?.destroy)return()=>V.destroy()})}function Sn(p,R,u=R){var V=new WeakSet;va(p,"input",async O=>{var X=O?p.defaultValue:p.value;if(X=We(p)?Ge(X):X,u(X),Ce!==null&&V.add(Ce),await Le(),X!==(X=R())){var C=p.selectionStart,c=p.selectionEnd,J=p.value.length;if(p.value=X??"",c!==null){var W=p.value.length;C===c&&c===J&&W>J?(p.selectionStart=W,p.selectionEnd=W):(p.selectionStart=C,p.selectionEnd=Math.min(c,W))}}}),(fa&&p.defaultValue!==p.value||j(R)==null&&p.value)&&(u(We(p)?Ge(p.value):p.value),Ce!==null&&V.add(Ce)),pa(()=>{var O=R();if(p===document.activeElement){var X=ba??Ce;if(V.has(X))return}We(p)&&O===Ge(p.value)||p.type==="date"&&!O&&!p.value||O!==p.value&&(p.value=O??"")})}function We(p){var R=p.type;return R==="number"||R==="range"}function Ge(p){return p===""?null:+p}function ia(p){return typeof p=="string"?p?document.querySelector(p):null:p??null}function sa(p,R="body"){let u=ia(R)??document.body;return u&&u.appendChild(p),{update(V){const O=ia(V)??document.body;O===u||!O||(p.parentNode&&p.parentNode.removeChild(p),O.appendChild(p),u=O)},destroy(){p.parentNode&&p.parentNode.removeChild(p)}}}var En=$('<button type="button"> </button>'),zn=$('<div class="radial svelte-furii8"><div class="radial-label svelte-furii8"> </div> <!></div>'),kn=$('<div class="picker svelte-furii8"><button type="button" class="value-button svelte-furii8" aria-label="Utility value"><span class="value-label svelte-furii8"> </span></button> <p class="hint svelte-furii8" aria-live="polite"> </p> <!></div>');function jn(p,R){pe(R,!1);const u=g(),V=g(),O=g(),X=g();let C=Xt(R,"value",8,null),c=Xt(R,"disabled",8,!1);const J=0,W=100,Lt=Array.from({length:11},(e,l)=>l*10),lt=176,jt=62,Ot=Lt.length;function Z(e){const l=e/Ot*Math.PI*2-Math.PI/2,f=Math.cos(l)*jt,q=Math.sin(l)*jt;return`translate(calc(-50% + ${f}px), calc(-50% + ${q}px))`}const nt=120,zt=120,Mt=250,P=12,st="[data-result-pane]",N=ze();let A=g(!1),w=g(null),_=g(void 0),m=g(null),Q=g(null),ht=g(""),ft=!1,tt=0,b=g(null),it=null,T=!1,K=0,rt=null;const pt=e=>typeof e=="number"?e.toString().padStart(2,"0"):"??";function Ct(e){return N("register",{element:e}),{destroy(){N("unregister",{element:e})}}}function xt(e){N("commit",{value:e})}function et(e){if(c())return;kt(!0);const l=typeof t(u)=="number"?t(u):0,f=Math.min(W,Math.max(J,l+e));a(_,f),xt(f)}function Nt(e){if(c())return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(A)){if(St(l))return;e.preventDefault();return}if(!T&&l>zt){T=!0,U(!1);return}if(T)return;e.preventDefault();const f=e.ctrlKey?10:e.shiftKey?5:1;for(tt+=e.deltaY;tt<=-nt;)et(f),tt+=nt;for(;tt>=nt;)et(-f),tt-=nt}function Pt(e){if(c())return;const l=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(b)!==null?ct():t(A)&&U(!1),N("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(A)&&U(!1),N("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),U(!0);break;case"Escape":t(A)?(e.preventDefault(),U(!1)):t(b)!==null&&(e.preventDefault(),kt(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),et(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),et(e.shiftKey?-5:-1);break;case"Backspace":(t(b)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),ot());break;case"Delete":(t(b)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),I());break;default:l&&(e.preventDefault(),e.stopPropagation(),x(e.key))}}function Ht(e){if(!t(A))return;const l=e.target;t(m)?.contains(l)||t(Q)?.contains(l)||U(!1)}function Ft(e){t(A)&&e.key==="Escape"&&(e.preventDefault(),U(!1))}function It(e){if(!t(A))return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);St(l)}function Qt(){ft||(window.addEventListener("pointerdown",Ht,!0),window.addEventListener("keydown",Ft,!0),window.addEventListener("wheel",It,{passive:!0}),window.addEventListener("scroll",Ut,!0),window.addEventListener("resize",Ut,!0),ft=!0)}function Vt(){ft&&(window.removeEventListener("pointerdown",Ht,!0),window.removeEventListener("keydown",Ft,!0),window.removeEventListener("wheel",It),window.removeEventListener("scroll",Ut,!0),window.removeEventListener("resize",Ut,!0),ft=!1)}async function Ut(){await Jt()}async function Jt(){if(!t(A)||!t(m)||(await Le(),!t(A)||!t(m)))return;const e=t(m).getBoundingClientRect(),l=lt,f=l/2;let q=e.top+e.height/2,o=e.left+e.width/2;const n=P,d=qt(),k=window.innerHeight-d-P,F=P,E=window.innerWidth-P,H=q-f,vt=q+f,ut=o-f,bt=o+f;let Y=0;H<n?Y=H-n:vt>k&&(Y=vt-k);let z=0;if(ut<F?z=ut-F:bt>E&&(z=bt-E),(z!==0||Y!==0)&&(window.scrollBy({top:Y,left:z,behavior:"auto"}),await Le(),!t(A)||!t(m)))return;const L=t(m).getBoundingClientRect();q=L.top+L.height/2,o=L.left+L.width/2;const Et=P+f,yt=window.innerHeight-d-P-f,At=P+f,Dt=window.innerWidth-P-f;q=Math.min(Math.max(q,Et),yt),o=Math.min(Math.max(o,At),Dt);const Zt=t(Q)?.offsetParent instanceof HTMLElement?t(Q).offsetParent.getBoundingClientRect():null,oe=Zt?.top??0,re=Zt?.left??0,ne=q-oe,le=o-re;a(ht,`top:${Math.round(ne)}px;left:${Math.round(le)}px;--overlay-size:${l}px;`)}function qt(){const e=document.querySelector(st);if(!e)return 0;const l=e.getBoundingClientRect();if(l.top>=window.innerHeight)return 0;const f=Math.min(l.height,Math.max(0,window.innerHeight-Math.max(l.top,0)));return Math.max(0,f)}function U(e){if(c())return;const l=e??!t(A);l!==t(A)&&(a(A,l),t(A)?(T=!1,Rt(),a(b,null),it=null,a(w,typeof t(u)=="number"?t(u):null),a(_,void 0),tt=0,Qt(),Jt()):(a(w,null),a(ht,""),Vt(),Rt()))}function Yt(e){c()||(a(b,null),it=null,a(_,e),xt(e),a(w,e),U(!1))}Ze(()=>{Vt(),Rt()});function y(){t(b)===null&&(it=typeof t(u)=="number"?t(u):C()??null,typeof t(u)=="number"?a(b,t(u).toString()):typeof it=="number"?a(b,it.toString()):a(b,""))}function v(e){const l=e.replace(/\D/g,"").slice(0,3);if(l.length===0){a(b,""),a(_,null),xt(null);return}const f=Number.parseInt(l,10),q=f>W?W:f;if(f>W&&l.length>0){a(b,String(Math.floor(f/10))),a(_,Number.parseInt(t(b),10)),xt(t(_));return}a(b,q.toString()),a(_,q),xt(q)}function x(e){y();const l=t(b)??"",f=l+e,q=Number.parseInt(f,10);!Number.isNaN(q)&&q>W&&l!==""||v(f)}function ot(){y();const e=t(b)??"";if(e.length===0){a(b,""),a(_,null),xt(null);return}v(e.slice(0,-1))}function I(){y(),a(b,""),a(_,null),xt(null)}function ct(){t(b)!==null&&(a(b,null),it=null)}function kt(e){if(t(b)===null)return;const l=it;a(b,null),it=null,!e&&l!==C()?(a(_,l??null),xt(l??null)):e||a(_,void 0)}function Rt(){K=0,rt&&(clearTimeout(rt),rt=null)}function St(e){return t(A)?(K+=e,rt&&clearTimeout(rt),rt=window.setTimeout(()=>{K=0,rt=null},Mt),K>=zt?(T||(T=!0),U(!1),Rt(),!0):!1):!1}B(()=>(t(_),Tt(C())),()=>{t(_)!==void 0&&C()===t(_)&&a(_,void 0)}),B(()=>(t(_),Tt(C())),()=>{a(u,t(_)===void 0?C():t(_))}),B(()=>(Tt(c()),t(u)),()=>{a(V,c()?"disabled":t(u)===null?"empty":t(u)<J||t(u)>W?"invalid":"valid")}),B(()=>t(V),()=>{a(O,t(V)==="invalid"?"Keep between 0 and 100.":"")}),B(()=>(t(b),t(u)),()=>{a(X,t(b)!==null?t(b)===""?"??":t(b):pt(t(u)))}),ye(),fe();var M=kn(),S=r(M),_t=r(S),Kt=r(_t,!0);i(_t),i(S),he(()=>D("click",S,()=>U())),he(()=>D("keydown",S,Pt)),he(()=>D("auto-open",S,()=>U(!0))),Oe(S,e=>Ct?.(e)),ge(S,e=>a(m,e),()=>t(m));var Bt=s(S,2),Wt=r(Bt,!0);i(Bt);var gt=s(Bt,2);{var $t=e=>{var l=zn(),f=r(l),q=r(f,!0);i(f);var o=s(f,2);ae(o,3,()=>Lt,n=>n,(n,d,k,F)=>{var E=En();let H;var vt=r(E);i(E),dt(ut=>{H=Ue(E,1,"radial-option svelte-furii8",null,H,{selected:t(u)===t(d),hovered:t(w)===t(d)}),ue(E,ut),at(vt,`${t(d)??""}%`)},[()=>(Tt(t(k)),j(()=>`transform: ${Z(t(k))}`))]),D("pointerenter",E,()=>a(w,t(d))),D("focus",E,()=>a(w,t(d))),D("pointerleave",E,()=>a(w,null)),D("blur",E,()=>a(w,null)),D("click",E,()=>Yt(t(d))),h(n,E)}),i(l),ge(l,n=>a(Q,n),()=>t(Q)),Oe(l,n=>sa?.(n)),dt(n=>{ue(l,t(ht)),at(q,n)},[()=>(t(w),t(u),j(()=>pt(t(w)??t(u))))]),h(e,l)};wt(gt,e=>{t(A)&&e($t)})}i(M),dt(()=>{ve(M,"data-state",t(V)),ve(M,"data-open",t(A)),S.disabled=c(),at(Kt,t(X)),at(Wt,t(O))}),D("wheel",M,Nt),h(p,M),be()}var qn=$('<button type="button"> </button>'),$n=$('<div class="radial svelte-cojlv"><div class="radial-label svelte-cojlv"> </div> <!></div>'),Mn=$('<div class="picker svelte-cojlv"><button type="button" class="value-button svelte-cojlv" aria-label="Attendance probability"><span class="value-label svelte-cojlv"> </span></button> <p class="hint svelte-cojlv" aria-live="polite"> </p> <!></div>');function Cn(p,R){pe(R,!1);const u=g(),V=g(),O=g(),X=g();let C=Xt(R,"value",8,null),c=Xt(R,"disabled",8,!1);const J=0,W=100,Lt=Array.from({length:11},(e,l)=>l*10),lt=176,jt=62,Ot=Lt.length,Z=120,nt=120,zt=250,Mt=12,P="[data-result-pane]";function st(e){const l=e/Ot*Math.PI*2-Math.PI/2,f=Math.cos(l)*jt,q=Math.sin(l)*jt;return`translate(calc(-50% + ${f}px), calc(-50% + ${q}px))`}const N=ze();let A=g(!1),w=g(null),_=g(void 0),m=g(null),Q=g(null),ht=g(""),ft=!1,tt=0,b=g(null),it=null,T=!1,K=0,rt=null;const pt=e=>typeof e=="number"?`${e.toString().padStart(2,"0")}%`:"??%";function Ct(e){return N("register",{element:e}),{destroy(){N("unregister",{element:e})}}}function xt(e){N("commit",{value:e})}function et(e){if(c())return;kt(!0);const l=typeof t(u)=="number"?t(u):0,f=Math.min(W,Math.max(J,l+e));a(_,f),xt(f)}function Nt(e){if(c())return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(A)){if(St(l))return;e.preventDefault();return}if(!T&&l>nt){T=!0,U(!1);return}if(T)return;e.preventDefault();const f=e.ctrlKey?10:e.shiftKey?5:1;for(tt+=e.deltaY;tt<=-Z;)et(f),tt+=Z;for(;tt>=Z;)et(-f),tt-=Z}function Pt(e){if(c())return;const l=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(b)!==null?ct():t(A)&&U(!1),N("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(A)&&U(!1),N("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),U(!0);break;case"Escape":t(A)?(e.preventDefault(),U(!1)):t(b)!==null&&(e.preventDefault(),kt(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),et(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),et(e.shiftKey?-5:-1);break;case"Backspace":(t(b)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),ot());break;case"Delete":(t(b)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),I());break;default:l&&(e.preventDefault(),e.stopPropagation(),x(e.key))}}function Ht(e){if(!t(A))return;const l=e.target;t(m)?.contains(l)||t(Q)?.contains(l)||U(!1)}function Ft(e){t(A)&&e.key==="Escape"&&(e.preventDefault(),U(!1))}function It(e){if(!t(A))return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);St(l)}function Qt(){ft||(window.addEventListener("pointerdown",Ht,!0),window.addEventListener("keydown",Ft,!0),window.addEventListener("wheel",It,{passive:!0}),window.addEventListener("scroll",Ut,!0),window.addEventListener("resize",Ut,!0),ft=!0)}function Vt(){ft&&(window.removeEventListener("pointerdown",Ht,!0),window.removeEventListener("keydown",Ft,!0),window.removeEventListener("wheel",It),window.removeEventListener("scroll",Ut,!0),window.removeEventListener("resize",Ut,!0),ft=!1)}async function Ut(){await Jt()}async function Jt(){if(!t(A)||!t(m)||(await Le(),!t(A)||!t(m)))return;const e=t(m).getBoundingClientRect(),l=lt,f=l/2;let q=e.top+e.height/2,o=e.left+e.width/2;const n=Mt,d=qt(),k=window.innerHeight-d-Mt,F=Mt,E=window.innerWidth-Mt,H=q-f,vt=q+f,ut=o-f,bt=o+f;let Y=0;H<n?Y=H-n:vt>k&&(Y=vt-k);let z=0;if(ut<F?z=ut-F:bt>E&&(z=bt-E),(z!==0||Y!==0)&&(window.scrollBy({top:Y,left:z,behavior:"auto"}),await Le(),!t(A)||!t(m)))return;const L=t(m).getBoundingClientRect();q=L.top+L.height/2,o=L.left+L.width/2;const Et=Mt+f,yt=window.innerHeight-d-Mt-f,At=Mt+f,Dt=window.innerWidth-Mt-f;q=Math.min(Math.max(q,Et),yt),o=Math.min(Math.max(o,At),Dt);const Zt=t(Q)?.offsetParent instanceof HTMLElement?t(Q).offsetParent.getBoundingClientRect():null,oe=Zt?.top??0,re=Zt?.left??0,ne=q-oe,le=o-re;a(ht,`top:${Math.round(ne)}px;left:${Math.round(le)}px;--overlay-size:${l}px;`)}function qt(){const e=document.querySelector(P);if(!e)return 0;const l=e.getBoundingClientRect();if(l.top>=window.innerHeight)return 0;const f=Math.min(l.height,Math.max(0,window.innerHeight-Math.max(l.top,0)));return Math.max(0,f)}function U(e){if(c())return;const l=e??!t(A);l!==t(A)&&(a(A,l),t(A)?(T=!1,Rt(),a(b,null),it=null,a(w,t(u)),a(_,void 0),tt=0,Qt(),Jt()):(a(w,null),a(ht,""),Vt(),Rt()))}function Yt(e){c()||(a(b,null),it=null,a(_,e),xt(e),a(w,e),U(!1))}Ze(()=>{Vt(),Rt()});function y(){t(b)===null&&(it=typeof t(u)=="number"?t(u):C()??null,typeof t(u)=="number"?a(b,t(u).toString()):typeof it=="number"?a(b,it.toString()):a(b,""))}function v(e){const l=e.replace(/\D/g,"").slice(0,3);if(l.length===0){a(b,""),a(_,null),xt(null);return}const f=Number.parseInt(l,10),q=f>W?W:f;if(f>W&&l.length>0){a(b,String(Math.floor(f/10))),a(_,Number.parseInt(t(b),10)),xt(t(_));return}a(b,q.toString()),a(_,q),xt(q)}function x(e){y();const l=t(b)??"",f=l+e,q=Number.parseInt(f,10);!Number.isNaN(q)&&q>W&&l!==""||v(f)}function ot(){y();const e=t(b)??"";if(e.length===0){a(b,""),a(_,null),xt(null);return}v(e.slice(0,-1))}function I(){y(),a(b,""),a(_,null),xt(null)}function ct(){t(b)!==null&&(a(b,null),it=null)}function kt(e){if(t(b)===null)return;const l=it;a(b,null),it=null,!e&&l!==C()?(a(_,l??null),xt(l??null)):e||a(_,void 0)}function Rt(){K=0,rt&&(clearTimeout(rt),rt=null)}function St(e){return t(A)?(K+=e,rt&&clearTimeout(rt),rt=window.setTimeout(()=>{K=0,rt=null},zt),K>=nt?(T||(T=!0),U(!1),Rt(),!0):!1):!1}B(()=>(t(_),Tt(C())),()=>{t(_)!==void 0&&C()===t(_)&&a(_,void 0)}),B(()=>(t(_),Tt(C())),()=>{a(u,t(_)===void 0?C():t(_))}),B(()=>(Tt(c()),t(u)),()=>{a(V,c()?"disabled":t(u)===null?"empty":t(u)<J||t(u)>W?"invalid":"valid")}),B(()=>t(V),()=>{a(O,t(V)==="invalid"?"Keep between 0 and 100%.":"")}),B(()=>(t(b),t(u)),()=>{a(X,t(b)!==null?t(b)===""?"??%":`${t(b)}%`:pt(t(u)))}),ye(),fe();var M=Mn(),S=r(M),_t=r(S),Kt=r(_t,!0);i(_t),i(S),he(()=>D("click",S,()=>U())),he(()=>D("keydown",S,Pt)),he(()=>D("auto-open",S,()=>U(!0))),Oe(S,e=>Ct?.(e)),ge(S,e=>a(m,e),()=>t(m));var Bt=s(S,2),Wt=r(Bt,!0);i(Bt);var gt=s(Bt,2);{var $t=e=>{var l=$n(),f=r(l),q=r(f,!0);i(f);var o=s(f,2);ae(o,3,()=>Lt,n=>n,(n,d,k,F)=>{var E=qn();let H;var vt=r(E);i(E),dt(ut=>{H=Ue(E,1,"radial-option svelte-cojlv",null,H,{selected:t(u)===t(d),hovered:t(w)===t(d)}),ue(E,ut),at(vt,`${t(d)??""}%`)},[()=>(Tt(t(k)),j(()=>`transform: ${st(t(k))}`))]),D("pointerenter",E,()=>a(w,t(d))),D("focus",E,()=>a(w,t(d))),D("pointerleave",E,()=>a(w,null)),D("blur",E,()=>a(w,null)),D("click",E,()=>Yt(t(d))),h(n,E)}),i(l),ge(l,n=>a(Q,n),()=>t(Q)),Oe(l,n=>sa?.(n)),dt(n=>{ue(l,t(ht)),at(q,n)},[()=>(t(w),t(u),j(()=>pt(t(w)??t(u))))]),h(e,l)};wt(gt,e=>{t(A)&&e($t)})}i(M),dt(()=>{ve(M,"data-state",t(V)),ve(M,"data-open",t(A)),S.disabled=c(),at(Kt,t(X)),at(Wt,t(O))}),D("wheel",M,Nt),h(p,M),be()}let De=null;const An='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function Ln(){if(typeof document>"u")return;const p=document.activeElement;p&&typeof p.focus=="function"&&(De=p)}function Tn(){if(De){try{De.focus({preventScroll:!0})}catch{}De=null}}function oa(p){if(!p)return;const R=p.querySelector(An);R&&R.focus({preventScroll:!0})}var Rn=$('<p class="empty svelte-1bwzqxo">No continents detected in this dataset.</p>'),Pn=$("<option> </option>"),Dn=$('<div class="matrix-row svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo"> </div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>â€”</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>â€”</option><option>0</option><option>25</option><option>50</option><option>75</option><option>100</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>â€”</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div></div>'),In=$('<div class="backdrop svelte-1bwzqxo" role="presentation" tabindex="-1"><div class="dialog svelte-1bwzqxo" role="dialog" aria-modal="true" aria-label="Bulk actions"><header class="svelte-1bwzqxo"><div><h2 class="svelte-1bwzqxo">Bulk Actions</h2> <p class="subtitle svelte-1bwzqxo">Trigger presets or continent tweaks without leaving the grid.</p></div> <button type="button" class="close svelte-1bwzqxo" aria-label="Close dialog">Ã—</button></header> <div class="content svelte-1bwzqxo"><section class="global svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Global Overrides</h3> <div class="global-grid svelte-1bwzqxo"><fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Probabilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all to 100%</button> <button type="button" class="svelte-1bwzqxo">Set all to 50%</button> <button type="button" class="svelte-1bwzqxo">Set all to 0%</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">âˆ’10 to all</button></div> <div class="normalize svelte-1bwzqxo"><span>Normalize average to</span> <input type="number" min="0" max="100" step="1" aria-label="Target mean probability"/> <span>%</span> <button type="button" class="svelte-1bwzqxo">Normalize</button></div></fieldset> <fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Utilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all utilities to 50</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">âˆ’10 to all</button></div></fieldset></div></section> <section class="matrix svelte-1bwzqxo"><header class="matrix-head svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Per-Continent Adjustments</h3> <p class="svelte-1bwzqxo">Set specific baselines or deltas for each region.</p></header> <div class="matrix-table svelte-1bwzqxo"><div class="matrix-row matrix-header svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo">Continent</div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div>Utility</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div>Probability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div></div> <!></div></section></div> <footer class="actions svelte-1bwzqxo"><button type="button" class="secondary svelte-1bwzqxo">Close</button></footer></div></div>');function On(p,R){pe(R,!1);let u=Xt(R,"open",8,!1),V=Xt(R,"continents",24,()=>[]);const O=ze();let X=g(null),C=g(!1),c=g([]),J=g(50);const W=["","0","25","50","75","100"];function Lt(w){return{continent:w,utilitySet:"",utilityDelta:"",probabilitySet:"",probabilityDelta:""}}function lt(w=!1){const _=new Map(t(c).map(m=>[m.continent,m]));a(c,V().map(m=>!w&&_.has(m)?{..._.get(m)}:Lt(m))),V().length===0&&a(c,[])}function jt(){a(J,50),lt(!0)}function Ot(){O("cancel")}function Z(w,_=0,m=100){return Math.max(_,Math.min(m,Math.round(w)))}function nt(w){if(w.trim()==="")return null;const _=Number(w);return Number.isFinite(_)?_:null}function zt(w){const _=Array.isArray(w)?w:[w];O("apply",{actions:_})}function Mt(w){const _=w.currentTarget,m=w.target;m&&_.contains(m)&&m!==_||Ot()}function P(w){w.key==="Escape"&&(w.preventDefault(),Ot())}B(()=>Tt(u()),()=>{a(C,u())}),B(()=>(Tt(u()),t(C)),()=>{u()&&!t(C)&&jt()}),B(()=>(Tt(u()),t(X),oa),()=>{u()&&t(X)&&oa(t(X))}),B(()=>Tt(u()),()=>{u()&&lt(!1)}),ye(),fe();var st=ee(),N=te(st);{var A=w=>{var _=In(),m=r(_),Q=r(m),ht=s(r(Q),2);i(Q);var ft=s(Q,2),tt=r(ft),b=s(r(tt),2),it=r(b),T=s(r(it),2),K=r(T),rt=s(K,2),pt=s(rt,2);i(T);var Ct=s(T,2),xt=r(Ct),et=s(xt,2);i(Ct);var Nt=s(Ct,2),Pt=s(r(Nt),2);ma(Pt);var Ht=s(Pt,4);i(Nt),i(it);var Ft=s(it,2),It=s(r(Ft),2),Qt=r(It);i(It);var Vt=s(It,2),Ut=r(Vt),Jt=s(Ut,2);i(Vt),i(Ft),i(b),i(tt);var qt=s(tt,2),U=s(r(qt),2),Yt=s(r(U),2);{var y=I=>{var ct=Rn();h(I,ct)},v=I=>{var ct=ee(),kt=te(ct);ae(kt,3,()=>t(c),Rt=>Rt.continent,(Rt,St,M)=>{var S=Dn(),_t=r(S),Kt=r(_t,!0);i(_t);var Bt=s(_t,2),Wt=r(Bt),gt=r(Wt),$t=r(gt),e=r($t);i($t);var l=s($t,2);dt(()=>{t(c),Re(()=>{t(M)})}),ae(l,5,()=>W,mt=>mt,(mt,Se)=>{var Me=Pn(),ca=r(Me,!0);i(Me);var aa={};dt(()=>{at(ca,t(Se)===""?"â€”":t(Se)),aa!==(aa=t(Se))&&(Me.value=(Me.__value=t(Se))??"")}),h(mt,Me)}),i(l),i(gt);var f=s(gt,2);i(Wt);var q=s(Wt,2),o=r(q),n=r(o),d=r(n);i(n);var k=s(n,2);dt(()=>{t(c),Re(()=>{t(M)})});var F=r(k);F.value=F.__value="";var E=s(F);E.value=E.__value="-50";var H=s(E);H.value=H.__value="-25";var vt=s(H);vt.value=vt.__value="-10";var ut=s(vt);ut.value=ut.__value="-5";var bt=s(ut);bt.value=bt.__value="+5";var Y=s(bt);Y.value=Y.__value="+10";var z=s(Y);z.value=z.__value="+25";var L=s(z);L.value=L.__value="+50",i(k),i(o);var Et=s(o,2);i(q),i(Bt);var yt=s(Bt,2),At=r(yt),Dt=r(At),Zt=r(Dt),oe=r(Zt);i(Zt);var re=s(Zt,2);dt(()=>{t(c),Re(()=>{t(M)})});var ne=r(re);ne.value=ne.__value="";var le=s(ne);le.value=le.__value="0";var ke=s(le);ke.value=ke.__value="25";var je=s(ke);je.value=je.__value="50";var _e=s(je);_e.value=_e.__value="75";var Te=s(_e);Te.value=Te.__value="100",i(re),i(Dt);var qe=s(Dt,2);i(At);var $e=s(At,2),we=r($e),xe=r(we),Be=r(xe);i(xe);var G=s(xe,2);dt(()=>{t(c),Re(()=>{t(M)})});var Gt=r(G);Gt.value=Gt.__value="";var se=s(Gt);se.value=se.__value="-50";var me=s(se);me.value=me.__value="-25";var Ne=s(me);Ne.value=Ne.__value="-10";var He=s(Ne);He.value=He.__value="-5";var Ve=s(He);Ve.value=Ve.__value="+5";var Ke=s(Ve);Ke.value=Ke.__value="+10";var Fe=s(Ke);Fe.value=Fe.__value="+25";var ta=s(Fe);ta.value=ta.__value="+50",i(G),i(we);var ea=s(we,2);i($e),i(yt),i(S),dt((mt,Se)=>{at(Kt,(t(St),j(()=>t(St).continent))),at(e,`Set utility for ${t(St),j(()=>t(St).continent)??""}`),f.disabled=(t(c),Tt(t(M)),j(()=>t(c)[t(M)].utilitySet==="")),at(d,`Adjust utility by for ${t(St),j(()=>t(St).continent)??""}`),Et.disabled=mt,at(oe,`Set probability for ${t(St),j(()=>t(St).continent)??""}`),qe.disabled=(t(c),Tt(t(M)),j(()=>t(c)[t(M)].probabilitySet==="")),at(Be,`Adjust probability by for ${t(St),j(()=>t(St).continent)??""}`),ea.disabled=Se},[()=>(t(c),Tt(t(M)),j(()=>nt(t(c)[t(M)].utilityDelta)===null)),()=>(t(c),Tt(t(M)),j(()=>nt(t(c)[t(M)].probabilityDelta)===null))]),Pe(l,()=>t(c)[t(M)].utilitySet,mt=>Ee(c,t(c)[t(M)].utilitySet=mt)),D("click",f,()=>{const mt=nt(t(c)[t(M)].utilitySet);mt!==null&&zt({type:"setContinentUtility",continent:t(St).continent,value:Z(mt)})}),Pe(k,()=>t(c)[t(M)].utilityDelta,mt=>Ee(c,t(c)[t(M)].utilityDelta=mt)),D("click",Et,()=>{const mt=nt(t(c)[t(M)].utilityDelta);mt===null||mt===0||(Ee(c,t(c)[t(M)].utilityDelta=mt>0?`+${mt}`:`${mt}`),zt({type:"adjustContinentUtility",continent:t(St).continent,delta:Math.round(mt)}))}),Pe(re,()=>t(c)[t(M)].probabilitySet,mt=>Ee(c,t(c)[t(M)].probabilitySet=mt)),D("click",qe,()=>{const mt=nt(t(c)[t(M)].probabilitySet);mt!==null&&zt({type:"setContinentProbability",continent:t(St).continent,value:Z(mt)})}),Pe(G,()=>t(c)[t(M)].probabilityDelta,mt=>Ee(c,t(c)[t(M)].probabilityDelta=mt)),D("click",ea,()=>{const mt=nt(t(c)[t(M)].probabilityDelta);mt===null||mt===0||(Ee(c,t(c)[t(M)].probabilityDelta=mt>0?`+${mt}`:`${mt}`),zt({type:"adjustContinentProbability",continent:t(St).continent,delta:Math.round(mt)}))}),h(Rt,S)}),h(I,ct)};wt(Yt,I=>{t(c),j(()=>t(c).length===0)?I(y):I(v,!1)})}i(U),i(qt),i(ft);var x=s(ft,2),ot=r(x);i(x),i(m),ge(m,I=>a(X,I),()=>t(X)),i(_),D("click",ht,Ot),D("click",K,()=>zt({type:"setAllProbabilities",value:100})),D("click",rt,()=>zt({type:"setAllProbabilities",value:50})),D("click",pt,()=>zt({type:"setAllProbabilities",value:0})),D("click",xt,()=>zt({type:"adjustAllProbabilities",delta:10})),D("click",et,()=>zt({type:"adjustAllProbabilities",delta:-10})),Sn(Pt,()=>t(J),I=>a(J,I)),D("click",Ht,()=>{Number.isFinite(t(J))&&zt({type:"normalizeProbabilities",target:Z(Number(t(J)))})}),D("click",Qt,()=>zt({type:"setAllUtilities",value:50})),D("click",Ut,()=>zt({type:"adjustAllUtilities",delta:10})),D("click",Jt,()=>zt({type:"adjustAllUtilities",delta:-10})),D("click",ot,Ot),D("click",_,Mt),D("keydown",_,P),h(w,_)};wt(N,w=>{u()&&w(A)})}h(p,st),be()}var Un=$('<p class="empty svelte-h2c6bt">No commands yet.</p>'),Bn=$('<li class="svelte-h2c6bt"> </li>'),Nn=$('<ul class="diffs svelte-h2c6bt"></ul>'),Hn=$('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Vn=$('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Kn=$('<ul class="svelte-h2c6bt"></ul>'),Fn=$('<p class="empty svelte-h2c6bt">Nothing queued.</p>'),Yn=$('<li class="svelte-h2c6bt"> </li>'),Wn=$('<ul class="diffs svelte-h2c6bt"></ul>'),Gn=$('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Xn=$('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Jn=$('<ul class="svelte-h2c6bt"></ul>'),Zn=$('<div class="history-overlay svelte-h2c6bt" role="dialog" aria-label="Command history"><section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Past</header> <!></section> <section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Future</header> <!></section></div>'),Qn=$('<div class="history-wrapper svelte-h2c6bt" role="group"><button type="button" class="history-button svelte-h2c6bt" aria-haspopup="dialog"><span class="btn-icon svelte-h2c6bt" aria-hidden="true">ğŸ§¾</span> <span> </span></button> <!></div>');function ti(p,R){pe(R,!1);const u=()=>ce(ie,"$commandHistoryStore",O),V=()=>ce(la,"$citiesStore",O),[O,X]=Je();let C=g(!1),c=g(null),J=g({past:[],future:[]}),W=g([]),Lt=g([]),lt=g([]),jt=g({});function Ot(){a(C,!0)}function Z(m){m instanceof FocusEvent&&m.currentTarget instanceof HTMLElement&&m.relatedTarget instanceof HTMLElement&&m.currentTarget.contains(m.relatedTarget)||a(C,!1)}function nt(m,Q=!1){return m==null?"??":Q?`${m}%`:`${m}`}function zt(m,Q){if(!m&&!Q)return[];const ht=m?.entries??{},ft=Q?.entries??{},tt=new Set([...Object.keys(ht),...Object.keys(ft)]),b=[];for(const it of tt){const T=ht[it]??null,K=ft[it]??null,rt=t(jt)[it]?.name??it;if(!T&&K){K.utility!==null&&b.push(`${rt} utility ${nt(null)} â†’ ${nt(K.utility)}`),K.probability!==null&&b.push(`${rt} probability ${nt(null,!0)} â†’ ${nt(K.probability,!0)}`);continue}T&&K&&(T.utility!==K.utility&&b.push(`${rt} utility ${nt(T.utility)} â†’ ${nt(K.utility)}`),T.probability!==K.probability&&b.push(`${rt} probability ${nt(T.probability,!0)} â†’ ${nt(K.probability,!0)}`)),T&&!K&&(T.utility!==null&&b.push(`${rt} utility ${nt(T.utility)} â†’ ${nt(null)}`),T.probability!==null&&b.push(`${rt} probability ${nt(T.probability,!0)} â†’ ${nt(null,!0)}`))}return b}function Mt(m,Q){return zt(m,Q)}B(()=>u(),()=>{a(J,u())}),B(()=>t(J),()=>{a(W,[...t(J).past??[]].slice().reverse())}),B(()=>t(J),()=>{a(Lt,t(J).future??[])}),B(()=>V(),()=>{a(lt,V()??[])}),B(()=>t(lt),()=>{a(jt,Object.fromEntries(t(lt).map(m=>[m.id,m])))}),ye(),fe();var P=Qn(),st=r(P),N=s(r(st),2),A=r(N);i(N),i(st),ge(st,m=>a(c,m),()=>t(c));var w=s(st,2);{var _=m=>{var Q=Zn(),ht=r(Q),ft=s(r(ht),2);{var tt=pt=>{var Ct=Un();h(pt,Ct)},b=pt=>{var Ct=Kn();ae(Ct,5,()=>t(W),Xe,(xt,et)=>{var Nt=Vn(),Pt=r(Nt),Ht=r(Pt),Ft=r(Ht,!0);i(Ht);var It=s(Ht,2),Qt=r(It);i(It),i(Pt);var Vt=s(Pt,2);{var Ut=qt=>{var U=Nn();ae(U,5,()=>(t(et),j(()=>Mt(t(et).before?.vote,t(et).after?.vote))),Yt=>Yt,(Yt,y)=>{var v=Bn(),x=r(v,!0);i(v),dt(()=>at(x,t(y))),h(Yt,v)}),i(U),h(qt,U)},Jt=qt=>{var U=Hn();h(qt,U)};wt(Vt,qt=>{t(et),j(()=>Mt(t(et).before?.vote,t(et).after?.vote).length)?qt(Ut):qt(Jt,!1)})}i(Nt),dt(qt=>{at(Ft,(t(et),j(()=>t(et).label))),at(Qt,`[${qt??""}]`)},[()=>(t(et),j(()=>t(et).scope.join(", ")))]),h(xt,Nt)}),i(Ct),h(pt,Ct)};wt(ft,pt=>{t(W),j(()=>t(W).length===0)?pt(tt):pt(b,!1)})}i(ht);var it=s(ht,2),T=s(r(it),2);{var K=pt=>{var Ct=Fn();h(pt,Ct)},rt=pt=>{var Ct=Jn();ae(Ct,5,()=>t(Lt),Xe,(xt,et)=>{var Nt=Xn(),Pt=r(Nt),Ht=r(Pt),Ft=r(Ht,!0);i(Ht);var It=s(Ht,2),Qt=r(It);i(It),i(Pt);var Vt=s(Pt,2);{var Ut=qt=>{var U=Wn();ae(U,5,()=>(t(et),j(()=>Mt(t(et).before?.vote,t(et).after?.vote))),Yt=>Yt,(Yt,y)=>{var v=Yn(),x=r(v,!0);i(v),dt(()=>at(x,t(y))),h(Yt,v)}),i(U),h(qt,U)},Jt=qt=>{var U=Gn();h(qt,U)};wt(Vt,qt=>{t(et),j(()=>Mt(t(et).before?.vote,t(et).after?.vote).length)?qt(Ut):qt(Jt,!1)})}i(Nt),dt(qt=>{at(Ft,(t(et),j(()=>t(et).label))),at(Qt,`[${qt??""}]`)},[()=>(t(et),j(()=>t(et).scope.join(", ")))]),h(xt,Nt)}),i(Ct),h(pt,Ct)};wt(T,pt=>{t(Lt),j(()=>t(Lt).length===0)?pt(K):pt(rt,!1)})}i(it),i(Q),h(m,Q)};wt(w,m=>{t(C)&&m(_)})}i(P),dt(()=>{ve(st,"aria-expanded",t(C)),at(A,`Log (${t(J),j(()=>t(J).past.length)??""})`)}),D("mouseenter",P,Ot),D("mouseleave",P,Z),D("focusin",P,Ot),D("focusout",P,Z),h(p,P),be(),X()}var ei=$("<img/>");function ra(p,R){const u=na(R,["children","$$slots","$$events","$$legacy"]),V=na(u,["src","alt","loading","decoding"]);let O=Xt(R,"src",8),X=Xt(R,"alt",8),C=Xt(R,"loading",8,"lazy"),c=Xt(R,"decoding",8,"async");var J=ei();ha(J,()=>({...V,src:O(),alt:X(),loading:C(),decoding:c()})),ua(J),h(p,J)}var ai=$('<p class="status svelte-f9uau2">Loading imageryâ€¦</p>'),ni=$('<p class="status error svelte-f9uau2"> </p>'),ii=$('<figure class="inline-frame svelte-f9uau2"><!></figure>'),oi=$('<p class="inline-weather svelte-f9uau2"> </p>'),ri=$('<p class="inline-food svelte-f9uau2"> </p>'),li=$('<div class="inline-track svelte-f9uau2"></div> <div class="inline-overlay svelte-f9uau2"><div class="inline-heading svelte-f9uau2"><span class="inline-name svelte-f9uau2"> </span> <span class="inline-country svelte-f9uau2"> </span></div> <p class="inline-summary svelte-f9uau2"> </p> <!> <!></div>',1),si=$('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),ci=$('<div class="inline-strip svelte-f9uau2" role="group"><!></div>'),ui=$('<div class="background-placeholder svelte-f9uau2">Loading imageryâ€¦</div>'),di=$('<div class="background-placeholder svelte-f9uau2"> </div>'),vi=$('<div><div class="sprite-frame svelte-f9uau2"></div> <div class="sprite-frame svelte-f9uau2"></div></div>'),fi=$('<div class="background-placeholder svelte-f9uau2">Preparing imageryâ€¦</div>'),pi=$('<div class="background-strip svelte-f9uau2" aria-hidden="true"><!></div>'),bi=$('<p class="status svelte-f9uau2">Loading imageryâ€¦</p>'),_i=$('<p class="status error svelte-f9uau2"> </p>'),mi=$('<span class="credit svelte-f9uau2"> </span>'),hi=$('<figcaption class="svelte-f9uau2"> <!></figcaption>'),gi=$('<figure class="svelte-f9uau2"><!> <!></figure>'),yi=$('<div class="image-row svelte-f9uau2"></div>'),wi=$('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),xi=$('<div class="image-strip svelte-f9uau2" role="group"><!></div>');function Si(p,R){pe(R,!1);const u=g(),V=g(),O=g(),X=g();let C=Xt(R,"city",8),c=Xt(R,"variant",8,"details"),J=Xt(R,"direction",8,"normal"),W=Xt(R,"showCaptions",8,!0),Lt=Xt(R,"scrollDuration",8,24);const lt=Object.create(null),jt=Object.create(null),Ot=Object.create(null),Z=480,nt="Details available in the expanded view.",zt=1,Mt={};let P=g("idle"),st=g(null),N=g([]),A=g([]),w=g(""),_=null,m=0,Q=g({}),ht=g([]),ft=g(null),tt=g(1),b=g(1),it=0,T="";function K(y){let v=0;for(let x=0;x<y.length;x+=1)v=(v<<5)-v+y.charCodeAt(x),v|=0;return v}function rt(y){const v=Lt()*2.5,x=y?.id;if(!x)return v;const ct=.5+Math.abs(K(x))%1e3/1e3*zt;return v*ct}function pt(y){return`/${C().images_path}/${y}`}async function Ct(y){if(!y)return;const v=++m;if(lt[y]){a(st,lt[y]),a(N,t(st)?.images??[]),a(P,"ready"),a(w,""),typeof window<"u"&&Pt(t(N));return}a(w,""),a(P,"loading");try{const x=await ga(y);if(v!==m)return;lt[y]=x,a(st,x),a(N,x.images??[]),a(P,"ready"),typeof window<"u"&&Pt(t(N))}catch(x){if(v!==m)return;a(P,"error"),a(w,x instanceof Error?x.message:"Unable to load images.")}}function xt(y){const v=y?.id??null;if(!v){_!==null&&(_=null,a(st,null),a(N,[]),a(A,[]),a(P,"idle"),a(w,""));return}if(v===_)return;_=v;const x=lt[v];if(x){a(st,x),a(N,x.images??[]),a(P,"ready"),a(w,""),et(),typeof window<"u"&&Pt(t(N));return}a(st,null),a(N,[]),a(A,[]),a(P,"loading"),a(w,""),Ct(v).then(et)}function et(){const y=t(N)??[],v=y.length>1?Qt(_,y):y;(c()==="inline"||c()==="background")&&v.length>0?a(A,[...v,...v]):a(A,v)}function Nt(y){if(!y)return 1;const v=t(Q)[y]??jt[y];return v&&Number.isFinite(v)&&v>0?v:1}async function Pt(y){const v=y.filter(x=>x.image&&!jt[x.image]);v.length!==0&&(await Promise.all(v.map(x=>new Promise(ot=>{const I=new Image;I.src=pt(x.image),I.onload=()=>{const ct=I.naturalHeight?I.naturalWidth/I.naturalHeight:1;jt[x.image]=ct>0?ct:1,ot()},I.onerror=()=>{jt[x.image]=1,ot()}}))),a(Q,Object.fromEntries(Object.entries(jt).map(([x,ot])=>[x,ot&&Number.isFinite(ot)&&ot>0?ot:1]))))}function Ht(y){const v=Ot[y];return v&&v.complete&&v.naturalWidth>0?Promise.resolve(v):new Promise((x,ot)=>{const I=new Image;I.crossOrigin="anonymous",I.decoding="async",I.onload=()=>{Ot[y]=I,x(I)},I.onerror=()=>{ot(new Error(`Unable to load image at ${y}`))},I.src=y})}async function Ft(y){const v=y.filter(S=>!!S.image);if(v.length===0)throw new Error("No image sources available for sprite generation.");const x=await Promise.all(v.map(S=>Ht(pt(S.image)))),ot=Z,I=x.map(S=>S.naturalHeight?S.naturalWidth/S.naturalHeight*ot:ot),ct=Math.max(1,Math.round(I.reduce((S,_t)=>S+_t,0))),kt=document.createElement("canvas");kt.width=ct,kt.height=ot;const Rt=kt.getContext("2d");if(!Rt)throw new Error("Unable to obtain canvas rendering context.");let St=0;for(let S=0;S<x.length;S+=1){const _t=x[S],Kt=I[S];Rt.drawImage(_t,St,0,Kt,ot),St+=Kt}let M="";try{M=kt.toDataURL("image/webp",.92)}catch{M=""}return(!M||M==="data:,")&&(M=kt.toDataURL("image/png")),{url:M,ratio:ct/ot}}function It(y){const v=[...y];for(let x=v.length-1;x>0;x-=1){const ot=Math.floor(Math.random()*(x+1));[v[x],v[ot]]=[v[ot],v[x]]}return v}function Qt(y,v){if(!y)return It(v);const x=Mt[y];if(x&&x.length===v.length)return x;const ot=It(v);return Mt[y]=ot,ot}function Vt(){a(ft,null),a(tt,1),T=""}async function Ut(y){if(typeof window>"u"||c()!=="background")return;const v=y.length>1?Qt(_,y):y,x=v.map(I=>I.image??"").join("|");if(x&&x===T&&t(ft))return;if(!v.length){Vt();return}const ot=++it;try{const{url:I,ratio:ct}=await Ft(v);if(ot!==it)return;a(ft,I),a(tt,Number.isFinite(ct)&&ct>0?ct:1),T=x}catch(I){if(ot!==it)return;Vt(),console.warn("CityImageStrip: failed to build sprite",I)}}da(()=>xt(C())),Qe(()=>{xt(C()),typeof window<"u"&&t(N).length&&Pt(t(N))}),B(()=>{},()=>{et()}),B(()=>t(st),()=>{a(u,t(st)?.summary??"")}),B(()=>t(st),()=>{a(V,t(st)?.seasonal_notes??"")}),B(()=>t(st),()=>{a(O,t(st)?.food_and_drink?.[0]??"")}),B(()=>Tt(C()),()=>{a(X,rt(C()))}),B(()=>(t(A),t(Q)),()=>{a(ht,t(A).map(y=>(t(Q),Nt(y.image))))}),B(()=>t(tt),()=>{a(b,Number.isFinite(t(tt))&&t(tt)>0?t(tt):1)}),B(()=>(Tt(c()),t(P),t(N)),()=>{typeof window<"u"&&c()==="background"&&(t(P)==="ready"?Ut(t(N)):Vt())}),ye(),fe();var Jt=ee(),qt=te(Jt);{var U=y=>{var v=ci(),x=r(v);{var ot=ct=>{var kt=ai();h(ct,kt)},I=ct=>{var kt=ee(),Rt=te(kt);{var St=S=>{var _t=ni(),Kt=r(_t,!0);i(_t),dt(()=>at(Kt,t(w))),h(S,_t)},M=S=>{var _t=ee(),Kt=te(_t);{var Bt=gt=>{var $t=li(),e=te($t);ae(e,5,()=>t(A),Xe,(bt,Y,z)=>{var L=ii(),Et=r(L);{let yt=Ae(()=>(t(Y),j(()=>pt(t(Y).image)))),At=Ae(()=>(t(Y),Tt(C()),j(()=>t(Y).caption??`${C().name} skyline`)));ra(Et,{get src(){return t(yt)},get alt(){return t(At)},loading:"lazy",decoding:"async"})}i(L),dt(()=>{ve(L,"aria-hidden",(t(N),j(()=>z>=t(N).length?"true":void 0))),ue(L,(t(ht),j(()=>`aspect-ratio: ${t(ht)[z]??1}`)))}),h(bt,L)}),i(e);var l=s(e,2),f=r(l),q=r(f),o=r(q,!0);i(q);var n=s(q,2),d=r(n,!0);i(n),i(f);var k=s(f,2),F=r(k,!0);i(k);var E=s(k,2);{var H=bt=>{var Y=oi(),z=r(Y,!0);i(Y),dt(()=>at(z,t(V))),h(bt,Y)};wt(E,bt=>{t(V)&&bt(H)})}var vt=s(E,2);{var ut=bt=>{var Y=ri(),z=r(Y,!0);i(Y),dt(()=>at(z,t(O))),h(bt,Y)};wt(vt,bt=>{t(O)&&bt(ut)})}i(l),dt(()=>{ue(e,`--scroll-duration: ${t(X)}s; --scroll-direction: ${J()}`),at(o,(Tt(C()),j(()=>C().name))),at(d,(Tt(C()),j(()=>C().country))),at(F,t(u)||nt)}),h(gt,$t)},Wt=gt=>{var $t=si();h(gt,$t)};wt(Kt,gt=>{t(A),j(()=>t(A).length)?gt(Bt):gt(Wt,!1)},!0)}h(S,_t)};wt(Rt,S=>{t(P)==="error"?S(St):S(M,!1)},!0)}h(ct,kt)};wt(x,ct=>{t(P)==="loading"?ct(ot):ct(I,!1)})}i(v),dt(()=>ve(v,"aria-label",(Tt(C()),j(()=>`Images for ${C().name}`)))),h(y,v)},Yt=y=>{var v=ee(),x=te(v);{var ot=ct=>{var kt=pi(),Rt=r(kt);{var St=S=>{var _t=ui();h(S,_t)},M=S=>{var _t=ee(),Kt=te(_t);{var Bt=gt=>{var $t=di(),e=r($t,!0);i($t),dt(()=>at(e,t(w))),h(gt,$t)},Wt=gt=>{var $t=ee(),e=te($t);{var l=q=>{var o=vi();let n;var d=r(o);let k;var F=s(d,2);let E;i(o),dt(()=>{n=Ue(o,1,"sprite-runner svelte-f9uau2",null,n,{paused:!t(ft)}),ue(o,`--scroll-duration: ${t(X)}s; --scroll-direction: ${J()==="reverse"?"reverse":"normal"};`),k=ue(d,`--sprite-ratio: ${t(b)};`,k,{"background-image":`url("${t(ft)}")`}),E=ue(F,`--sprite-ratio: ${t(b)};`,E,{"background-image":`url("${t(ft)}")`})}),h(q,o)},f=q=>{var o=fi();h(q,o)};wt(e,q=>{t(ft)?q(l):q(f,!1)},!0)}h(gt,$t)};wt(Kt,gt=>{t(P)==="error"?gt(Bt):gt(Wt,!1)},!0)}h(S,_t)};wt(Rt,S=>{t(P)==="loading"?S(St):S(M,!1)})}i(kt),h(ct,kt)},I=ct=>{var kt=xi(),Rt=r(kt);{var St=S=>{var _t=bi();h(S,_t)},M=S=>{var _t=ee(),Kt=te(_t);{var Bt=gt=>{var $t=_i(),e=r($t,!0);i($t),dt(()=>at(e,t(w))),h(gt,$t)},Wt=gt=>{var $t=ee(),e=te($t);{var l=q=>{var o=yi();ae(o,5,()=>t(N),n=>n.image,(n,d)=>{var k=gi(),F=r(k);{let vt=Ae(()=>(t(d),j(()=>pt(t(d).image)))),ut=Ae(()=>(t(d),Tt(C()),j(()=>t(d).caption??`${C().name} skyline`)));ra(F,{get src(){return t(vt)},get alt(){return t(ut)},loading:"lazy",decoding:"async"})}var E=s(F,2);{var H=vt=>{var ut=hi(),bt=r(ut),Y=s(bt);{var z=L=>{var Et=mi(),yt=r(Et);i(Et),dt(()=>at(yt,`Â· ${t(d),j(()=>t(d).credit)??""}`)),h(L,Et)};wt(Y,L=>{t(d),j(()=>t(d).credit)&&L(z)})}i(ut),dt(()=>at(bt,`${t(d),j(()=>t(d).caption)??""} `)),h(vt,ut)};wt(E,vt=>{Tt(W()),t(d),j(()=>W()&&t(d).caption)&&vt(H)})}i(k),h(n,k)}),i(o),h(q,o)},f=q=>{var o=wi();h(q,o)};wt(e,q=>{t(N),j(()=>t(N).length)?q(l):q(f,!1)},!0)}h(gt,$t)};wt(Kt,gt=>{t(P)==="error"?gt(Bt):gt(Wt,!1)},!0)}h(S,_t)};wt(Rt,S=>{t(P)==="loading"?S(St):S(M,!1)})}i(kt),dt(()=>ve(kt,"aria-label",(Tt(C()),j(()=>`Images for ${C().name}`)))),h(ct,kt)};wt(x,ct=>{c()==="background"?ct(ot):ct(I,!1)},!0)}h(y,v)};wt(qt,y=>{c()==="inline"?y(U):y(Yt,!1)})}h(p,Jt),be()}var Ei=$('<span class="chip svelte-jdafhq"><span class="label svelte-jdafhq">Country</span> <strong class="svelte-jdafhq"> </strong></span>'),zi=$('<span class="chip status-chip svelte-jdafhq" role="status"><span class="label svelte-jdafhq">Status</span> <strong class="svelte-jdafhq">Session cleared.</strong></span>'),ki=$('<div class="confirm-backdrop svelte-jdafhq" role="presentation"><div class="confirm-box svelte-jdafhq" role="dialog" aria-modal="true" aria-labelledby="reset-heading"><h3 id="reset-heading" class="svelte-jdafhq">Clear all saved data?</h3> <p class="svelte-jdafhq">This removes your ballot inputs and undo history from this device. You cannot undo this action.</p> <div class="confirm-actions svelte-jdafhq"><button type="button" class="danger svelte-jdafhq">Yes, clear everything</button> <button type="button" class="svelte-jdafhq">Cancel</button></div></div></div>'),ji=$('<div><!> <span class="chip chip-button static svelte-jdafhq"><span class="label svelte-jdafhq">Last saved</span> <span class="chip-content svelte-jdafhq"><span class="chip-icon svelte-jdafhq" aria-hidden="true">ğŸ’¾</span> <strong class="svelte-jdafhq"> </strong></span></span> <button type="button" class="chip chip-button svelte-jdafhq"><span class="label svelte-jdafhq"><span class="btn-icon svelte-jdafhq" aria-hidden="true">ğŸ—‘</span> Reset</span> <strong class="svelte-jdafhq">Clear ballot</strong></button> <!></div> <!>',1);function qi(p,R){pe(R,!1);const u=()=>ce(Ie,"$settingsStore",O),V=()=>ce(de,"$voteSessionStore",O),[O,X]=Je(),C=g();let c=Xt(R,"inline",8,!1);const J=ze();let W=g(!1),Lt=g(!1),lt=null,jt=g(),Ot=g();function Z(){a(W,!0)}function nt(){a(W,!1)}function zt(){de.clear(),wa.reset(),ie.clear(),Ie.update(T=>({...T,preferredMode:null})),a(Lt,!0),nt(),lt&&clearTimeout(lt),lt=setTimeout(()=>{a(Lt,!1)},3500),J("cleared")}Ze(()=>{lt&&clearTimeout(lt)});const Mt=c()?"status-inline":"status-ribbon";B(()=>u(),()=>{a(jt,u())}),B(()=>V(),()=>{a(Ot,V())}),B(()=>t(Ot),()=>{a(C,t(Ot).lastUpdated?new Date(t(Ot).lastUpdated).toLocaleTimeString():"Not saved yet")}),ye(),fe();var P=ji(),st=te(P),N=r(st);{var A=T=>{var K=Ei(),rt=s(r(K),2),pt=r(rt,!0);i(rt),i(K),dt(()=>at(pt,(t(jt),j(()=>t(jt).countryKey)))),h(T,K)};wt(N,T=>{t(jt),j(()=>t(jt).countryKey)&&T(A)})}var w=s(N,2),_=s(r(w),2),m=s(r(_),2),Q=r(m,!0);i(m),i(_),i(w);var ht=s(w,2),ft=s(ht,2);{var tt=T=>{var K=zi();h(T,K)};wt(ft,T=>{t(Lt)&&T(tt)})}i(st);var b=s(st,2);{var it=T=>{var K=ki(),rt=r(K),pt=s(r(rt),4),Ct=r(pt),xt=s(Ct,2);i(pt),i(rt),i(K),D("click",Ct,zt),D("click",xt,nt),h(T,K)};wt(b,T=>{t(W)&&T(it)})}dt(()=>{Ue(st,1,ya(Mt),"svelte-jdafhq"),at(Q,t(C))}),D("click",ht,Z),h(p,P),be(),X()}var $i=$('<div class="info-chip summary-chip svelte-1mrulz2"><span aria-hidden="true">â„¹ï¸</span> </div>'),Mi=$('<div class="info-chip summary-chip error svelte-1mrulz2"><span aria-hidden="true">âš </span> City insights not available.</div>'),Ci=$('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">ğŸŒ¤</span> </div>'),Ai=$('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">ğŸ½</span> </div>'),Li=$('<tr class="city-row svelte-1mrulz2"><th scope="row" class="city-col svelte-1mrulz2"><div class="city-card svelte-1mrulz2"><div class="row-bg svelte-1mrulz2"><!></div> <div class="row-content svelte-1mrulz2"><div class="city-headline svelte-1mrulz2"><div class="city-title svelte-1mrulz2"><span class="city-country svelte-1mrulz2"><span class="flag svelte-1mrulz2" aria-hidden="true"> </span> </span> <span class="city-name svelte-1mrulz2"> </span></div></div> <div class="meta-stack svelte-1mrulz2"><!> <!> <!></div></div></div></th><td class="utility-col svelte-1mrulz2"><!></td><td class="probability-col svelte-1mrulz2"><div class="probability-cell svelte-1mrulz2"><div class="input-stack svelte-1mrulz2"><!> <button type="button" class="row-reset svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">âŸ²</span> Reset</button></div></div></td></tr>'),Ti=$('<section class="grid-shell svelte-1mrulz2"><header class="grid-header svelte-1mrulz2"><!> <div class="toolbar svelte-1mrulz2"><!> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">â†º</span> Undo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">â†»</span> Redo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">ğŸ› </span> Bulk Actions</button></div></header> <div class="table-scroll svelte-1mrulz2"><table class="svelte-1mrulz2"><colgroup><col class="col-city svelte-1mrulz2"/><col class="col-utility svelte-1mrulz2"/><col class="col-probability svelte-1mrulz2"/></colgroup><thead class="svelte-1mrulz2"><tr><th scope="col" class="city-header svelte-1mrulz2">City</th><th scope="col" class="utility-header svelte-1mrulz2">Utility</th><th scope="col" class="probability-header svelte-1mrulz2">Probability</th></tr></thead><tbody class="svelte-1mrulz2"></tbody></table></div> <!></section>');function Ri(p,R){pe(R,!1);const u=()=>ce(la,"$citiesStore",c),V=()=>ce(Sa,"$citiesDocumentStore",c),O=()=>ce(de,"$voteSessionStore",c),X=()=>ce(ie,"$commandHistoryStore",c),C=()=>ce(Ie,"$settingsStore",c),[c,J]=Je(),W=Object.assign({"../data/static/meta/athens-greece.json":ka,"../data/static/meta/bangkok-thailand.json":ja,"../data/static/meta/belgrade-serbia.json":qa,"../data/static/meta/bucharest-romania.json":$a,"../data/static/meta/budapest-hungary.json":Ma,"../data/static/meta/buenos-aires-argentina.json":Ca,"../data/static/meta/cairo-egypt.json":Aa,"../data/static/meta/cartagena-colombia.json":La,"../data/static/meta/casablanca-morocco.json":Ta,"../data/static/meta/chiang-mai-thailand.json":Ra,"../data/static/meta/delhi-india.json":Pa,"../data/static/meta/doha-qatar.json":Da,"../data/static/meta/dubai-uae.json":Ia,"../data/static/meta/dublin-ireland.json":Oa,"../data/static/meta/florence-italy.json":Ua,"../data/static/meta/guadalajara-mexico.json":Ba,"../data/static/meta/hanoi-vietnam.json":Na,"../data/static/meta/helsinki-finland.json":Ha,"../data/static/meta/ho-chi-minh-city-vietnam.json":Va,"../data/static/meta/hong-kong-hong-kong.json":Ka,"../data/static/meta/jakarta-indonesia.json":Fa,"../data/static/meta/krakow-poland.json":Ya,"../data/static/meta/lima-peru.json":Wa,"../data/static/meta/ljubljana-slovenia.json":Ga,"../data/static/meta/lyon-france.json":Xa,"../data/static/meta/madrid-spain.json":Ja,"../data/static/meta/manila-philippines.json":Za,"../data/static/meta/marrakesh-morocco.json":Qa,"../data/static/meta/mendoza-argentina.json":tn,"../data/static/meta/mumbai-india.json":en,"../data/static/meta/munich-germany.json":an,"../data/static/meta/nairobi-kenya.json":nn,"../data/static/meta/nicosia-cyprus.json":on,"../data/static/meta/prague-czech-republic.json":rn,"../data/static/meta/quito-ecuador.json":ln,"../data/static/meta/rio-de-janeiro-brazil.json":sn,"../data/static/meta/rotterdam-netherlands.json":cn,"../data/static/meta/santiago-chile.json":un,"../data/static/meta/sao-paulo-brazil.json":dn,"../data/static/meta/seoul-south-korea.json":vn,"../data/static/meta/seville-spain.json":fn,"../data/static/meta/stockholm-sweden.json":pn,"../data/static/meta/taipei-taiwan.json":bn,"../data/static/meta/tashkent-uzbekistan.json":_n,"../data/static/meta/template.json":mn,"../data/static/meta/thessaloniki-greece.json":hn,"../data/static/meta/tunis-tunisia.json":gn,"../data/static/meta/vienna-austria.json":yn,"../data/static/meta/warsaw-poland.json":wn,"../data/static/meta/zagreb-croatia.json":xn}),Lt=/\/meta\/([^/]+)\.json$/,lt={};for(const[o,n]of Object.entries(W)){const d=Lt.exec(o);if(!d)continue;const k=d[1],F=xa.parse(n);lt[k]=F}const jt={Greece:"ğŸ‡¬ğŸ‡·",Thailand:"ğŸ‡¹ğŸ‡­",Serbia:"ğŸ‡·ğŸ‡¸",Argentina:"ğŸ‡¦ğŸ‡·",Romania:"ğŸ‡·ğŸ‡´",Hungary:"ğŸ‡­ğŸ‡º",Egypt:"ğŸ‡ªğŸ‡¬",Morocco:"ğŸ‡²ğŸ‡¦",Ireland:"ğŸ‡®ğŸ‡ª",UAE:"ğŸ‡¦ğŸ‡ª",Italy:"ğŸ‡®ğŸ‡¹",Vietnam:"ğŸ‡»ğŸ‡³",Finland:"ğŸ‡«ğŸ‡®","Hong Kong":"ğŸ‡­ğŸ‡°",Peru:"ğŸ‡µğŸ‡ª",France:"ğŸ‡«ğŸ‡·",Spain:"ğŸ‡ªğŸ‡¸",Philippines:"ğŸ‡µğŸ‡­",Germany:"ğŸ‡©ğŸ‡ª",Cyprus:"ğŸ‡¨ğŸ‡¾","Czech Republic":"ğŸ‡¨ğŸ‡¿",Brazil:"ğŸ‡§ğŸ‡·",Netherlands:"ğŸ‡³ğŸ‡±",Chile:"ğŸ‡¨ğŸ‡±","South Korea":"ğŸ‡°ğŸ‡·",Sweden:"ğŸ‡¸ğŸ‡ª",Taiwan:"ğŸ‡¹ğŸ‡¼",Uzbekistan:"ğŸ‡ºğŸ‡¿",Tunisia:"ğŸ‡¹ğŸ‡³",Croatia:"ğŸ‡­ğŸ‡·"};function Ot(o){return jt[o]??"ğŸŒ"}let Z=g([]),nt=g({}),zt=g([]),Mt=g(null),P=g(de.getSnapshot()),st=g({past:[],future:[]}),N=g();const A=lt;let w=g(!1),_=g(null),m=g(!1),Q=g([]),ht=g([]);const ft={},tt=["utility","probability"],b=ze();let it=g(!1),T=g(!1),K=g([]),rt=g(!1);const pt="reunion-phase2:grid-order";function Ct(o,n){const d=n.detail.value;U(o,"utility",d)}function xt(o,n){const d=n.detail.value;U(o,"probability",d)}function et(){Ln(),a(w,!0)}function Nt(){a(w,!1),Tn()}function Pt(){if(!t(Z).length)return;const o=t(Z).map(n=>n.id);for(let n=o.length-1;n>0;n-=1){const d=Math.floor(Math.random()*(n+1));[o[n],o[d]]=[o[d],o[n]]}a(ht,o),Ft(o)}function Ht(){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(pt);if(!o)return null;const n=JSON.parse(o);return Array.isArray(n)?n:null}catch{return null}}function Ft(o){if(!(typeof localStorage>"u"))try{localStorage.setItem(pt,JSON.stringify(o))}catch{}}function It(o){return A[o]??null}function Qt(o){const n=It(o);return n?.food_and_drink?.length?n.food_and_drink.slice(0,2).join(" â€¢ "):null}function Vt(o){return It(o)?.seasonal_notes??null}function Ut(){Pt(),b("reset")}function Jt(o){const{actions:n}=o.detail;if(!n||n.length===0){Nt();return}const d={},k=z=>Math.max(0,Math.min(100,Math.round(z))),F=(z,L)=>{const Et=d[z];if(Et&&Et[L]!==void 0){const Dt=Et[L];return typeof Dt=="number"?Dt:0}const At=t(P).entries[z]?.[L]??null;return typeof At=="number"?At:0},E=(z,L,Et)=>{let yt=d[z];yt||(yt={},d[z]=yt),yt[L]=k(Et)},H=t(Z).map(z=>z.id),vt={};for(const z of t(Z))(vt[z.continent]??=[]).push(z.id);const ut=(z,L,Et)=>{for(const yt of z)E(yt,L,Et)},bt=(z,L,Et)=>{for(const yt of z){const At=F(yt,L);E(yt,L,At+Et)}};for(const z of n)switch(z.type){case"setAllProbabilities":ut(H,"probability",z.value);break;case"setAllUtilities":ut(H,"utility",z.value);break;case"adjustAllUtilities":bt(H,"utility",z.delta);break;case"adjustAllProbabilities":bt(H,"probability",z.delta);break;case"normalizeProbabilities":{const L=k(z.target),Et=H.map(At=>F(At,"probability")),yt=Et.reduce((At,Dt)=>At+Dt,0)/(Et.length||1);if(yt===0)ut(H,"probability",L);else{const At=L/yt;Et.forEach((Dt,Zt)=>{const oe=k(Dt*At);E(H[Zt],"probability",oe)})}break}case"setContinentUtility":{const L=vt[z.continent]??[];ut(L,"utility",z.value);break}case"adjustContinentUtility":{const L=vt[z.continent]??[];bt(L,"utility",z.delta);break}case"setContinentProbability":{const L=vt[z.continent]??[];ut(L,"probability",z.value);break}case"adjustContinentProbability":{const L=vt[z.continent]??[];bt(L,"probability",z.delta);break}}const Y=[];for(const[z,L]of Object.entries(d)){const Et=t(P).entries[z],yt={};let At=!1;if(L.utility!==void 0){const Dt=k(L.utility);(Et?.utility??null)!==Dt&&(yt.utility=Dt,yt.autoFilled=!1,At=!0)}if(L.probability!==void 0){const Dt=k(L.probability);(Et?.probability??null)!==Dt&&(yt.probability=Dt,At=!0)}At&&Y.push({cityId:z,updates:yt})}Y.length!==0&&(ie.execute({label:`Bulk actions (${Y.length} cities)`,scope:["vote"],perform:()=>{for(const{cityId:z,updates:L}of Y)de.updateEntry(z,L)}}),Ea(`Applied bulk actions to ${Y.length} ${Y.length===1?"city":"cities"}.`))}function qt(o){return t(P).entries[o]??{cityId:o,utility:null,probability:null,autoFilled:!1}}function U(o,n,d){if((t(P).entries[o]?.[n]??null)===d)return;const E=n==="utility"?{utility:d,autoFilled:!1}:{probability:d};ie.execute({label:`${n==="utility"?"Utility":"Probability"} â†’ ${o}`,scope:["vote"],perform:()=>{de.updateEntry(o,E)}})}function Yt(o){t(P).entries[o]&&ie.execute({label:`Reset ${o}`,scope:["vote"],perform:()=>de.resetCity(o)})}function y(o,n,d){if(!d)return;d.dataset.cityId=o,d.dataset.column=n;const k=ft[o]??{};k[n]=d,ft[o]=k}function v(o,n,d){const k=ft[o];k&&k[n]===d&&(delete k[n],ft[o]=k)}function x(o,n,d=!1){const F=ft[o]?.[n];return!F||"disabled"in F&&F.disabled?!1:(F.focus(),typeof F.select=="function"&&F.select(),d&&setTimeout(()=>{F.dispatchEvent(new CustomEvent("auto-open",{bubbles:!1}))},0),!0)}function ot(o,n,d=!0){if(x(o,n,d)||!t(_))return;const k=t(_).querySelector(`tr[data-row="${o}"]`);k&&(k.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{x(o,n,d)},120))}function I(o,n,d){const k=tt.length,F=t(Q).findIndex(Y=>Y.city.id===o);if(F===-1)return;const E=tt.indexOf(n);if(E===-1)return;const H=F*k+E,vt=Math.min(t(Q).length*k-1,Math.max(0,H+d)),ut=t(Q)[Math.floor(vt/k)],bt=tt[vt%k];ut&&ot(ut.city.id,bt)}function ct(o){const{key:n}=o;if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"].includes(n))return;const d=o.target;if(!(d instanceof HTMLElement))return;const k=d.dataset.cityId,F=d.dataset.column;if(!k||!F)return;let E=t(Z).findIndex(bt=>bt.id===k);if(E===-1)return;let H=tt.indexOf(F);if(H===-1)return;switch(o.preventDefault(),n){case"ArrowUp":E=Math.max(0,E-1);break;case"ArrowDown":E=Math.min(t(Z).length-1,E+1);break;case"ArrowLeft":H>0?H-=1:E>0&&(E-=1,H=tt.length-1);break;case"ArrowRight":H<tt.length-1?H+=1:E<t(Z).length-1&&(E+=1,H=0);break;case"Home":H=0;break;case"End":H=tt.length-1;break}const vt=t(Z)[E],ut=tt[H];ot(vt.id,ut,!0)}function kt(o){!(o.ctrlKey||o.metaKey)||o.key.toLowerCase()!=="z"||(o.preventDefault(),o.shiftKey?ie.redo():ie.undo())}function Rt(){ie.undo()}function St(){ie.redo()}Qe(()=>(window.addEventListener("keydown",kt),Pt(),()=>{window.removeEventListener("keydown",kt)})),B(()=>u(),()=>{a(Z,u())}),B(()=>t(Z),()=>{a(nt,Object.fromEntries(t(Z).map(o=>[o.id,o])))}),B(()=>(t(Z),t(ht),t(nt)),()=>{if(t(Z).length&&t(ht).length!==t(Z).length){const o=Ht();o?.length===t(Z).length?a(ht,o.filter(n=>t(nt)[n])):(a(ht,t(Z).map(n=>n.id)),Ft(t(ht)))}}),B(()=>(t(ht),t(nt)),()=>{a(zt,t(ht).map(o=>t(nt)[o]).filter(o=>!!o))}),B(()=>V(),()=>{a(Mt,V())}),B(()=>O(),()=>{a(P,O())}),B(()=>X(),()=>{a(st,X())}),B(()=>C(),()=>{a(N,C())}),B(()=>(t(P),t(zt),t(Z)),()=>{t(P);const o=t(zt).length===t(Z).length&&t(zt).length>0?t(zt):t(Z);a(Q,o.map((n,d)=>{const k=qt(n.id);return{city:n,entry:k,index:d,meta:It(n.id)}}))}),B(()=>t(st),()=>{a(it,(t(st).past??[]).length>0)}),B(()=>t(st),()=>{a(T,(t(st).future??[]).length>0)}),B(()=>(t(N),t(m)),()=>{a(rt,!!t(N)?.countryKey&&!t(m))}),B(()=>(t(Mt),t(Z)),()=>{a(K,t(Mt)?.continents?.length?[...t(Mt).continents]:Array.from(new Set(t(Z).map(o=>o.continent))).sort())}),ye(),fe();var M=Ti(),S=r(M),_t=r(S);qi(_t,{inline:!0,$$events:{cleared:Ut}});var Kt=s(_t,2),Bt=r(Kt);ti(Bt,{});var Wt=s(Bt,2),gt=s(Wt,2),$t=s(gt,2);i(Kt),i(S);var e=s(S,2),l=r(e),f=s(r(l),2);ae(f,5,()=>t(Q),o=>o.city.id,(o,n)=>{var d=Li(),k=r(d),F=r(k),E=r(F),H=r(E);{let G=Ae(()=>(t(n),j(()=>t(n).index%2===0?"normal":"reverse")));Si(H,{get city(){return t(n),j(()=>t(n).city)},variant:"background",get direction(){return t(G)}})}i(E);var vt=s(E,2),ut=r(vt),bt=r(ut),Y=r(bt),z=r(Y),L=r(z,!0);i(z);var Et=s(z);i(Y);var yt=s(Y,2),At=r(yt,!0);i(yt),i(bt),i(ut);var Dt=s(ut,2),Zt=r(Dt);{var oe=G=>{var Gt=$i(),se=s(r(Gt));i(Gt),dt(()=>at(se,` ${t(n),j(()=>t(n).meta.summary)??""}`)),h(G,Gt)},re=G=>{var Gt=Mi();h(G,Gt)};wt(Zt,G=>{t(n),j(()=>t(n).meta)?G(oe):G(re,!1)})}var ne=s(Zt,2);{var le=G=>{var Gt=Ci(),se=s(r(Gt));i(Gt),dt(me=>at(se,` ${me??""}`),[()=>(t(n),j(()=>Vt(t(n).city.id)))]),h(G,Gt)};wt(ne,G=>{t(n),j(()=>Vt(t(n).city.id))&&G(le)})}var ke=s(ne,2);{var je=G=>{var Gt=Ai(),se=s(r(Gt));i(Gt),dt(me=>at(se,` ${me??""}`),[()=>(t(n),j(()=>Qt(t(n).city.id)))]),h(G,Gt)};wt(ke,G=>{t(n),j(()=>Qt(t(n).city.id))&&G(je)})}i(Dt),i(vt),i(F),i(k);var _e=s(k),Te=r(_e);jn(Te,{get value(){return t(n),j(()=>t(n).entry.utility)},$$events:{commit:G=>Ct(t(n).city.id,G),register:G=>y(t(n).city.id,"utility",G.detail.element),unregister:G=>v(t(n).city.id,"utility",G.detail.element),advance:G=>I(t(n).city.id,"utility",G.detail?.direction??1,G.detail?.open??!0)}}),i(_e);var qe=s(_e),$e=r(qe),we=r($e),xe=r(we);Cn(xe,{get value(){return t(n),j(()=>t(n).entry.probability)},$$events:{commit:G=>xt(t(n).city.id,G),register:G=>y(t(n).city.id,"probability",G.detail.element),unregister:G=>v(t(n).city.id,"probability",G.detail.element),advance:G=>I(t(n).city.id,"probability",G.detail?.direction??1,G.detail?.open??!0)}});var Be=s(xe,2);i(we),i($e),i(qe),i(d),dt(G=>{ve(d,"data-row",(t(n),j(()=>t(n).city.id))),at(L,G),at(Et,` ${t(n),j(()=>t(n).city.country)??""}`),at(At,(t(n),j(()=>t(n).city.name)))},[()=>(t(n),j(()=>Ot(t(n).city.country)))]),D("click",Be,()=>Yt(t(n).city.id)),h(o,d)}),i(f),i(l),i(e),ge(e,o=>a(_,o),()=>t(_));var q=s(e,2);On(q,{get open(){return t(w)},get continents(){return t(K)},$$events:{cancel:Nt,apply:Jt}}),i(M),dt(()=>{Wt.disabled=!t(it),gt.disabled=!t(T)}),D("click",Wt,Rt),D("click",gt,St),D("click",$t,et),D("keydown",l,ct),h(p,M),be(),J()}var Pi=$(`<section class="hero svelte-yczqw6"><h1 class="svelte-yczqw6">Phase 2 Ballot Guide</h1> <p class="lede svelte-yczqw6">Record personal utility U(c) on a 0â€“100 scale for each finalist city and estimate your attendance probability P(c) as a percentage. Everything stays local until you export the JSON ballot.</p> <section class="phase-cards svelte-yczqw6"><article class="svelte-yczqw6"><h2>Phase 0 Â· Externality</h2> <ul class="svelte-yczqw6"><li>Each voter valued a hypothetical â€œ+1 extra attendee.â€</li> <li>Responses combined via 10% trimmed mean (median fallback if &lt;10 voters).</li> <li class="svelte-yczqw6">The shared externality constant is <strong class="svelte-yczqw6">E = 24.4</strong>.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 1 Â· Pruning</h2> <ul class="svelte-yczqw6"><li>A binary vote trimmed 86 nominees down to the top 25 (plus ties).</li> <li>That survivor list became the finalist pool you are filling out now.</li> <li>Round totals (S1) were published for transparency.</li></ul></article> <article class="current svelte-yczqw6"><h2>Phase 2 Â· Your Ballot</h2> <span class="current-tag svelte-yczqw6">Current step</span> <ul class="svelte-yczqw6"><li>Enter personal utility U(c) for every finalist.</li> <li>Estimate attendance probability P(c); values are not auto-normalized.</li> <li>Export JSON mirrors these entries exactly for Phase 3 submission.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 3 Â· Aggregation</h2> <ul class="svelte-yczqw6"><li>Coordinators aggregate attendance (Att) and expected utility (EU) across ballots.</li> <li>TEW(c) = EU(c) + 24.4 Ã— Att(c); highest TEW wins after tie-breakers.</li> <li>Tie-break order: higher Att, higher median U among Pâ‰¥50%, higher overall median U.</li></ul></article></section> <section class="framework svelte-yczqw6"><h3 class="svelte-yczqw6">Total Expected Welfare snapshot</h3> <pre class="svelte-yczqw6">TEW(c) = EU(c) + 24.4 Ã— Att(c)</pre> <p>Att(c) is the expected attendee count (Î£ P_i(c)/100) and EU(c) is the expected personal utility (Î£ (P_i(c)/100) Ã— U_i(c)). During Phase 3 the coordinators compute these values from the exported ballots and publish the full scoring table.</p> <h3 class="svelte-yczqw6">Next-year accountability</h3> <p>If a voter reports a high probability for the winning city but skips the reunion without force-majeure proof, next year's ballot is scaled by 1 âˆ’ P<sub>winning</sub>/200. Accurate percentages keep your future weight intact.</p></section> <footer class="modal-footer svelte-yczqw6"><button type="button" class="primary svelte-yczqw6">Start filling the grid</button></footer></section>`);function Di(p,R){pe(R,!1);let u=Xt(R,"open",8,!1);const V=ze();function O(){V("close")}fe();var X=ee(),C=te(X);{var c=J=>{var W=Pi(),Lt=s(r(W),8),lt=r(Lt);i(Lt),i(W),D("click",lt,O),h(J,W)};wt(C,J=>{u()&&J(c)})}h(p,X),be()}var Ii=$('<div class="page-container svelte-1uha8ag"><!></div>');function Vo(p,R){pe(R,!1);const u="reunion-phase2:phase-explainer-dismissed:v1",V="v1";let O=g(!1);Qe(()=>{Ie.update(jt=>jt.preferredMode==="grid"?jt:{...jt,preferredMode:"grid"}),typeof de.setMode=="function"&&de.setMode("grid");const lt=localStorage.getItem(u);a(O,lt!==V),Ye.set(t(O))});function X(){a(O,!1),localStorage.setItem(u,V),requestAnimationFrame(()=>window.scrollTo({top:0,behavior:"smooth"})),Ye.set(!1)}function C(){localStorage.removeItem(u),a(O,!0),Ye.set(!0)}fe();var c=Ii();za("1uha8ag",lt=>{_a.title="Reunion 2026 â€” Lightning Grid"});var J=r(c);{var W=lt=>{Di(lt,{open:!0,$$events:{close:X}})},Lt=lt=>{Ri(lt,{$$events:{reset:C}})};wt(J,lt=>{t(O)?lt(W):lt(Lt,!1)})}i(c),h(p,c),be()}export{Vo as component};
