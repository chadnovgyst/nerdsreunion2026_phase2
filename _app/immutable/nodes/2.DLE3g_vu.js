import{f as S,g as R,s as at,a as g,b as ne,d as ve,e as Ze,r as da}from"../chunks/DscdaUK8.js";import{i as me}from"../chunks/tUnkN8nb.js";import{c as je,a as Qe,o as Re,b as va}from"../chunks/DX2lUfdR.js";import{e as ye,u as E,aN as fa,N as Le,a9 as Ae,V as pa,r as ba,aO as ma,v as _e,a as t,a7 as y,ac as U,s as i,C as At,ad as xe,z as r,A as o,y as l,w as ct,x as he,aa as te,aP as Pe,aQ as ke,d as Me,ae as _a}from"../chunks/CtXWJ4Rl.js";import{i as gt}from"../chunks/j1nT2hqj.js";import{s as be,b as ie,c as Be,a as fe,j as ha,k as De,m as oe,n as sa,o as Je,q as ga,u as ya,w as wa,f as Oe,v as pe,x as xa,y as Ea,z as Sa,g as za,h as ka,i as We}from"../chunks/Cr3u1VxF.js";import ja from"../chunks/DN3J-sCw.js";import qa from"../chunks/BKbm5EfA.js";import $a from"../chunks/BvbcL8L1.js";import Ca from"../chunks/CpqWQj0X.js";import La from"../chunks/CMBHzUVU.js";import Ma from"../chunks/BNFRKsyx.js";import Aa from"../chunks/CvpCKVSJ.js";import Ra from"../chunks/DKqRZLee.js";import Ta from"../chunks/e1t1TJwC.js";import Pa from"../chunks/pOAIlSuq.js";import Da from"../chunks/CDr_-IW6.js";import Ia from"../chunks/DkwgWrlg.js";import Oa from"../chunks/BdPnv_Ww.js";import Na from"../chunks/Wp1az9L3.js";import Ba from"../chunks/BozMgj6L.js";import Ua from"../chunks/ChEK7k_d.js";import Ha from"../chunks/BT5hMKdo.js";import Va from"../chunks/DZg2n5Gj.js";import Fa from"../chunks/B--_m8y4.js";import Ka from"../chunks/BPfJ8Mnp.js";import Ya from"../chunks/BbyHsVxX.js";import Wa from"../chunks/D1dfjzr5.js";import Ga from"../chunks/sTVjfoeb.js";import Xa from"../chunks/BJv4UY2l.js";import Ja from"../chunks/DqmJETbX.js";import Za from"../chunks/Dbr1vHU4.js";import Qa from"../chunks/DIrtYIXF.js";import tn from"../chunks/ZuxV2OeQ.js";import en from"../chunks/BBQehyBW.js";import an from"../chunks/CTUHu1i9.js";import nn from"../chunks/DgcN0BtG.js";import on from"../chunks/D89J0wRi.js";import rn from"../chunks/D3GOXJB7.js";import ln from"../chunks/KMlGcXzU.js";import sn from"../chunks/hyOVM0Ug.js";import cn from"../chunks/D_zlzWZC.js";import un from"../chunks/DBEQdhVc.js";import dn from"../chunks/Kieb5-lA.js";import vn from"../chunks/nEnXKinN.js";import fn from"../chunks/t4Dmsr4x.js";import pn from"../chunks/CXnItg8R.js";import bn from"../chunks/DWD3NyID.js";import mn from"../chunks/BGVZ31-y.js";import _n from"../chunks/DK9tbYvT.js";import hn from"../chunks/9Ve3I6w0.js";import gn from"../chunks/DkuNIGT0.js";import yn from"../chunks/CuS-bfel.js";import wn from"../chunks/D7_Q8Xbe.js";import xn from"../chunks/BVE7Js9b.js";import En from"../chunks/B-q0s-Uw.js";import{b as we}from"../chunks/BkcxXaB0.js";import{p as Wt,l as na}from"../chunks/CvkxTUf8.js";import{b as ia}from"../chunks/BpJTb-MP.js";function Ne(b,C,d){ye(()=>{var H=E(()=>C(b,d?.())||{});if(H?.destroy)return()=>H.destroy()})}function Sn(b,C,d=C){var H=new WeakSet;fa(b,"input",async B=>{var G=B?b.defaultValue:b.value;if(G=Ge(b)?Xe(G):G,d(G),Le!==null&&H.add(Le),await Ae(),G!==(G=C())){var j=b.selectionStart,u=b.selectionEnd,X=b.value.length;if(b.value=G??"",u!==null){var K=b.value.length;j===u&&u===X&&K>X?(b.selectionStart=K,b.selectionEnd=K):(b.selectionStart=j,b.selectionEnd=Math.min(u,K))}}}),(pa&&b.defaultValue!==b.value||E(C)==null&&b.value)&&(d(Ge(b)?Xe(b.value):b.value),Le!==null&&H.add(Le)),ba(()=>{var B=C();if(b===document.activeElement){var G=ma??Le;if(H.has(G))return}Ge(b)&&B===Xe(b.value)||b.type==="date"&&!B&&!b.value||B!==b.value&&(b.value=B??"")})}function Ge(b){var C=b.type;return C==="number"||C==="range"}function Xe(b){return b===""?null:+b}function oa(b){return typeof b=="string"?b?document.querySelector(b):null:b??null}function ca(b,C="body"){let d=oa(C)??document.body;return d&&d.appendChild(b),{update(H){const B=oa(H)??document.body;B===d||!B||(b.parentNode&&b.parentNode.removeChild(b),B.appendChild(b),d=B)},destroy(){b.parentNode&&b.parentNode.removeChild(b)}}}var zn=S('<button type="button"> </button>'),kn=S('<div class="radial svelte-furii8"><div class="radial-label svelte-furii8"> </div> <!></div>'),jn=S('<div class="picker svelte-furii8"><button type="button" class="value-button svelte-furii8" aria-label="Favorability value"><span class="value-label svelte-furii8"> </span></button> <p class="hint svelte-furii8" aria-live="polite"> </p> <!></div>');function qn(b,C){_e(C,!1);const d=y(),H=y(),B=y(),G=y();let j=Wt(C,"value",8,null),u=Wt(C,"disabled",8,!1);const X=0,K=100,Lt=Array.from({length:11},(e,a)=>a*10),rt=176,qt=62,Dt=Lt.length;function J(e){const a=e/Dt*Math.PI*2-Math.PI/2,n=Math.cos(a)*qt,s=Math.sin(a)*qt;return`translate(calc(-50% + ${n}px), calc(-50% + ${s}px))`}const nt=120,St=120,$t=250,M=12,it="[data-result-pane]",lt="reunion:radial-channel",zt=je();let v=y(!1),z=y(null),c=y(void 0),L=y(null),st=y(null),ht=y(""),ut=!1,ft=0,m=y(null),k=null,O=!1,yt=0,V=null;const wt=e=>typeof e=="number"?e.toString().padStart(2,"0"):"??";function Gt(e){return zt("register",{element:e}),{destroy(){zt("unregister",{element:e})}}}function P(e){zt("commit",{value:e})}function Ct(e){if(u())return;Et(!0);const a=typeof t(d)=="number"?t(d):0,n=Math.min(K,Math.max(X,a+e));i(c,n),P(n)}function Ot(e){if(u())return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(v)){if(N(a))return;e.preventDefault();return}if(!O&&a>St){O=!0,Z(!1);return}if(O)return;e.preventDefault();const n=e.ctrlKey?10:e.shiftKey?5:1;for(ft+=e.deltaY;ft<=-nt;)Ct(n),ft+=nt;for(;ft>=nt;)Ct(-n),ft-=nt}function Nt(e){if(u())return;const a=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(m)!==null?pt():t(v)&&Z(!1),zt("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(v)&&Z(!1),zt("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),Z(!0);break;case"Escape":t(v)?(e.preventDefault(),Z(!1)):t(m)!==null&&(e.preventDefault(),Et(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?-5:-1);break;case"Backspace":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),T());break;case"Delete":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),Q());break;default:a&&(e.preventDefault(),e.stopPropagation(),x(e.key))}}function Vt(e){if(!t(v))return;const a=e.target;t(L)?.contains(a)||t(st)?.contains(a)||Z(!1)}function It(e){t(v)&&e.key==="Escape"&&(e.preventDefault(),Z(!1))}function Ft(e){if(!t(v))return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);N(a)}function Xt(){ut||(window.addEventListener("pointerdown",Vt,!0),window.addEventListener("keydown",It,!0),window.addEventListener("wheel",Ft,{passive:!0}),window.addEventListener("scroll",Bt,!0),window.addEventListener("resize",Bt,!0),ut=!0)}function Ht(){ut&&(window.removeEventListener("pointerdown",Vt,!0),window.removeEventListener("keydown",It,!0),window.removeEventListener("wheel",Ft),window.removeEventListener("scroll",Bt,!0),window.removeEventListener("resize",Bt,!0),ut=!1)}async function Bt(){await xt()}async function xt(){if(!t(v)||!t(L)||(await Ae(),!t(v)||!t(L)))return;const e=t(L).getBoundingClientRect(),a=rt,n=a/2;let s=e.top+e.height/2,_=e.left+e.width/2;const w=M,q=Pt(),I=window.innerHeight-q-M,jt=M,$=window.innerWidth-M,vt=s-n,et=s+n,h=_-n,A=_+n;let F=0;vt<w?F=vt-w:et>I&&(F=et-I);let Y=0;if(h<jt?Y=h-jt:A>$&&(Y=A-$),(Y!==0||F!==0)&&(window.scrollBy({top:F,left:Y,behavior:"auto"}),await Ae(),!t(v)||!t(L)))return;const mt=t(L).getBoundingClientRect();s=mt.top+mt.height/2,_=mt.left+mt.width/2;const Mt=M+n,Qt=window.innerHeight-q-M-n,re=M+n,le=window.innerWidth-M-n;s=Math.min(Math.max(s,Mt),Qt),_=Math.min(Math.max(_,re),le);const ee=t(st)?.offsetParent instanceof HTMLElement?t(st).offsetParent.getBoundingClientRect():null,se=ee?.top??0,ce=ee?.left??0,ue=s-se,ae=_-ce;i(ht,`top:${Math.round(ue)}px;left:${Math.round(ae)}px;--overlay-size:${a}px;`)}function Pt(){const e=document.querySelector(it);if(!e)return 0;const a=e.getBoundingClientRect();if(a.top>=window.innerHeight)return 0;const n=Math.min(a.height,Math.max(0,window.innerHeight-Math.max(a.top,0)));return Math.max(0,n)}function Z(e){if(u())return;const a=e??!t(v);a!==t(v)&&(i(v,a),t(v)?(Rt(),O=!1,dt(),i(m,null),k=null,i(z,typeof t(d)=="number"?t(d):null),i(c,void 0),ft=0,Xt(),xt()):(i(z,null),i(ht,""),Ht(),dt()))}function Zt(e){u()||(i(m,null),k=null,i(c,e),P(e),i(z,e),Z(!1))}Qe(()=>{Ht(),dt()}),Re(()=>{const e=a=>D(a);return window.addEventListener(lt,e),()=>{window.removeEventListener(lt,e)}});function p(){t(m)===null&&(k=typeof t(d)=="number"?t(d):j()??null,typeof t(d)=="number"?i(m,t(d).toString()):typeof k=="number"?i(m,k.toString()):i(m,""))}function f(e){const a=e.replace(/\D/g,"").slice(0,3);if(a.length===0){i(m,""),i(c,null),P(null);return}const n=Number.parseInt(a,10),s=n>K?K:n;if(n>K&&a.length>0){i(m,String(Math.floor(n/10))),i(c,Number.parseInt(t(m),10)),P(t(c));return}i(m,s.toString()),i(c,s),P(s)}function x(e){p();const a=t(m)??"",n=a+e,s=Number.parseInt(n,10);!Number.isNaN(s)&&s>K&&a!==""||f(n)}function T(){p();const e=t(m)??"";if(e.length===0){i(m,""),i(c,null),P(null);return}f(e.slice(0,-1))}function Q(){p(),i(m,""),i(c,null),P(null)}function pt(){t(m)!==null&&(i(m,null),k=null)}function Et(e){if(t(m)===null)return;const a=k;i(m,null),k=null,!e&&a!==j()?(i(c,a??null),P(a??null)):e||i(c,void 0)}function dt(){yt=0,V&&(clearTimeout(V),V=null)}function N(e){return t(v)?(yt+=e,V&&clearTimeout(V),V=window.setTimeout(()=>{yt=0,V=null},$t),yt>=St?(O||(O=!0),Z(!1),dt(),!0):!1):!1}function Rt(){if(typeof window>"u")return;const e={source:t(L)};window.dispatchEvent(new CustomEvent(lt,{detail:e}))}function D(e){!t(v)||e.detail?.source===t(L)||Z(!1)}U(()=>(t(c),At(j())),()=>{t(c)!==void 0&&j()===t(c)&&i(c,void 0)}),U(()=>(t(c),At(j())),()=>{i(d,t(c)===void 0?j():t(c))}),U(()=>(At(u()),t(d)),()=>{i(H,u()?"disabled":t(d)===null?"empty":t(d)<X||t(d)>K?"invalid":"valid")}),U(()=>t(H),()=>{i(B,t(H)==="invalid"?"Keep between 0 and 100.":"")}),U(()=>(t(m),t(d)),()=>{i(G,t(m)!==null?t(m)===""?"??":t(m):wt(t(d)))}),xe(),me();var tt=jn(),ot=r(tt),Ut=r(ot),Kt=r(Ut,!0);o(Ut),o(ot),ye(()=>R("click",ot,()=>Z())),ye(()=>R("keydown",ot,Nt)),ye(()=>R("auto-open",ot,()=>Z(!0))),Ne(ot,e=>Gt?.(e)),we(ot,e=>i(L,e),()=>t(L));var bt=l(ot,2),kt=r(bt,!0);o(bt);var Tt=l(bt,2);{var Jt=e=>{var a=kn(),n=r(a),s=r(n,!0);o(n);var _=l(n,2);ie(_,3,()=>Lt,w=>w,(w,q,I,jt)=>{var $=zn();let vt;var et=r($);o($),ct(h=>{vt=Be($,1,"radial-option svelte-furii8",null,vt,{selected:t(d)===t(q),hovered:t(z)===t(q)}),fe($,h),at(et,`${t(q)??""}%`)},[()=>(At(t(I)),E(()=>`transform: ${J(t(I))}`))]),R("pointerenter",$,()=>i(z,t(q))),R("focus",$,()=>i(z,t(q))),R("pointerleave",$,()=>i(z,null)),R("blur",$,()=>i(z,null)),R("click",$,()=>Zt(t(q))),g(w,$)}),o(a),we(a,w=>i(st,w),()=>t(st)),Ne(a,w=>ca?.(w)),ct(w=>{fe(a,t(ht)),at(s,w)},[()=>(t(z),t(d),E(()=>wt(t(z)??t(d))))]),g(e,a)};gt(Tt,e=>{t(v)&&e(Jt)})}o(tt),ct(()=>{be(tt,"data-state",t(H)),be(tt,"data-open",t(v)),ot.disabled=u(),at(Kt,t(G)),at(kt,t(B))}),R("wheel",tt,Ot),g(b,tt),he()}var $n=S('<button type="button"> </button>'),Cn=S('<div class="radial svelte-cojlv"><div class="radial-label svelte-cojlv"> </div> <!></div>'),Ln=S('<div class="picker svelte-cojlv"><button type="button" class="value-button svelte-cojlv" aria-label="Attendance probability"><span class="value-label svelte-cojlv"> </span></button> <p class="hint svelte-cojlv" aria-live="polite"> </p> <!></div>');function Mn(b,C){_e(C,!1);const d=y(),H=y(),B=y(),G=y();let j=Wt(C,"value",8,null),u=Wt(C,"disabled",8,!1);const X=0,K=100,Lt=Array.from({length:11},(e,a)=>a*10),rt=176,qt=62,Dt=Lt.length,J=120,nt=120,St=250,$t=12,M="[data-result-pane]",it="reunion:radial-channel";function lt(e){const a=e/Dt*Math.PI*2-Math.PI/2,n=Math.cos(a)*qt,s=Math.sin(a)*qt;return`translate(calc(-50% + ${n}px), calc(-50% + ${s}px))`}const zt=je();let v=y(!1),z=y(null),c=y(void 0),L=y(null),st=y(null),ht=y(""),ut=!1,ft=0,m=y(null),k=null,O=!1,yt=0,V=null;const wt=e=>typeof e=="number"?`${e.toString().padStart(2,"0")}%`:"??%";function Gt(e){return zt("register",{element:e}),{destroy(){zt("unregister",{element:e})}}}function P(e){zt("commit",{value:e})}function Ct(e){if(u())return;Et(!0);const a=typeof t(d)=="number"?t(d):0,n=Math.min(K,Math.max(X,a+e));i(c,n),P(n)}function Ot(e){if(u())return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(v)){if(N(a))return;e.preventDefault();return}if(!O&&a>nt){O=!0,Z(!1);return}if(O)return;e.preventDefault();const n=e.ctrlKey?10:e.shiftKey?5:1;for(ft+=e.deltaY;ft<=-J;)Ct(n),ft+=J;for(;ft>=J;)Ct(-n),ft-=J}function Nt(e){if(u())return;const a=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(m)!==null?pt():t(v)&&Z(!1),zt("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(v)&&Z(!1),zt("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),Z(!0);break;case"Escape":t(v)?(e.preventDefault(),Z(!1)):t(m)!==null&&(e.preventDefault(),Et(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?-5:-1);break;case"Backspace":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),T());break;case"Delete":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),Q());break;default:a&&(e.preventDefault(),e.stopPropagation(),x(e.key))}}function Vt(e){if(!t(v))return;const a=e.target;t(L)?.contains(a)||t(st)?.contains(a)||Z(!1)}function It(e){t(v)&&e.key==="Escape"&&(e.preventDefault(),Z(!1))}function Ft(e){if(!t(v))return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);N(a)}function Xt(){ut||(window.addEventListener("pointerdown",Vt,!0),window.addEventListener("keydown",It,!0),window.addEventListener("wheel",Ft,{passive:!0}),window.addEventListener("scroll",Bt,!0),window.addEventListener("resize",Bt,!0),ut=!0)}function Ht(){ut&&(window.removeEventListener("pointerdown",Vt,!0),window.removeEventListener("keydown",It,!0),window.removeEventListener("wheel",Ft),window.removeEventListener("scroll",Bt,!0),window.removeEventListener("resize",Bt,!0),ut=!1)}async function Bt(){await xt()}async function xt(){if(!t(v)||!t(L)||(await Ae(),!t(v)||!t(L)))return;const e=t(L).getBoundingClientRect(),a=rt,n=a/2;let s=e.top+e.height/2,_=e.left+e.width/2;const w=$t,q=Pt(),I=window.innerHeight-q-$t,jt=$t,$=window.innerWidth-$t,vt=s-n,et=s+n,h=_-n,A=_+n;let F=0;vt<w?F=vt-w:et>I&&(F=et-I);let Y=0;if(h<jt?Y=h-jt:A>$&&(Y=A-$),(Y!==0||F!==0)&&(window.scrollBy({top:F,left:Y,behavior:"auto"}),await Ae(),!t(v)||!t(L)))return;const mt=t(L).getBoundingClientRect();s=mt.top+mt.height/2,_=mt.left+mt.width/2;const Mt=$t+n,Qt=window.innerHeight-q-$t-n,re=$t+n,le=window.innerWidth-$t-n;s=Math.min(Math.max(s,Mt),Qt),_=Math.min(Math.max(_,re),le);const ee=t(st)?.offsetParent instanceof HTMLElement?t(st).offsetParent.getBoundingClientRect():null,se=ee?.top??0,ce=ee?.left??0,ue=s-se,ae=_-ce;i(ht,`top:${Math.round(ue)}px;left:${Math.round(ae)}px;--overlay-size:${a}px;`)}function Pt(){const e=document.querySelector(M);if(!e)return 0;const a=e.getBoundingClientRect();if(a.top>=window.innerHeight)return 0;const n=Math.min(a.height,Math.max(0,window.innerHeight-Math.max(a.top,0)));return Math.max(0,n)}function Z(e){if(u())return;const a=e??!t(v);a!==t(v)&&(i(v,a),t(v)?(Rt(),O=!1,dt(),i(m,null),k=null,i(z,t(d)),i(c,void 0),ft=0,Xt(),xt()):(i(z,null),i(ht,""),Ht(),dt()))}function Zt(e){u()||(i(m,null),k=null,i(c,e),P(e),i(z,e),Z(!1))}Qe(()=>{Ht(),dt()}),Re(()=>{const e=a=>D(a);return window.addEventListener(it,e),()=>{window.removeEventListener(it,e)}});function p(){t(m)===null&&(k=typeof t(d)=="number"?t(d):j()??null,typeof t(d)=="number"?i(m,t(d).toString()):typeof k=="number"?i(m,k.toString()):i(m,""))}function f(e){const a=e.replace(/\D/g,"").slice(0,3);if(a.length===0){i(m,""),i(c,null),P(null);return}const n=Number.parseInt(a,10),s=n>K?K:n;if(n>K&&a.length>0){i(m,String(Math.floor(n/10))),i(c,Number.parseInt(t(m),10)),P(t(c));return}i(m,s.toString()),i(c,s),P(s)}function x(e){p();const a=t(m)??"",n=a+e,s=Number.parseInt(n,10);!Number.isNaN(s)&&s>K&&a!==""||f(n)}function T(){p();const e=t(m)??"";if(e.length===0){i(m,""),i(c,null),P(null);return}f(e.slice(0,-1))}function Q(){p(),i(m,""),i(c,null),P(null)}function pt(){t(m)!==null&&(i(m,null),k=null)}function Et(e){if(t(m)===null)return;const a=k;i(m,null),k=null,!e&&a!==j()?(i(c,a??null),P(a??null)):e||i(c,void 0)}function dt(){yt=0,V&&(clearTimeout(V),V=null)}function N(e){return t(v)?(yt+=e,V&&clearTimeout(V),V=window.setTimeout(()=>{yt=0,V=null},St),yt>=nt?(O||(O=!0),Z(!1),dt(),!0):!1):!1}function Rt(){if(typeof window>"u")return;const e={source:t(L)};window.dispatchEvent(new CustomEvent(it,{detail:e}))}function D(e){!t(v)||e.detail?.source===t(L)||Z(!1)}U(()=>(t(c),At(j())),()=>{t(c)!==void 0&&j()===t(c)&&i(c,void 0)}),U(()=>(t(c),At(j())),()=>{i(d,t(c)===void 0?j():t(c))}),U(()=>(At(u()),t(d)),()=>{i(H,u()?"disabled":t(d)===null?"empty":t(d)<X||t(d)>K?"invalid":"valid")}),U(()=>t(H),()=>{i(B,t(H)==="invalid"?"Keep between 0 and 100%.":"")}),U(()=>(t(m),t(d)),()=>{i(G,t(m)!==null?t(m)===""?"??%":`${t(m)}%`:wt(t(d)))}),xe(),me();var tt=Ln(),ot=r(tt),Ut=r(ot),Kt=r(Ut,!0);o(Ut),o(ot),ye(()=>R("click",ot,()=>Z())),ye(()=>R("keydown",ot,Nt)),ye(()=>R("auto-open",ot,()=>Z(!0))),Ne(ot,e=>Gt?.(e)),we(ot,e=>i(L,e),()=>t(L));var bt=l(ot,2),kt=r(bt,!0);o(bt);var Tt=l(bt,2);{var Jt=e=>{var a=Cn(),n=r(a),s=r(n,!0);o(n);var _=l(n,2);ie(_,3,()=>Lt,w=>w,(w,q,I,jt)=>{var $=$n();let vt;var et=r($);o($),ct(h=>{vt=Be($,1,"radial-option svelte-cojlv",null,vt,{selected:t(d)===t(q),hovered:t(z)===t(q)}),fe($,h),at(et,`${t(q)??""}%`)},[()=>(At(t(I)),E(()=>`transform: ${lt(t(I))}`))]),R("pointerenter",$,()=>i(z,t(q))),R("focus",$,()=>i(z,t(q))),R("pointerleave",$,()=>i(z,null)),R("blur",$,()=>i(z,null)),R("click",$,()=>Zt(t(q))),g(w,$)}),o(a),we(a,w=>i(st,w),()=>t(st)),Ne(a,w=>ca?.(w)),ct(w=>{fe(a,t(ht)),at(s,w)},[()=>(t(z),t(d),E(()=>wt(t(z)??t(d))))]),g(e,a)};gt(Tt,e=>{t(v)&&e(Jt)})}o(tt),ct(()=>{be(tt,"data-state",t(H)),be(tt,"data-open",t(v)),ot.disabled=u(),at(Kt,t(G)),at(kt,t(B))}),R("wheel",tt,Ot),g(b,tt),he()}let Ie=null;const An='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function Rn(){if(typeof document>"u")return;const b=document.activeElement;b&&typeof b.focus=="function"&&(Ie=b)}function Tn(){if(Ie){try{Ie.focus({preventScroll:!0})}catch{}Ie=null}}function ra(b){if(!b)return;const C=b.querySelector(An);C&&C.focus({preventScroll:!0})}var Pn=S('<p class="empty svelte-1bwzqxo">No continents detected in this dataset.</p>'),Dn=S("<option> </option>"),In=S('<div class="matrix-row svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo"> </div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>0</option><option>25</option><option>50</option><option>75</option><option>100</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div></div>'),On=S('<div class="backdrop svelte-1bwzqxo" role="presentation" tabindex="-1"><div class="dialog svelte-1bwzqxo" role="dialog" aria-modal="true" aria-label="Bulk actions"><header class="svelte-1bwzqxo"><div><h2 class="svelte-1bwzqxo">Bulk Actions</h2> <p class="subtitle svelte-1bwzqxo">Trigger presets or continent tweaks without leaving the grid.</p></div> <button type="button" class="close svelte-1bwzqxo" aria-label="Close dialog">√ó</button></header> <div class="content svelte-1bwzqxo"><section class="global svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Global Overrides</h3> <div class="global-grid svelte-1bwzqxo"><fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Probabilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all to 100%</button> <button type="button" class="svelte-1bwzqxo">Set all to 50%</button> <button type="button" class="svelte-1bwzqxo">Set all to 0%</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div> <div class="normalize svelte-1bwzqxo"><span>Normalize average to</span> <input type="number" min="0" max="100" step="1" aria-label="Target mean probability"/> <span>%</span> <button type="button" class="svelte-1bwzqxo">Normalize</button></div></fieldset> <fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Utilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all utilities to 50</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div></fieldset></div></section> <section class="matrix svelte-1bwzqxo"><header class="matrix-head svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Per-Continent Adjustments</h3> <p class="svelte-1bwzqxo">Set specific baselines or deltas for each region.</p></header> <div class="matrix-table svelte-1bwzqxo"><div class="matrix-row matrix-header svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo">Continent</div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div>Favorability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div>Probability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div></div> <!></div></section></div> <footer class="actions svelte-1bwzqxo"><button type="button" class="secondary svelte-1bwzqxo">Close</button></footer></div></div>');function Nn(b,C){_e(C,!1);let d=Wt(C,"open",8,!1),H=Wt(C,"continents",24,()=>[]);const B=je();let G=y(null),j=y(!1),u=y([]),X=y(50);const K=["","0","25","50","75","100"];function Lt(v){return{continent:v,utilitySet:"",utilityDelta:"",probabilitySet:"",probabilityDelta:""}}function rt(v=!1){const z=new Map(t(u).map(c=>[c.continent,c]));i(u,H().map(c=>!v&&z.has(c)?{...z.get(c)}:Lt(c))),H().length===0&&i(u,[])}function qt(){i(X,50),rt(!0)}function Dt(){B("cancel")}function J(v,z=0,c=100){return Math.max(z,Math.min(c,Math.round(v)))}function nt(v){if(v.trim()==="")return null;const z=Number(v);return Number.isFinite(z)?z:null}function St(v){const z=Array.isArray(v)?v:[v];B("apply",{actions:z})}function $t(v){const z=v.currentTarget,c=v.target;c&&z.contains(c)&&c!==z||Dt()}function M(v){v.key==="Escape"&&(v.preventDefault(),Dt())}U(()=>At(d()),()=>{i(j,d())}),U(()=>(At(d()),t(j)),()=>{d()&&!t(j)&&qt()}),U(()=>(At(d()),t(G),ra),()=>{d()&&t(G)&&ra(t(G))}),U(()=>At(d()),()=>{d()&&rt(!1)}),xe(),me();var it=ne(),lt=te(it);{var zt=v=>{var z=On(),c=r(z),L=r(c),st=l(r(L),2);o(L);var ht=l(L,2),ut=r(ht),ft=l(r(ut),2),m=r(ft),k=l(r(m),2),O=r(k),yt=l(O,2),V=l(yt,2);o(k);var wt=l(k,2),Gt=r(wt),P=l(Gt,2);o(wt);var Ct=l(wt,2),Ot=l(r(Ct),2);ha(Ot);var Nt=l(Ot,4);o(Ct),o(m);var Vt=l(m,2),It=l(r(Vt),2),Ft=r(It);o(It);var Xt=l(It,2),Ht=r(Xt),Bt=l(Ht,2);o(Xt),o(Vt),o(ft),o(ut);var xt=l(ut,2),Pt=l(r(xt),2),Z=l(r(Pt),2);{var Zt=T=>{var Q=Pn();g(T,Q)},p=T=>{var Q=ne(),pt=te(Q);ie(pt,3,()=>t(u),Et=>Et.continent,(Et,dt,N)=>{var Rt=In(),D=r(Rt),tt=r(D,!0);o(D);var ot=l(D,2),Ut=r(ot),Kt=r(Ut),bt=r(Kt),kt=r(bt);o(bt);var Tt=l(bt,2);ct(()=>{t(u),Pe(()=>{t(N)})}),ie(Tt,5,()=>K,_t=>_t,(_t,ze)=>{var Ce=Dn(),ua=r(Ce,!0);o(Ce);var aa={};ct(()=>{at(ua,t(ze)===""?"‚Äî":t(ze)),aa!==(aa=t(ze))&&(Ce.value=(Ce.__value=t(ze))??"")}),g(_t,Ce)}),o(Tt),o(Kt);var Jt=l(Kt,2);o(Ut);var e=l(Ut,2),a=r(e),n=r(a),s=r(n);o(n);var _=l(n,2);ct(()=>{t(u),Pe(()=>{t(N)})});var w=r(_);w.value=w.__value="";var q=l(w);q.value=q.__value="-50";var I=l(q);I.value=I.__value="-25";var jt=l(I);jt.value=jt.__value="-10";var $=l(jt);$.value=$.__value="-5";var vt=l($);vt.value=vt.__value="+5";var et=l(vt);et.value=et.__value="+10";var h=l(et);h.value=h.__value="+25";var A=l(h);A.value=A.__value="+50",o(_),o(a);var F=l(a,2);o(e),o(ot);var Y=l(ot,2),mt=r(Y),Mt=r(mt),Qt=r(Mt),re=r(Qt);o(Qt);var le=l(Qt,2);ct(()=>{t(u),Pe(()=>{t(N)})});var ee=r(le);ee.value=ee.__value="";var se=l(ee);se.value=se.__value="0";var ce=l(se);ce.value=ce.__value="25";var ue=l(ce);ue.value=ue.__value="50";var ae=l(ue);ae.value=ae.__value="75";var Te=l(ae);Te.value=Te.__value="100",o(le),o(Mt);var qe=l(Mt,2);o(mt);var $e=l(mt,2),Ee=r($e),Se=r(Ee),Ue=r(Se);o(Se);var W=l(Se,2);ct(()=>{t(u),Pe(()=>{t(N)})});var Yt=r(W);Yt.value=Yt.__value="";var de=l(Yt);de.value=de.__value="-50";var ge=l(de);ge.value=ge.__value="-25";var He=l(ge);He.value=He.__value="-10";var Ve=l(He);Ve.value=Ve.__value="-5";var Fe=l(Ve);Fe.value=Fe.__value="+5";var Ke=l(Fe);Ke.value=Ke.__value="+10";var Ye=l(Ke);Ye.value=Ye.__value="+25";var ta=l(Ye);ta.value=ta.__value="+50",o(W),o(Ee);var ea=l(Ee,2);o($e),o(Y),o(Rt),ct((_t,ze)=>{at(tt,(t(dt),E(()=>t(dt).continent))),at(kt,`Set favorability for ${t(dt),E(()=>t(dt).continent)??""}`),Jt.disabled=(t(u),At(t(N)),E(()=>t(u)[t(N)].utilitySet==="")),at(s,`Adjust favorability by for ${t(dt),E(()=>t(dt).continent)??""}`),F.disabled=_t,at(re,`Set probability for ${t(dt),E(()=>t(dt).continent)??""}`),qe.disabled=(t(u),At(t(N)),E(()=>t(u)[t(N)].probabilitySet==="")),at(Ue,`Adjust probability by for ${t(dt),E(()=>t(dt).continent)??""}`),ea.disabled=ze},[()=>(t(u),At(t(N)),E(()=>nt(t(u)[t(N)].utilityDelta)===null)),()=>(t(u),At(t(N)),E(()=>nt(t(u)[t(N)].probabilityDelta)===null))]),De(Tt,()=>t(u)[t(N)].utilitySet,_t=>ke(u,t(u)[t(N)].utilitySet=_t)),R("click",Jt,()=>{const _t=nt(t(u)[t(N)].utilitySet);_t!==null&&St({type:"setContinentUtility",continent:t(dt).continent,value:J(_t)})}),De(_,()=>t(u)[t(N)].utilityDelta,_t=>ke(u,t(u)[t(N)].utilityDelta=_t)),R("click",F,()=>{const _t=nt(t(u)[t(N)].utilityDelta);_t===null||_t===0||(ke(u,t(u)[t(N)].utilityDelta=_t>0?`+${_t}`:`${_t}`),St({type:"adjustContinentUtility",continent:t(dt).continent,delta:Math.round(_t)}))}),De(le,()=>t(u)[t(N)].probabilitySet,_t=>ke(u,t(u)[t(N)].probabilitySet=_t)),R("click",qe,()=>{const _t=nt(t(u)[t(N)].probabilitySet);_t!==null&&St({type:"setContinentProbability",continent:t(dt).continent,value:J(_t)})}),De(W,()=>t(u)[t(N)].probabilityDelta,_t=>ke(u,t(u)[t(N)].probabilityDelta=_t)),R("click",ea,()=>{const _t=nt(t(u)[t(N)].probabilityDelta);_t===null||_t===0||(ke(u,t(u)[t(N)].probabilityDelta=_t>0?`+${_t}`:`${_t}`),St({type:"adjustContinentProbability",continent:t(dt).continent,delta:Math.round(_t)}))}),g(Et,Rt)}),g(T,Q)};gt(Z,T=>{t(u),E(()=>t(u).length===0)?T(Zt):T(p,!1)})}o(Pt),o(xt),o(ht);var f=l(ht,2),x=r(f);o(f),o(c),we(c,T=>i(G,T),()=>t(G)),o(z),R("click",st,Dt),R("click",O,()=>St({type:"setAllProbabilities",value:100})),R("click",yt,()=>St({type:"setAllProbabilities",value:50})),R("click",V,()=>St({type:"setAllProbabilities",value:0})),R("click",Gt,()=>St({type:"adjustAllProbabilities",delta:10})),R("click",P,()=>St({type:"adjustAllProbabilities",delta:-10})),Sn(Ot,()=>t(X),T=>i(X,T)),R("click",Nt,()=>{Number.isFinite(t(X))&&St({type:"normalizeProbabilities",target:J(Number(t(X)))})}),R("click",Ft,()=>St({type:"setAllUtilities",value:50})),R("click",Ht,()=>St({type:"adjustAllUtilities",delta:10})),R("click",Bt,()=>St({type:"adjustAllUtilities",delta:-10})),R("click",x,Dt),R("click",z,$t),R("keydown",z,M),g(v,z)};gt(lt,v=>{d()&&v(zt)})}g(b,it),he()}var Bn=S('<p class="empty svelte-h2c6bt">No commands yet.</p>'),Un=S('<li class="svelte-h2c6bt"> </li>'),Hn=S('<ul class="diffs svelte-h2c6bt"></ul>'),Vn=S('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Fn=S('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Kn=S('<ul class="svelte-h2c6bt"></ul>'),Yn=S('<p class="empty svelte-h2c6bt">Nothing queued.</p>'),Wn=S('<li class="svelte-h2c6bt"> </li>'),Gn=S('<ul class="diffs svelte-h2c6bt"></ul>'),Xn=S('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Jn=S('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Zn=S('<ul class="svelte-h2c6bt"></ul>'),Qn=S('<div class="history-overlay svelte-h2c6bt" role="dialog" aria-label="Command history"><section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Past</header> <!></section> <section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Future</header> <!></section></div>'),ti=S('<div class="history-wrapper svelte-h2c6bt" role="group"><button type="button" class="history-button svelte-h2c6bt" aria-haspopup="dialog"><span class="btn-icon svelte-h2c6bt" aria-hidden="true">üßæ</span> <span> </span></button> <!></div>');function ei(b,C){_e(C,!1);const d=()=>ve(oe,"$commandHistoryStore",B),H=()=>ve(sa,"$citiesStore",B),[B,G]=Ze();let j=y(!1),u=y(null),X=y({past:[],future:[]}),K=y([]),Lt=y([]),rt=y([]),qt=y({});function Dt(){i(j,!0)}function J(c){c instanceof FocusEvent&&c.currentTarget instanceof HTMLElement&&c.relatedTarget instanceof HTMLElement&&c.currentTarget.contains(c.relatedTarget)||i(j,!1)}function nt(c,L=!1){return c==null?"??":L?`${c}%`:`${c}`}function St(c,L){if(!c&&!L)return[];const st=c?.entries??{},ht=L?.entries??{},ut=new Set([...Object.keys(st),...Object.keys(ht)]),ft=[];for(const m of ut){const k=st[m]??null,O=ht[m]??null,yt=t(qt)[m]?.name??m;if(!k&&O){O.utility!==null&&ft.push(`${yt} utility ${nt(null)} ‚Üí ${nt(O.utility)}`),O.probability!==null&&ft.push(`${yt} probability ${nt(null,!0)} ‚Üí ${nt(O.probability,!0)}`);continue}k&&O&&(k.utility!==O.utility&&ft.push(`${yt} utility ${nt(k.utility)} ‚Üí ${nt(O.utility)}`),k.probability!==O.probability&&ft.push(`${yt} probability ${nt(k.probability,!0)} ‚Üí ${nt(O.probability,!0)}`)),k&&!O&&(k.utility!==null&&ft.push(`${yt} utility ${nt(k.utility)} ‚Üí ${nt(null)}`),k.probability!==null&&ft.push(`${yt} probability ${nt(k.probability,!0)} ‚Üí ${nt(null,!0)}`))}return ft}function $t(c,L){return St(c,L)}U(()=>d(),()=>{i(X,d())}),U(()=>t(X),()=>{i(K,[...t(X).past??[]].slice().reverse())}),U(()=>t(X),()=>{i(Lt,t(X).future??[])}),U(()=>H(),()=>{i(rt,H()??[])}),U(()=>t(rt),()=>{i(qt,Object.fromEntries(t(rt).map(c=>[c.id,c])))}),xe(),me();var M=ti(),it=r(M),lt=l(r(it),2),zt=r(lt);o(lt),o(it),we(it,c=>i(u,c),()=>t(u));var v=l(it,2);{var z=c=>{var L=Qn(),st=r(L),ht=l(r(st),2);{var ut=V=>{var wt=Bn();g(V,wt)},ft=V=>{var wt=Kn();ie(wt,5,()=>t(K),Je,(Gt,P)=>{var Ct=Fn(),Ot=r(Ct),Nt=r(Ot),Vt=r(Nt,!0);o(Nt);var It=l(Nt,2),Ft=r(It);o(It),o(Ot);var Xt=l(Ot,2);{var Ht=xt=>{var Pt=Hn();ie(Pt,5,()=>(t(P),E(()=>$t(t(P).before?.vote,t(P).after?.vote))),Z=>Z,(Z,Zt)=>{var p=Un(),f=r(p,!0);o(p),ct(()=>at(f,t(Zt))),g(Z,p)}),o(Pt),g(xt,Pt)},Bt=xt=>{var Pt=Vn();g(xt,Pt)};gt(Xt,xt=>{t(P),E(()=>$t(t(P).before?.vote,t(P).after?.vote).length)?xt(Ht):xt(Bt,!1)})}o(Ct),ct(xt=>{at(Vt,(t(P),E(()=>t(P).label))),at(Ft,`[${xt??""}]`)},[()=>(t(P),E(()=>t(P).scope.join(", ")))]),g(Gt,Ct)}),o(wt),g(V,wt)};gt(ht,V=>{t(K),E(()=>t(K).length===0)?V(ut):V(ft,!1)})}o(st);var m=l(st,2),k=l(r(m),2);{var O=V=>{var wt=Yn();g(V,wt)},yt=V=>{var wt=Zn();ie(wt,5,()=>t(Lt),Je,(Gt,P)=>{var Ct=Jn(),Ot=r(Ct),Nt=r(Ot),Vt=r(Nt,!0);o(Nt);var It=l(Nt,2),Ft=r(It);o(It),o(Ot);var Xt=l(Ot,2);{var Ht=xt=>{var Pt=Gn();ie(Pt,5,()=>(t(P),E(()=>$t(t(P).before?.vote,t(P).after?.vote))),Z=>Z,(Z,Zt)=>{var p=Wn(),f=r(p,!0);o(p),ct(()=>at(f,t(Zt))),g(Z,p)}),o(Pt),g(xt,Pt)},Bt=xt=>{var Pt=Xn();g(xt,Pt)};gt(Xt,xt=>{t(P),E(()=>$t(t(P).before?.vote,t(P).after?.vote).length)?xt(Ht):xt(Bt,!1)})}o(Ct),ct(xt=>{at(Vt,(t(P),E(()=>t(P).label))),at(Ft,`[${xt??""}]`)},[()=>(t(P),E(()=>t(P).scope.join(", ")))]),g(Gt,Ct)}),o(wt),g(V,wt)};gt(k,V=>{t(Lt),E(()=>t(Lt).length===0)?V(O):V(yt,!1)})}o(m),o(L),g(c,L)};gt(v,c=>{t(j)&&c(z)})}o(M),ct(()=>{be(it,"aria-expanded",t(j)),at(zt,`Log (${t(X),E(()=>t(X).past.length)??""})`)}),R("mouseenter",M,Dt),R("mouseleave",M,J),R("focusin",M,Dt),R("focusout",M,J),g(b,M),he(),G()}var ai=S("<img/>");function la(b,C){const d=na(C,["children","$$slots","$$events","$$legacy"]),H=na(d,["src","alt","loading","decoding"]);let B=Wt(C,"src",8),G=Wt(C,"alt",8),j=Wt(C,"loading",8,"lazy"),u=Wt(C,"decoding",8,"async");var X=ai();ga(X,()=>({...H,src:B(),alt:G(),loading:j(),decoding:u()})),da(X),g(b,X)}var ni=S('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),ii=S('<p class="status error svelte-f9uau2"> </p>'),oi=S('<figure class="inline-frame svelte-f9uau2"><!></figure>'),ri=S('<p class="inline-weather svelte-f9uau2"> </p>'),li=S('<p class="inline-food svelte-f9uau2"> </p>'),si=S('<div class="inline-track svelte-f9uau2"></div> <div class="inline-overlay svelte-f9uau2"><div class="inline-heading svelte-f9uau2"><span class="inline-name svelte-f9uau2"> </span> <span class="inline-country svelte-f9uau2"> </span></div> <p class="inline-summary svelte-f9uau2"> </p> <!> <!></div>',1),ci=S('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),ui=S('<div class="inline-strip svelte-f9uau2" role="group"><!></div>'),di=S('<div class="background-placeholder svelte-f9uau2">Loading imagery‚Ä¶</div>'),vi=S('<div class="background-placeholder svelte-f9uau2"> </div>'),fi=S('<div><div class="sprite-frame svelte-f9uau2"></div> <div class="sprite-frame svelte-f9uau2"></div></div>'),pi=S('<div class="background-placeholder svelte-f9uau2">Preparing imagery‚Ä¶</div>'),bi=S('<div class="background-strip svelte-f9uau2" aria-hidden="true"><!></div>'),mi=S('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),_i=S('<p class="status error svelte-f9uau2"> </p>'),hi=S('<span class="credit svelte-f9uau2"> </span>'),gi=S('<figcaption class="svelte-f9uau2"> <!></figcaption>'),yi=S('<figure class="svelte-f9uau2"><!> <!></figure>'),wi=S('<div class="image-row svelte-f9uau2"></div>'),xi=S('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),Ei=S('<div class="image-strip svelte-f9uau2" role="group"><!></div>');function Si(b,C){_e(C,!1);const d=y(),H=y(),B=y(),G=y();let j=Wt(C,"city",8),u=Wt(C,"variant",8,"details"),X=Wt(C,"direction",8,"normal"),K=Wt(C,"showCaptions",8,!0),Lt=Wt(C,"scrollDuration",8,24);const rt=Object.create(null),qt=Object.create(null),Dt=Object.create(null),J=480,nt="Details available in the expanded view.",St=1,$t={};let M=y("idle"),it=y(null),lt=y([]),zt=y([]),v=y(""),z=null,c=0,L=y({}),st=y([]),ht=y(null),ut=y(1),ft=y(1),m=0,k="";function O(p){let f=0;for(let x=0;x<p.length;x+=1)f=(f<<5)-f+p.charCodeAt(x),f|=0;return f}function yt(p){const f=Lt()*2.5,x=p?.id;if(!x)return f;const pt=.5+Math.abs(O(x))%1e3/1e3*St;return f*pt}function V(p){const f=p.startsWith("/")?p:`/${p}`;return ia?`${ia}${f}`:f}function wt(p){return V(`${j().images_path}/${p}`)}async function Gt(p){if(!p)return;const f=++c;if(rt[p]){i(it,rt[p]),i(lt,t(it)?.images??[]),i(M,"ready"),i(v,""),typeof window<"u"&&Nt(t(lt));return}i(v,""),i(M,"loading");try{const x=await ya(p);if(f!==c)return;rt[p]=x,i(it,x),i(lt,x.images??[]),i(M,"ready"),typeof window<"u"&&Nt(t(lt))}catch(x){if(f!==c)return;i(M,"error"),i(v,x instanceof Error?x.message:"Unable to load images.")}}function P(p){const f=p?.id??null;if(!f){z!==null&&(z=null,i(it,null),i(lt,[]),i(zt,[]),i(M,"idle"),i(v,""));return}if(f===z)return;z=f;const x=rt[f];if(x){i(it,x),i(lt,x.images??[]),i(M,"ready"),i(v,""),Ct(),typeof window<"u"&&Nt(t(lt));return}i(it,null),i(lt,[]),i(zt,[]),i(M,"loading"),i(v,""),Gt(f).then(Ct)}function Ct(){const p=t(lt)??[],f=p.length>1?Xt(z,p):p;(u()==="inline"||u()==="background")&&f.length>0?i(zt,[...f,...f]):i(zt,f)}function Ot(p){if(!p)return 1;const f=t(L)[p]??qt[p];return f&&Number.isFinite(f)&&f>0?f:1}async function Nt(p){const f=p.filter(x=>x.image&&!qt[x.image]);f.length!==0&&(await Promise.all(f.map(x=>new Promise(T=>{const Q=new Image;Q.src=wt(x.image),Q.onload=()=>{const pt=Q.naturalHeight?Q.naturalWidth/Q.naturalHeight:1;qt[x.image]=pt>0?pt:1,T()},Q.onerror=()=>{qt[x.image]=1,T()}}))),i(L,Object.fromEntries(Object.entries(qt).map(([x,T])=>[x,T&&Number.isFinite(T)&&T>0?T:1]))))}function Vt(p){const f=Dt[p];return f&&f.complete&&f.naturalWidth>0?Promise.resolve(f):new Promise((x,T)=>{const Q=new Image;Q.crossOrigin="anonymous",Q.decoding="async",Q.onload=()=>{Dt[p]=Q,x(Q)},Q.onerror=()=>{T(new Error(`Unable to load image at ${p}`))},Q.src=p})}async function It(p){const f=p.filter(D=>!!D.image);if(f.length===0)throw new Error("No image sources available for sprite generation.");const x=await Promise.all(f.map(D=>Vt(wt(D.image)))),T=J,Q=x.map(D=>D.naturalHeight?D.naturalWidth/D.naturalHeight*T:T),pt=Math.max(1,Math.round(Q.reduce((D,tt)=>D+tt,0))),Et=document.createElement("canvas");Et.width=pt,Et.height=T;const dt=Et.getContext("2d");if(!dt)throw new Error("Unable to obtain canvas rendering context.");let N=0;for(let D=0;D<x.length;D+=1){const tt=x[D],ot=Q[D];dt.drawImage(tt,N,0,ot,T),N+=ot}let Rt="";try{Rt=Et.toDataURL("image/webp",.92)}catch{Rt=""}return(!Rt||Rt==="data:,")&&(Rt=Et.toDataURL("image/png")),{url:Rt,ratio:pt/T}}function Ft(p){const f=[...p];for(let x=f.length-1;x>0;x-=1){const T=Math.floor(Math.random()*(x+1));[f[x],f[T]]=[f[T],f[x]]}return f}function Xt(p,f){if(!p)return Ft(f);const x=$t[p];if(x&&x.length===f.length)return x;const T=Ft(f);return $t[p]=T,T}function Ht(){i(ht,null),i(ut,1),k=""}async function Bt(p){if(typeof window>"u"||u()!=="background")return;const f=p.length>1?Xt(z,p):p,x=f.map(Q=>Q.image??"").join("|");if(x&&x===k&&t(ht))return;if(!f.length){Ht();return}const T=++m;try{const{url:Q,ratio:pt}=await It(f);if(T!==m)return;i(ht,Q),i(ut,Number.isFinite(pt)&&pt>0?pt:1),k=x}catch(Q){if(T!==m)return;Ht(),console.warn("CityImageStrip: failed to build sprite",Q)}}va(()=>P(j())),Re(()=>{P(j()),typeof window<"u"&&t(lt).length&&Nt(t(lt))}),U(()=>{},()=>{Ct()}),U(()=>t(it),()=>{i(d,t(it)?.summary??"")}),U(()=>t(it),()=>{i(H,t(it)?.seasonal_notes??"")}),U(()=>t(it),()=>{i(B,t(it)?.food_and_drink?.[0]??"")}),U(()=>At(j()),()=>{i(G,yt(j()))}),U(()=>(t(zt),t(L)),()=>{i(st,t(zt).map(p=>(t(L),Ot(p.image))))}),U(()=>t(ut),()=>{i(ft,Number.isFinite(t(ut))&&t(ut)>0?t(ut):1)}),U(()=>(At(u()),t(M),t(lt)),()=>{typeof window<"u"&&u()==="background"&&(t(M)==="ready"?Bt(t(lt)):Ht())}),xe(),me();var xt=ne(),Pt=te(xt);{var Z=p=>{var f=ui(),x=r(f);{var T=pt=>{var Et=ni();g(pt,Et)},Q=pt=>{var Et=ne(),dt=te(Et);{var N=D=>{var tt=ii(),ot=r(tt,!0);o(tt),ct(()=>at(ot,t(v))),g(D,tt)},Rt=D=>{var tt=ne(),ot=te(tt);{var Ut=bt=>{var kt=si(),Tt=te(kt);ie(Tt,5,()=>t(zt),Je,(et,h,A)=>{var F=oi(),Y=r(F);{let mt=Me(()=>(t(h),E(()=>wt(t(h).image)))),Mt=Me(()=>(t(h),At(j()),E(()=>t(h).caption??`${j().name} skyline`)));la(Y,{get src(){return t(mt)},get alt(){return t(Mt)},loading:"lazy",decoding:"async"})}o(F),ct(()=>{be(F,"aria-hidden",(t(lt),E(()=>A>=t(lt).length?"true":void 0))),fe(F,(t(st),E(()=>`aspect-ratio: ${t(st)[A]??1}`)))}),g(et,F)}),o(Tt);var Jt=l(Tt,2),e=r(Jt),a=r(e),n=r(a,!0);o(a);var s=l(a,2),_=r(s,!0);o(s),o(e);var w=l(e,2),q=r(w,!0);o(w);var I=l(w,2);{var jt=et=>{var h=ri(),A=r(h,!0);o(h),ct(()=>at(A,t(H))),g(et,h)};gt(I,et=>{t(H)&&et(jt)})}var $=l(I,2);{var vt=et=>{var h=li(),A=r(h,!0);o(h),ct(()=>at(A,t(B))),g(et,h)};gt($,et=>{t(B)&&et(vt)})}o(Jt),ct(()=>{fe(Tt,`--scroll-duration: ${t(G)}s; --scroll-direction: ${X()}`),at(n,(At(j()),E(()=>j().name))),at(_,(At(j()),E(()=>j().country))),at(q,t(d)||nt)}),g(bt,kt)},Kt=bt=>{var kt=ci();g(bt,kt)};gt(ot,bt=>{t(zt),E(()=>t(zt).length)?bt(Ut):bt(Kt,!1)},!0)}g(D,tt)};gt(dt,D=>{t(M)==="error"?D(N):D(Rt,!1)},!0)}g(pt,Et)};gt(x,pt=>{t(M)==="loading"?pt(T):pt(Q,!1)})}o(f),ct(()=>be(f,"aria-label",(At(j()),E(()=>`Images for ${j().name}`)))),g(p,f)},Zt=p=>{var f=ne(),x=te(f);{var T=pt=>{var Et=bi(),dt=r(Et);{var N=D=>{var tt=di();g(D,tt)},Rt=D=>{var tt=ne(),ot=te(tt);{var Ut=bt=>{var kt=vi(),Tt=r(kt,!0);o(kt),ct(()=>at(Tt,t(v))),g(bt,kt)},Kt=bt=>{var kt=ne(),Tt=te(kt);{var Jt=a=>{var n=fi();let s;var _=r(n);let w;var q=l(_,2);let I;o(n),ct(()=>{s=Be(n,1,"sprite-runner svelte-f9uau2",null,s,{paused:!t(ht)}),fe(n,`--scroll-duration: ${t(G)}s; --scroll-direction: ${X()==="reverse"?"reverse":"normal"};`),w=fe(_,`--sprite-ratio: ${t(ft)};`,w,{"background-image":`url("${t(ht)}")`}),I=fe(q,`--sprite-ratio: ${t(ft)};`,I,{"background-image":`url("${t(ht)}")`})}),g(a,n)},e=a=>{var n=pi();g(a,n)};gt(Tt,a=>{t(ht)?a(Jt):a(e,!1)},!0)}g(bt,kt)};gt(ot,bt=>{t(M)==="error"?bt(Ut):bt(Kt,!1)},!0)}g(D,tt)};gt(dt,D=>{t(M)==="loading"?D(N):D(Rt,!1)})}o(Et),g(pt,Et)},Q=pt=>{var Et=Ei(),dt=r(Et);{var N=D=>{var tt=mi();g(D,tt)},Rt=D=>{var tt=ne(),ot=te(tt);{var Ut=bt=>{var kt=_i(),Tt=r(kt,!0);o(kt),ct(()=>at(Tt,t(v))),g(bt,kt)},Kt=bt=>{var kt=ne(),Tt=te(kt);{var Jt=a=>{var n=wi();ie(n,5,()=>t(lt),s=>s.image,(s,_)=>{var w=yi(),q=r(w);{let $=Me(()=>(t(_),E(()=>wt(t(_).image)))),vt=Me(()=>(t(_),At(j()),E(()=>t(_).caption??`${j().name} skyline`)));la(q,{get src(){return t($)},get alt(){return t(vt)},loading:"lazy",decoding:"async"})}var I=l(q,2);{var jt=$=>{var vt=gi(),et=r(vt),h=l(et);{var A=F=>{var Y=hi(),mt=r(Y);o(Y),ct(()=>at(mt,`¬∑ ${t(_),E(()=>t(_).credit)??""}`)),g(F,Y)};gt(h,F=>{t(_),E(()=>t(_).credit)&&F(A)})}o(vt),ct(()=>at(et,`${t(_),E(()=>t(_).caption)??""} `)),g($,vt)};gt(I,$=>{At(K()),t(_),E(()=>K()&&t(_).caption)&&$(jt)})}o(w),g(s,w)}),o(n),g(a,n)},e=a=>{var n=xi();g(a,n)};gt(Tt,a=>{t(lt),E(()=>t(lt).length)?a(Jt):a(e,!1)},!0)}g(bt,kt)};gt(ot,bt=>{t(M)==="error"?bt(Ut):bt(Kt,!1)},!0)}g(D,tt)};gt(dt,D=>{t(M)==="loading"?D(N):D(Rt,!1)})}o(Et),ct(()=>be(Et,"aria-label",(At(j()),E(()=>`Images for ${j().name}`)))),g(pt,Et)};gt(x,pt=>{u()==="background"?pt(T):pt(Q,!1)},!0)}g(p,f)};gt(Pt,p=>{u()==="inline"?p(Z):p(Zt,!1)})}g(b,xt),he()}var zi=S('<span class="chip svelte-jdafhq"><span class="label svelte-jdafhq">Country</span> <strong class="svelte-jdafhq"> </strong></span>'),ki=S('<span class="chip status-chip svelte-jdafhq" role="status"><span class="label svelte-jdafhq">Status</span> <strong class="svelte-jdafhq">Session cleared.</strong></span>'),ji=S('<div class="confirm-backdrop svelte-jdafhq" role="presentation"><div class="confirm-box svelte-jdafhq" role="dialog" aria-modal="true" aria-labelledby="reset-heading"><h3 id="reset-heading" class="svelte-jdafhq">Clear all saved data?</h3> <p class="svelte-jdafhq">This removes your ballot inputs and undo history from this device. You cannot undo this action.</p> <div class="confirm-actions svelte-jdafhq"><button type="button" class="danger svelte-jdafhq">Yes, clear everything</button> <button type="button" class="svelte-jdafhq">Cancel</button></div></div></div>'),qi=S('<div><!> <span class="chip chip-button static svelte-jdafhq"><span class="label svelte-jdafhq">Last saved</span> <span class="chip-content svelte-jdafhq"><span class="chip-icon svelte-jdafhq" aria-hidden="true">üíæ</span> <strong class="svelte-jdafhq"> </strong></span></span> <button type="button" class="chip chip-button svelte-jdafhq"><span class="label svelte-jdafhq"><span class="btn-icon svelte-jdafhq" aria-hidden="true">üóë</span> Reset</span> <strong class="svelte-jdafhq">Clear ballot</strong></button> <!></div> <!>',1);function $i(b,C){_e(C,!1);const d=()=>ve(Oe,"$settingsStore",B),H=()=>ve(pe,"$voteSessionStore",B),[B,G]=Ze(),j=y();let u=Wt(C,"inline",8,!1);const X=je();let K=y(!1),Lt=y(!1),rt=null,qt=y(),Dt=y();function J(){i(K,!0)}function nt(){i(K,!1)}function St(){pe.clear(),xa.reset(),oe.clear(),Oe.update(k=>({...k,preferredMode:null})),i(Lt,!0),nt(),rt&&clearTimeout(rt),rt=setTimeout(()=>{i(Lt,!1)},3500),X("cleared")}Qe(()=>{rt&&clearTimeout(rt)});const $t=u()?"status-inline":"status-ribbon";U(()=>d(),()=>{i(qt,d())}),U(()=>H(),()=>{i(Dt,H())}),U(()=>t(Dt),()=>{i(j,t(Dt).lastUpdated?new Date(t(Dt).lastUpdated).toLocaleTimeString():"Not saved yet")}),xe(),me();var M=qi(),it=te(M),lt=r(it);{var zt=k=>{var O=zi(),yt=l(r(O),2),V=r(yt,!0);o(yt),o(O),ct(()=>at(V,(t(qt),E(()=>t(qt).countryKey)))),g(k,O)};gt(lt,k=>{t(qt),E(()=>t(qt).countryKey)&&k(zt)})}var v=l(lt,2),z=l(r(v),2),c=l(r(z),2),L=r(c,!0);o(c),o(z),o(v);var st=l(v,2),ht=l(st,2);{var ut=k=>{var O=ki();g(k,O)};gt(ht,k=>{t(Lt)&&k(ut)})}o(it);var ft=l(it,2);{var m=k=>{var O=ji(),yt=r(O),V=l(r(yt),4),wt=r(V),Gt=l(wt,2);o(V),o(yt),o(O),R("click",wt,St),R("click",Gt,nt),g(k,O)};gt(ft,k=>{t(K)&&k(m)})}ct(()=>{Be(it,1,wa($t),"svelte-jdafhq"),at(L,t(j))}),R("click",st,J),g(b,M),he(),G()}var Ci=S('<div class="info-chip summary-chip svelte-1mrulz2"><span aria-hidden="true">‚ÑπÔ∏è</span> </div>'),Li=S('<div class="info-chip summary-chip error svelte-1mrulz2"><span aria-hidden="true">‚ö†</span> City insights not available.</div>'),Mi=S('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üå§</span> </div>'),Ai=S('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üçΩ</span> </div>'),Ri=S('<tr class="city-row svelte-1mrulz2"><th scope="row" class="city-col svelte-1mrulz2"><div class="city-card svelte-1mrulz2"><div class="row-bg svelte-1mrulz2"><!></div> <div class="row-content svelte-1mrulz2"><div class="city-headline svelte-1mrulz2"><div class="city-title svelte-1mrulz2"><span class="city-country svelte-1mrulz2"><span class="flag svelte-1mrulz2" aria-hidden="true"> </span> </span> <span class="city-name svelte-1mrulz2"> </span></div></div> <div class="meta-stack svelte-1mrulz2"><!> <!> <!></div></div></div></th><td class="utility-col svelte-1mrulz2"><!></td><td class="probability-col svelte-1mrulz2"><div class="probability-cell svelte-1mrulz2"><div class="input-stack svelte-1mrulz2"><!> <button type="button" class="row-reset svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚ü≤</span> Reset</button></div></div></td></tr>'),Ti=S('<section class="grid-shell svelte-1mrulz2"><header class="grid-header svelte-1mrulz2"><!> <div class="toolbar svelte-1mrulz2"><!> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Ü∫</span> Undo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Üª</span> Redo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">üõ†</span> Bulk Actions</button></div></header> <div class="table-scroll svelte-1mrulz2"><table class="svelte-1mrulz2"><colgroup><col class="col-city svelte-1mrulz2"/><col class="col-utility svelte-1mrulz2"/><col class="col-probability svelte-1mrulz2"/></colgroup><thead class="svelte-1mrulz2"><tr><th scope="col" class="city-header svelte-1mrulz2">City</th><th scope="col" class="utility-header svelte-1mrulz2">Favorability</th><th scope="col" class="probability-header svelte-1mrulz2">Probability</th></tr></thead><tbody class="svelte-1mrulz2"></tbody></table></div> <!></section>');function Pi(b,C){_e(C,!1);const d=()=>ve(sa,"$citiesStore",u),H=()=>ve(Sa,"$citiesDocumentStore",u),B=()=>ve(pe,"$voteSessionStore",u),G=()=>ve(oe,"$commandHistoryStore",u),j=()=>ve(Oe,"$settingsStore",u),[u,X]=Ze(),K=Object.assign({"../data/static/meta/athens-greece.json":ja,"../data/static/meta/bangkok-thailand.json":qa,"../data/static/meta/belgrade-serbia.json":$a,"../data/static/meta/bucharest-romania.json":Ca,"../data/static/meta/budapest-hungary.json":La,"../data/static/meta/buenos-aires-argentina.json":Ma,"../data/static/meta/cairo-egypt.json":Aa,"../data/static/meta/cartagena-colombia.json":Ra,"../data/static/meta/casablanca-morocco.json":Ta,"../data/static/meta/chiang-mai-thailand.json":Pa,"../data/static/meta/delhi-india.json":Da,"../data/static/meta/doha-qatar.json":Ia,"../data/static/meta/dubai-uae.json":Oa,"../data/static/meta/dublin-ireland.json":Na,"../data/static/meta/florence-italy.json":Ba,"../data/static/meta/guadalajara-mexico.json":Ua,"../data/static/meta/hanoi-vietnam.json":Ha,"../data/static/meta/helsinki-finland.json":Va,"../data/static/meta/ho-chi-minh-city-vietnam.json":Fa,"../data/static/meta/hong-kong-hong-kong.json":Ka,"../data/static/meta/jakarta-indonesia.json":Ya,"../data/static/meta/krakow-poland.json":Wa,"../data/static/meta/lima-peru.json":Ga,"../data/static/meta/ljubljana-slovenia.json":Xa,"../data/static/meta/lyon-france.json":Ja,"../data/static/meta/madrid-spain.json":Za,"../data/static/meta/manila-philippines.json":Qa,"../data/static/meta/marrakesh-morocco.json":tn,"../data/static/meta/mendoza-argentina.json":en,"../data/static/meta/mumbai-india.json":an,"../data/static/meta/munich-germany.json":nn,"../data/static/meta/nairobi-kenya.json":on,"../data/static/meta/nicosia-cyprus.json":rn,"../data/static/meta/prague-czech-republic.json":ln,"../data/static/meta/quito-ecuador.json":sn,"../data/static/meta/rio-de-janeiro-brazil.json":cn,"../data/static/meta/rotterdam-netherlands.json":un,"../data/static/meta/santiago-chile.json":dn,"../data/static/meta/sao-paulo-brazil.json":vn,"../data/static/meta/seoul-south-korea.json":fn,"../data/static/meta/seville-spain.json":pn,"../data/static/meta/stockholm-sweden.json":bn,"../data/static/meta/taipei-taiwan.json":mn,"../data/static/meta/tashkent-uzbekistan.json":_n,"../data/static/meta/template.json":hn,"../data/static/meta/thessaloniki-greece.json":gn,"../data/static/meta/tunis-tunisia.json":yn,"../data/static/meta/vienna-austria.json":wn,"../data/static/meta/warsaw-poland.json":xn,"../data/static/meta/zagreb-croatia.json":En}),Lt=/\/meta\/([^/]+)\.json$/,rt={};for(const[a,n]of Object.entries(K)){const s=Lt.exec(a);if(!s)continue;const _=s[1],w=Ea.parse(n);rt[_]=w}const qt={Greece:"üá¨üá∑",Thailand:"üáπüá≠",Serbia:"üá∑üá∏",Argentina:"üá¶üá∑",Romania:"üá∑üá¥",Hungary:"üá≠üá∫",Egypt:"üá™üá¨",Morocco:"üá≤üá¶",Ireland:"üáÆüá™",UAE:"üá¶üá™",Italy:"üáÆüáπ",Vietnam:"üáªüá≥",Finland:"üá´üáÆ","Hong Kong":"üá≠üá∞",Peru:"üáµüá™",France:"üá´üá∑",Spain:"üá™üá∏",Philippines:"üáµüá≠",Germany:"üá©üá™",Cyprus:"üá®üáæ","Czech Republic":"üá®üáø",Brazil:"üáßüá∑",Netherlands:"üá≥üá±",Chile:"üá®üá±","South Korea":"üá∞üá∑",Sweden:"üá∏üá™",Taiwan:"üáπüáº",Uzbekistan:"üá∫üáø",Tunisia:"üáπüá≥",Croatia:"üá≠üá∑"};function Dt(a){return qt[a]??"üåç"}let J=y([]),nt=y({}),St=y([]),$t=y(null),M=y(pe.getSnapshot()),it=y({past:[],future:[]}),lt=y();const zt=rt;let v=y(!1),z=y(null),c=y(!1),L=y([]),st=y([]);const ht={},ut=["utility","probability"],ft=je();let m=y(!1),k=y(!1),O=y([]),yt=y(!1);const V="reunion-phase2:grid-order";function wt(a,n){const s=n.detail.value;Pt(a,"utility",s)}function Gt(a,n){const s=n.detail.value;Pt(a,"probability",s)}function P(){Rn(),i(v,!0)}function Ct(){i(v,!1),Tn()}function Ot(){if(!t(J).length)return;const a=t(J).map(n=>n.id);for(let n=a.length-1;n>0;n-=1){const s=Math.floor(Math.random()*(n+1));[a[n],a[s]]=[a[s],a[n]]}i(st,a),Vt(a)}function Nt(){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(V);if(!a)return null;const n=JSON.parse(a);return Array.isArray(n)?n:null}catch{return null}}function Vt(a){if(!(typeof localStorage>"u"))try{localStorage.setItem(V,JSON.stringify(a))}catch{}}function It(a){return zt[a]??null}function Ft(a){const n=It(a);return n?.food_and_drink?.length?n.food_and_drink.slice(0,2).join(" ‚Ä¢ "):null}function Xt(a){return It(a)?.seasonal_notes??null}function Ht(){Ot(),ft("reset")}function Bt(a){const{actions:n}=a.detail;if(!n||n.length===0){Ct();return}const s={},_=h=>Math.max(0,Math.min(100,Math.round(h))),w=(h,A)=>{const F=s[h];if(F&&F[A]!==void 0){const Mt=F[A];return typeof Mt=="number"?Mt:0}const mt=t(M).entries[h]?.[A]??null;return typeof mt=="number"?mt:0},q=(h,A,F)=>{let Y=s[h];Y||(Y={},s[h]=Y),Y[A]=_(F)},I=t(J).map(h=>h.id),jt={};for(const h of t(J))(jt[h.continent]??=[]).push(h.id);const $=(h,A,F)=>{for(const Y of h)q(Y,A,F)},vt=(h,A,F)=>{for(const Y of h){const mt=w(Y,A);q(Y,A,mt+F)}};for(const h of n)switch(h.type){case"setAllProbabilities":$(I,"probability",h.value);break;case"setAllUtilities":$(I,"utility",h.value);break;case"adjustAllUtilities":vt(I,"utility",h.delta);break;case"adjustAllProbabilities":vt(I,"probability",h.delta);break;case"normalizeProbabilities":{const A=_(h.target),F=I.map(mt=>w(mt,"probability")),Y=F.reduce((mt,Mt)=>mt+Mt,0)/(F.length||1);if(Y===0)$(I,"probability",A);else{const mt=A/Y;F.forEach((Mt,Qt)=>{const re=_(Mt*mt);q(I[Qt],"probability",re)})}break}case"setContinentUtility":{const A=jt[h.continent]??[];$(A,"utility",h.value);break}case"adjustContinentUtility":{const A=jt[h.continent]??[];vt(A,"utility",h.delta);break}case"setContinentProbability":{const A=jt[h.continent]??[];$(A,"probability",h.value);break}case"adjustContinentProbability":{const A=jt[h.continent]??[];vt(A,"probability",h.delta);break}}const et=[];for(const[h,A]of Object.entries(s)){const F=t(M).entries[h],Y={};let mt=!1;if(A.utility!==void 0){const Mt=_(A.utility);(F?.utility??null)!==Mt&&(Y.utility=Mt,Y.autoFilled=!1,mt=!0)}if(A.probability!==void 0){const Mt=_(A.probability);(F?.probability??null)!==Mt&&(Y.probability=Mt,mt=!0)}mt&&et.push({cityId:h,updates:Y})}et.length!==0&&(oe.execute({label:`Bulk actions (${et.length} cities)`,scope:["vote"],perform:()=>{for(const{cityId:h,updates:A}of et)pe.updateEntry(h,A)}}),za(`Applied bulk actions to ${et.length} ${et.length===1?"city":"cities"}.`))}function xt(a){return t(M).entries[a]??{cityId:a,utility:null,probability:null,autoFilled:!1}}function Pt(a,n,s){if((t(M).entries[a]?.[n]??null)===s)return;const q=n==="utility"?{utility:s,autoFilled:!1}:{probability:s};oe.execute({label:`${n==="utility"?"Favorability":"Probability"} ‚Üí ${a}`,scope:["vote"],perform:()=>{pe.updateEntry(a,q)}})}function Z(a){t(M).entries[a]&&oe.execute({label:`Reset ${a}`,scope:["vote"],perform:()=>pe.resetCity(a)})}function Zt(a,n,s){if(!s)return;s.dataset.cityId=a,s.dataset.column=n;const _=ht[a]??{};_[n]=s,ht[a]=_}function p(a,n,s){const _=ht[a];_&&_[n]===s&&(delete _[n],ht[a]=_)}function f(a,n,s=!1){const w=ht[a]?.[n];return!w||"disabled"in w&&w.disabled?!1:(w.focus(),typeof w.select=="function"&&w.select(),s&&setTimeout(()=>{w.dispatchEvent(new CustomEvent("auto-open",{bubbles:!1}))},0),!0)}function x(a,n,s=!0){if(f(a,n,s)||!t(z))return;const _=t(z).querySelector(`tr[data-row="${a}"]`);_&&(_.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{f(a,n,s)},120))}function T(a,n,s){const _=ut.length,w=t(L).findIndex(et=>et.city.id===a);if(w===-1)return;const q=ut.indexOf(n);if(q===-1)return;const I=w*_+q,jt=Math.min(t(L).length*_-1,Math.max(0,I+s)),$=t(L)[Math.floor(jt/_)],vt=ut[jt%_];$&&x($.city.id,vt)}function Q(a){const{key:n}=a;if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"].includes(n))return;const s=a.target;if(!(s instanceof HTMLElement))return;const _=s.dataset.cityId,w=s.dataset.column;if(!_||!w)return;let q=t(J).findIndex(vt=>vt.id===_);if(q===-1)return;let I=ut.indexOf(w);if(I===-1)return;switch(a.preventDefault(),n){case"ArrowUp":q=Math.max(0,q-1);break;case"ArrowDown":q=Math.min(t(J).length-1,q+1);break;case"ArrowLeft":I>0?I-=1:q>0&&(q-=1,I=ut.length-1);break;case"ArrowRight":I<ut.length-1?I+=1:q<t(J).length-1&&(q+=1,I=0);break;case"Home":I=0;break;case"End":I=ut.length-1;break}const jt=t(J)[q],$=ut[I];x(jt.id,$,!0)}function pt(a){!(a.ctrlKey||a.metaKey)||a.key.toLowerCase()!=="z"||(a.preventDefault(),a.shiftKey?oe.redo():oe.undo())}function Et(){oe.undo()}function dt(){oe.redo()}Re(()=>(window.addEventListener("keydown",pt),Ot(),()=>{window.removeEventListener("keydown",pt)})),U(()=>d(),()=>{i(J,d())}),U(()=>t(J),()=>{i(nt,Object.fromEntries(t(J).map(a=>[a.id,a])))}),U(()=>(t(J),t(st),t(nt)),()=>{if(t(J).length&&t(st).length!==t(J).length){const a=Nt();a?.length===t(J).length?i(st,a.filter(n=>t(nt)[n])):(i(st,t(J).map(n=>n.id)),Vt(t(st)))}}),U(()=>(t(st),t(nt)),()=>{i(St,t(st).map(a=>t(nt)[a]).filter(a=>!!a))}),U(()=>H(),()=>{i($t,H())}),U(()=>B(),()=>{i(M,B())}),U(()=>G(),()=>{i(it,G())}),U(()=>j(),()=>{i(lt,j())}),U(()=>(t(M),t(St),t(J)),()=>{t(M);const a=t(St).length===t(J).length&&t(St).length>0?t(St):t(J);i(L,a.map((n,s)=>{const _=xt(n.id);return{city:n,entry:_,index:s,meta:It(n.id)}}))}),U(()=>t(it),()=>{i(m,(t(it).past??[]).length>0)}),U(()=>t(it),()=>{i(k,(t(it).future??[]).length>0)}),U(()=>(t(lt),t(c)),()=>{i(yt,!!t(lt)?.countryKey&&!t(c))}),U(()=>(t($t),t(J)),()=>{i(O,t($t)?.continents?.length?[...t($t).continents]:Array.from(new Set(t(J).map(a=>a.continent))).sort())}),xe(),me();var N=Ti(),Rt=r(N),D=r(Rt);$i(D,{inline:!0,$$events:{cleared:Ht}});var tt=l(D,2),ot=r(tt);ei(ot,{});var Ut=l(ot,2),Kt=l(Ut,2),bt=l(Kt,2);o(tt),o(Rt);var kt=l(Rt,2),Tt=r(kt),Jt=l(r(Tt),2);ie(Jt,5,()=>t(L),a=>a.city.id,(a,n)=>{var s=Ri(),_=r(s),w=r(_),q=r(w),I=r(q);{let W=Me(()=>(t(n),E(()=>t(n).index%2===0?"normal":"reverse")));Si(I,{get city(){return t(n),E(()=>t(n).city)},variant:"background",get direction(){return t(W)}})}o(q);var jt=l(q,2),$=r(jt),vt=r($),et=r(vt),h=r(et),A=r(h,!0);o(h);var F=l(h);o(et);var Y=l(et,2),mt=r(Y,!0);o(Y),o(vt),o($);var Mt=l($,2),Qt=r(Mt);{var re=W=>{var Yt=Ci(),de=l(r(Yt));o(Yt),ct(()=>at(de,` ${t(n),E(()=>t(n).meta.summary)??""}`)),g(W,Yt)},le=W=>{var Yt=Li();g(W,Yt)};gt(Qt,W=>{t(n),E(()=>t(n).meta)?W(re):W(le,!1)})}var ee=l(Qt,2);{var se=W=>{var Yt=Mi(),de=l(r(Yt));o(Yt),ct(ge=>at(de,` ${ge??""}`),[()=>(t(n),E(()=>Xt(t(n).city.id)))]),g(W,Yt)};gt(ee,W=>{t(n),E(()=>Xt(t(n).city.id))&&W(se)})}var ce=l(ee,2);{var ue=W=>{var Yt=Ai(),de=l(r(Yt));o(Yt),ct(ge=>at(de,` ${ge??""}`),[()=>(t(n),E(()=>Ft(t(n).city.id)))]),g(W,Yt)};gt(ce,W=>{t(n),E(()=>Ft(t(n).city.id))&&W(ue)})}o(Mt),o(jt),o(w),o(_);var ae=l(_),Te=r(ae);qn(Te,{get value(){return t(n),E(()=>t(n).entry.utility)},$$events:{commit:W=>wt(t(n).city.id,W),register:W=>Zt(t(n).city.id,"utility",W.detail.element),unregister:W=>p(t(n).city.id,"utility",W.detail.element),advance:W=>T(t(n).city.id,"utility",W.detail?.direction??1,W.detail?.open??!0)}}),o(ae);var qe=l(ae),$e=r(qe),Ee=r($e),Se=r(Ee);Mn(Se,{get value(){return t(n),E(()=>t(n).entry.probability)},$$events:{commit:W=>Gt(t(n).city.id,W),register:W=>Zt(t(n).city.id,"probability",W.detail.element),unregister:W=>p(t(n).city.id,"probability",W.detail.element),advance:W=>T(t(n).city.id,"probability",W.detail?.direction??1,W.detail?.open??!0)}});var Ue=l(Se,2);o(Ee),o($e),o(qe),o(s),ct(W=>{be(s,"data-row",(t(n),E(()=>t(n).city.id))),at(A,W),at(F,` ${t(n),E(()=>t(n).city.country)??""}`),at(mt,(t(n),E(()=>t(n).city.name)))},[()=>(t(n),E(()=>Dt(t(n).city.country)))]),R("click",Ue,()=>Z(t(n).city.id)),g(a,s)}),o(Jt),o(Tt),o(kt),we(kt,a=>i(z,a),()=>t(z));var e=l(kt,2);Nn(e,{get open(){return t(v)},get continents(){return t(O)},$$events:{cancel:Ct,apply:Bt}}),o(N),ct(()=>{Ut.disabled=!t(m),Kt.disabled=!t(k)}),R("click",Ut,Et),R("click",Kt,dt),R("click",bt,P),R("keydown",Tt,Q),g(b,N),he(),X()}var Di=S(`<section class="hero svelte-yczqw6"><h1 class="svelte-yczqw6">Phase 2 Ballot Guide</h1> <p class="lede svelte-yczqw6">Record personal utility U(c) on a 0‚Äì100 scale for each finalist city and estimate your attendance probability P(c) as a percentage. Everything stays local until you export the JSON ballot.</p> <section class="phase-cards svelte-yczqw6"><article class="svelte-yczqw6"><h2>Phase 0 ¬∑ Externality</h2> <ul class="svelte-yczqw6"><li>Each voter valued a hypothetical ‚Äú+1 extra attendee.‚Äù</li> <li>Responses combined via 10% trimmed mean (median fallback if &lt;10 voters).</li> <li class="svelte-yczqw6">The shared externality constant is <strong class="svelte-yczqw6">E = 24.4</strong>.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 1 ¬∑ Pruning</h2> <ul class="svelte-yczqw6"><li>A binary vote trimmed 86 nominees down to the top 37 (plus ties).</li> <li>That survivor list became the finalist pool you are filling out now.</li> <li>Round totals (S1) were published for transparency.</li></ul></article> <article class="current svelte-yczqw6"><h2>Phase 2 ¬∑ Your Ballot</h2> <span class="current-tag svelte-yczqw6">Current step</span> <ul class="svelte-yczqw6"><li>Enter personal utility U(c) for every finalist.</li> <li>Estimate attendance probability P(c); values are not auto-normalized.</li> <li>Export JSON mirrors these entries exactly for Phase 3 submission.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 3 ¬∑ Aggregation</h2> <ul class="svelte-yczqw6"><li>Coordinators aggregate attendance (Att) and expected utility (EU) across ballots.</li> <li>TEW(c) = EU(c) + (24.4 √ó N) √ó Att(c); highest TEW wins after tie-breakers.</li> <li>Tie-break order: higher Att, higher median U among P‚â•50%, higher overall median U.</li></ul></article></section> <section class="framework svelte-yczqw6"><h3 class="svelte-yczqw6">Total Expected Welfare snapshot</h3> <pre class="svelte-yczqw6">TEW(c) = EU(c) + (24.4 √ó N) √ó Att(c)</pre> <p>Att(c) is the expected attendee count (Œ£ P_i(c)/100) and EU(c) is the expected personal utility (Œ£ (P_i(c)/100) √ó U_i(c)). During Phase 3 the coordinators compute these values from the exported ballots and publish the full scoring table.</p> <h3 class="svelte-yczqw6">Next-year accountability</h3> <p>If a voter reports a high probability for the winning city but skips the reunion without force-majeure proof, next year's ballot is scaled by 1 ‚àí P<sub>winning</sub>/200. Accurate percentages keep your future weight intact.</p></section> <footer class="modal-footer svelte-yczqw6"><button type="button" class="primary svelte-yczqw6">Start filling the grid</button></footer></section>`);function Ii(b,C){_e(C,!1);let d=Wt(C,"open",8,!1);const H=je();function B(){H("close")}me();var G=ne(),j=te(G);{var u=X=>{var K=Di(),Lt=l(r(K),8),rt=r(Lt);o(Lt),o(K),R("click",rt,B),g(X,K)};gt(j,X=>{d()&&X(u)})}g(b,G),he()}var Oi=S('<div class="page-container svelte-1uha8ag"><!></div>');function Ko(b,C){_e(C,!1);const d="reunion-phase2:phase-explainer-dismissed:v1",H="v1";let B=y(!1);Re(()=>{Oe.update(qt=>qt.preferredMode==="grid"?qt:{...qt,preferredMode:"grid"}),typeof pe.setMode=="function"&&pe.setMode("grid");const rt=localStorage.getItem(d);i(B,rt!==H),We.set(t(B))});function G(){i(B,!1),localStorage.setItem(d,H),requestAnimationFrame(()=>window.scrollTo({top:0,behavior:"smooth"})),We.set(!1)}function j(){localStorage.removeItem(d),i(B,!0),We.set(!0)}me();var u=Oi();ka("1uha8ag",rt=>{_a.title="Reunion 2026 ‚Äî Lightning Grid"});var X=r(u);{var K=rt=>{Ii(rt,{open:!0,$$events:{close:G}})},Lt=rt=>{Pi(rt,{$$events:{reset:j}})};gt(X,rt=>{t(B)?rt(K):rt(Lt,!1)})}o(u),g(b,u),he()}export{Ko as component};
