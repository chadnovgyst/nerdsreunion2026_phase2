import{f as k,g as R,s as rt,a as y,b as ne,d as ve,e as Qe,r as da}from"../chunks/DscdaUK8.js";import{i as me}from"../chunks/tUnkN8nb.js";import{c as je,a as Be,o as Ae,b as va}from"../chunks/DX2lUfdR.js";import{e as ye,u as S,aN as fa,N as Me,a9 as Te,V as pa,r as ba,aO as ma,v as _e,a as t,a7 as h,ac as V,s as i,C as Tt,ad as xe,z as r,A as o,y as l,w as ct,x as he,aa as te,aP as Pe,aQ as ke,d as Le,ae as _a}from"../chunks/CtXWJ4Rl.js";import{i as yt}from"../chunks/j1nT2hqj.js";import{s as be,b as ie,c as Ue,a as fe,j as ha,k as De,m as oe,n as sa,o as Ze,q as ga,u as ya,w as wa,f as Ne,v as pe,x as xa,y as Ea,z as Sa,g as za,h as ka,i as Ge}from"../chunks/Cr3u1VxF.js";import ja from"../chunks/DN3J-sCw.js";import qa from"../chunks/BKbm5EfA.js";import $a from"../chunks/BvbcL8L1.js";import Ca from"../chunks/CpqWQj0X.js";import Ma from"../chunks/CMBHzUVU.js";import La from"../chunks/BNFRKsyx.js";import Ta from"../chunks/CvpCKVSJ.js";import Aa from"../chunks/DKqRZLee.js";import Ra from"../chunks/e1t1TJwC.js";import Pa from"../chunks/pOAIlSuq.js";import Da from"../chunks/CDr_-IW6.js";import Ia from"../chunks/DkwgWrlg.js";import Na from"../chunks/BdPnv_Ww.js";import Oa from"../chunks/Wp1az9L3.js";import Ba from"../chunks/BozMgj6L.js";import Ua from"../chunks/ChEK7k_d.js";import Ha from"../chunks/BT5hMKdo.js";import Va from"../chunks/DZg2n5Gj.js";import Fa from"../chunks/B--_m8y4.js";import Ka from"../chunks/BPfJ8Mnp.js";import Ya from"../chunks/BbyHsVxX.js";import Wa from"../chunks/D1dfjzr5.js";import Ga from"../chunks/sTVjfoeb.js";import Xa from"../chunks/BJv4UY2l.js";import Ja from"../chunks/DqmJETbX.js";import Za from"../chunks/Dbr1vHU4.js";import Qa from"../chunks/DIrtYIXF.js";import tn from"../chunks/ZuxV2OeQ.js";import en from"../chunks/BBQehyBW.js";import an from"../chunks/CTUHu1i9.js";import nn from"../chunks/DgcN0BtG.js";import on from"../chunks/D89J0wRi.js";import rn from"../chunks/D3GOXJB7.js";import ln from"../chunks/KMlGcXzU.js";import sn from"../chunks/hyOVM0Ug.js";import cn from"../chunks/D_zlzWZC.js";import un from"../chunks/DBEQdhVc.js";import dn from"../chunks/Kieb5-lA.js";import vn from"../chunks/nEnXKinN.js";import fn from"../chunks/t4Dmsr4x.js";import pn from"../chunks/CXnItg8R.js";import bn from"../chunks/DWD3NyID.js";import mn from"../chunks/BGVZ31-y.js";import _n from"../chunks/DK9tbYvT.js";import hn from"../chunks/9Ve3I6w0.js";import gn from"../chunks/DkuNIGT0.js";import yn from"../chunks/CuS-bfel.js";import wn from"../chunks/D7_Q8Xbe.js";import xn from"../chunks/BVE7Js9b.js";import En from"../chunks/B-q0s-Uw.js";import{b as we}from"../chunks/BkcxXaB0.js";import{p as Wt,l as na}from"../chunks/CvkxTUf8.js";import{b as ia}from"../chunks/B2s5iAv5.js";function Oe(b,M,d){ye(()=>{var K=S(()=>M(b,d?.())||{});if(K?.destroy)return()=>K.destroy()})}function Sn(b,M,d=M){var K=new WeakSet;fa(b,"input",async X=>{var U=X?b.defaultValue:b.value;if(U=Xe(b)?Je(U):U,d(U),Me!==null&&K.add(Me),await Te(),U!==(U=M())){var j=b.selectionStart,u=b.selectionEnd,J=b.value.length;if(b.value=U??"",u!==null){var H=b.value.length;j===u&&u===J&&H>J?(b.selectionStart=H,b.selectionEnd=H):(b.selectionStart=j,b.selectionEnd=Math.min(u,H))}}}),(pa&&b.defaultValue!==b.value||S(M)==null&&b.value)&&(d(Xe(b)?Je(b.value):b.value),Me!==null&&K.add(Me)),ba(()=>{var X=M();if(b===document.activeElement){var U=ma??Me;if(K.has(U))return}Xe(b)&&X===Je(b.value)||b.type==="date"&&!X&&!b.value||X!==b.value&&(b.value=X??"")})}function Xe(b){var M=b.type;return M==="number"||M==="range"}function Je(b){return b===""?null:+b}function oa(b){return typeof b=="string"?b?document.querySelector(b):null:b??null}function ca(b,M="body"){let d=oa(M)??document.body;return d&&d.appendChild(b),{update(K){const X=oa(K)??document.body;X===d||!X||(b.parentNode&&b.parentNode.removeChild(b),X.appendChild(b),d=X)},destroy(){b.parentNode&&b.parentNode.removeChild(b)}}}var zn=k('<button type="button"> </button>'),kn=k('<div class="radial svelte-furii8"><div class="radial-label svelte-furii8"> </div> <!></div>'),jn=k('<div class="picker svelte-furii8"><button type="button" class="value-button svelte-furii8" aria-label="Favorability value"><span class="value-label svelte-furii8"> </span></button> <p class="hint svelte-furii8" aria-live="polite"> </p> <!></div>');function qn(b,M){_e(M,!1);const d=h(),K=h(),X=h(),U=h();let j=Wt(M,"value",8,null),u=Wt(M,"disabled",8,!1);const J=0,H=100,Mt=Array.from({length:11},(e,a)=>a*10),qt=176,$t=62,At=Mt.length;function F(e){const a=e/At*Math.PI*2-Math.PI/2,n=Math.cos(a)*$t,s=Math.sin(a)*$t;return`translate(calc(-50% + ${n}px), calc(-50% + ${s}px))`}const Y=120,ft=120,zt=250,T=12,Z="[data-result-pane]",z="reunion:radial-channel",Q=je();let v=h(!1),x=h(null),c=h(void 0),L=h(null),lt=h(null),gt=h(""),ut=!1,pt=0,m=h(null),q=null,O=!1,wt=0,W=null;const xt=e=>typeof e=="number"?e.toString().padStart(2,"0"):"??";function Gt(e){return Q("register",{element:e}),{destroy(){Q("unregister",{element:e})}}}function D(e){Q("commit",{value:e})}function Ct(e){if(u())return;St(!0);const a=typeof t(d)=="number"?t(d):0,n=Math.min(H,Math.max(J,a+e));i(c,n),D(n)}function Nt(e){if(u())return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(v)){if(B(a))return;e.preventDefault();return}if(!O&&a>ft){O=!0,at(!1);return}if(O)return;e.preventDefault();const n=e.ctrlKey?10:e.shiftKey?5:1;for(pt+=e.deltaY;pt<=-Y;)Ct(n),pt+=Y;for(;pt>=Y;)Ct(-n),pt-=Y}function Ot(e){if(u())return;const a=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(m)!==null?bt():t(v)&&at(!1),Q("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(v)&&at(!1),Q("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),at(!0);break;case"Escape":t(v)?(e.preventDefault(),at(!1)):t(m)!==null&&(e.preventDefault(),St(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?-5:-1);break;case"Backspace":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),P());break;case"Delete":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),nt());break;default:a&&(e.preventDefault(),e.stopPropagation(),E(e.key))}}function Vt(e){if(!t(v))return;const a=e.target;t(L)?.contains(a)||t(lt)?.contains(a)||at(!1)}function It(e){t(v)&&e.key==="Escape"&&(e.preventDefault(),at(!1))}function Ft(e){if(!t(v))return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);B(a)}function Xt(){ut||(window.addEventListener("pointerdown",Vt,!0),window.addEventListener("keydown",It,!0),window.addEventListener("wheel",Ft,{passive:!0}),window.addEventListener("scroll",Bt,!0),window.addEventListener("resize",Bt,!0),ut=!0)}function Ht(){ut&&(window.removeEventListener("pointerdown",Vt,!0),window.removeEventListener("keydown",It,!0),window.removeEventListener("wheel",Ft),window.removeEventListener("scroll",Bt,!0),window.removeEventListener("resize",Bt,!0),ut=!1)}async function Bt(){await Et()}async function Et(){if(!t(v)||!t(L)||(await Te(),!t(v)||!t(L)))return;const e=t(L).getBoundingClientRect(),a=qt,n=a/2;let s=e.top+e.height/2,_=e.left+e.width/2;const w=T,$=Dt(),N=window.innerHeight-$-T,jt=T,C=window.innerWidth-T,vt=s-n,ot=s+n,g=_-n,A=_+n;let G=0;vt<w?G=vt-w:ot>N&&(G=ot-N);let tt=0;if(g<jt?tt=g-jt:A>C&&(tt=A-C),(tt!==0||G!==0)&&(window.scrollBy({top:G,left:tt,behavior:"auto"}),await Te(),!t(v)||!t(L)))return;const _t=t(L).getBoundingClientRect();s=_t.top+_t.height/2,_=_t.left+_t.width/2;const Lt=T+n,Qt=window.innerHeight-$-T-n,re=T+n,le=window.innerWidth-T-n;s=Math.min(Math.max(s,Lt),Qt),_=Math.min(Math.max(_,re),le);const ee=t(lt)?.offsetParent instanceof HTMLElement?t(lt).offsetParent.getBoundingClientRect():null,se=ee?.top??0,ce=ee?.left??0,ue=s-se,ae=_-ce;i(gt,`top:${Math.round(ue)}px;left:${Math.round(ae)}px;--overlay-size:${a}px;`)}function Dt(){const e=document.querySelector(Z);if(!e)return 0;const a=e.getBoundingClientRect();if(a.top>=window.innerHeight)return 0;const n=Math.min(a.height,Math.max(0,window.innerHeight-Math.max(a.top,0)));return Math.max(0,n)}function at(e){if(u())return;const a=e??!t(v);a!==t(v)&&(i(v,a),t(v)?(Rt(),O=!1,dt(),i(m,null),q=null,i(x,typeof t(d)=="number"?t(d):null),i(c,void 0),pt=0,Xt(),Et()):(i(x,null),i(gt,""),Ht(),dt()))}function Zt(e){u()||(i(m,null),q=null,i(c,e),D(e),i(x,e),at(!1))}Be(()=>{Ht(),dt()}),Ae(()=>{const e=a=>I(a);return window.addEventListener(z,e),()=>{window.removeEventListener(z,e)}});function p(){t(m)===null&&(q=typeof t(d)=="number"?t(d):j()??null,typeof t(d)=="number"?i(m,t(d).toString()):typeof q=="number"?i(m,q.toString()):i(m,""))}function f(e){const a=e.replace(/\D/g,"").slice(0,3);if(a.length===0){i(m,""),i(c,null),D(null);return}const n=Number.parseInt(a,10),s=n>H?H:n;if(n>H&&a.length>0){i(m,String(Math.floor(n/10))),i(c,Number.parseInt(t(m),10)),D(t(c));return}i(m,s.toString()),i(c,s),D(s)}function E(e){p();const a=t(m)??"",n=a+e,s=Number.parseInt(n,10);!Number.isNaN(s)&&s>H&&a!==""||f(n)}function P(){p();const e=t(m)??"";if(e.length===0){i(m,""),i(c,null),D(null);return}f(e.slice(0,-1))}function nt(){p(),i(m,""),i(c,null),D(null)}function bt(){t(m)!==null&&(i(m,null),q=null)}function St(e){if(t(m)===null)return;const a=q;i(m,null),q=null,!e&&a!==j()?(i(c,a??null),D(a??null)):e||i(c,void 0)}function dt(){wt=0,W&&(clearTimeout(W),W=null)}function B(e){return t(v)?(wt+=e,W&&clearTimeout(W),W=window.setTimeout(()=>{wt=0,W=null},zt),wt>=ft?(O||(O=!0),at(!1),dt(),!0):!1):!1}function Rt(){if(typeof window>"u")return;const e={source:t(L)};window.dispatchEvent(new CustomEvent(z,{detail:e}))}function I(e){!t(v)||e.detail?.source===t(L)||at(!1)}V(()=>(t(c),Tt(j())),()=>{t(c)!==void 0&&j()===t(c)&&i(c,void 0)}),V(()=>(t(c),Tt(j())),()=>{i(d,t(c)===void 0?j():t(c))}),V(()=>(Tt(u()),t(d)),()=>{i(K,u()?"disabled":t(d)===null?"empty":t(d)<J||t(d)>H?"invalid":"valid")}),V(()=>t(K),()=>{i(X,t(K)==="invalid"?"Keep between 0 and 100.":"")}),V(()=>(t(m),t(d)),()=>{i(U,t(m)!==null?t(m)===""?"??":t(m):xt(t(d)))}),xe(),me();var it=jn(),st=r(it),Ut=r(st),Kt=r(Ut,!0);o(Ut),o(st),ye(()=>R("click",st,()=>at())),ye(()=>R("keydown",st,Ot)),ye(()=>R("auto-open",st,()=>at(!0))),Oe(st,e=>Gt?.(e)),we(st,e=>i(L,e),()=>t(L));var mt=l(st,2),kt=r(mt,!0);o(mt);var Pt=l(mt,2);{var Jt=e=>{var a=kn(),n=r(a),s=r(n,!0);o(n);var _=l(n,2);ie(_,3,()=>Mt,w=>w,(w,$,N,jt)=>{var C=zn();let vt;var ot=r(C);o(C),ct(g=>{vt=Ue(C,1,"radial-option svelte-furii8",null,vt,{selected:t(d)===t($),hovered:t(x)===t($)}),fe(C,g),rt(ot,`${t($)??""}%`)},[()=>(Tt(t(N)),S(()=>`transform: ${F(t(N))}`))]),R("pointerenter",C,()=>i(x,t($))),R("focus",C,()=>i(x,t($))),R("pointerleave",C,()=>i(x,null)),R("blur",C,()=>i(x,null)),R("click",C,()=>Zt(t($))),y(w,C)}),o(a),we(a,w=>i(lt,w),()=>t(lt)),Oe(a,w=>ca?.(w)),ct(w=>{fe(a,t(gt)),rt(s,w)},[()=>(t(x),t(d),S(()=>xt(t(x)??t(d))))]),y(e,a)};yt(Pt,e=>{t(v)&&e(Jt)})}o(it),ct(()=>{be(it,"data-state",t(K)),be(it,"data-open",t(v)),st.disabled=u(),rt(Kt,t(U)),rt(kt,t(X))}),R("wheel",it,Nt),y(b,it),he()}var $n=k('<button type="button"> </button>'),Cn=k('<div class="radial svelte-cojlv"><div class="radial-label svelte-cojlv"> </div> <!></div>'),Mn=k('<div class="picker svelte-cojlv"><button type="button" class="value-button svelte-cojlv" aria-label="Attendance probability"><span class="value-label svelte-cojlv"> </span></button> <p class="hint svelte-cojlv" aria-live="polite"> </p> <!></div>');function Ln(b,M){_e(M,!1);const d=h(),K=h(),X=h(),U=h();let j=Wt(M,"value",8,null),u=Wt(M,"disabled",8,!1);const J=0,H=100,Mt=Array.from({length:11},(e,a)=>a*10),qt=176,$t=62,At=Mt.length,F=120,Y=120,ft=250,zt=12,T="[data-result-pane]",Z="reunion:radial-channel";function z(e){const a=e/At*Math.PI*2-Math.PI/2,n=Math.cos(a)*$t,s=Math.sin(a)*$t;return`translate(calc(-50% + ${n}px), calc(-50% + ${s}px))`}const Q=je();let v=h(!1),x=h(null),c=h(void 0),L=h(null),lt=h(null),gt=h(""),ut=!1,pt=0,m=h(null),q=null,O=!1,wt=0,W=null;const xt=e=>typeof e=="number"?`${e.toString().padStart(2,"0")}%`:"??%";function Gt(e){return Q("register",{element:e}),{destroy(){Q("unregister",{element:e})}}}function D(e){Q("commit",{value:e})}function Ct(e){if(u())return;St(!0);const a=typeof t(d)=="number"?t(d):0,n=Math.min(H,Math.max(J,a+e));i(c,n),D(n)}function Nt(e){if(u())return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t(v)){if(B(a))return;e.preventDefault();return}if(!O&&a>Y){O=!0,at(!1);return}if(O)return;e.preventDefault();const n=e.ctrlKey?10:e.shiftKey?5:1;for(pt+=e.deltaY;pt<=-F;)Ct(n),pt+=F;for(;pt>=F;)Ct(-n),pt-=F}function Ot(e){if(u())return;const a=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(m)!==null?bt():t(v)&&at(!1),Q("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t(v)&&at(!1),Q("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),at(!0);break;case"Escape":t(v)?(e.preventDefault(),at(!1)):t(m)!==null&&(e.preventDefault(),St(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),Ct(e.shiftKey?-5:-1);break;case"Backspace":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),P());break;case"Delete":(t(m)!==null||typeof t(d)=="number"||t(d)===null)&&(e.preventDefault(),e.stopPropagation(),nt());break;default:a&&(e.preventDefault(),e.stopPropagation(),E(e.key))}}function Vt(e){if(!t(v))return;const a=e.target;t(L)?.contains(a)||t(lt)?.contains(a)||at(!1)}function It(e){t(v)&&e.key==="Escape"&&(e.preventDefault(),at(!1))}function Ft(e){if(!t(v))return;const a=Math.abs(e.deltaY)+Math.abs(e.deltaX);B(a)}function Xt(){ut||(window.addEventListener("pointerdown",Vt,!0),window.addEventListener("keydown",It,!0),window.addEventListener("wheel",Ft,{passive:!0}),window.addEventListener("scroll",Bt,!0),window.addEventListener("resize",Bt,!0),ut=!0)}function Ht(){ut&&(window.removeEventListener("pointerdown",Vt,!0),window.removeEventListener("keydown",It,!0),window.removeEventListener("wheel",Ft),window.removeEventListener("scroll",Bt,!0),window.removeEventListener("resize",Bt,!0),ut=!1)}async function Bt(){await Et()}async function Et(){if(!t(v)||!t(L)||(await Te(),!t(v)||!t(L)))return;const e=t(L).getBoundingClientRect(),a=qt,n=a/2;let s=e.top+e.height/2,_=e.left+e.width/2;const w=zt,$=Dt(),N=window.innerHeight-$-zt,jt=zt,C=window.innerWidth-zt,vt=s-n,ot=s+n,g=_-n,A=_+n;let G=0;vt<w?G=vt-w:ot>N&&(G=ot-N);let tt=0;if(g<jt?tt=g-jt:A>C&&(tt=A-C),(tt!==0||G!==0)&&(window.scrollBy({top:G,left:tt,behavior:"auto"}),await Te(),!t(v)||!t(L)))return;const _t=t(L).getBoundingClientRect();s=_t.top+_t.height/2,_=_t.left+_t.width/2;const Lt=zt+n,Qt=window.innerHeight-$-zt-n,re=zt+n,le=window.innerWidth-zt-n;s=Math.min(Math.max(s,Lt),Qt),_=Math.min(Math.max(_,re),le);const ee=t(lt)?.offsetParent instanceof HTMLElement?t(lt).offsetParent.getBoundingClientRect():null,se=ee?.top??0,ce=ee?.left??0,ue=s-se,ae=_-ce;i(gt,`top:${Math.round(ue)}px;left:${Math.round(ae)}px;--overlay-size:${a}px;`)}function Dt(){const e=document.querySelector(T);if(!e)return 0;const a=e.getBoundingClientRect();if(a.top>=window.innerHeight)return 0;const n=Math.min(a.height,Math.max(0,window.innerHeight-Math.max(a.top,0)));return Math.max(0,n)}function at(e){if(u())return;const a=e??!t(v);a!==t(v)&&(i(v,a),t(v)?(Rt(),O=!1,dt(),i(m,null),q=null,i(x,t(d)),i(c,void 0),pt=0,Xt(),Et()):(i(x,null),i(gt,""),Ht(),dt()))}function Zt(e){u()||(i(m,null),q=null,i(c,e),D(e),i(x,e),at(!1))}Be(()=>{Ht(),dt()}),Ae(()=>{const e=a=>I(a);return window.addEventListener(Z,e),()=>{window.removeEventListener(Z,e)}});function p(){t(m)===null&&(q=typeof t(d)=="number"?t(d):j()??null,typeof t(d)=="number"?i(m,t(d).toString()):typeof q=="number"?i(m,q.toString()):i(m,""))}function f(e){const a=e.replace(/\D/g,"").slice(0,3);if(a.length===0){i(m,""),i(c,null),D(null);return}const n=Number.parseInt(a,10),s=n>H?H:n;if(n>H&&a.length>0){i(m,String(Math.floor(n/10))),i(c,Number.parseInt(t(m),10)),D(t(c));return}i(m,s.toString()),i(c,s),D(s)}function E(e){p();const a=t(m)??"",n=a+e,s=Number.parseInt(n,10);!Number.isNaN(s)&&s>H&&a!==""||f(n)}function P(){p();const e=t(m)??"";if(e.length===0){i(m,""),i(c,null),D(null);return}f(e.slice(0,-1))}function nt(){p(),i(m,""),i(c,null),D(null)}function bt(){t(m)!==null&&(i(m,null),q=null)}function St(e){if(t(m)===null)return;const a=q;i(m,null),q=null,!e&&a!==j()?(i(c,a??null),D(a??null)):e||i(c,void 0)}function dt(){wt=0,W&&(clearTimeout(W),W=null)}function B(e){return t(v)?(wt+=e,W&&clearTimeout(W),W=window.setTimeout(()=>{wt=0,W=null},ft),wt>=Y?(O||(O=!0),at(!1),dt(),!0):!1):!1}function Rt(){if(typeof window>"u")return;const e={source:t(L)};window.dispatchEvent(new CustomEvent(Z,{detail:e}))}function I(e){!t(v)||e.detail?.source===t(L)||at(!1)}V(()=>(t(c),Tt(j())),()=>{t(c)!==void 0&&j()===t(c)&&i(c,void 0)}),V(()=>(t(c),Tt(j())),()=>{i(d,t(c)===void 0?j():t(c))}),V(()=>(Tt(u()),t(d)),()=>{i(K,u()?"disabled":t(d)===null?"empty":t(d)<J||t(d)>H?"invalid":"valid")}),V(()=>t(K),()=>{i(X,t(K)==="invalid"?"Keep between 0 and 100%.":"")}),V(()=>(t(m),t(d)),()=>{i(U,t(m)!==null?t(m)===""?"??%":`${t(m)}%`:xt(t(d)))}),xe(),me();var it=Mn(),st=r(it),Ut=r(st),Kt=r(Ut,!0);o(Ut),o(st),ye(()=>R("click",st,()=>at())),ye(()=>R("keydown",st,Ot)),ye(()=>R("auto-open",st,()=>at(!0))),Oe(st,e=>Gt?.(e)),we(st,e=>i(L,e),()=>t(L));var mt=l(st,2),kt=r(mt,!0);o(mt);var Pt=l(mt,2);{var Jt=e=>{var a=Cn(),n=r(a),s=r(n,!0);o(n);var _=l(n,2);ie(_,3,()=>Mt,w=>w,(w,$,N,jt)=>{var C=$n();let vt;var ot=r(C);o(C),ct(g=>{vt=Ue(C,1,"radial-option svelte-cojlv",null,vt,{selected:t(d)===t($),hovered:t(x)===t($)}),fe(C,g),rt(ot,`${t($)??""}%`)},[()=>(Tt(t(N)),S(()=>`transform: ${z(t(N))}`))]),R("pointerenter",C,()=>i(x,t($))),R("focus",C,()=>i(x,t($))),R("pointerleave",C,()=>i(x,null)),R("blur",C,()=>i(x,null)),R("click",C,()=>Zt(t($))),y(w,C)}),o(a),we(a,w=>i(lt,w),()=>t(lt)),Oe(a,w=>ca?.(w)),ct(w=>{fe(a,t(gt)),rt(s,w)},[()=>(t(x),t(d),S(()=>xt(t(x)??t(d))))]),y(e,a)};yt(Pt,e=>{t(v)&&e(Jt)})}o(it),ct(()=>{be(it,"data-state",t(K)),be(it,"data-open",t(v)),st.disabled=u(),rt(Kt,t(U)),rt(kt,t(X))}),R("wheel",it,Nt),y(b,it),he()}let Ie=null;const Tn='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function An(){if(typeof document>"u")return;const b=document.activeElement;b&&typeof b.focus=="function"&&(Ie=b)}function Rn(){if(Ie){try{Ie.focus({preventScroll:!0})}catch{}Ie=null}}function ra(b){if(!b)return;const M=b.querySelector(Tn);M&&M.focus({preventScroll:!0})}var Pn=k('<p class="empty svelte-1bwzqxo">No continents detected in this dataset.</p>'),Dn=k("<option> </option>"),In=k('<div class="matrix-row svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo"> </div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>0</option><option>25</option><option>50</option><option>75</option><option>100</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div></div>'),Nn=k('<div class="backdrop svelte-1bwzqxo" role="presentation" tabindex="-1"><div class="dialog svelte-1bwzqxo" role="dialog" aria-modal="true" aria-label="Bulk actions"><header class="svelte-1bwzqxo"><div><h2 class="svelte-1bwzqxo">Bulk Actions</h2> <p class="subtitle svelte-1bwzqxo">Trigger presets or continent tweaks without leaving the grid.</p></div> <button type="button" class="close svelte-1bwzqxo" aria-label="Close dialog">√ó</button></header> <div class="content svelte-1bwzqxo"><section class="global svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Global Overrides</h3> <div class="global-grid svelte-1bwzqxo"><fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Probabilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all to 100%</button> <button type="button" class="svelte-1bwzqxo">Set all to 50%</button> <button type="button" class="svelte-1bwzqxo">Set all to 0%</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div> <div class="normalize svelte-1bwzqxo"><span>Normalize average to</span> <input type="number" min="0" max="100" step="1" aria-label="Target mean probability"/> <span>%</span> <button type="button" class="svelte-1bwzqxo">Normalize</button></div></fieldset> <fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Utilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all utilities to 50</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div></fieldset></div></section> <section class="matrix svelte-1bwzqxo"><header class="matrix-head svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Per-Continent Adjustments</h3> <p class="svelte-1bwzqxo">Set specific baselines or deltas for each region.</p></header> <div class="matrix-table svelte-1bwzqxo"><div class="matrix-row matrix-header svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo">Continent</div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div>Favorability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div>Probability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div></div> <!></div></section></div> <footer class="actions svelte-1bwzqxo"><button type="button" class="secondary svelte-1bwzqxo">Close</button></footer></div></div>');function On(b,M){_e(M,!1);let d=Wt(M,"open",8,!1),K=Wt(M,"continents",24,()=>[]);const X=je();let U=h(null),j=h(!1),u=h([]),J=h(50);const H=["","0","25","50","75","100"];function Mt(v){return{continent:v,utilitySet:"",utilityDelta:"",probabilitySet:"",probabilityDelta:""}}function qt(v=!1){const x=new Map(t(u).map(c=>[c.continent,c]));i(u,K().map(c=>!v&&x.has(c)?{...x.get(c)}:Mt(c))),K().length===0&&i(u,[])}function $t(){i(J,50),qt(!0)}function At(){X("cancel")}function F(v,x=0,c=100){return Math.max(x,Math.min(c,Math.round(v)))}function Y(v){if(v.trim()==="")return null;const x=Number(v);return Number.isFinite(x)?x:null}function ft(v){const x=Array.isArray(v)?v:[v];X("apply",{actions:x})}function zt(v){const x=v.currentTarget,c=v.target;c&&x.contains(c)&&c!==x||At()}function T(v){v.key==="Escape"&&(v.preventDefault(),At())}V(()=>Tt(d()),()=>{i(j,d())}),V(()=>(Tt(d()),t(j)),()=>{d()&&!t(j)&&$t()}),V(()=>(Tt(d()),t(U),ra),()=>{d()&&t(U)&&ra(t(U))}),V(()=>Tt(d()),()=>{d()&&qt(!1)}),xe(),me();var Z=ne(),z=te(Z);{var Q=v=>{var x=Nn(),c=r(x),L=r(c),lt=l(r(L),2);o(L);var gt=l(L,2),ut=r(gt),pt=l(r(ut),2),m=r(pt),q=l(r(m),2),O=r(q),wt=l(O,2),W=l(wt,2);o(q);var xt=l(q,2),Gt=r(xt),D=l(Gt,2);o(xt);var Ct=l(xt,2),Nt=l(r(Ct),2);ha(Nt);var Ot=l(Nt,4);o(Ct),o(m);var Vt=l(m,2),It=l(r(Vt),2),Ft=r(It);o(It);var Xt=l(It,2),Ht=r(Xt),Bt=l(Ht,2);o(Xt),o(Vt),o(pt),o(ut);var Et=l(ut,2),Dt=l(r(Et),2),at=l(r(Dt),2);{var Zt=P=>{var nt=Pn();y(P,nt)},p=P=>{var nt=ne(),bt=te(nt);ie(bt,3,()=>t(u),St=>St.continent,(St,dt,B)=>{var Rt=In(),I=r(Rt),it=r(I,!0);o(I);var st=l(I,2),Ut=r(st),Kt=r(Ut),mt=r(Kt),kt=r(mt);o(mt);var Pt=l(mt,2);ct(()=>{t(u),Pe(()=>{t(B)})}),ie(Pt,5,()=>H,ht=>ht,(ht,ze)=>{var Ce=Dn(),ua=r(Ce,!0);o(Ce);var aa={};ct(()=>{rt(ua,t(ze)===""?"‚Äî":t(ze)),aa!==(aa=t(ze))&&(Ce.value=(Ce.__value=t(ze))??"")}),y(ht,Ce)}),o(Pt),o(Kt);var Jt=l(Kt,2);o(Ut);var e=l(Ut,2),a=r(e),n=r(a),s=r(n);o(n);var _=l(n,2);ct(()=>{t(u),Pe(()=>{t(B)})});var w=r(_);w.value=w.__value="";var $=l(w);$.value=$.__value="-50";var N=l($);N.value=N.__value="-25";var jt=l(N);jt.value=jt.__value="-10";var C=l(jt);C.value=C.__value="-5";var vt=l(C);vt.value=vt.__value="+5";var ot=l(vt);ot.value=ot.__value="+10";var g=l(ot);g.value=g.__value="+25";var A=l(g);A.value=A.__value="+50",o(_),o(a);var G=l(a,2);o(e),o(st);var tt=l(st,2),_t=r(tt),Lt=r(_t),Qt=r(Lt),re=r(Qt);o(Qt);var le=l(Qt,2);ct(()=>{t(u),Pe(()=>{t(B)})});var ee=r(le);ee.value=ee.__value="";var se=l(ee);se.value=se.__value="0";var ce=l(se);ce.value=ce.__value="25";var ue=l(ce);ue.value=ue.__value="50";var ae=l(ue);ae.value=ae.__value="75";var Re=l(ae);Re.value=Re.__value="100",o(le),o(Lt);var qe=l(Lt,2);o(_t);var $e=l(_t,2),Ee=r($e),Se=r(Ee),He=r(Se);o(Se);var et=l(Se,2);ct(()=>{t(u),Pe(()=>{t(B)})});var Yt=r(et);Yt.value=Yt.__value="";var de=l(Yt);de.value=de.__value="-50";var ge=l(de);ge.value=ge.__value="-25";var Ve=l(ge);Ve.value=Ve.__value="-10";var Fe=l(Ve);Fe.value=Fe.__value="-5";var Ke=l(Fe);Ke.value=Ke.__value="+5";var Ye=l(Ke);Ye.value=Ye.__value="+10";var We=l(Ye);We.value=We.__value="+25";var ta=l(We);ta.value=ta.__value="+50",o(et),o(Ee);var ea=l(Ee,2);o($e),o(tt),o(Rt),ct((ht,ze)=>{rt(it,(t(dt),S(()=>t(dt).continent))),rt(kt,`Set favorability for ${t(dt),S(()=>t(dt).continent)??""}`),Jt.disabled=(t(u),Tt(t(B)),S(()=>t(u)[t(B)].utilitySet==="")),rt(s,`Adjust favorability by for ${t(dt),S(()=>t(dt).continent)??""}`),G.disabled=ht,rt(re,`Set probability for ${t(dt),S(()=>t(dt).continent)??""}`),qe.disabled=(t(u),Tt(t(B)),S(()=>t(u)[t(B)].probabilitySet==="")),rt(He,`Adjust probability by for ${t(dt),S(()=>t(dt).continent)??""}`),ea.disabled=ze},[()=>(t(u),Tt(t(B)),S(()=>Y(t(u)[t(B)].utilityDelta)===null)),()=>(t(u),Tt(t(B)),S(()=>Y(t(u)[t(B)].probabilityDelta)===null))]),De(Pt,()=>t(u)[t(B)].utilitySet,ht=>ke(u,t(u)[t(B)].utilitySet=ht)),R("click",Jt,()=>{const ht=Y(t(u)[t(B)].utilitySet);ht!==null&&ft({type:"setContinentUtility",continent:t(dt).continent,value:F(ht)})}),De(_,()=>t(u)[t(B)].utilityDelta,ht=>ke(u,t(u)[t(B)].utilityDelta=ht)),R("click",G,()=>{const ht=Y(t(u)[t(B)].utilityDelta);ht===null||ht===0||(ke(u,t(u)[t(B)].utilityDelta=ht>0?`+${ht}`:`${ht}`),ft({type:"adjustContinentUtility",continent:t(dt).continent,delta:Math.round(ht)}))}),De(le,()=>t(u)[t(B)].probabilitySet,ht=>ke(u,t(u)[t(B)].probabilitySet=ht)),R("click",qe,()=>{const ht=Y(t(u)[t(B)].probabilitySet);ht!==null&&ft({type:"setContinentProbability",continent:t(dt).continent,value:F(ht)})}),De(et,()=>t(u)[t(B)].probabilityDelta,ht=>ke(u,t(u)[t(B)].probabilityDelta=ht)),R("click",ea,()=>{const ht=Y(t(u)[t(B)].probabilityDelta);ht===null||ht===0||(ke(u,t(u)[t(B)].probabilityDelta=ht>0?`+${ht}`:`${ht}`),ft({type:"adjustContinentProbability",continent:t(dt).continent,delta:Math.round(ht)}))}),y(St,Rt)}),y(P,nt)};yt(at,P=>{t(u),S(()=>t(u).length===0)?P(Zt):P(p,!1)})}o(Dt),o(Et),o(gt);var f=l(gt,2),E=r(f);o(f),o(c),we(c,P=>i(U,P),()=>t(U)),o(x),R("click",lt,At),R("click",O,()=>ft({type:"setAllProbabilities",value:100})),R("click",wt,()=>ft({type:"setAllProbabilities",value:50})),R("click",W,()=>ft({type:"setAllProbabilities",value:0})),R("click",Gt,()=>ft({type:"adjustAllProbabilities",delta:10})),R("click",D,()=>ft({type:"adjustAllProbabilities",delta:-10})),Sn(Nt,()=>t(J),P=>i(J,P)),R("click",Ot,()=>{Number.isFinite(t(J))&&ft({type:"normalizeProbabilities",target:F(Number(t(J)))})}),R("click",Ft,()=>ft({type:"setAllUtilities",value:50})),R("click",Ht,()=>ft({type:"adjustAllUtilities",delta:10})),R("click",Bt,()=>ft({type:"adjustAllUtilities",delta:-10})),R("click",E,At),R("click",x,zt),R("keydown",x,T),y(v,x)};yt(z,v=>{d()&&v(Q)})}y(b,Z),he()}var Bn=k('<p class="empty svelte-h2c6bt">No commands yet.</p>'),Un=k('<li class="svelte-h2c6bt"> </li>'),Hn=k('<ul class="diffs svelte-h2c6bt"></ul>'),Vn=k('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Fn=k('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Kn=k('<ul class="svelte-h2c6bt"></ul>'),Yn=k('<p class="empty svelte-h2c6bt">Nothing queued.</p>'),Wn=k('<li class="svelte-h2c6bt"> </li>'),Gn=k('<ul class="diffs svelte-h2c6bt"></ul>'),Xn=k('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Jn=k('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Zn=k('<ul class="svelte-h2c6bt"></ul>'),Qn=k('<div class="history-overlay svelte-h2c6bt" role="dialog" aria-label="Command history"><section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Past</header> <!></section> <section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Future</header> <!></section></div>'),ti=k('<div class="history-wrapper svelte-h2c6bt" role="group"><button type="button" class="history-button svelte-h2c6bt" aria-haspopup="dialog"><span class="btn-icon svelte-h2c6bt" aria-hidden="true">üßæ</span> <span> </span></button> <!></div>');function ei(b,M){_e(M,!1);const d=()=>ve(oe,"$commandHistoryStore",X),K=()=>ve(sa,"$citiesStore",X),[X,U]=Qe();let j=h(!1),u=h(null),J=h({past:[],future:[]}),H=h([]),Mt=h([]),qt=h([]),$t=h({});function At(){i(j,!0)}function F(c){c instanceof FocusEvent&&c.currentTarget instanceof HTMLElement&&c.relatedTarget instanceof HTMLElement&&c.currentTarget.contains(c.relatedTarget)||i(j,!1)}function Y(c,L=!1){return c==null?"??":L?`${c}%`:`${c}`}function ft(c,L){if(!c&&!L)return[];const lt=c?.entries??{},gt=L?.entries??{},ut=new Set([...Object.keys(lt),...Object.keys(gt)]),pt=[];for(const m of ut){const q=lt[m]??null,O=gt[m]??null,wt=t($t)[m]?.name??m;if(!q&&O){O.utility!==null&&pt.push(`${wt} utility ${Y(null)} ‚Üí ${Y(O.utility)}`),O.probability!==null&&pt.push(`${wt} probability ${Y(null,!0)} ‚Üí ${Y(O.probability,!0)}`);continue}q&&O&&(q.utility!==O.utility&&pt.push(`${wt} utility ${Y(q.utility)} ‚Üí ${Y(O.utility)}`),q.probability!==O.probability&&pt.push(`${wt} probability ${Y(q.probability,!0)} ‚Üí ${Y(O.probability,!0)}`)),q&&!O&&(q.utility!==null&&pt.push(`${wt} utility ${Y(q.utility)} ‚Üí ${Y(null)}`),q.probability!==null&&pt.push(`${wt} probability ${Y(q.probability,!0)} ‚Üí ${Y(null,!0)}`))}return pt}function zt(c,L){return ft(c,L)}V(()=>d(),()=>{i(J,d())}),V(()=>t(J),()=>{i(H,[...t(J).past??[]].slice().reverse())}),V(()=>t(J),()=>{i(Mt,t(J).future??[])}),V(()=>K(),()=>{i(qt,K()??[])}),V(()=>t(qt),()=>{i($t,Object.fromEntries(t(qt).map(c=>[c.id,c])))}),xe(),me();var T=ti(),Z=r(T),z=l(r(Z),2),Q=r(z);o(z),o(Z),we(Z,c=>i(u,c),()=>t(u));var v=l(Z,2);{var x=c=>{var L=Qn(),lt=r(L),gt=l(r(lt),2);{var ut=W=>{var xt=Bn();y(W,xt)},pt=W=>{var xt=Kn();ie(xt,5,()=>t(H),Ze,(Gt,D)=>{var Ct=Fn(),Nt=r(Ct),Ot=r(Nt),Vt=r(Ot,!0);o(Ot);var It=l(Ot,2),Ft=r(It);o(It),o(Nt);var Xt=l(Nt,2);{var Ht=Et=>{var Dt=Hn();ie(Dt,5,()=>(t(D),S(()=>zt(t(D).before?.vote,t(D).after?.vote))),at=>at,(at,Zt)=>{var p=Un(),f=r(p,!0);o(p),ct(()=>rt(f,t(Zt))),y(at,p)}),o(Dt),y(Et,Dt)},Bt=Et=>{var Dt=Vn();y(Et,Dt)};yt(Xt,Et=>{t(D),S(()=>zt(t(D).before?.vote,t(D).after?.vote).length)?Et(Ht):Et(Bt,!1)})}o(Ct),ct(Et=>{rt(Vt,(t(D),S(()=>t(D).label))),rt(Ft,`[${Et??""}]`)},[()=>(t(D),S(()=>t(D).scope.join(", ")))]),y(Gt,Ct)}),o(xt),y(W,xt)};yt(gt,W=>{t(H),S(()=>t(H).length===0)?W(ut):W(pt,!1)})}o(lt);var m=l(lt,2),q=l(r(m),2);{var O=W=>{var xt=Yn();y(W,xt)},wt=W=>{var xt=Zn();ie(xt,5,()=>t(Mt),Ze,(Gt,D)=>{var Ct=Jn(),Nt=r(Ct),Ot=r(Nt),Vt=r(Ot,!0);o(Ot);var It=l(Ot,2),Ft=r(It);o(It),o(Nt);var Xt=l(Nt,2);{var Ht=Et=>{var Dt=Gn();ie(Dt,5,()=>(t(D),S(()=>zt(t(D).before?.vote,t(D).after?.vote))),at=>at,(at,Zt)=>{var p=Wn(),f=r(p,!0);o(p),ct(()=>rt(f,t(Zt))),y(at,p)}),o(Dt),y(Et,Dt)},Bt=Et=>{var Dt=Xn();y(Et,Dt)};yt(Xt,Et=>{t(D),S(()=>zt(t(D).before?.vote,t(D).after?.vote).length)?Et(Ht):Et(Bt,!1)})}o(Ct),ct(Et=>{rt(Vt,(t(D),S(()=>t(D).label))),rt(Ft,`[${Et??""}]`)},[()=>(t(D),S(()=>t(D).scope.join(", ")))]),y(Gt,Ct)}),o(xt),y(W,xt)};yt(q,W=>{t(Mt),S(()=>t(Mt).length===0)?W(O):W(wt,!1)})}o(m),o(L),y(c,L)};yt(v,c=>{t(j)&&c(x)})}o(T),ct(()=>{be(Z,"aria-expanded",t(j)),rt(Q,`Log (${t(J),S(()=>t(J).past.length)??""})`)}),R("mouseenter",T,At),R("mouseleave",T,F),R("focusin",T,At),R("focusout",T,F),y(b,T),he(),U()}var ai=k("<img/>");function la(b,M){const d=na(M,["children","$$slots","$$events","$$legacy"]),K=na(d,["src","alt","loading","decoding"]);let X=Wt(M,"src",8),U=Wt(M,"alt",8),j=Wt(M,"loading",8,"lazy"),u=Wt(M,"decoding",8,"async");var J=ai();ga(J,()=>({...K,src:X(),alt:U(),loading:j(),decoding:u()})),da(J),y(b,J)}var ni=k('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),ii=k('<p class="status error svelte-f9uau2"> </p>'),oi=k('<figure class="inline-frame svelte-f9uau2"><!></figure>'),ri=k('<p class="inline-weather svelte-f9uau2"> </p>'),li=k('<p class="inline-food svelte-f9uau2"> </p>'),si=k('<div class="inline-track svelte-f9uau2"></div> <div class="inline-overlay svelte-f9uau2"><div class="inline-heading svelte-f9uau2"><span class="inline-name svelte-f9uau2"> </span> <span class="inline-country svelte-f9uau2"> </span></div> <p class="inline-summary svelte-f9uau2"> </p> <!> <!></div>',1),ci=k('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),ui=k('<div class="inline-strip svelte-f9uau2" role="group"><!></div>'),di=k('<div class="background-placeholder svelte-f9uau2">Loading imagery‚Ä¶</div>'),vi=k('<div class="background-placeholder svelte-f9uau2"> </div>'),fi=k('<div><div class="sprite-frame svelte-f9uau2"></div> <div class="sprite-frame svelte-f9uau2"></div></div>'),pi=k('<div class="background-placeholder svelte-f9uau2">Preparing imagery‚Ä¶</div>'),bi=k('<div class="background-strip svelte-f9uau2" aria-hidden="true"><!></div>'),mi=k('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),_i=k('<p class="status error svelte-f9uau2"> </p>'),hi=k('<span class="credit svelte-f9uau2"> </span>'),gi=k('<figcaption class="svelte-f9uau2"> <!></figcaption>'),yi=k('<figure class="svelte-f9uau2"><!> <!></figure>'),wi=k('<div class="image-row svelte-f9uau2"></div>'),xi=k('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),Ei=k('<div class="image-strip svelte-f9uau2" role="group"><!></div>');function Si(b,M){_e(M,!1);const d=h(),K=h(),X=h(),U=h();let j=Wt(M,"city",8),u=Wt(M,"variant",8,"details"),J=Wt(M,"direction",8,"normal"),H=Wt(M,"showCaptions",8,!0),Mt=Wt(M,"scrollDuration",8,24);const qt=Object.create(null),$t=Object.create(null),At=Object.create(null),F=480,Y="Details available in the expanded view.",ft=1,zt={};let T=h("idle"),Z=h(null),z=h([]),Q=h([]),v=h(""),x=null,c=0,L=h({}),lt=h([]),gt=h(null),ut=h(1),pt=h(1),m=0,q="";function O(p){let f=0;for(let E=0;E<p.length;E+=1)f=(f<<5)-f+p.charCodeAt(E),f|=0;return f}function wt(p){const f=Mt()*2.5,E=p?.id;if(!E)return f;const bt=.5+Math.abs(O(E))%1e3/1e3*ft;return f*bt}function W(p){const f=p.startsWith("/")?p:`/${p}`;return ia?`${ia}${f}`:f}function xt(p){return W(`${j().images_path}/${p}`)}async function Gt(p){if(!p)return;const f=++c;if(qt[p]){i(Z,qt[p]),i(z,t(Z)?.images??[]),i(T,"ready"),i(v,""),typeof window<"u"&&Ot(t(z));return}i(v,""),i(T,"loading");try{const E=await ya(p);if(f!==c)return;qt[p]=E,i(Z,E),i(z,E.images??[]),i(T,"ready"),typeof window<"u"&&Ot(t(z))}catch(E){if(f!==c)return;i(T,"error"),i(v,E instanceof Error?E.message:"Unable to load images.")}}function D(p){const f=p?.id??null;if(!f){x!==null&&(x=null,i(Z,null),i(z,[]),i(Q,[]),i(T,"idle"),i(v,""));return}if(f===x)return;x=f;const E=qt[f];if(E){i(Z,E),i(z,E.images??[]),i(T,"ready"),i(v,""),Ct(),typeof window<"u"&&Ot(t(z));return}i(Z,null),i(z,[]),i(Q,[]),i(T,"loading"),i(v,""),Gt(f).then(Ct)}function Ct(){const p=t(z)??[],f=p.length>1?Xt(x,p):p;(u()==="inline"||u()==="background")&&f.length>0?i(Q,[...f,...f]):i(Q,f)}function Nt(p){if(!p)return 1;const f=t(L)[p]??$t[p];return f&&Number.isFinite(f)&&f>0?f:1}async function Ot(p){const f=p.filter(E=>E.image&&!$t[E.image]);f.length!==0&&(await Promise.all(f.map(E=>new Promise(P=>{const nt=new Image;nt.src=xt(E.image),nt.onload=()=>{const bt=nt.naturalHeight?nt.naturalWidth/nt.naturalHeight:1;$t[E.image]=bt>0?bt:1,P()},nt.onerror=()=>{$t[E.image]=1,P()}}))),i(L,Object.fromEntries(Object.entries($t).map(([E,P])=>[E,P&&Number.isFinite(P)&&P>0?P:1]))))}function Vt(p){const f=At[p];return f&&f.complete&&f.naturalWidth>0?Promise.resolve(f):new Promise((E,P)=>{const nt=new Image;nt.crossOrigin="anonymous",nt.decoding="async",nt.onload=()=>{At[p]=nt,E(nt)},nt.onerror=()=>{P(new Error(`Unable to load image at ${p}`))},nt.src=p})}async function It(p){const f=p.filter(I=>!!I.image);if(f.length===0)throw new Error("No image sources available for sprite generation.");const E=await Promise.all(f.map(I=>Vt(xt(I.image)))),P=F,nt=E.map(I=>I.naturalHeight?I.naturalWidth/I.naturalHeight*P:P),bt=Math.max(1,Math.round(nt.reduce((I,it)=>I+it,0))),St=document.createElement("canvas");St.width=bt,St.height=P;const dt=St.getContext("2d");if(!dt)throw new Error("Unable to obtain canvas rendering context.");let B=0;for(let I=0;I<E.length;I+=1){const it=E[I],st=nt[I];dt.drawImage(it,B,0,st,P),B+=st}let Rt="";try{Rt=St.toDataURL("image/webp",.92)}catch{Rt=""}return(!Rt||Rt==="data:,")&&(Rt=St.toDataURL("image/png")),{url:Rt,ratio:bt/P}}function Ft(p){const f=[...p];for(let E=f.length-1;E>0;E-=1){const P=Math.floor(Math.random()*(E+1));[f[E],f[P]]=[f[P],f[E]]}return f}function Xt(p,f){if(!p)return Ft(f);const E=zt[p];if(E&&E.length===f.length)return E;const P=Ft(f);return zt[p]=P,P}function Ht(){i(gt,null),i(ut,1),q=""}async function Bt(p){if(typeof window>"u"||u()!=="background")return;const f=p.length>1?Xt(x,p):p,E=f.map(nt=>nt.image??"").join("|");if(E&&E===q&&t(gt))return;if(!f.length){Ht();return}const P=++m;try{const{url:nt,ratio:bt}=await It(f);if(P!==m)return;i(gt,nt),i(ut,Number.isFinite(bt)&&bt>0?bt:1),q=E}catch(nt){if(P!==m)return;Ht(),console.warn("CityImageStrip: failed to build sprite",nt)}}va(()=>D(j())),Ae(()=>{D(j()),typeof window<"u"&&t(z).length&&Ot(t(z))}),V(()=>{},()=>{Ct()}),V(()=>t(Z),()=>{i(d,t(Z)?.summary??"")}),V(()=>t(Z),()=>{i(K,t(Z)?.seasonal_notes??"")}),V(()=>t(Z),()=>{i(X,t(Z)?.food_and_drink?.[0]??"")}),V(()=>Tt(j()),()=>{i(U,wt(j()))}),V(()=>(t(Q),t(L)),()=>{i(lt,t(Q).map(p=>(t(L),Nt(p.image))))}),V(()=>t(ut),()=>{i(pt,Number.isFinite(t(ut))&&t(ut)>0?t(ut):1)}),V(()=>(Tt(u()),t(T),t(z)),()=>{typeof window<"u"&&u()==="background"&&(t(T)==="ready"?Bt(t(z)):Ht())}),xe(),me();var Et=ne(),Dt=te(Et);{var at=p=>{var f=ui(),E=r(f);{var P=bt=>{var St=ni();y(bt,St)},nt=bt=>{var St=ne(),dt=te(St);{var B=I=>{var it=ii(),st=r(it,!0);o(it),ct(()=>rt(st,t(v))),y(I,it)},Rt=I=>{var it=ne(),st=te(it);{var Ut=mt=>{var kt=si(),Pt=te(kt);ie(Pt,5,()=>t(Q),Ze,(ot,g,A)=>{var G=oi(),tt=r(G);{let _t=Le(()=>(t(g),S(()=>xt(t(g).image)))),Lt=Le(()=>(t(g),Tt(j()),S(()=>t(g).caption??`${j().name} skyline`)));la(tt,{get src(){return t(_t)},get alt(){return t(Lt)},loading:"lazy",decoding:"async"})}o(G),ct(()=>{be(G,"aria-hidden",(t(z),S(()=>A>=t(z).length?"true":void 0))),fe(G,(t(lt),S(()=>`aspect-ratio: ${t(lt)[A]??1}`)))}),y(ot,G)}),o(Pt);var Jt=l(Pt,2),e=r(Jt),a=r(e),n=r(a,!0);o(a);var s=l(a,2),_=r(s,!0);o(s),o(e);var w=l(e,2),$=r(w,!0);o(w);var N=l(w,2);{var jt=ot=>{var g=ri(),A=r(g,!0);o(g),ct(()=>rt(A,t(K))),y(ot,g)};yt(N,ot=>{t(K)&&ot(jt)})}var C=l(N,2);{var vt=ot=>{var g=li(),A=r(g,!0);o(g),ct(()=>rt(A,t(X))),y(ot,g)};yt(C,ot=>{t(X)&&ot(vt)})}o(Jt),ct(()=>{fe(Pt,`--scroll-duration: ${t(U)}s; --scroll-direction: ${J()}`),rt(n,(Tt(j()),S(()=>j().name))),rt(_,(Tt(j()),S(()=>j().country))),rt($,t(d)||Y)}),y(mt,kt)},Kt=mt=>{var kt=ci();y(mt,kt)};yt(st,mt=>{t(Q),S(()=>t(Q).length)?mt(Ut):mt(Kt,!1)},!0)}y(I,it)};yt(dt,I=>{t(T)==="error"?I(B):I(Rt,!1)},!0)}y(bt,St)};yt(E,bt=>{t(T)==="loading"?bt(P):bt(nt,!1)})}o(f),ct(()=>be(f,"aria-label",(Tt(j()),S(()=>`Images for ${j().name}`)))),y(p,f)},Zt=p=>{var f=ne(),E=te(f);{var P=bt=>{var St=bi(),dt=r(St);{var B=I=>{var it=di();y(I,it)},Rt=I=>{var it=ne(),st=te(it);{var Ut=mt=>{var kt=vi(),Pt=r(kt,!0);o(kt),ct(()=>rt(Pt,t(v))),y(mt,kt)},Kt=mt=>{var kt=ne(),Pt=te(kt);{var Jt=a=>{var n=fi();let s;var _=r(n);let w;var $=l(_,2);let N;o(n),ct(()=>{s=Ue(n,1,"sprite-runner svelte-f9uau2",null,s,{paused:!t(gt)}),fe(n,`--scroll-duration: ${t(U)}s; --scroll-direction: ${J()==="reverse"?"reverse":"normal"};`),w=fe(_,`--sprite-ratio: ${t(pt)};`,w,{"background-image":`url("${t(gt)}")`}),N=fe($,`--sprite-ratio: ${t(pt)};`,N,{"background-image":`url("${t(gt)}")`})}),y(a,n)},e=a=>{var n=pi();y(a,n)};yt(Pt,a=>{t(gt)?a(Jt):a(e,!1)},!0)}y(mt,kt)};yt(st,mt=>{t(T)==="error"?mt(Ut):mt(Kt,!1)},!0)}y(I,it)};yt(dt,I=>{t(T)==="loading"?I(B):I(Rt,!1)})}o(St),y(bt,St)},nt=bt=>{var St=Ei(),dt=r(St);{var B=I=>{var it=mi();y(I,it)},Rt=I=>{var it=ne(),st=te(it);{var Ut=mt=>{var kt=_i(),Pt=r(kt,!0);o(kt),ct(()=>rt(Pt,t(v))),y(mt,kt)},Kt=mt=>{var kt=ne(),Pt=te(kt);{var Jt=a=>{var n=wi();ie(n,5,()=>t(z),s=>s.image,(s,_)=>{var w=yi(),$=r(w);{let C=Le(()=>(t(_),S(()=>xt(t(_).image)))),vt=Le(()=>(t(_),Tt(j()),S(()=>t(_).caption??`${j().name} skyline`)));la($,{get src(){return t(C)},get alt(){return t(vt)},loading:"lazy",decoding:"async"})}var N=l($,2);{var jt=C=>{var vt=gi(),ot=r(vt),g=l(ot);{var A=G=>{var tt=hi(),_t=r(tt);o(tt),ct(()=>rt(_t,`¬∑ ${t(_),S(()=>t(_).credit)??""}`)),y(G,tt)};yt(g,G=>{t(_),S(()=>t(_).credit)&&G(A)})}o(vt),ct(()=>rt(ot,`${t(_),S(()=>t(_).caption)??""} `)),y(C,vt)};yt(N,C=>{Tt(H()),t(_),S(()=>H()&&t(_).caption)&&C(jt)})}o(w),y(s,w)}),o(n),y(a,n)},e=a=>{var n=xi();y(a,n)};yt(Pt,a=>{t(z),S(()=>t(z).length)?a(Jt):a(e,!1)},!0)}y(mt,kt)};yt(st,mt=>{t(T)==="error"?mt(Ut):mt(Kt,!1)},!0)}y(I,it)};yt(dt,I=>{t(T)==="loading"?I(B):I(Rt,!1)})}o(St),ct(()=>be(St,"aria-label",(Tt(j()),S(()=>`Images for ${j().name}`)))),y(bt,St)};yt(E,bt=>{u()==="background"?bt(P):bt(nt,!1)},!0)}y(p,f)};yt(Dt,p=>{u()==="inline"?p(at):p(Zt,!1)})}y(b,Et),he()}var zi=k('<span class="chip svelte-jdafhq"><span class="label svelte-jdafhq">Country</span> <strong class="svelte-jdafhq"> </strong></span>'),ki=k('<span class="chip status-chip svelte-jdafhq" role="status"><span class="label svelte-jdafhq">Status</span> <strong class="svelte-jdafhq">Session cleared.</strong></span>'),ji=k('<div class="confirm-backdrop svelte-jdafhq" role="presentation"><div class="confirm-box svelte-jdafhq" role="dialog" aria-modal="true" aria-labelledby="reset-heading"><h3 id="reset-heading" class="svelte-jdafhq">Clear all saved data?</h3> <p class="svelte-jdafhq">This removes your ballot inputs and undo history from this device. You cannot undo this action.</p> <div class="confirm-actions svelte-jdafhq"><button type="button" class="danger svelte-jdafhq">Yes, clear everything</button> <button type="button" class="svelte-jdafhq">Cancel</button></div></div></div>'),qi=k('<div><!> <span class="chip chip-button static svelte-jdafhq"><span class="label svelte-jdafhq">Last saved</span> <span class="chip-content svelte-jdafhq"><span class="chip-icon svelte-jdafhq" aria-hidden="true">üíæ</span> <strong class="svelte-jdafhq"> </strong></span></span> <button type="button" class="chip chip-button svelte-jdafhq"><span class="label svelte-jdafhq"><span class="btn-icon svelte-jdafhq" aria-hidden="true">üóë</span> Reset</span> <strong class="svelte-jdafhq">Clear ballot</strong></button> <!></div> <!>',1);function $i(b,M){_e(M,!1);const d=()=>ve(Ne,"$settingsStore",X),K=()=>ve(pe,"$voteSessionStore",X),[X,U]=Qe(),j=h();let u=Wt(M,"inline",8,!1);const J=je();let H=h(!1),Mt=h(!1),qt=null,$t=h(),At=h();function F(){i(H,!0)}function Y(){i(H,!1)}function ft(){pe.clear(),xa.reset(),oe.clear(),Ne.update(q=>({...q,preferredMode:null})),i(Mt,!0),Y(),qt&&clearTimeout(qt),qt=setTimeout(()=>{i(Mt,!1)},3500),J("cleared")}Be(()=>{qt&&clearTimeout(qt)});const zt=u()?"status-inline":"status-ribbon";V(()=>d(),()=>{i($t,d())}),V(()=>K(),()=>{i(At,K())}),V(()=>t(At),()=>{i(j,t(At).lastUpdated?new Date(t(At).lastUpdated).toLocaleTimeString():"Not saved yet")}),xe(),me();var T=qi(),Z=te(T),z=r(Z);{var Q=q=>{var O=zi(),wt=l(r(O),2),W=r(wt,!0);o(wt),o(O),ct(()=>rt(W,(t($t),S(()=>t($t).countryKey)))),y(q,O)};yt(z,q=>{t($t),S(()=>t($t).countryKey)&&q(Q)})}var v=l(z,2),x=l(r(v),2),c=l(r(x),2),L=r(c,!0);o(c),o(x),o(v);var lt=l(v,2),gt=l(lt,2);{var ut=q=>{var O=ki();y(q,O)};yt(gt,q=>{t(Mt)&&q(ut)})}o(Z);var pt=l(Z,2);{var m=q=>{var O=ji(),wt=r(O),W=l(r(wt),4),xt=r(W),Gt=l(xt,2);o(W),o(wt),o(O),R("click",xt,ft),R("click",Gt,Y),y(q,O)};yt(pt,q=>{t(H)&&q(m)})}ct(()=>{Ue(Z,1,wa(zt),"svelte-jdafhq"),rt(L,t(j))}),R("click",lt,F),y(b,T),he(),U()}var Ci=k('<div class="info-chip summary-chip svelte-1mrulz2"><span aria-hidden="true">‚ÑπÔ∏è</span> </div>'),Mi=k('<div class="info-chip summary-chip error svelte-1mrulz2"><span aria-hidden="true">‚ö†</span> City insights not available.</div>'),Li=k('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üå§</span> </div>'),Ti=k('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üçΩ</span> </div>'),Ai=k('<tr class="city-row svelte-1mrulz2"><th scope="row" class="city-col svelte-1mrulz2"><div class="city-card svelte-1mrulz2"><div class="row-bg svelte-1mrulz2"><!></div> <div class="row-content svelte-1mrulz2"><div class="city-headline svelte-1mrulz2"><div class="city-title svelte-1mrulz2"><span class="city-country svelte-1mrulz2"><span class="flag svelte-1mrulz2" aria-hidden="true"> </span> </span> <span class="city-name svelte-1mrulz2"> </span></div></div> <div class="meta-stack svelte-1mrulz2"><!> <!> <!></div></div></div></th><td class="utility-col svelte-1mrulz2"><!></td><td class="probability-col svelte-1mrulz2"><div class="probability-cell svelte-1mrulz2"><div class="input-stack svelte-1mrulz2"><!> <button type="button" class="row-reset svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚ü≤</span> Reset</button></div></div></td></tr>'),Ri=k('<section class="grid-shell svelte-1mrulz2"><header class="grid-header svelte-1mrulz2"><!> <div class="toolbar svelte-1mrulz2"><!> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Ü∫</span> Undo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Üª</span> Redo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">üõ†</span> Bulk Actions</button></div></header> <div class="table-scroll svelte-1mrulz2"><table class="svelte-1mrulz2"><colgroup><col class="col-city svelte-1mrulz2"/><col class="col-utility svelte-1mrulz2"/><col class="col-probability svelte-1mrulz2"/></colgroup><thead class="svelte-1mrulz2"><tr><th scope="col" class="city-header svelte-1mrulz2">City</th><th scope="col" class="utility-header svelte-1mrulz2">Favorability</th><th scope="col" class="probability-header svelte-1mrulz2">Probability</th></tr></thead><tbody class="svelte-1mrulz2"></tbody></table></div> <!></section>');function Pi(b,M){_e(M,!1);const d=()=>ve(sa,"$citiesStore",u),K=()=>ve(Sa,"$citiesDocumentStore",u),X=()=>ve(pe,"$voteSessionStore",u),U=()=>ve(oe,"$commandHistoryStore",u),j=()=>ve(Ne,"$settingsStore",u),[u,J]=Qe(),H=Object.assign({"../data/static/meta/athens-greece.json":ja,"../data/static/meta/bangkok-thailand.json":qa,"../data/static/meta/belgrade-serbia.json":$a,"../data/static/meta/bucharest-romania.json":Ca,"../data/static/meta/budapest-hungary.json":Ma,"../data/static/meta/buenos-aires-argentina.json":La,"../data/static/meta/cairo-egypt.json":Ta,"../data/static/meta/cartagena-colombia.json":Aa,"../data/static/meta/casablanca-morocco.json":Ra,"../data/static/meta/chiang-mai-thailand.json":Pa,"../data/static/meta/delhi-india.json":Da,"../data/static/meta/doha-qatar.json":Ia,"../data/static/meta/dubai-uae.json":Na,"../data/static/meta/dublin-ireland.json":Oa,"../data/static/meta/florence-italy.json":Ba,"../data/static/meta/guadalajara-mexico.json":Ua,"../data/static/meta/hanoi-vietnam.json":Ha,"../data/static/meta/helsinki-finland.json":Va,"../data/static/meta/ho-chi-minh-city-vietnam.json":Fa,"../data/static/meta/hong-kong-hong-kong.json":Ka,"../data/static/meta/jakarta-indonesia.json":Ya,"../data/static/meta/krakow-poland.json":Wa,"../data/static/meta/lima-peru.json":Ga,"../data/static/meta/ljubljana-slovenia.json":Xa,"../data/static/meta/lyon-france.json":Ja,"../data/static/meta/madrid-spain.json":Za,"../data/static/meta/manila-philippines.json":Qa,"../data/static/meta/marrakesh-morocco.json":tn,"../data/static/meta/mendoza-argentina.json":en,"../data/static/meta/mumbai-india.json":an,"../data/static/meta/munich-germany.json":nn,"../data/static/meta/nairobi-kenya.json":on,"../data/static/meta/nicosia-cyprus.json":rn,"../data/static/meta/prague-czech-republic.json":ln,"../data/static/meta/quito-ecuador.json":sn,"../data/static/meta/rio-de-janeiro-brazil.json":cn,"../data/static/meta/rotterdam-netherlands.json":un,"../data/static/meta/santiago-chile.json":dn,"../data/static/meta/sao-paulo-brazil.json":vn,"../data/static/meta/seoul-south-korea.json":fn,"../data/static/meta/seville-spain.json":pn,"../data/static/meta/stockholm-sweden.json":bn,"../data/static/meta/taipei-taiwan.json":mn,"../data/static/meta/tashkent-uzbekistan.json":_n,"../data/static/meta/template.json":hn,"../data/static/meta/thessaloniki-greece.json":gn,"../data/static/meta/tunis-tunisia.json":yn,"../data/static/meta/vienna-austria.json":wn,"../data/static/meta/warsaw-poland.json":xn,"../data/static/meta/zagreb-croatia.json":En}),Mt=/\/meta\/([^/]+)\.json$/,qt={};for(const[a,n]of Object.entries(H)){const s=Mt.exec(a);if(!s)continue;const _=s[1],w=Ea.parse(n);qt[_]=w}const $t={Greece:"üá¨üá∑",Thailand:"üáπüá≠",Serbia:"üá∑üá∏",Argentina:"üá¶üá∑",Romania:"üá∑üá¥",Hungary:"üá≠üá∫",Egypt:"üá™üá¨",Morocco:"üá≤üá¶",Ireland:"üáÆüá™",UAE:"üá¶üá™",Italy:"üáÆüáπ",Vietnam:"üáªüá≥",Finland:"üá´üáÆ","Hong Kong":"üá≠üá∞",Peru:"üáµüá™",France:"üá´üá∑",Spain:"üá™üá∏",Philippines:"üáµüá≠",Germany:"üá©üá™",Cyprus:"üá®üáæ","Czech Republic":"üá®üáø",Brazil:"üáßüá∑",Netherlands:"üá≥üá±",Chile:"üá®üá±","South Korea":"üá∞üá∑",Sweden:"üá∏üá™",Taiwan:"üáπüáº",Uzbekistan:"üá∫üáø",Tunisia:"üáπüá≥",Croatia:"üá≠üá∑"};function At(a){return $t[a]??"üåç"}let F=h([]),Y=h({}),ft=h([]),zt=h(null),T=h(pe.getSnapshot()),Z=h({past:[],future:[]}),z=h();const Q=qt;let v=h(!1),x=h(null),c=h(!1),L=h([]),lt=h([]);const gt={},ut=["utility","probability"],pt=je();let m=h(!1),q=h(!1),O=h([]),wt=h(!1);const W="reunion-phase2:grid-order";function xt(a,n){const s=n.detail.value;Dt(a,"utility",s)}function Gt(a,n){const s=n.detail.value;Dt(a,"probability",s)}function D(){An(),i(v,!0)}function Ct(){i(v,!1),Rn()}function Nt(){if(!t(F).length)return;const a=t(F).map(n=>n.id);for(let n=a.length-1;n>0;n-=1){const s=Math.floor(Math.random()*(n+1));[a[n],a[s]]=[a[s],a[n]]}i(lt,a),Vt(a)}function Ot(){if(typeof localStorage>"u")return null;try{const a=localStorage.getItem(W);if(!a)return null;const n=JSON.parse(a);return Array.isArray(n)?n:null}catch{return null}}function Vt(a){if(!(typeof localStorage>"u"))try{localStorage.setItem(W,JSON.stringify(a))}catch{}}function It(a){return Q[a]??null}function Ft(a){const n=It(a);return n?.food_and_drink?.length?n.food_and_drink.slice(0,2).join(" ‚Ä¢ "):null}function Xt(a){return It(a)?.seasonal_notes??null}function Ht(){Nt(),pt("reset")}function Bt(a){const{actions:n}=a.detail;if(!n||n.length===0){Ct();return}const s={},_=g=>Math.max(0,Math.min(100,Math.round(g))),w=(g,A)=>{const G=s[g];if(G&&G[A]!==void 0){const Lt=G[A];return typeof Lt=="number"?Lt:0}const _t=t(T).entries[g]?.[A]??null;return typeof _t=="number"?_t:0},$=(g,A,G)=>{let tt=s[g];tt||(tt={},s[g]=tt),tt[A]=_(G)},N=t(F).map(g=>g.id),jt={};for(const g of t(F))(jt[g.continent]??=[]).push(g.id);const C=(g,A,G)=>{for(const tt of g)$(tt,A,G)},vt=(g,A,G)=>{for(const tt of g){const _t=w(tt,A);$(tt,A,_t+G)}};for(const g of n)switch(g.type){case"setAllProbabilities":C(N,"probability",g.value);break;case"setAllUtilities":C(N,"utility",g.value);break;case"adjustAllUtilities":vt(N,"utility",g.delta);break;case"adjustAllProbabilities":vt(N,"probability",g.delta);break;case"normalizeProbabilities":{const A=_(g.target),G=N.map(_t=>w(_t,"probability")),tt=G.reduce((_t,Lt)=>_t+Lt,0)/(G.length||1);if(tt===0)C(N,"probability",A);else{const _t=A/tt;G.forEach((Lt,Qt)=>{const re=_(Lt*_t);$(N[Qt],"probability",re)})}break}case"setContinentUtility":{const A=jt[g.continent]??[];C(A,"utility",g.value);break}case"adjustContinentUtility":{const A=jt[g.continent]??[];vt(A,"utility",g.delta);break}case"setContinentProbability":{const A=jt[g.continent]??[];C(A,"probability",g.value);break}case"adjustContinentProbability":{const A=jt[g.continent]??[];vt(A,"probability",g.delta);break}}const ot=[];for(const[g,A]of Object.entries(s)){const G=t(T).entries[g],tt={};let _t=!1;if(A.utility!==void 0){const Lt=_(A.utility);(G?.utility??null)!==Lt&&(tt.utility=Lt,tt.autoFilled=!1,_t=!0)}if(A.probability!==void 0){const Lt=_(A.probability);(G?.probability??null)!==Lt&&(tt.probability=Lt,_t=!0)}_t&&ot.push({cityId:g,updates:tt})}ot.length!==0&&(oe.execute({label:`Bulk actions (${ot.length} cities)`,scope:["vote"],perform:()=>{for(const{cityId:g,updates:A}of ot)pe.updateEntry(g,A)}}),za(`Applied bulk actions to ${ot.length} ${ot.length===1?"city":"cities"}.`))}function Et(a){return t(T).entries[a]??{cityId:a,utility:null,probability:null,autoFilled:!1}}function Dt(a,n,s){if((t(T).entries[a]?.[n]??null)===s)return;const $=n==="utility"?{utility:s,autoFilled:!1}:{probability:s};oe.execute({label:`${n==="utility"?"Favorability":"Probability"} ‚Üí ${a}`,scope:["vote"],perform:()=>{pe.updateEntry(a,$)}})}function at(a){t(T).entries[a]&&oe.execute({label:`Reset ${a}`,scope:["vote"],perform:()=>pe.resetCity(a)})}function Zt(a,n,s){if(!s)return;s.dataset.cityId=a,s.dataset.column=n;const _=gt[a]??{};_[n]=s,gt[a]=_}function p(a,n,s){const _=gt[a];_&&_[n]===s&&(delete _[n],gt[a]=_)}function f(a,n,s=!1){const w=gt[a]?.[n];return!w||"disabled"in w&&w.disabled?!1:(w.focus(),typeof w.select=="function"&&w.select(),s&&setTimeout(()=>{w.dispatchEvent(new CustomEvent("auto-open",{bubbles:!1}))},0),!0)}function E(a,n,s=!0){if(f(a,n,s)||!t(x))return;const _=t(x).querySelector(`tr[data-row="${a}"]`);_&&(_.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{f(a,n,s)},120))}function P(a,n,s){const _=ut.length,w=t(L).findIndex(ot=>ot.city.id===a);if(w===-1)return;const $=ut.indexOf(n);if($===-1)return;const N=w*_+$,jt=Math.min(t(L).length*_-1,Math.max(0,N+s)),C=t(L)[Math.floor(jt/_)],vt=ut[jt%_];C&&E(C.city.id,vt)}function nt(a){const{key:n}=a;if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"].includes(n))return;const s=a.target;if(!(s instanceof HTMLElement))return;const _=s.dataset.cityId,w=s.dataset.column;if(!_||!w)return;let $=t(F).findIndex(vt=>vt.id===_);if($===-1)return;let N=ut.indexOf(w);if(N===-1)return;switch(a.preventDefault(),n){case"ArrowUp":$=Math.max(0,$-1);break;case"ArrowDown":$=Math.min(t(F).length-1,$+1);break;case"ArrowLeft":N>0?N-=1:$>0&&($-=1,N=ut.length-1);break;case"ArrowRight":N<ut.length-1?N+=1:$<t(F).length-1&&($+=1,N=0);break;case"Home":N=0;break;case"End":N=ut.length-1;break}const jt=t(F)[$],C=ut[N];E(jt.id,C,!0)}function bt(a){!(a.ctrlKey||a.metaKey)||a.key.toLowerCase()!=="z"||(a.preventDefault(),a.shiftKey?oe.redo():oe.undo())}function St(){oe.undo()}function dt(){oe.redo()}Ae(()=>(window.addEventListener("keydown",bt),Nt(),()=>{window.removeEventListener("keydown",bt)})),V(()=>d(),()=>{i(F,d())}),V(()=>t(F),()=>{i(Y,Object.fromEntries(t(F).map(a=>[a.id,a])))}),V(()=>(t(F),t(lt),t(Y)),()=>{if(t(F).length&&t(lt).length!==t(F).length){const a=Ot();a?.length===t(F).length?i(lt,a.filter(n=>t(Y)[n])):(i(lt,t(F).map(n=>n.id)),Vt(t(lt)))}}),V(()=>(t(lt),t(Y)),()=>{i(ft,t(lt).map(a=>t(Y)[a]).filter(a=>!!a))}),V(()=>K(),()=>{i(zt,K())}),V(()=>X(),()=>{i(T,X())}),V(()=>U(),()=>{i(Z,U())}),V(()=>j(),()=>{i(z,j())}),V(()=>(t(T),t(ft),t(F)),()=>{t(T);const a=t(ft).length===t(F).length&&t(ft).length>0?t(ft):t(F);i(L,a.map((n,s)=>{const _=Et(n.id);return{city:n,entry:_,index:s,meta:It(n.id)}}))}),V(()=>t(Z),()=>{i(m,(t(Z).past??[]).length>0)}),V(()=>t(Z),()=>{i(q,(t(Z).future??[]).length>0)}),V(()=>(t(z),t(c)),()=>{i(wt,!!t(z)?.countryKey&&!t(c))}),V(()=>(t(zt),t(F)),()=>{i(O,t(zt)?.continents?.length?[...t(zt).continents]:Array.from(new Set(t(F).map(a=>a.continent))).sort())}),xe(),me();var B=Ri(),Rt=r(B),I=r(Rt);$i(I,{inline:!0,$$events:{cleared:Ht}});var it=l(I,2),st=r(it);ei(st,{});var Ut=l(st,2),Kt=l(Ut,2),mt=l(Kt,2);o(it),o(Rt);var kt=l(Rt,2),Pt=r(kt),Jt=l(r(Pt),2);ie(Jt,5,()=>t(L),a=>a.city.id,(a,n)=>{var s=Ai(),_=r(s),w=r(_),$=r(w),N=r($);{let et=Le(()=>(t(n),S(()=>t(n).index%2===0?"normal":"reverse")));Si(N,{get city(){return t(n),S(()=>t(n).city)},variant:"background",get direction(){return t(et)}})}o($);var jt=l($,2),C=r(jt),vt=r(C),ot=r(vt),g=r(ot),A=r(g,!0);o(g);var G=l(g);o(ot);var tt=l(ot,2),_t=r(tt,!0);o(tt),o(vt),o(C);var Lt=l(C,2),Qt=r(Lt);{var re=et=>{var Yt=Ci(),de=l(r(Yt));o(Yt),ct(()=>rt(de,` ${t(n),S(()=>t(n).meta.summary)??""}`)),y(et,Yt)},le=et=>{var Yt=Mi();y(et,Yt)};yt(Qt,et=>{t(n),S(()=>t(n).meta)?et(re):et(le,!1)})}var ee=l(Qt,2);{var se=et=>{var Yt=Li(),de=l(r(Yt));o(Yt),ct(ge=>rt(de,` ${ge??""}`),[()=>(t(n),S(()=>Xt(t(n).city.id)))]),y(et,Yt)};yt(ee,et=>{t(n),S(()=>Xt(t(n).city.id))&&et(se)})}var ce=l(ee,2);{var ue=et=>{var Yt=Ti(),de=l(r(Yt));o(Yt),ct(ge=>rt(de,` ${ge??""}`),[()=>(t(n),S(()=>Ft(t(n).city.id)))]),y(et,Yt)};yt(ce,et=>{t(n),S(()=>Ft(t(n).city.id))&&et(ue)})}o(Lt),o(jt),o(w),o(_);var ae=l(_),Re=r(ae);qn(Re,{get value(){return t(n),S(()=>t(n).entry.utility)},$$events:{commit:et=>xt(t(n).city.id,et),register:et=>Zt(t(n).city.id,"utility",et.detail.element),unregister:et=>p(t(n).city.id,"utility",et.detail.element),advance:et=>P(t(n).city.id,"utility",et.detail?.direction??1,et.detail?.open??!0)}}),o(ae);var qe=l(ae),$e=r(qe),Ee=r($e),Se=r(Ee);Ln(Se,{get value(){return t(n),S(()=>t(n).entry.probability)},$$events:{commit:et=>Gt(t(n).city.id,et),register:et=>Zt(t(n).city.id,"probability",et.detail.element),unregister:et=>p(t(n).city.id,"probability",et.detail.element),advance:et=>P(t(n).city.id,"probability",et.detail?.direction??1,et.detail?.open??!0)}});var He=l(Se,2);o(Ee),o($e),o(qe),o(s),ct(et=>{be(s,"data-row",(t(n),S(()=>t(n).city.id))),rt(A,et),rt(G,` ${t(n),S(()=>t(n).city.country)??""}`),rt(_t,(t(n),S(()=>t(n).city.name)))},[()=>(t(n),S(()=>At(t(n).city.country)))]),R("click",He,()=>at(t(n).city.id)),y(a,s)}),o(Jt),o(Pt),o(kt),we(kt,a=>i(x,a),()=>t(x));var e=l(kt,2);On(e,{get open(){return t(v)},get continents(){return t(O)},$$events:{cancel:Ct,apply:Bt}}),o(B),ct(()=>{Ut.disabled=!t(m),Kt.disabled=!t(q)}),R("click",Ut,St),R("click",Kt,dt),R("click",mt,D),R("keydown",Pt,nt),y(b,B),he(),J()}var Di=k(`<section class="hero svelte-yczqw6"><h1 class="svelte-yczqw6">Phase 2 Ballot Guide</h1> <p class="lede svelte-yczqw6">Record personal utility U(c) on a 0‚Äì100 scale for each finalist city and estimate your attendance probability P(c) as a percentage. Everything stays local until you export the JSON ballot.</p> <section class="phase-cards svelte-yczqw6"><article class="svelte-yczqw6"><h2>Phase 0 ¬∑ Externality</h2> <ul class="svelte-yczqw6"><li>Each voter valued a hypothetical ‚Äú+1 extra attendee.‚Äù</li> <li>Responses combined via 10% trimmed mean (median fallback if &lt;10 voters).</li> <li class="svelte-yczqw6">The shared externality constant is <strong class="svelte-yczqw6">E = 24.4</strong>.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 1 ¬∑ Pruning</h2> <ul class="svelte-yczqw6"><li>A binary vote trimmed 86 nominees down to the top 37 (plus ties).</li> <li>That survivor list became the finalist pool you are filling out now.</li> <li>Round totals (S1) were published for transparency.</li></ul></article> <article class="current svelte-yczqw6"><h2>Phase 2 ¬∑ Your Ballot</h2> <span class="current-tag svelte-yczqw6">Current step</span> <ul class="svelte-yczqw6"><li>Enter personal utility U(c) for every finalist.</li> <li>Estimate attendance probability P(c); values are not auto-normalized.</li> <li>Export JSON mirrors these entries exactly for Phase 3 submission.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 3 ¬∑ Aggregation</h2> <ul class="svelte-yczqw6"><li>Coordinators aggregate attendance (Att) and expected utility (EU) across ballots.</li> <li>TEW(c) = EU(c) + (24.4 √ó N) √ó Att(c); highest TEW wins after tie-breakers.</li> <li>Tie-break order: higher Att, higher median U among P‚â•50%, higher overall median U.</li></ul></article></section> <section class="framework svelte-yczqw6"><h3 class="svelte-yczqw6">Total Expected Welfare snapshot</h3> <pre class="svelte-yczqw6">TEW(c) = EU(c) + (24.4 √ó N) √ó Att(c)</pre> <p>Att(c) is the expected attendee count (Œ£ P_i(c)/100) and EU(c) is the expected personal utility (Œ£ (P_i(c)/100) √ó U_i(c)). During Phase 3 the coordinators compute these values from the exported ballots and publish the full scoring table.</p> <h3 class="svelte-yczqw6">Next-year accountability</h3> <p>If a voter reports a high probability for the winning city but skips the reunion without force-majeure proof, next year's ballot is scaled by 1 ‚àí P<sub>winning</sub>/200. Accurate percentages keep your future weight intact.</p></section> <footer class="modal-footer svelte-yczqw6"><button type="button" class="primary svelte-yczqw6">Start filling the grid</button></footer></section>`);function Ii(b,M){_e(M,!1);let d=Wt(M,"open",8,!1);const K=je();function X(){K("close")}me();var U=ne(),j=te(U);{var u=J=>{var H=Di(),Mt=l(r(H),8),qt=r(Mt);o(Mt),o(H),R("click",qt,X),y(J,H)};yt(j,J=>{d()&&J(u)})}y(b,U),he()}var Ni=k('<div class="page-container svelte-1uha8ag"><!></div>');function Ko(b,M){_e(M,!1);const d="reunion-phase2:phase-explainer-dismissed:v1",K="v1",X=Date.UTC(2025,10,28,21,0,0);let U=h(!1),j=At(X-Date.now()),u=F(j),J=h(Y(u)),H=null;Ae(()=>{Ne.update(Q=>Q.preferredMode==="grid"?Q:{...Q,preferredMode:"grid"}),typeof pe.setMode=="function"&&pe.setMode("grid");const z=localStorage.getItem(d);i(U,z!==K),Ge.set(t(U)),$t(),H=setInterval($t,3e4)}),Be(()=>{H&&(clearInterval(H),H=null)});function Mt(){i(U,!1),localStorage.setItem(d,K),requestAnimationFrame(()=>window.scrollTo({top:0,behavior:"smooth"})),Ge.set(!1)}function qt(){localStorage.removeItem(d),i(U,!0),Ge.set(!0)}function $t(){const z=X-Date.now();j=At(z),u=F(j),i(J,Y(u))}function At(z){if(z<=0)return"Voting closed";const Q=Math.max(0,Math.floor(z/6e4)),v=Math.floor(Q/1440),x=Math.floor((Q-v*24*60)/60),c=Q%60,L=String(x).padStart(2,"0"),lt=String(c).padStart(2,"0");return`${v}d ${L}:${lt}`}function F(z){return z==="Voting closed"?z:`Voting ends in ${z} GMT`}function Y(z){const Q="Reunion 2026 ‚Äî Lightning Grid";return z?`${Q} (${z})`:Q}me();var ft=Ni();ka("1uha8ag",z=>{ct(()=>_a.title=t(J)??"")});var zt=r(ft);{var T=z=>{Ii(z,{open:!0,$$events:{close:Mt}})},Z=z=>{Pi(z,{$$events:{reset:qt}})};yt(zt,z=>{t(U)?z(T):z(Z,!1)})}o(ft),y(b,ft),he()}export{Ko as component};
