import{f as j,g as D,s as nt,a as y,b as ee,d as ce,e as Je,r as da}from"../chunks/DscdaUK8.js";import{i as fe}from"../chunks/tUnkN8nb.js";import{c as ze,a as Ze,b as va,o as Qe}from"../chunks/DX2lUfdR.js";import{e as he,u as k,aN as fa,N as Ce,a9 as Le,V as pa,r as ba,aO as ma,v as pe,ac as H,a as t,a7 as w,s as a,C as Pt,ad as ye,z as r,A as i,y as s,w as vt,x as be,aa as te,aP as Re,aQ as Ee,d as Ae,ae as _a}from"../chunks/CtXWJ4Rl.js";import{i as gt}from"../chunks/j1nT2hqj.js";import{s as ve,b as ae,c as Ue,a as ue,j as ha,k as Pe,m as ie,n as sa,o as Xe,q as ga,u as ya,w as wa,f as Ie,v as de,x as xa,y as Sa,z as Ea,g as za,h as ka,i as Ye}from"../chunks/BU4FSgLZ.js";import ja from"../chunks/DN3J-sCw.js";import qa from"../chunks/BKbm5EfA.js";import $a from"../chunks/BvbcL8L1.js";import Ma from"../chunks/CpqWQj0X.js";import Ca from"../chunks/CMBHzUVU.js";import Aa from"../chunks/BNFRKsyx.js";import La from"../chunks/CvpCKVSJ.js";import Ta from"../chunks/DKqRZLee.js";import Ra from"../chunks/e1t1TJwC.js";import Pa from"../chunks/pOAIlSuq.js";import Da from"../chunks/CDr_-IW6.js";import Ia from"../chunks/DkwgWrlg.js";import Oa from"../chunks/BdPnv_Ww.js";import Ua from"../chunks/Wp1az9L3.js";import Ba from"../chunks/BozMgj6L.js";import Na from"../chunks/ChEK7k_d.js";import Ha from"../chunks/BT5hMKdo.js";import Va from"../chunks/DZg2n5Gj.js";import Ka from"../chunks/B--_m8y4.js";import Fa from"../chunks/BPfJ8Mnp.js";import Ya from"../chunks/BbyHsVxX.js";import Wa from"../chunks/D1dfjzr5.js";import Ga from"../chunks/sTVjfoeb.js";import Xa from"../chunks/BJv4UY2l.js";import Ja from"../chunks/DqmJETbX.js";import Za from"../chunks/Dbr1vHU4.js";import Qa from"../chunks/DIrtYIXF.js";import tn from"../chunks/ZuxV2OeQ.js";import en from"../chunks/BBQehyBW.js";import an from"../chunks/CTUHu1i9.js";import nn from"../chunks/DgcN0BtG.js";import on from"../chunks/D89J0wRi.js";import rn from"../chunks/D3GOXJB7.js";import ln from"../chunks/KMlGcXzU.js";import sn from"../chunks/hyOVM0Ug.js";import cn from"../chunks/D_zlzWZC.js";import un from"../chunks/DBEQdhVc.js";import dn from"../chunks/Kieb5-lA.js";import vn from"../chunks/nEnXKinN.js";import fn from"../chunks/t4Dmsr4x.js";import pn from"../chunks/CXnItg8R.js";import bn from"../chunks/DWD3NyID.js";import mn from"../chunks/BGVZ31-y.js";import _n from"../chunks/DK9tbYvT.js";import hn from"../chunks/9Ve3I6w0.js";import gn from"../chunks/DkuNIGT0.js";import yn from"../chunks/CuS-bfel.js";import wn from"../chunks/D7_Q8Xbe.js";import xn from"../chunks/BVE7Js9b.js";import Sn from"../chunks/B-q0s-Uw.js";import{b as ge}from"../chunks/BkcxXaB0.js";import{p as Xt,l as na}from"../chunks/CvkxTUf8.js";import{b as ia}from"../chunks/BxtykZZu.js";function Oe(f,L,u){he(()=>{var K=k(()=>L(f,u?.())||{});if(K?.destroy)return()=>K.destroy()})}function En(f,L,u=L){var K=new WeakSet;fa(f,"input",async B=>{var X=B?f.defaultValue:f.value;if(X=We(f)?Ge(X):X,u(X),Ce!==null&&K.add(Ce),await Le(),X!==(X=L())){var q=f.selectionStart,c=f.selectionEnd,J=f.value.length;if(f.value=X??"",c!==null){var Y=f.value.length;q===c&&c===J&&Y>J?(f.selectionStart=Y,f.selectionEnd=Y):(f.selectionStart=q,f.selectionEnd=Math.min(c,Y))}}}),(pa&&f.defaultValue!==f.value||k(L)==null&&f.value)&&(u(We(f)?Ge(f.value):f.value),Ce!==null&&K.add(Ce)),ba(()=>{var B=L();if(f===document.activeElement){var X=ma??Ce;if(K.has(X))return}We(f)&&B===Ge(f.value)||f.type==="date"&&!B&&!f.value||B!==f.value&&(f.value=B??"")})}function We(f){var L=f.type;return L==="number"||L==="range"}function Ge(f){return f===""?null:+f}function oa(f){return typeof f=="string"?f?document.querySelector(f):null:f??null}function ca(f,L="body"){let u=oa(L)??document.body;return u&&u.appendChild(f),{update(K){const B=oa(K)??document.body;B===u||!B||(f.parentNode&&f.parentNode.removeChild(f),B.appendChild(f),u=B)},destroy(){f.parentNode&&f.parentNode.removeChild(f)}}}var zn=j('<button type="button"> </button>'),kn=j('<div class="radial svelte-furii8"><div class="radial-label svelte-furii8"> </div> <!></div>'),jn=j('<div class="picker svelte-furii8"><button type="button" class="value-button svelte-furii8" aria-label="Utility value"><span class="value-label svelte-furii8"> </span></button> <p class="hint svelte-furii8" aria-live="polite"> </p> <!></div>');function qn(f,L){pe(L,!1);const u=w(),K=w(),B=w(),X=w();let q=Xt(L,"value",8,null),c=Xt(L,"disabled",8,!1);const J=0,Y=100,Lt=Array.from({length:11},(e,l)=>l*10),st=176,Mt=62,Ot=Lt.length;function Z(e){const l=e/Ot*Math.PI*2-Math.PI/2,b=Math.cos(l)*Mt,P=Math.sin(l)*Mt;return`translate(calc(-50% + ${b}px), calc(-50% + ${P}px))`}const it=120,St=120,At=250,T=12,ct="[data-result-pane]",V=ze();let $=w(!1),S=w(null),m=w(void 0),h=w(null),Q=w(null),ht=w(""),bt=!1,tt=0,p=w(null),ot=null,C=!1,F=0,lt=null;const yt=e=>typeof e=="number"?e.toString().padStart(2,"0"):"??";function kt(e){return V("register",{element:e}),{destroy(){V("unregister",{element:e})}}}function Et(e){V("commit",{value:e})}function rt(e){if(c())return;ut(!0);const l=typeof t(u)=="number"?t(u):0,b=Math.min(Y,Math.max(J,l+e));a(m,b),Et(b)}function Ut(e){if(c())return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t($)){if(wt(l))return;e.preventDefault();return}if(!C&&l>St){C=!0,N(!1);return}if(C)return;e.preventDefault();const b=e.ctrlKey?10:e.shiftKey?5:1;for(tt+=e.deltaY;tt<=-it;)rt(b),tt+=it;for(;tt>=it;)rt(-b),tt-=it}function Nt(e){if(c())return;const l=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(p)!==null?et():t($)&&N(!1),V("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t($)&&N(!1),V("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),N(!0);break;case"Escape":t($)?(e.preventDefault(),N(!1)):t(p)!==null&&(e.preventDefault(),ut(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),rt(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),rt(e.shiftKey?-5:-1);break;case"Backspace":(t(p)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),z());break;case"Delete":(t(p)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),I());break;default:l&&(e.preventDefault(),e.stopPropagation(),d(e.key))}}function Dt(e){if(!t($))return;const l=e.target;t(h)?.contains(l)||t(Q)?.contains(l)||N(!1)}function Kt(e){t($)&&e.key==="Escape"&&(e.preventDefault(),N(!1))}function Bt(e){if(!t($))return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);wt(l)}function Zt(){bt||(window.addEventListener("pointerdown",Dt,!0),window.addEventListener("keydown",Kt,!0),window.addEventListener("wheel",Bt,{passive:!0}),window.addEventListener("scroll",It,!0),window.addEventListener("resize",It,!0),bt=!0)}function Ht(){bt&&(window.removeEventListener("pointerdown",Dt,!0),window.removeEventListener("keydown",Kt,!0),window.removeEventListener("wheel",Bt),window.removeEventListener("scroll",It,!0),window.removeEventListener("resize",It,!0),bt=!1)}async function It(){await Qt()}async function Qt(){if(!t($)||!t(h)||(await Le(),!t($)||!t(h)))return;const e=t(h).getBoundingClientRect(),l=st,b=l/2;let P=e.top+e.height/2,o=e.left+e.width/2;const n=T,v=jt(),x=window.innerHeight-v-T,U=T,E=window.innerWidth-T,O=P-b,xt=P+b,dt=o-b,$t=o+b;let at=0;O<n?at=O-n:xt>x&&(at=xt-x);let g=0;if(dt<U?g=dt-U:$t>E&&(g=$t-E),(g!==0||at!==0)&&(window.scrollBy({top:at,left:g,behavior:"auto"}),await Le(),!t($)||!t(h)))return;const A=t(h).getBoundingClientRect();P=A.top+A.height/2,o=A.left+A.width/2;const pt=T+b,mt=window.innerHeight-v-T-b,Ct=T+b,Rt=window.innerWidth-T-b;P=Math.min(Math.max(P,pt),mt),o=Math.min(Math.max(o,Ct),Rt);const Jt=t(Q)?.offsetParent instanceof HTMLElement?t(Q).offsetParent.getBoundingClientRect():null,oe=Jt?.top??0,re=Jt?.left??0,ne=P-oe,le=o-re;a(ht,`top:${Math.round(ne)}px;left:${Math.round(le)}px;--overlay-size:${l}px;`)}function jt(){const e=document.querySelector(ct);if(!e)return 0;const l=e.getBoundingClientRect();if(l.top>=window.innerHeight)return 0;const b=Math.min(l.height,Math.max(0,window.innerHeight-Math.max(l.top,0)));return Math.max(0,b)}function N(e){if(c())return;const l=e??!t($);l!==t($)&&(a($,l),t($)?(C=!1,ft(),a(p,null),ot=null,a(S,typeof t(u)=="number"?t(u):null),a(m,void 0),tt=0,Zt(),Qt()):(a(S,null),a(ht,""),Ht(),ft()))}function Ft(e){c()||(a(p,null),ot=null,a(m,e),Et(e),a(S,e),N(!1))}Ze(()=>{Ht(),ft()});function Vt(){t(p)===null&&(ot=typeof t(u)=="number"?t(u):q()??null,typeof t(u)=="number"?a(p,t(u).toString()):typeof ot=="number"?a(p,ot.toString()):a(p,""))}function _(e){const l=e.replace(/\D/g,"").slice(0,3);if(l.length===0){a(p,""),a(m,null),Et(null);return}const b=Number.parseInt(l,10),P=b>Y?Y:b;if(b>Y&&l.length>0){a(p,String(Math.floor(b/10))),a(m,Number.parseInt(t(p),10)),Et(t(m));return}a(p,P.toString()),a(m,P),Et(P)}function d(e){Vt();const l=t(p)??"",b=l+e,P=Number.parseInt(b,10);!Number.isNaN(P)&&P>Y&&l!==""||_(b)}function z(){Vt();const e=t(p)??"";if(e.length===0){a(p,""),a(m,null),Et(null);return}_(e.slice(0,-1))}function I(){Vt(),a(p,""),a(m,null),Et(null)}function et(){t(p)!==null&&(a(p,null),ot=null)}function ut(e){if(t(p)===null)return;const l=ot;a(p,null),ot=null,!e&&l!==q()?(a(m,l??null),Et(l??null)):e||a(m,void 0)}function ft(){F=0,lt&&(clearTimeout(lt),lt=null)}function wt(e){return t($)?(F+=e,lt&&clearTimeout(lt),lt=window.setTimeout(()=>{F=0,lt=null},At),F>=St?(C||(C=!0),N(!1),ft(),!0):!1):!1}H(()=>(t(m),Pt(q())),()=>{t(m)!==void 0&&q()===t(m)&&a(m,void 0)}),H(()=>(t(m),Pt(q())),()=>{a(u,t(m)===void 0?q():t(m))}),H(()=>(Pt(c()),t(u)),()=>{a(K,c()?"disabled":t(u)===null?"empty":t(u)<J||t(u)>Y?"invalid":"valid")}),H(()=>t(K),()=>{a(B,t(K)==="invalid"?"Keep between 0 and 100.":"")}),H(()=>(t(p),t(u)),()=>{a(X,t(p)!==null?t(p)===""?"??":t(p):yt(t(u)))}),ye(),fe();var M=jn(),W=r(M),R=r(W),qt=r(R,!0);i(R),i(W),he(()=>D("click",W,()=>N())),he(()=>D("keydown",W,Nt)),he(()=>D("auto-open",W,()=>N(!0))),Oe(W,e=>kt?.(e)),ge(W,e=>a(h,e),()=>t(h));var Tt=s(W,2),Yt=r(Tt,!0);i(Tt);var Wt=s(Tt,2);{var zt=e=>{var l=kn(),b=r(l),P=r(b,!0);i(b);var o=s(b,2);ae(o,3,()=>Lt,n=>n,(n,v,x,U)=>{var E=zn();let O;var xt=r(E);i(E),vt(dt=>{O=Ue(E,1,"radial-option svelte-furii8",null,O,{selected:t(u)===t(v),hovered:t(S)===t(v)}),ue(E,dt),nt(xt,`${t(v)??""}%`)},[()=>(Pt(t(x)),k(()=>`transform: ${Z(t(x))}`))]),D("pointerenter",E,()=>a(S,t(v))),D("focus",E,()=>a(S,t(v))),D("pointerleave",E,()=>a(S,null)),D("blur",E,()=>a(S,null)),D("click",E,()=>Ft(t(v))),y(n,E)}),i(l),ge(l,n=>a(Q,n),()=>t(Q)),Oe(l,n=>ca?.(n)),vt(n=>{ue(l,t(ht)),nt(P,n)},[()=>(t(S),t(u),k(()=>yt(t(S)??t(u))))]),y(e,l)};gt(Wt,e=>{t($)&&e(zt)})}i(M),vt(()=>{ve(M,"data-state",t(K)),ve(M,"data-open",t($)),W.disabled=c(),nt(qt,t(X)),nt(Yt,t(B))}),D("wheel",M,Ut),y(f,M),be()}var $n=j('<button type="button"> </button>'),Mn=j('<div class="radial svelte-cojlv"><div class="radial-label svelte-cojlv"> </div> <!></div>'),Cn=j('<div class="picker svelte-cojlv"><button type="button" class="value-button svelte-cojlv" aria-label="Attendance probability"><span class="value-label svelte-cojlv"> </span></button> <p class="hint svelte-cojlv" aria-live="polite"> </p> <!></div>');function An(f,L){pe(L,!1);const u=w(),K=w(),B=w(),X=w();let q=Xt(L,"value",8,null),c=Xt(L,"disabled",8,!1);const J=0,Y=100,Lt=Array.from({length:11},(e,l)=>l*10),st=176,Mt=62,Ot=Lt.length,Z=120,it=120,St=250,At=12,T="[data-result-pane]";function ct(e){const l=e/Ot*Math.PI*2-Math.PI/2,b=Math.cos(l)*Mt,P=Math.sin(l)*Mt;return`translate(calc(-50% + ${b}px), calc(-50% + ${P}px))`}const V=ze();let $=w(!1),S=w(null),m=w(void 0),h=w(null),Q=w(null),ht=w(""),bt=!1,tt=0,p=w(null),ot=null,C=!1,F=0,lt=null;const yt=e=>typeof e=="number"?`${e.toString().padStart(2,"0")}%`:"??%";function kt(e){return V("register",{element:e}),{destroy(){V("unregister",{element:e})}}}function Et(e){V("commit",{value:e})}function rt(e){if(c())return;ut(!0);const l=typeof t(u)=="number"?t(u):0,b=Math.min(Y,Math.max(J,l+e));a(m,b),Et(b)}function Ut(e){if(c())return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);if(t($)){if(wt(l))return;e.preventDefault();return}if(!C&&l>it){C=!0,N(!1);return}if(C)return;e.preventDefault();const b=e.ctrlKey?10:e.shiftKey?5:1;for(tt+=e.deltaY;tt<=-Z;)rt(b),tt+=Z;for(;tt>=Z;)rt(-b),tt-=Z}function Nt(e){if(c())return;const l=e.key.length===1&&e.key>="0"&&e.key<="9";switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),t(p)!==null?et():t($)&&N(!1),V("advance",{direction:1});break;case"Tab":e.preventDefault(),e.stopPropagation(),t($)&&N(!1),V("advance",{direction:e.shiftKey?-1:1});break;case" ":e.preventDefault(),e.stopPropagation(),N(!0);break;case"Escape":t($)?(e.preventDefault(),N(!1)):t(p)!==null&&(e.preventDefault(),ut(!1));break;case"ArrowUp":case"ArrowRight":e.preventDefault(),e.stopPropagation(),rt(e.shiftKey?5:1);break;case"ArrowDown":case"ArrowLeft":e.preventDefault(),e.stopPropagation(),rt(e.shiftKey?-5:-1);break;case"Backspace":(t(p)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),z());break;case"Delete":(t(p)!==null||typeof t(u)=="number"||t(u)===null)&&(e.preventDefault(),e.stopPropagation(),I());break;default:l&&(e.preventDefault(),e.stopPropagation(),d(e.key))}}function Dt(e){if(!t($))return;const l=e.target;t(h)?.contains(l)||t(Q)?.contains(l)||N(!1)}function Kt(e){t($)&&e.key==="Escape"&&(e.preventDefault(),N(!1))}function Bt(e){if(!t($))return;const l=Math.abs(e.deltaY)+Math.abs(e.deltaX);wt(l)}function Zt(){bt||(window.addEventListener("pointerdown",Dt,!0),window.addEventListener("keydown",Kt,!0),window.addEventListener("wheel",Bt,{passive:!0}),window.addEventListener("scroll",It,!0),window.addEventListener("resize",It,!0),bt=!0)}function Ht(){bt&&(window.removeEventListener("pointerdown",Dt,!0),window.removeEventListener("keydown",Kt,!0),window.removeEventListener("wheel",Bt),window.removeEventListener("scroll",It,!0),window.removeEventListener("resize",It,!0),bt=!1)}async function It(){await Qt()}async function Qt(){if(!t($)||!t(h)||(await Le(),!t($)||!t(h)))return;const e=t(h).getBoundingClientRect(),l=st,b=l/2;let P=e.top+e.height/2,o=e.left+e.width/2;const n=At,v=jt(),x=window.innerHeight-v-At,U=At,E=window.innerWidth-At,O=P-b,xt=P+b,dt=o-b,$t=o+b;let at=0;O<n?at=O-n:xt>x&&(at=xt-x);let g=0;if(dt<U?g=dt-U:$t>E&&(g=$t-E),(g!==0||at!==0)&&(window.scrollBy({top:at,left:g,behavior:"auto"}),await Le(),!t($)||!t(h)))return;const A=t(h).getBoundingClientRect();P=A.top+A.height/2,o=A.left+A.width/2;const pt=At+b,mt=window.innerHeight-v-At-b,Ct=At+b,Rt=window.innerWidth-At-b;P=Math.min(Math.max(P,pt),mt),o=Math.min(Math.max(o,Ct),Rt);const Jt=t(Q)?.offsetParent instanceof HTMLElement?t(Q).offsetParent.getBoundingClientRect():null,oe=Jt?.top??0,re=Jt?.left??0,ne=P-oe,le=o-re;a(ht,`top:${Math.round(ne)}px;left:${Math.round(le)}px;--overlay-size:${l}px;`)}function jt(){const e=document.querySelector(T);if(!e)return 0;const l=e.getBoundingClientRect();if(l.top>=window.innerHeight)return 0;const b=Math.min(l.height,Math.max(0,window.innerHeight-Math.max(l.top,0)));return Math.max(0,b)}function N(e){if(c())return;const l=e??!t($);l!==t($)&&(a($,l),t($)?(C=!1,ft(),a(p,null),ot=null,a(S,t(u)),a(m,void 0),tt=0,Zt(),Qt()):(a(S,null),a(ht,""),Ht(),ft()))}function Ft(e){c()||(a(p,null),ot=null,a(m,e),Et(e),a(S,e),N(!1))}Ze(()=>{Ht(),ft()});function Vt(){t(p)===null&&(ot=typeof t(u)=="number"?t(u):q()??null,typeof t(u)=="number"?a(p,t(u).toString()):typeof ot=="number"?a(p,ot.toString()):a(p,""))}function _(e){const l=e.replace(/\D/g,"").slice(0,3);if(l.length===0){a(p,""),a(m,null),Et(null);return}const b=Number.parseInt(l,10),P=b>Y?Y:b;if(b>Y&&l.length>0){a(p,String(Math.floor(b/10))),a(m,Number.parseInt(t(p),10)),Et(t(m));return}a(p,P.toString()),a(m,P),Et(P)}function d(e){Vt();const l=t(p)??"",b=l+e,P=Number.parseInt(b,10);!Number.isNaN(P)&&P>Y&&l!==""||_(b)}function z(){Vt();const e=t(p)??"";if(e.length===0){a(p,""),a(m,null),Et(null);return}_(e.slice(0,-1))}function I(){Vt(),a(p,""),a(m,null),Et(null)}function et(){t(p)!==null&&(a(p,null),ot=null)}function ut(e){if(t(p)===null)return;const l=ot;a(p,null),ot=null,!e&&l!==q()?(a(m,l??null),Et(l??null)):e||a(m,void 0)}function ft(){F=0,lt&&(clearTimeout(lt),lt=null)}function wt(e){return t($)?(F+=e,lt&&clearTimeout(lt),lt=window.setTimeout(()=>{F=0,lt=null},St),F>=it?(C||(C=!0),N(!1),ft(),!0):!1):!1}H(()=>(t(m),Pt(q())),()=>{t(m)!==void 0&&q()===t(m)&&a(m,void 0)}),H(()=>(t(m),Pt(q())),()=>{a(u,t(m)===void 0?q():t(m))}),H(()=>(Pt(c()),t(u)),()=>{a(K,c()?"disabled":t(u)===null?"empty":t(u)<J||t(u)>Y?"invalid":"valid")}),H(()=>t(K),()=>{a(B,t(K)==="invalid"?"Keep between 0 and 100%.":"")}),H(()=>(t(p),t(u)),()=>{a(X,t(p)!==null?t(p)===""?"??%":`${t(p)}%`:yt(t(u)))}),ye(),fe();var M=Cn(),W=r(M),R=r(W),qt=r(R,!0);i(R),i(W),he(()=>D("click",W,()=>N())),he(()=>D("keydown",W,Nt)),he(()=>D("auto-open",W,()=>N(!0))),Oe(W,e=>kt?.(e)),ge(W,e=>a(h,e),()=>t(h));var Tt=s(W,2),Yt=r(Tt,!0);i(Tt);var Wt=s(Tt,2);{var zt=e=>{var l=Mn(),b=r(l),P=r(b,!0);i(b);var o=s(b,2);ae(o,3,()=>Lt,n=>n,(n,v,x,U)=>{var E=$n();let O;var xt=r(E);i(E),vt(dt=>{O=Ue(E,1,"radial-option svelte-cojlv",null,O,{selected:t(u)===t(v),hovered:t(S)===t(v)}),ue(E,dt),nt(xt,`${t(v)??""}%`)},[()=>(Pt(t(x)),k(()=>`transform: ${ct(t(x))}`))]),D("pointerenter",E,()=>a(S,t(v))),D("focus",E,()=>a(S,t(v))),D("pointerleave",E,()=>a(S,null)),D("blur",E,()=>a(S,null)),D("click",E,()=>Ft(t(v))),y(n,E)}),i(l),ge(l,n=>a(Q,n),()=>t(Q)),Oe(l,n=>ca?.(n)),vt(n=>{ue(l,t(ht)),nt(P,n)},[()=>(t(S),t(u),k(()=>yt(t(S)??t(u))))]),y(e,l)};gt(Wt,e=>{t($)&&e(zt)})}i(M),vt(()=>{ve(M,"data-state",t(K)),ve(M,"data-open",t($)),W.disabled=c(),nt(qt,t(X)),nt(Yt,t(B))}),D("wheel",M,Ut),y(f,M),be()}let De=null;const Ln='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function Tn(){if(typeof document>"u")return;const f=document.activeElement;f&&typeof f.focus=="function"&&(De=f)}function Rn(){if(De){try{De.focus({preventScroll:!0})}catch{}De=null}}function ra(f){if(!f)return;const L=f.querySelector(Ln);L&&L.focus({preventScroll:!0})}var Pn=j('<p class="empty svelte-1bwzqxo">No continents detected in this dataset.</p>'),Dn=j("<option> </option>"),In=j('<div class="matrix-row svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo"> </div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div class="control-row svelte-1bwzqxo"><label><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>0</option><option>25</option><option>50</option><option>75</option><option>100</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div> <div class="control-row svelte-1bwzqxo"><label class="delta-label svelte-1bwzqxo"><span class="sr-only"> </span> <select class="svelte-1bwzqxo"><option>‚Äî</option><option>-50</option><option>-25</option><option>-10</option><option>-5</option><option>+5</option><option>+10</option><option>+25</option><option>+50</option></select></label> <button type="button" class="svelte-1bwzqxo">Apply</button></div></div></div>'),On=j('<div class="backdrop svelte-1bwzqxo" role="presentation" tabindex="-1"><div class="dialog svelte-1bwzqxo" role="dialog" aria-modal="true" aria-label="Bulk actions"><header class="svelte-1bwzqxo"><div><h2 class="svelte-1bwzqxo">Bulk Actions</h2> <p class="subtitle svelte-1bwzqxo">Trigger presets or continent tweaks without leaving the grid.</p></div> <button type="button" class="close svelte-1bwzqxo" aria-label="Close dialog">√ó</button></header> <div class="content svelte-1bwzqxo"><section class="global svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Global Overrides</h3> <div class="global-grid svelte-1bwzqxo"><fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Probabilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all to 100%</button> <button type="button" class="svelte-1bwzqxo">Set all to 50%</button> <button type="button" class="svelte-1bwzqxo">Set all to 0%</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div> <div class="normalize svelte-1bwzqxo"><span>Normalize average to</span> <input type="number" min="0" max="100" step="1" aria-label="Target mean probability"/> <span>%</span> <button type="button" class="svelte-1bwzqxo">Normalize</button></div></fieldset> <fieldset class="svelte-1bwzqxo"><legend class="svelte-1bwzqxo">Utilities</legend> <div class="button-column svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">Set all utilities to 50</button></div> <div class="button-row svelte-1bwzqxo"><button type="button" class="svelte-1bwzqxo">+10 to all</button> <button type="button" class="svelte-1bwzqxo">‚àí10 to all</button></div></fieldset></div></section> <section class="matrix svelte-1bwzqxo"><header class="matrix-head svelte-1bwzqxo"><h3 class="svelte-1bwzqxo">Per-Continent Adjustments</h3> <p class="svelte-1bwzqxo">Set specific baselines or deltas for each region.</p></header> <div class="matrix-table svelte-1bwzqxo"><div class="matrix-row matrix-header svelte-1bwzqxo"><div class="matrix-cell continent-cell svelte-1bwzqxo">Continent</div> <div class="matrix-cell utility-cell svelte-1bwzqxo"><div>Utility</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div> <div class="matrix-cell probability-cell svelte-1bwzqxo"><div>Probability</div> <div class="cell-sub svelte-1bwzqxo">Set to / Adjust by</div></div></div> <!></div></section></div> <footer class="actions svelte-1bwzqxo"><button type="button" class="secondary svelte-1bwzqxo">Close</button></footer></div></div>');function Un(f,L){pe(L,!1);let u=Xt(L,"open",8,!1),K=Xt(L,"continents",24,()=>[]);const B=ze();let X=w(null),q=w(!1),c=w([]),J=w(50);const Y=["","0","25","50","75","100"];function Lt(S){return{continent:S,utilitySet:"",utilityDelta:"",probabilitySet:"",probabilityDelta:""}}function st(S=!1){const m=new Map(t(c).map(h=>[h.continent,h]));a(c,K().map(h=>!S&&m.has(h)?{...m.get(h)}:Lt(h))),K().length===0&&a(c,[])}function Mt(){a(J,50),st(!0)}function Ot(){B("cancel")}function Z(S,m=0,h=100){return Math.max(m,Math.min(h,Math.round(S)))}function it(S){if(S.trim()==="")return null;const m=Number(S);return Number.isFinite(m)?m:null}function St(S){const m=Array.isArray(S)?S:[S];B("apply",{actions:m})}function At(S){const m=S.currentTarget,h=S.target;h&&m.contains(h)&&h!==m||Ot()}function T(S){S.key==="Escape"&&(S.preventDefault(),Ot())}H(()=>Pt(u()),()=>{a(q,u())}),H(()=>(Pt(u()),t(q)),()=>{u()&&!t(q)&&Mt()}),H(()=>(Pt(u()),t(X),ra),()=>{u()&&t(X)&&ra(t(X))}),H(()=>Pt(u()),()=>{u()&&st(!1)}),ye(),fe();var ct=ee(),V=te(ct);{var $=S=>{var m=On(),h=r(m),Q=r(h),ht=s(r(Q),2);i(Q);var bt=s(Q,2),tt=r(bt),p=s(r(tt),2),ot=r(p),C=s(r(ot),2),F=r(C),lt=s(F,2),yt=s(lt,2);i(C);var kt=s(C,2),Et=r(kt),rt=s(Et,2);i(kt);var Ut=s(kt,2),Nt=s(r(Ut),2);ha(Nt);var Dt=s(Nt,4);i(Ut),i(ot);var Kt=s(ot,2),Bt=s(r(Kt),2),Zt=r(Bt);i(Bt);var Ht=s(Bt,2),It=r(Ht),Qt=s(It,2);i(Ht),i(Kt),i(p),i(tt);var jt=s(tt,2),N=s(r(jt),2),Ft=s(r(N),2);{var Vt=I=>{var et=Pn();y(I,et)},_=I=>{var et=ee(),ut=te(et);ae(ut,3,()=>t(c),ft=>ft.continent,(ft,wt,M)=>{var W=In(),R=r(W),qt=r(R,!0);i(R);var Tt=s(R,2),Yt=r(Tt),Wt=r(Yt),zt=r(Wt),e=r(zt);i(zt);var l=s(zt,2);vt(()=>{t(c),Re(()=>{t(M)})}),ae(l,5,()=>Y,_t=>_t,(_t,Se)=>{var Me=Dn(),ua=r(Me,!0);i(Me);var aa={};vt(()=>{nt(ua,t(Se)===""?"‚Äî":t(Se)),aa!==(aa=t(Se))&&(Me.value=(Me.__value=t(Se))??"")}),y(_t,Me)}),i(l),i(Wt);var b=s(Wt,2);i(Yt);var P=s(Yt,2),o=r(P),n=r(o),v=r(n);i(n);var x=s(n,2);vt(()=>{t(c),Re(()=>{t(M)})});var U=r(x);U.value=U.__value="";var E=s(U);E.value=E.__value="-50";var O=s(E);O.value=O.__value="-25";var xt=s(O);xt.value=xt.__value="-10";var dt=s(xt);dt.value=dt.__value="-5";var $t=s(dt);$t.value=$t.__value="+5";var at=s($t);at.value=at.__value="+10";var g=s(at);g.value=g.__value="+25";var A=s(g);A.value=A.__value="+50",i(x),i(o);var pt=s(o,2);i(P),i(Tt);var mt=s(Tt,2),Ct=r(mt),Rt=r(Ct),Jt=r(Rt),oe=r(Jt);i(Jt);var re=s(Jt,2);vt(()=>{t(c),Re(()=>{t(M)})});var ne=r(re);ne.value=ne.__value="";var le=s(ne);le.value=le.__value="0";var ke=s(le);ke.value=ke.__value="25";var je=s(ke);je.value=je.__value="50";var me=s(je);me.value=me.__value="75";var Te=s(me);Te.value=Te.__value="100",i(re),i(Rt);var qe=s(Rt,2);i(Ct);var $e=s(Ct,2),we=r($e),xe=r(we),Be=r(xe);i(xe);var G=s(xe,2);vt(()=>{t(c),Re(()=>{t(M)})});var Gt=r(G);Gt.value=Gt.__value="";var se=s(Gt);se.value=se.__value="-50";var _e=s(se);_e.value=_e.__value="-25";var Ne=s(_e);Ne.value=Ne.__value="-10";var He=s(Ne);He.value=He.__value="-5";var Ve=s(He);Ve.value=Ve.__value="+5";var Ke=s(Ve);Ke.value=Ke.__value="+10";var Fe=s(Ke);Fe.value=Fe.__value="+25";var ta=s(Fe);ta.value=ta.__value="+50",i(G),i(we);var ea=s(we,2);i($e),i(mt),i(W),vt((_t,Se)=>{nt(qt,(t(wt),k(()=>t(wt).continent))),nt(e,`Set utility for ${t(wt),k(()=>t(wt).continent)??""}`),b.disabled=(t(c),Pt(t(M)),k(()=>t(c)[t(M)].utilitySet==="")),nt(v,`Adjust utility by for ${t(wt),k(()=>t(wt).continent)??""}`),pt.disabled=_t,nt(oe,`Set probability for ${t(wt),k(()=>t(wt).continent)??""}`),qe.disabled=(t(c),Pt(t(M)),k(()=>t(c)[t(M)].probabilitySet==="")),nt(Be,`Adjust probability by for ${t(wt),k(()=>t(wt).continent)??""}`),ea.disabled=Se},[()=>(t(c),Pt(t(M)),k(()=>it(t(c)[t(M)].utilityDelta)===null)),()=>(t(c),Pt(t(M)),k(()=>it(t(c)[t(M)].probabilityDelta)===null))]),Pe(l,()=>t(c)[t(M)].utilitySet,_t=>Ee(c,t(c)[t(M)].utilitySet=_t)),D("click",b,()=>{const _t=it(t(c)[t(M)].utilitySet);_t!==null&&St({type:"setContinentUtility",continent:t(wt).continent,value:Z(_t)})}),Pe(x,()=>t(c)[t(M)].utilityDelta,_t=>Ee(c,t(c)[t(M)].utilityDelta=_t)),D("click",pt,()=>{const _t=it(t(c)[t(M)].utilityDelta);_t===null||_t===0||(Ee(c,t(c)[t(M)].utilityDelta=_t>0?`+${_t}`:`${_t}`),St({type:"adjustContinentUtility",continent:t(wt).continent,delta:Math.round(_t)}))}),Pe(re,()=>t(c)[t(M)].probabilitySet,_t=>Ee(c,t(c)[t(M)].probabilitySet=_t)),D("click",qe,()=>{const _t=it(t(c)[t(M)].probabilitySet);_t!==null&&St({type:"setContinentProbability",continent:t(wt).continent,value:Z(_t)})}),Pe(G,()=>t(c)[t(M)].probabilityDelta,_t=>Ee(c,t(c)[t(M)].probabilityDelta=_t)),D("click",ea,()=>{const _t=it(t(c)[t(M)].probabilityDelta);_t===null||_t===0||(Ee(c,t(c)[t(M)].probabilityDelta=_t>0?`+${_t}`:`${_t}`),St({type:"adjustContinentProbability",continent:t(wt).continent,delta:Math.round(_t)}))}),y(ft,W)}),y(I,et)};gt(Ft,I=>{t(c),k(()=>t(c).length===0)?I(Vt):I(_,!1)})}i(N),i(jt),i(bt);var d=s(bt,2),z=r(d);i(d),i(h),ge(h,I=>a(X,I),()=>t(X)),i(m),D("click",ht,Ot),D("click",F,()=>St({type:"setAllProbabilities",value:100})),D("click",lt,()=>St({type:"setAllProbabilities",value:50})),D("click",yt,()=>St({type:"setAllProbabilities",value:0})),D("click",Et,()=>St({type:"adjustAllProbabilities",delta:10})),D("click",rt,()=>St({type:"adjustAllProbabilities",delta:-10})),En(Nt,()=>t(J),I=>a(J,I)),D("click",Dt,()=>{Number.isFinite(t(J))&&St({type:"normalizeProbabilities",target:Z(Number(t(J)))})}),D("click",Zt,()=>St({type:"setAllUtilities",value:50})),D("click",It,()=>St({type:"adjustAllUtilities",delta:10})),D("click",Qt,()=>St({type:"adjustAllUtilities",delta:-10})),D("click",z,Ot),D("click",m,At),D("keydown",m,T),y(S,m)};gt(V,S=>{u()&&S($)})}y(f,ct),be()}var Bn=j('<p class="empty svelte-h2c6bt">No commands yet.</p>'),Nn=j('<li class="svelte-h2c6bt"> </li>'),Hn=j('<ul class="diffs svelte-h2c6bt"></ul>'),Vn=j('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Kn=j('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Fn=j('<ul class="svelte-h2c6bt"></ul>'),Yn=j('<p class="empty svelte-h2c6bt">Nothing queued.</p>'),Wn=j('<li class="svelte-h2c6bt"> </li>'),Gn=j('<ul class="diffs svelte-h2c6bt"></ul>'),Xn=j('<p class="empty svelte-h2c6bt">No displayed changes</p>'),Jn=j('<li class="svelte-h2c6bt"><div class="row-head svelte-h2c6bt"><strong> </strong> <span class="meta svelte-h2c6bt"> </span></div> <!></li>'),Zn=j('<ul class="svelte-h2c6bt"></ul>'),Qn=j('<div class="history-overlay svelte-h2c6bt" role="dialog" aria-label="Command history"><section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Past</header> <!></section> <section class="svelte-h2c6bt"><header class="svelte-h2c6bt">Future</header> <!></section></div>'),ti=j('<div class="history-wrapper svelte-h2c6bt" role="group"><button type="button" class="history-button svelte-h2c6bt" aria-haspopup="dialog"><span class="btn-icon svelte-h2c6bt" aria-hidden="true">üßæ</span> <span> </span></button> <!></div>');function ei(f,L){pe(L,!1);const u=()=>ce(ie,"$commandHistoryStore",B),K=()=>ce(sa,"$citiesStore",B),[B,X]=Je();let q=w(!1),c=w(null),J=w({past:[],future:[]}),Y=w([]),Lt=w([]),st=w([]),Mt=w({});function Ot(){a(q,!0)}function Z(h){h instanceof FocusEvent&&h.currentTarget instanceof HTMLElement&&h.relatedTarget instanceof HTMLElement&&h.currentTarget.contains(h.relatedTarget)||a(q,!1)}function it(h,Q=!1){return h==null?"??":Q?`${h}%`:`${h}`}function St(h,Q){if(!h&&!Q)return[];const ht=h?.entries??{},bt=Q?.entries??{},tt=new Set([...Object.keys(ht),...Object.keys(bt)]),p=[];for(const ot of tt){const C=ht[ot]??null,F=bt[ot]??null,lt=t(Mt)[ot]?.name??ot;if(!C&&F){F.utility!==null&&p.push(`${lt} utility ${it(null)} ‚Üí ${it(F.utility)}`),F.probability!==null&&p.push(`${lt} probability ${it(null,!0)} ‚Üí ${it(F.probability,!0)}`);continue}C&&F&&(C.utility!==F.utility&&p.push(`${lt} utility ${it(C.utility)} ‚Üí ${it(F.utility)}`),C.probability!==F.probability&&p.push(`${lt} probability ${it(C.probability,!0)} ‚Üí ${it(F.probability,!0)}`)),C&&!F&&(C.utility!==null&&p.push(`${lt} utility ${it(C.utility)} ‚Üí ${it(null)}`),C.probability!==null&&p.push(`${lt} probability ${it(C.probability,!0)} ‚Üí ${it(null,!0)}`))}return p}function At(h,Q){return St(h,Q)}H(()=>u(),()=>{a(J,u())}),H(()=>t(J),()=>{a(Y,[...t(J).past??[]].slice().reverse())}),H(()=>t(J),()=>{a(Lt,t(J).future??[])}),H(()=>K(),()=>{a(st,K()??[])}),H(()=>t(st),()=>{a(Mt,Object.fromEntries(t(st).map(h=>[h.id,h])))}),ye(),fe();var T=ti(),ct=r(T),V=s(r(ct),2),$=r(V);i(V),i(ct),ge(ct,h=>a(c,h),()=>t(c));var S=s(ct,2);{var m=h=>{var Q=Qn(),ht=r(Q),bt=s(r(ht),2);{var tt=yt=>{var kt=Bn();y(yt,kt)},p=yt=>{var kt=Fn();ae(kt,5,()=>t(Y),Xe,(Et,rt)=>{var Ut=Kn(),Nt=r(Ut),Dt=r(Nt),Kt=r(Dt,!0);i(Dt);var Bt=s(Dt,2),Zt=r(Bt);i(Bt),i(Nt);var Ht=s(Nt,2);{var It=jt=>{var N=Hn();ae(N,5,()=>(t(rt),k(()=>At(t(rt).before?.vote,t(rt).after?.vote))),Ft=>Ft,(Ft,Vt)=>{var _=Nn(),d=r(_,!0);i(_),vt(()=>nt(d,t(Vt))),y(Ft,_)}),i(N),y(jt,N)},Qt=jt=>{var N=Vn();y(jt,N)};gt(Ht,jt=>{t(rt),k(()=>At(t(rt).before?.vote,t(rt).after?.vote).length)?jt(It):jt(Qt,!1)})}i(Ut),vt(jt=>{nt(Kt,(t(rt),k(()=>t(rt).label))),nt(Zt,`[${jt??""}]`)},[()=>(t(rt),k(()=>t(rt).scope.join(", ")))]),y(Et,Ut)}),i(kt),y(yt,kt)};gt(bt,yt=>{t(Y),k(()=>t(Y).length===0)?yt(tt):yt(p,!1)})}i(ht);var ot=s(ht,2),C=s(r(ot),2);{var F=yt=>{var kt=Yn();y(yt,kt)},lt=yt=>{var kt=Zn();ae(kt,5,()=>t(Lt),Xe,(Et,rt)=>{var Ut=Jn(),Nt=r(Ut),Dt=r(Nt),Kt=r(Dt,!0);i(Dt);var Bt=s(Dt,2),Zt=r(Bt);i(Bt),i(Nt);var Ht=s(Nt,2);{var It=jt=>{var N=Gn();ae(N,5,()=>(t(rt),k(()=>At(t(rt).before?.vote,t(rt).after?.vote))),Ft=>Ft,(Ft,Vt)=>{var _=Wn(),d=r(_,!0);i(_),vt(()=>nt(d,t(Vt))),y(Ft,_)}),i(N),y(jt,N)},Qt=jt=>{var N=Xn();y(jt,N)};gt(Ht,jt=>{t(rt),k(()=>At(t(rt).before?.vote,t(rt).after?.vote).length)?jt(It):jt(Qt,!1)})}i(Ut),vt(jt=>{nt(Kt,(t(rt),k(()=>t(rt).label))),nt(Zt,`[${jt??""}]`)},[()=>(t(rt),k(()=>t(rt).scope.join(", ")))]),y(Et,Ut)}),i(kt),y(yt,kt)};gt(C,yt=>{t(Lt),k(()=>t(Lt).length===0)?yt(F):yt(lt,!1)})}i(ot),i(Q),y(h,Q)};gt(S,h=>{t(q)&&h(m)})}i(T),vt(()=>{ve(ct,"aria-expanded",t(q)),nt($,`Log (${t(J),k(()=>t(J).past.length)??""})`)}),D("mouseenter",T,Ot),D("mouseleave",T,Z),D("focusin",T,Ot),D("focusout",T,Z),y(f,T),be(),X()}var ai=j("<img/>");function la(f,L){const u=na(L,["children","$$slots","$$events","$$legacy"]),K=na(u,["src","alt","loading","decoding"]);let B=Xt(L,"src",8),X=Xt(L,"alt",8),q=Xt(L,"loading",8,"lazy"),c=Xt(L,"decoding",8,"async");var J=ai();ga(J,()=>({...K,src:B(),alt:X(),loading:q(),decoding:c()})),da(J),y(f,J)}var ni=j('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),ii=j('<p class="status error svelte-f9uau2"> </p>'),oi=j('<figure class="inline-frame svelte-f9uau2"><!></figure>'),ri=j('<p class="inline-weather svelte-f9uau2"> </p>'),li=j('<p class="inline-food svelte-f9uau2"> </p>'),si=j('<div class="inline-track svelte-f9uau2"></div> <div class="inline-overlay svelte-f9uau2"><div class="inline-heading svelte-f9uau2"><span class="inline-name svelte-f9uau2"> </span> <span class="inline-country svelte-f9uau2"> </span></div> <p class="inline-summary svelte-f9uau2"> </p> <!> <!></div>',1),ci=j('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),ui=j('<div class="inline-strip svelte-f9uau2" role="group"><!></div>'),di=j('<div class="background-placeholder svelte-f9uau2">Loading imagery‚Ä¶</div>'),vi=j('<div class="background-placeholder svelte-f9uau2"> </div>'),fi=j('<div><div class="sprite-frame svelte-f9uau2"></div> <div class="sprite-frame svelte-f9uau2"></div></div>'),pi=j('<div class="background-placeholder svelte-f9uau2">Preparing imagery‚Ä¶</div>'),bi=j('<div class="background-strip svelte-f9uau2" aria-hidden="true"><!></div>'),mi=j('<p class="status svelte-f9uau2">Loading imagery‚Ä¶</p>'),_i=j('<p class="status error svelte-f9uau2"> </p>'),hi=j('<span class="credit svelte-f9uau2"> </span>'),gi=j('<figcaption class="svelte-f9uau2"> <!></figcaption>'),yi=j('<figure class="svelte-f9uau2"><!> <!></figure>'),wi=j('<div class="image-row svelte-f9uau2"></div>'),xi=j('<p class="status muted svelte-f9uau2">Images coming soon.</p>'),Si=j('<div class="image-strip svelte-f9uau2" role="group"><!></div>');function Ei(f,L){pe(L,!1);const u=w(),K=w(),B=w(),X=w();let q=Xt(L,"city",8),c=Xt(L,"variant",8,"details"),J=Xt(L,"direction",8,"normal"),Y=Xt(L,"showCaptions",8,!0),Lt=Xt(L,"scrollDuration",8,24);const st=Object.create(null),Mt=Object.create(null),Ot=Object.create(null),Z=480,it="Details available in the expanded view.",St=1,At={};let T=w("idle"),ct=w(null),V=w([]),$=w([]),S=w(""),m=null,h=0,Q=w({}),ht=w([]),bt=w(null),tt=w(1),p=w(1),ot=0,C="";function F(_){let d=0;for(let z=0;z<_.length;z+=1)d=(d<<5)-d+_.charCodeAt(z),d|=0;return d}function lt(_){const d=Lt()*2.5,z=_?.id;if(!z)return d;const ut=.5+Math.abs(F(z))%1e3/1e3*St;return d*ut}function yt(_){const d=_.startsWith("/")?_:`/${_}`;return ia?`${ia}${d}`:d}function kt(_){return yt(`${q().images_path}/${_}`)}async function Et(_){if(!_)return;const d=++h;if(st[_]){a(ct,st[_]),a(V,t(ct)?.images??[]),a(T,"ready"),a(S,""),typeof window<"u"&&Dt(t(V));return}a(S,""),a(T,"loading");try{const z=await ya(_);if(d!==h)return;st[_]=z,a(ct,z),a(V,z.images??[]),a(T,"ready"),typeof window<"u"&&Dt(t(V))}catch(z){if(d!==h)return;a(T,"error"),a(S,z instanceof Error?z.message:"Unable to load images.")}}function rt(_){const d=_?.id??null;if(!d){m!==null&&(m=null,a(ct,null),a(V,[]),a($,[]),a(T,"idle"),a(S,""));return}if(d===m)return;m=d;const z=st[d];if(z){a(ct,z),a(V,z.images??[]),a(T,"ready"),a(S,""),Ut(),typeof window<"u"&&Dt(t(V));return}a(ct,null),a(V,[]),a($,[]),a(T,"loading"),a(S,""),Et(d).then(Ut)}function Ut(){const _=t(V)??[],d=_.length>1?Ht(m,_):_;(c()==="inline"||c()==="background")&&d.length>0?a($,[...d,...d]):a($,d)}function Nt(_){if(!_)return 1;const d=t(Q)[_]??Mt[_];return d&&Number.isFinite(d)&&d>0?d:1}async function Dt(_){const d=_.filter(z=>z.image&&!Mt[z.image]);d.length!==0&&(await Promise.all(d.map(z=>new Promise(I=>{const et=new Image;et.src=kt(z.image),et.onload=()=>{const ut=et.naturalHeight?et.naturalWidth/et.naturalHeight:1;Mt[z.image]=ut>0?ut:1,I()},et.onerror=()=>{Mt[z.image]=1,I()}}))),a(Q,Object.fromEntries(Object.entries(Mt).map(([z,I])=>[z,I&&Number.isFinite(I)&&I>0?I:1]))))}function Kt(_){const d=Ot[_];return d&&d.complete&&d.naturalWidth>0?Promise.resolve(d):new Promise((z,I)=>{const et=new Image;et.crossOrigin="anonymous",et.decoding="async",et.onload=()=>{Ot[_]=et,z(et)},et.onerror=()=>{I(new Error(`Unable to load image at ${_}`))},et.src=_})}async function Bt(_){const d=_.filter(R=>!!R.image);if(d.length===0)throw new Error("No image sources available for sprite generation.");const z=await Promise.all(d.map(R=>Kt(kt(R.image)))),I=Z,et=z.map(R=>R.naturalHeight?R.naturalWidth/R.naturalHeight*I:I),ut=Math.max(1,Math.round(et.reduce((R,qt)=>R+qt,0))),ft=document.createElement("canvas");ft.width=ut,ft.height=I;const wt=ft.getContext("2d");if(!wt)throw new Error("Unable to obtain canvas rendering context.");let M=0;for(let R=0;R<z.length;R+=1){const qt=z[R],Tt=et[R];wt.drawImage(qt,M,0,Tt,I),M+=Tt}let W="";try{W=ft.toDataURL("image/webp",.92)}catch{W=""}return(!W||W==="data:,")&&(W=ft.toDataURL("image/png")),{url:W,ratio:ut/I}}function Zt(_){const d=[..._];for(let z=d.length-1;z>0;z-=1){const I=Math.floor(Math.random()*(z+1));[d[z],d[I]]=[d[I],d[z]]}return d}function Ht(_,d){if(!_)return Zt(d);const z=At[_];if(z&&z.length===d.length)return z;const I=Zt(d);return At[_]=I,I}function It(){a(bt,null),a(tt,1),C=""}async function Qt(_){if(typeof window>"u"||c()!=="background")return;const d=_.length>1?Ht(m,_):_,z=d.map(et=>et.image??"").join("|");if(z&&z===C&&t(bt))return;if(!d.length){It();return}const I=++ot;try{const{url:et,ratio:ut}=await Bt(d);if(I!==ot)return;a(bt,et),a(tt,Number.isFinite(ut)&&ut>0?ut:1),C=z}catch(et){if(I!==ot)return;It(),console.warn("CityImageStrip: failed to build sprite",et)}}va(()=>rt(q())),Qe(()=>{rt(q()),typeof window<"u"&&t(V).length&&Dt(t(V))}),H(()=>{},()=>{Ut()}),H(()=>t(ct),()=>{a(u,t(ct)?.summary??"")}),H(()=>t(ct),()=>{a(K,t(ct)?.seasonal_notes??"")}),H(()=>t(ct),()=>{a(B,t(ct)?.food_and_drink?.[0]??"")}),H(()=>Pt(q()),()=>{a(X,lt(q()))}),H(()=>(t($),t(Q)),()=>{a(ht,t($).map(_=>(t(Q),Nt(_.image))))}),H(()=>t(tt),()=>{a(p,Number.isFinite(t(tt))&&t(tt)>0?t(tt):1)}),H(()=>(Pt(c()),t(T),t(V)),()=>{typeof window<"u"&&c()==="background"&&(t(T)==="ready"?Qt(t(V)):It())}),ye(),fe();var jt=ee(),N=te(jt);{var Ft=_=>{var d=ui(),z=r(d);{var I=ut=>{var ft=ni();y(ut,ft)},et=ut=>{var ft=ee(),wt=te(ft);{var M=R=>{var qt=ii(),Tt=r(qt,!0);i(qt),vt(()=>nt(Tt,t(S))),y(R,qt)},W=R=>{var qt=ee(),Tt=te(qt);{var Yt=zt=>{var e=si(),l=te(e);ae(l,5,()=>t($),Xe,(at,g,A)=>{var pt=oi(),mt=r(pt);{let Ct=Ae(()=>(t(g),k(()=>kt(t(g).image)))),Rt=Ae(()=>(t(g),Pt(q()),k(()=>t(g).caption??`${q().name} skyline`)));la(mt,{get src(){return t(Ct)},get alt(){return t(Rt)},loading:"lazy",decoding:"async"})}i(pt),vt(()=>{ve(pt,"aria-hidden",(t(V),k(()=>A>=t(V).length?"true":void 0))),ue(pt,(t(ht),k(()=>`aspect-ratio: ${t(ht)[A]??1}`)))}),y(at,pt)}),i(l);var b=s(l,2),P=r(b),o=r(P),n=r(o,!0);i(o);var v=s(o,2),x=r(v,!0);i(v),i(P);var U=s(P,2),E=r(U,!0);i(U);var O=s(U,2);{var xt=at=>{var g=ri(),A=r(g,!0);i(g),vt(()=>nt(A,t(K))),y(at,g)};gt(O,at=>{t(K)&&at(xt)})}var dt=s(O,2);{var $t=at=>{var g=li(),A=r(g,!0);i(g),vt(()=>nt(A,t(B))),y(at,g)};gt(dt,at=>{t(B)&&at($t)})}i(b),vt(()=>{ue(l,`--scroll-duration: ${t(X)}s; --scroll-direction: ${J()}`),nt(n,(Pt(q()),k(()=>q().name))),nt(x,(Pt(q()),k(()=>q().country))),nt(E,t(u)||it)}),y(zt,e)},Wt=zt=>{var e=ci();y(zt,e)};gt(Tt,zt=>{t($),k(()=>t($).length)?zt(Yt):zt(Wt,!1)},!0)}y(R,qt)};gt(wt,R=>{t(T)==="error"?R(M):R(W,!1)},!0)}y(ut,ft)};gt(z,ut=>{t(T)==="loading"?ut(I):ut(et,!1)})}i(d),vt(()=>ve(d,"aria-label",(Pt(q()),k(()=>`Images for ${q().name}`)))),y(_,d)},Vt=_=>{var d=ee(),z=te(d);{var I=ut=>{var ft=bi(),wt=r(ft);{var M=R=>{var qt=di();y(R,qt)},W=R=>{var qt=ee(),Tt=te(qt);{var Yt=zt=>{var e=vi(),l=r(e,!0);i(e),vt(()=>nt(l,t(S))),y(zt,e)},Wt=zt=>{var e=ee(),l=te(e);{var b=o=>{var n=fi();let v;var x=r(n);let U;var E=s(x,2);let O;i(n),vt(()=>{v=Ue(n,1,"sprite-runner svelte-f9uau2",null,v,{paused:!t(bt)}),ue(n,`--scroll-duration: ${t(X)}s; --scroll-direction: ${J()==="reverse"?"reverse":"normal"};`),U=ue(x,`--sprite-ratio: ${t(p)};`,U,{"background-image":`url("${t(bt)}")`}),O=ue(E,`--sprite-ratio: ${t(p)};`,O,{"background-image":`url("${t(bt)}")`})}),y(o,n)},P=o=>{var n=pi();y(o,n)};gt(l,o=>{t(bt)?o(b):o(P,!1)},!0)}y(zt,e)};gt(Tt,zt=>{t(T)==="error"?zt(Yt):zt(Wt,!1)},!0)}y(R,qt)};gt(wt,R=>{t(T)==="loading"?R(M):R(W,!1)})}i(ft),y(ut,ft)},et=ut=>{var ft=Si(),wt=r(ft);{var M=R=>{var qt=mi();y(R,qt)},W=R=>{var qt=ee(),Tt=te(qt);{var Yt=zt=>{var e=_i(),l=r(e,!0);i(e),vt(()=>nt(l,t(S))),y(zt,e)},Wt=zt=>{var e=ee(),l=te(e);{var b=o=>{var n=wi();ae(n,5,()=>t(V),v=>v.image,(v,x)=>{var U=yi(),E=r(U);{let dt=Ae(()=>(t(x),k(()=>kt(t(x).image)))),$t=Ae(()=>(t(x),Pt(q()),k(()=>t(x).caption??`${q().name} skyline`)));la(E,{get src(){return t(dt)},get alt(){return t($t)},loading:"lazy",decoding:"async"})}var O=s(E,2);{var xt=dt=>{var $t=gi(),at=r($t),g=s(at);{var A=pt=>{var mt=hi(),Ct=r(mt);i(mt),vt(()=>nt(Ct,`¬∑ ${t(x),k(()=>t(x).credit)??""}`)),y(pt,mt)};gt(g,pt=>{t(x),k(()=>t(x).credit)&&pt(A)})}i($t),vt(()=>nt(at,`${t(x),k(()=>t(x).caption)??""} `)),y(dt,$t)};gt(O,dt=>{Pt(Y()),t(x),k(()=>Y()&&t(x).caption)&&dt(xt)})}i(U),y(v,U)}),i(n),y(o,n)},P=o=>{var n=xi();y(o,n)};gt(l,o=>{t(V),k(()=>t(V).length)?o(b):o(P,!1)},!0)}y(zt,e)};gt(Tt,zt=>{t(T)==="error"?zt(Yt):zt(Wt,!1)},!0)}y(R,qt)};gt(wt,R=>{t(T)==="loading"?R(M):R(W,!1)})}i(ft),vt(()=>ve(ft,"aria-label",(Pt(q()),k(()=>`Images for ${q().name}`)))),y(ut,ft)};gt(z,ut=>{c()==="background"?ut(I):ut(et,!1)},!0)}y(_,d)};gt(N,_=>{c()==="inline"?_(Ft):_(Vt,!1)})}y(f,jt),be()}var zi=j('<span class="chip svelte-jdafhq"><span class="label svelte-jdafhq">Country</span> <strong class="svelte-jdafhq"> </strong></span>'),ki=j('<span class="chip status-chip svelte-jdafhq" role="status"><span class="label svelte-jdafhq">Status</span> <strong class="svelte-jdafhq">Session cleared.</strong></span>'),ji=j('<div class="confirm-backdrop svelte-jdafhq" role="presentation"><div class="confirm-box svelte-jdafhq" role="dialog" aria-modal="true" aria-labelledby="reset-heading"><h3 id="reset-heading" class="svelte-jdafhq">Clear all saved data?</h3> <p class="svelte-jdafhq">This removes your ballot inputs and undo history from this device. You cannot undo this action.</p> <div class="confirm-actions svelte-jdafhq"><button type="button" class="danger svelte-jdafhq">Yes, clear everything</button> <button type="button" class="svelte-jdafhq">Cancel</button></div></div></div>'),qi=j('<div><!> <span class="chip chip-button static svelte-jdafhq"><span class="label svelte-jdafhq">Last saved</span> <span class="chip-content svelte-jdafhq"><span class="chip-icon svelte-jdafhq" aria-hidden="true">üíæ</span> <strong class="svelte-jdafhq"> </strong></span></span> <button type="button" class="chip chip-button svelte-jdafhq"><span class="label svelte-jdafhq"><span class="btn-icon svelte-jdafhq" aria-hidden="true">üóë</span> Reset</span> <strong class="svelte-jdafhq">Clear ballot</strong></button> <!></div> <!>',1);function $i(f,L){pe(L,!1);const u=()=>ce(Ie,"$settingsStore",B),K=()=>ce(de,"$voteSessionStore",B),[B,X]=Je(),q=w();let c=Xt(L,"inline",8,!1);const J=ze();let Y=w(!1),Lt=w(!1),st=null,Mt=w(),Ot=w();function Z(){a(Y,!0)}function it(){a(Y,!1)}function St(){de.clear(),xa.reset(),ie.clear(),Ie.update(C=>({...C,preferredMode:null})),a(Lt,!0),it(),st&&clearTimeout(st),st=setTimeout(()=>{a(Lt,!1)},3500),J("cleared")}Ze(()=>{st&&clearTimeout(st)});const At=c()?"status-inline":"status-ribbon";H(()=>u(),()=>{a(Mt,u())}),H(()=>K(),()=>{a(Ot,K())}),H(()=>t(Ot),()=>{a(q,t(Ot).lastUpdated?new Date(t(Ot).lastUpdated).toLocaleTimeString():"Not saved yet")}),ye(),fe();var T=qi(),ct=te(T),V=r(ct);{var $=C=>{var F=zi(),lt=s(r(F),2),yt=r(lt,!0);i(lt),i(F),vt(()=>nt(yt,(t(Mt),k(()=>t(Mt).countryKey)))),y(C,F)};gt(V,C=>{t(Mt),k(()=>t(Mt).countryKey)&&C($)})}var S=s(V,2),m=s(r(S),2),h=s(r(m),2),Q=r(h,!0);i(h),i(m),i(S);var ht=s(S,2),bt=s(ht,2);{var tt=C=>{var F=ki();y(C,F)};gt(bt,C=>{t(Lt)&&C(tt)})}i(ct);var p=s(ct,2);{var ot=C=>{var F=ji(),lt=r(F),yt=s(r(lt),4),kt=r(yt),Et=s(kt,2);i(yt),i(lt),i(F),D("click",kt,St),D("click",Et,it),y(C,F)};gt(p,C=>{t(Y)&&C(ot)})}vt(()=>{Ue(ct,1,wa(At),"svelte-jdafhq"),nt(Q,t(q))}),D("click",ht,Z),y(f,T),be(),X()}var Mi=j('<div class="info-chip summary-chip svelte-1mrulz2"><span aria-hidden="true">‚ÑπÔ∏è</span> </div>'),Ci=j('<div class="info-chip summary-chip error svelte-1mrulz2"><span aria-hidden="true">‚ö†</span> City insights not available.</div>'),Ai=j('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üå§</span> </div>'),Li=j('<div class="info-chip svelte-1mrulz2"><span aria-hidden="true">üçΩ</span> </div>'),Ti=j('<tr class="city-row svelte-1mrulz2"><th scope="row" class="city-col svelte-1mrulz2"><div class="city-card svelte-1mrulz2"><div class="row-bg svelte-1mrulz2"><!></div> <div class="row-content svelte-1mrulz2"><div class="city-headline svelte-1mrulz2"><div class="city-title svelte-1mrulz2"><span class="city-country svelte-1mrulz2"><span class="flag svelte-1mrulz2" aria-hidden="true"> </span> </span> <span class="city-name svelte-1mrulz2"> </span></div></div> <div class="meta-stack svelte-1mrulz2"><!> <!> <!></div></div></div></th><td class="utility-col svelte-1mrulz2"><!></td><td class="probability-col svelte-1mrulz2"><div class="probability-cell svelte-1mrulz2"><div class="input-stack svelte-1mrulz2"><!> <button type="button" class="row-reset svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚ü≤</span> Reset</button></div></div></td></tr>'),Ri=j('<section class="grid-shell svelte-1mrulz2"><header class="grid-header svelte-1mrulz2"><!> <div class="toolbar svelte-1mrulz2"><!> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Ü∫</span> Undo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">‚Üª</span> Redo</button> <button type="button" class="svelte-1mrulz2"><span class="btn-icon svelte-1mrulz2" aria-hidden="true">üõ†</span> Bulk Actions</button></div></header> <div class="table-scroll svelte-1mrulz2"><table class="svelte-1mrulz2"><colgroup><col class="col-city svelte-1mrulz2"/><col class="col-utility svelte-1mrulz2"/><col class="col-probability svelte-1mrulz2"/></colgroup><thead class="svelte-1mrulz2"><tr><th scope="col" class="city-header svelte-1mrulz2">City</th><th scope="col" class="utility-header svelte-1mrulz2">Utility</th><th scope="col" class="probability-header svelte-1mrulz2">Probability</th></tr></thead><tbody class="svelte-1mrulz2"></tbody></table></div> <!></section>');function Pi(f,L){pe(L,!1);const u=()=>ce(sa,"$citiesStore",c),K=()=>ce(Ea,"$citiesDocumentStore",c),B=()=>ce(de,"$voteSessionStore",c),X=()=>ce(ie,"$commandHistoryStore",c),q=()=>ce(Ie,"$settingsStore",c),[c,J]=Je(),Y=Object.assign({"../data/static/meta/athens-greece.json":ja,"../data/static/meta/bangkok-thailand.json":qa,"../data/static/meta/belgrade-serbia.json":$a,"../data/static/meta/bucharest-romania.json":Ma,"../data/static/meta/budapest-hungary.json":Ca,"../data/static/meta/buenos-aires-argentina.json":Aa,"../data/static/meta/cairo-egypt.json":La,"../data/static/meta/cartagena-colombia.json":Ta,"../data/static/meta/casablanca-morocco.json":Ra,"../data/static/meta/chiang-mai-thailand.json":Pa,"../data/static/meta/delhi-india.json":Da,"../data/static/meta/doha-qatar.json":Ia,"../data/static/meta/dubai-uae.json":Oa,"../data/static/meta/dublin-ireland.json":Ua,"../data/static/meta/florence-italy.json":Ba,"../data/static/meta/guadalajara-mexico.json":Na,"../data/static/meta/hanoi-vietnam.json":Ha,"../data/static/meta/helsinki-finland.json":Va,"../data/static/meta/ho-chi-minh-city-vietnam.json":Ka,"../data/static/meta/hong-kong-hong-kong.json":Fa,"../data/static/meta/jakarta-indonesia.json":Ya,"../data/static/meta/krakow-poland.json":Wa,"../data/static/meta/lima-peru.json":Ga,"../data/static/meta/ljubljana-slovenia.json":Xa,"../data/static/meta/lyon-france.json":Ja,"../data/static/meta/madrid-spain.json":Za,"../data/static/meta/manila-philippines.json":Qa,"../data/static/meta/marrakesh-morocco.json":tn,"../data/static/meta/mendoza-argentina.json":en,"../data/static/meta/mumbai-india.json":an,"../data/static/meta/munich-germany.json":nn,"../data/static/meta/nairobi-kenya.json":on,"../data/static/meta/nicosia-cyprus.json":rn,"../data/static/meta/prague-czech-republic.json":ln,"../data/static/meta/quito-ecuador.json":sn,"../data/static/meta/rio-de-janeiro-brazil.json":cn,"../data/static/meta/rotterdam-netherlands.json":un,"../data/static/meta/santiago-chile.json":dn,"../data/static/meta/sao-paulo-brazil.json":vn,"../data/static/meta/seoul-south-korea.json":fn,"../data/static/meta/seville-spain.json":pn,"../data/static/meta/stockholm-sweden.json":bn,"../data/static/meta/taipei-taiwan.json":mn,"../data/static/meta/tashkent-uzbekistan.json":_n,"../data/static/meta/template.json":hn,"../data/static/meta/thessaloniki-greece.json":gn,"../data/static/meta/tunis-tunisia.json":yn,"../data/static/meta/vienna-austria.json":wn,"../data/static/meta/warsaw-poland.json":xn,"../data/static/meta/zagreb-croatia.json":Sn}),Lt=/\/meta\/([^/]+)\.json$/,st={};for(const[o,n]of Object.entries(Y)){const v=Lt.exec(o);if(!v)continue;const x=v[1],U=Sa.parse(n);st[x]=U}const Mt={Greece:"üá¨üá∑",Thailand:"üáπüá≠",Serbia:"üá∑üá∏",Argentina:"üá¶üá∑",Romania:"üá∑üá¥",Hungary:"üá≠üá∫",Egypt:"üá™üá¨",Morocco:"üá≤üá¶",Ireland:"üáÆüá™",UAE:"üá¶üá™",Italy:"üáÆüáπ",Vietnam:"üáªüá≥",Finland:"üá´üáÆ","Hong Kong":"üá≠üá∞",Peru:"üáµüá™",France:"üá´üá∑",Spain:"üá™üá∏",Philippines:"üáµüá≠",Germany:"üá©üá™",Cyprus:"üá®üáæ","Czech Republic":"üá®üáø",Brazil:"üáßüá∑",Netherlands:"üá≥üá±",Chile:"üá®üá±","South Korea":"üá∞üá∑",Sweden:"üá∏üá™",Taiwan:"üáπüáº",Uzbekistan:"üá∫üáø",Tunisia:"üáπüá≥",Croatia:"üá≠üá∑"};function Ot(o){return Mt[o]??"üåç"}let Z=w([]),it=w({}),St=w([]),At=w(null),T=w(de.getSnapshot()),ct=w({past:[],future:[]}),V=w();const $=st;let S=w(!1),m=w(null),h=w(!1),Q=w([]),ht=w([]);const bt={},tt=["utility","probability"],p=ze();let ot=w(!1),C=w(!1),F=w([]),lt=w(!1);const yt="reunion-phase2:grid-order";function kt(o,n){const v=n.detail.value;N(o,"utility",v)}function Et(o,n){const v=n.detail.value;N(o,"probability",v)}function rt(){Tn(),a(S,!0)}function Ut(){a(S,!1),Rn()}function Nt(){if(!t(Z).length)return;const o=t(Z).map(n=>n.id);for(let n=o.length-1;n>0;n-=1){const v=Math.floor(Math.random()*(n+1));[o[n],o[v]]=[o[v],o[n]]}a(ht,o),Kt(o)}function Dt(){if(typeof localStorage>"u")return null;try{const o=localStorage.getItem(yt);if(!o)return null;const n=JSON.parse(o);return Array.isArray(n)?n:null}catch{return null}}function Kt(o){if(!(typeof localStorage>"u"))try{localStorage.setItem(yt,JSON.stringify(o))}catch{}}function Bt(o){return $[o]??null}function Zt(o){const n=Bt(o);return n?.food_and_drink?.length?n.food_and_drink.slice(0,2).join(" ‚Ä¢ "):null}function Ht(o){return Bt(o)?.seasonal_notes??null}function It(){Nt(),p("reset")}function Qt(o){const{actions:n}=o.detail;if(!n||n.length===0){Ut();return}const v={},x=g=>Math.max(0,Math.min(100,Math.round(g))),U=(g,A)=>{const pt=v[g];if(pt&&pt[A]!==void 0){const Rt=pt[A];return typeof Rt=="number"?Rt:0}const Ct=t(T).entries[g]?.[A]??null;return typeof Ct=="number"?Ct:0},E=(g,A,pt)=>{let mt=v[g];mt||(mt={},v[g]=mt),mt[A]=x(pt)},O=t(Z).map(g=>g.id),xt={};for(const g of t(Z))(xt[g.continent]??=[]).push(g.id);const dt=(g,A,pt)=>{for(const mt of g)E(mt,A,pt)},$t=(g,A,pt)=>{for(const mt of g){const Ct=U(mt,A);E(mt,A,Ct+pt)}};for(const g of n)switch(g.type){case"setAllProbabilities":dt(O,"probability",g.value);break;case"setAllUtilities":dt(O,"utility",g.value);break;case"adjustAllUtilities":$t(O,"utility",g.delta);break;case"adjustAllProbabilities":$t(O,"probability",g.delta);break;case"normalizeProbabilities":{const A=x(g.target),pt=O.map(Ct=>U(Ct,"probability")),mt=pt.reduce((Ct,Rt)=>Ct+Rt,0)/(pt.length||1);if(mt===0)dt(O,"probability",A);else{const Ct=A/mt;pt.forEach((Rt,Jt)=>{const oe=x(Rt*Ct);E(O[Jt],"probability",oe)})}break}case"setContinentUtility":{const A=xt[g.continent]??[];dt(A,"utility",g.value);break}case"adjustContinentUtility":{const A=xt[g.continent]??[];$t(A,"utility",g.delta);break}case"setContinentProbability":{const A=xt[g.continent]??[];dt(A,"probability",g.value);break}case"adjustContinentProbability":{const A=xt[g.continent]??[];$t(A,"probability",g.delta);break}}const at=[];for(const[g,A]of Object.entries(v)){const pt=t(T).entries[g],mt={};let Ct=!1;if(A.utility!==void 0){const Rt=x(A.utility);(pt?.utility??null)!==Rt&&(mt.utility=Rt,mt.autoFilled=!1,Ct=!0)}if(A.probability!==void 0){const Rt=x(A.probability);(pt?.probability??null)!==Rt&&(mt.probability=Rt,Ct=!0)}Ct&&at.push({cityId:g,updates:mt})}at.length!==0&&(ie.execute({label:`Bulk actions (${at.length} cities)`,scope:["vote"],perform:()=>{for(const{cityId:g,updates:A}of at)de.updateEntry(g,A)}}),za(`Applied bulk actions to ${at.length} ${at.length===1?"city":"cities"}.`))}function jt(o){return t(T).entries[o]??{cityId:o,utility:null,probability:null,autoFilled:!1}}function N(o,n,v){if((t(T).entries[o]?.[n]??null)===v)return;const E=n==="utility"?{utility:v,autoFilled:!1}:{probability:v};ie.execute({label:`${n==="utility"?"Utility":"Probability"} ‚Üí ${o}`,scope:["vote"],perform:()=>{de.updateEntry(o,E)}})}function Ft(o){t(T).entries[o]&&ie.execute({label:`Reset ${o}`,scope:["vote"],perform:()=>de.resetCity(o)})}function Vt(o,n,v){if(!v)return;v.dataset.cityId=o,v.dataset.column=n;const x=bt[o]??{};x[n]=v,bt[o]=x}function _(o,n,v){const x=bt[o];x&&x[n]===v&&(delete x[n],bt[o]=x)}function d(o,n,v=!1){const U=bt[o]?.[n];return!U||"disabled"in U&&U.disabled?!1:(U.focus(),typeof U.select=="function"&&U.select(),v&&setTimeout(()=>{U.dispatchEvent(new CustomEvent("auto-open",{bubbles:!1}))},0),!0)}function z(o,n,v=!0){if(d(o,n,v)||!t(m))return;const x=t(m).querySelector(`tr[data-row="${o}"]`);x&&(x.scrollIntoView({block:"center",behavior:"smooth"}),setTimeout(()=>{d(o,n,v)},120))}function I(o,n,v){const x=tt.length,U=t(Q).findIndex(at=>at.city.id===o);if(U===-1)return;const E=tt.indexOf(n);if(E===-1)return;const O=U*x+E,xt=Math.min(t(Q).length*x-1,Math.max(0,O+v)),dt=t(Q)[Math.floor(xt/x)],$t=tt[xt%x];dt&&z(dt.city.id,$t)}function et(o){const{key:n}=o;if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"].includes(n))return;const v=o.target;if(!(v instanceof HTMLElement))return;const x=v.dataset.cityId,U=v.dataset.column;if(!x||!U)return;let E=t(Z).findIndex($t=>$t.id===x);if(E===-1)return;let O=tt.indexOf(U);if(O===-1)return;switch(o.preventDefault(),n){case"ArrowUp":E=Math.max(0,E-1);break;case"ArrowDown":E=Math.min(t(Z).length-1,E+1);break;case"ArrowLeft":O>0?O-=1:E>0&&(E-=1,O=tt.length-1);break;case"ArrowRight":O<tt.length-1?O+=1:E<t(Z).length-1&&(E+=1,O=0);break;case"Home":O=0;break;case"End":O=tt.length-1;break}const xt=t(Z)[E],dt=tt[O];z(xt.id,dt,!0)}function ut(o){!(o.ctrlKey||o.metaKey)||o.key.toLowerCase()!=="z"||(o.preventDefault(),o.shiftKey?ie.redo():ie.undo())}function ft(){ie.undo()}function wt(){ie.redo()}Qe(()=>(window.addEventListener("keydown",ut),Nt(),()=>{window.removeEventListener("keydown",ut)})),H(()=>u(),()=>{a(Z,u())}),H(()=>t(Z),()=>{a(it,Object.fromEntries(t(Z).map(o=>[o.id,o])))}),H(()=>(t(Z),t(ht),t(it)),()=>{if(t(Z).length&&t(ht).length!==t(Z).length){const o=Dt();o?.length===t(Z).length?a(ht,o.filter(n=>t(it)[n])):(a(ht,t(Z).map(n=>n.id)),Kt(t(ht)))}}),H(()=>(t(ht),t(it)),()=>{a(St,t(ht).map(o=>t(it)[o]).filter(o=>!!o))}),H(()=>K(),()=>{a(At,K())}),H(()=>B(),()=>{a(T,B())}),H(()=>X(),()=>{a(ct,X())}),H(()=>q(),()=>{a(V,q())}),H(()=>(t(T),t(St),t(Z)),()=>{t(T);const o=t(St).length===t(Z).length&&t(St).length>0?t(St):t(Z);a(Q,o.map((n,v)=>{const x=jt(n.id);return{city:n,entry:x,index:v,meta:Bt(n.id)}}))}),H(()=>t(ct),()=>{a(ot,(t(ct).past??[]).length>0)}),H(()=>t(ct),()=>{a(C,(t(ct).future??[]).length>0)}),H(()=>(t(V),t(h)),()=>{a(lt,!!t(V)?.countryKey&&!t(h))}),H(()=>(t(At),t(Z)),()=>{a(F,t(At)?.continents?.length?[...t(At).continents]:Array.from(new Set(t(Z).map(o=>o.continent))).sort())}),ye(),fe();var M=Ri(),W=r(M),R=r(W);$i(R,{inline:!0,$$events:{cleared:It}});var qt=s(R,2),Tt=r(qt);ei(Tt,{});var Yt=s(Tt,2),Wt=s(Yt,2),zt=s(Wt,2);i(qt),i(W);var e=s(W,2),l=r(e),b=s(r(l),2);ae(b,5,()=>t(Q),o=>o.city.id,(o,n)=>{var v=Ti(),x=r(v),U=r(x),E=r(U),O=r(E);{let G=Ae(()=>(t(n),k(()=>t(n).index%2===0?"normal":"reverse")));Ei(O,{get city(){return t(n),k(()=>t(n).city)},variant:"background",get direction(){return t(G)}})}i(E);var xt=s(E,2),dt=r(xt),$t=r(dt),at=r($t),g=r(at),A=r(g,!0);i(g);var pt=s(g);i(at);var mt=s(at,2),Ct=r(mt,!0);i(mt),i($t),i(dt);var Rt=s(dt,2),Jt=r(Rt);{var oe=G=>{var Gt=Mi(),se=s(r(Gt));i(Gt),vt(()=>nt(se,` ${t(n),k(()=>t(n).meta.summary)??""}`)),y(G,Gt)},re=G=>{var Gt=Ci();y(G,Gt)};gt(Jt,G=>{t(n),k(()=>t(n).meta)?G(oe):G(re,!1)})}var ne=s(Jt,2);{var le=G=>{var Gt=Ai(),se=s(r(Gt));i(Gt),vt(_e=>nt(se,` ${_e??""}`),[()=>(t(n),k(()=>Ht(t(n).city.id)))]),y(G,Gt)};gt(ne,G=>{t(n),k(()=>Ht(t(n).city.id))&&G(le)})}var ke=s(ne,2);{var je=G=>{var Gt=Li(),se=s(r(Gt));i(Gt),vt(_e=>nt(se,` ${_e??""}`),[()=>(t(n),k(()=>Zt(t(n).city.id)))]),y(G,Gt)};gt(ke,G=>{t(n),k(()=>Zt(t(n).city.id))&&G(je)})}i(Rt),i(xt),i(U),i(x);var me=s(x),Te=r(me);qn(Te,{get value(){return t(n),k(()=>t(n).entry.utility)},$$events:{commit:G=>kt(t(n).city.id,G),register:G=>Vt(t(n).city.id,"utility",G.detail.element),unregister:G=>_(t(n).city.id,"utility",G.detail.element),advance:G=>I(t(n).city.id,"utility",G.detail?.direction??1,G.detail?.open??!0)}}),i(me);var qe=s(me),$e=r(qe),we=r($e),xe=r(we);An(xe,{get value(){return t(n),k(()=>t(n).entry.probability)},$$events:{commit:G=>Et(t(n).city.id,G),register:G=>Vt(t(n).city.id,"probability",G.detail.element),unregister:G=>_(t(n).city.id,"probability",G.detail.element),advance:G=>I(t(n).city.id,"probability",G.detail?.direction??1,G.detail?.open??!0)}});var Be=s(xe,2);i(we),i($e),i(qe),i(v),vt(G=>{ve(v,"data-row",(t(n),k(()=>t(n).city.id))),nt(A,G),nt(pt,` ${t(n),k(()=>t(n).city.country)??""}`),nt(Ct,(t(n),k(()=>t(n).city.name)))},[()=>(t(n),k(()=>Ot(t(n).city.country)))]),D("click",Be,()=>Ft(t(n).city.id)),y(o,v)}),i(b),i(l),i(e),ge(e,o=>a(m,o),()=>t(m));var P=s(e,2);Un(P,{get open(){return t(S)},get continents(){return t(F)},$$events:{cancel:Ut,apply:Qt}}),i(M),vt(()=>{Yt.disabled=!t(ot),Wt.disabled=!t(C)}),D("click",Yt,ft),D("click",Wt,wt),D("click",zt,rt),D("keydown",l,et),y(f,M),be(),J()}var Di=j(`<section class="hero svelte-yczqw6"><h1 class="svelte-yczqw6">Phase 2 Ballot Guide</h1> <p class="lede svelte-yczqw6">Record personal utility U(c) on a 0‚Äì100 scale for each finalist city and estimate your attendance probability P(c) as a percentage. Everything stays local until you export the JSON ballot.</p> <section class="phase-cards svelte-yczqw6"><article class="svelte-yczqw6"><h2>Phase 0 ¬∑ Externality</h2> <ul class="svelte-yczqw6"><li>Each voter valued a hypothetical ‚Äú+1 extra attendee.‚Äù</li> <li>Responses combined via 10% trimmed mean (median fallback if &lt;10 voters).</li> <li class="svelte-yczqw6">The shared externality constant is <strong class="svelte-yczqw6">E = 24.4</strong>.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 1 ¬∑ Pruning</h2> <ul class="svelte-yczqw6"><li>A binary vote trimmed 86 nominees down to the top 25 (plus ties).</li> <li>That survivor list became the finalist pool you are filling out now.</li> <li>Round totals (S1) were published for transparency.</li></ul></article> <article class="current svelte-yczqw6"><h2>Phase 2 ¬∑ Your Ballot</h2> <span class="current-tag svelte-yczqw6">Current step</span> <ul class="svelte-yczqw6"><li>Enter personal utility U(c) for every finalist.</li> <li>Estimate attendance probability P(c); values are not auto-normalized.</li> <li>Export JSON mirrors these entries exactly for Phase 3 submission.</li></ul></article> <article class="svelte-yczqw6"><h2>Phase 3 ¬∑ Aggregation</h2> <ul class="svelte-yczqw6"><li>Coordinators aggregate attendance (Att) and expected utility (EU) across ballots.</li> <li>TEW(c) = EU(c) + 24.4 √ó Att(c); highest TEW wins after tie-breakers.</li> <li>Tie-break order: higher Att, higher median U among P‚â•50%, higher overall median U.</li></ul></article></section> <section class="framework svelte-yczqw6"><h3 class="svelte-yczqw6">Total Expected Welfare snapshot</h3> <pre class="svelte-yczqw6">TEW(c) = EU(c) + 24.4 √ó Att(c)</pre> <p>Att(c) is the expected attendee count (Œ£ P_i(c)/100) and EU(c) is the expected personal utility (Œ£ (P_i(c)/100) √ó U_i(c)). During Phase 3 the coordinators compute these values from the exported ballots and publish the full scoring table.</p> <h3 class="svelte-yczqw6">Next-year accountability</h3> <p>If a voter reports a high probability for the winning city but skips the reunion without force-majeure proof, next year's ballot is scaled by 1 ‚àí P<sub>winning</sub>/200. Accurate percentages keep your future weight intact.</p></section> <footer class="modal-footer svelte-yczqw6"><button type="button" class="primary svelte-yczqw6">Start filling the grid</button></footer></section>`);function Ii(f,L){pe(L,!1);let u=Xt(L,"open",8,!1);const K=ze();function B(){K("close")}fe();var X=ee(),q=te(X);{var c=J=>{var Y=Di(),Lt=s(r(Y),8),st=r(Lt);i(Lt),i(Y),D("click",st,B),y(J,Y)};gt(q,J=>{u()&&J(c)})}y(f,X),be()}var Oi=j('<div class="page-container svelte-1uha8ag"><!></div>');function Fo(f,L){pe(L,!1);const u="reunion-phase2:phase-explainer-dismissed:v1",K="v1";let B=w(!1);Qe(()=>{Ie.update(Mt=>Mt.preferredMode==="grid"?Mt:{...Mt,preferredMode:"grid"}),typeof de.setMode=="function"&&de.setMode("grid");const st=localStorage.getItem(u);a(B,st!==K),Ye.set(t(B))});function X(){a(B,!1),localStorage.setItem(u,K),requestAnimationFrame(()=>window.scrollTo({top:0,behavior:"smooth"})),Ye.set(!1)}function q(){localStorage.removeItem(u),a(B,!0),Ye.set(!0)}fe();var c=Oi();ka("1uha8ag",st=>{_a.title="Reunion 2026 ‚Äî Lightning Grid"});var J=r(c);{var Y=st=>{Ii(st,{open:!0,$$events:{close:X}})},Lt=st=>{Pi(st,{$$events:{reset:q}})};gt(J,st=>{t(B)?st(Y):st(Lt,!1)})}i(c),y(f,c),be()}export{Fo as component};
